# Comparing `tmp/poetry_plugin_package_info-0.2.4.tar.gz` & `tmp/poetry_plugin_package_info-0.2.5.tar.gz`

## filetype from file(1)

```diff
@@ -1 +1 @@
-gzip compressed data, was "tmp.tar", last modified: Sun Jul  2 00:11:40 2023, max compression
+gzip compressed data, was "tmp.tar", last modified: Fri Jul 14 00:05:57 2023, max compression
```

## Comparing `poetry_plugin_package_info-0.2.4.tar` & `poetry_plugin_package_info-0.2.5.tar`

### file list

```diff
@@ -1,13 +1,13 @@
--rw-r--r--   0        0        0     1066 2023-07-02 00:11:12.483218 poetry_plugin_package_info-0.2.4/LICENSE
--rw-r--r--   0        0        0     8017 2023-07-02 00:11:12.483218 poetry_plugin_package_info-0.2.4/README.md
--rw-r--r--   0        0        0     1131 2023-07-02 00:11:12.483218 poetry_plugin_package_info-0.2.4/poetry_plugin_package_info/__init__.py
--rw-r--r--   0        0        0    95091 2023-07-02 00:11:12.487218 poetry_plugin_package_info-0.2.4/poetry_plugin_package_info/_zipfile.py
--rw-r--r--   0        0        0     1170 2023-07-02 00:11:12.487218 poetry_plugin_package_info-0.2.4/poetry_plugin_package_info/formatters/__init__.py
--rw-r--r--   0        0        0      814 2023-07-02 00:11:12.487218 poetry_plugin_package_info-0.2.4/poetry_plugin_package_info/formatters/black.py
--rw-r--r--   0        0        0     1172 2023-07-02 00:11:12.487218 poetry_plugin_package_info-0.2.4/poetry_plugin_package_info/generators/__init__.py
--rw-r--r--   0        0        0     8024 2023-07-02 00:11:12.487218 poetry_plugin_package_info-0.2.4/poetry_plugin_package_info/generators/git.py
--rw-r--r--   0        0        0     3149 2023-07-02 00:11:12.487218 poetry_plugin_package_info-0.2.4/poetry_plugin_package_info/generators/project.py
--rw-r--r--   0        0        0    37009 2023-07-02 00:11:12.487218 poetry_plugin_package_info-0.2.4/poetry_plugin_package_info/plugin.py
--rw-r--r--   0        0        0     4234 2023-07-02 00:11:12.487218 poetry_plugin_package_info-0.2.4/pyproject.toml
--rw-r--r--   0        0        0     9669 1970-01-01 00:00:00.000000 poetry_plugin_package_info-0.2.4/PKG-INFO
--rw-r--r--   0        0        0     2684 1970-01-01 00:00:00.000000 poetry_plugin_package_info/package_info.py
+-rw-r--r--   0        0        0     1066 2023-07-14 00:05:33.663848 poetry_plugin_package_info-0.2.5/LICENSE
+-rw-r--r--   0        0        0     8017 2023-07-14 00:05:33.663848 poetry_plugin_package_info-0.2.5/README.md
+-rw-r--r--   0        0        0     1131 2023-07-14 00:05:33.663848 poetry_plugin_package_info-0.2.5/poetry_plugin_package_info/__init__.py
+-rw-r--r--   0        0        0    97582 2023-07-14 00:05:33.663848 poetry_plugin_package_info-0.2.5/poetry_plugin_package_info/_zipfile.py
+-rw-r--r--   0        0        0     1170 2023-07-14 00:05:33.663848 poetry_plugin_package_info-0.2.5/poetry_plugin_package_info/formatters/__init__.py
+-rw-r--r--   0        0        0      814 2023-07-14 00:05:33.663848 poetry_plugin_package_info-0.2.5/poetry_plugin_package_info/formatters/black.py
+-rw-r--r--   0        0        0     1172 2023-07-14 00:05:33.663848 poetry_plugin_package_info-0.2.5/poetry_plugin_package_info/generators/__init__.py
+-rw-r--r--   0        0        0     8024 2023-07-14 00:05:33.663848 poetry_plugin_package_info-0.2.5/poetry_plugin_package_info/generators/git.py
+-rw-r--r--   0        0        0     3149 2023-07-14 00:05:33.663848 poetry_plugin_package_info-0.2.5/poetry_plugin_package_info/generators/project.py
+-rw-r--r--   0        0        0    37120 2023-07-14 00:05:33.663848 poetry_plugin_package_info-0.2.5/poetry_plugin_package_info/plugin.py
+-rw-r--r--   0        0        0     4234 2023-07-14 00:05:33.663848 poetry_plugin_package_info-0.2.5/pyproject.toml
+-rw-r--r--   0        0        0     9669 1970-01-01 00:00:00.000000 poetry_plugin_package_info-0.2.5/PKG-INFO
+-rw-r--r--   0        0        0     2684 1970-01-01 00:00:00.000000 poetry_plugin_package_info-0.2.5/poetry_plugin_package_info/package_info.py
```

### Comparing `poetry_plugin_package_info-0.2.4/LICENSE` & `poetry_plugin_package_info-0.2.5/LICENSE`

 * *Files identical despite different names*

### Comparing `poetry_plugin_package_info-0.2.4/README.md` & `poetry_plugin_package_info-0.2.5/README.md`

 * *Files identical despite different names*

### Comparing `poetry_plugin_package_info-0.2.4/poetry_plugin_package_info/__init__.py` & `poetry_plugin_package_info-0.2.5/poetry_plugin_package_info/__init__.py`

 * *Files identical despite different names*

### Comparing `poetry_plugin_package_info-0.2.4/poetry_plugin_package_info/_zipfile.py` & `poetry_plugin_package_info-0.2.5/poetry_plugin_package_info/_zipfile.py`

 * *Files 2% similar despite different names*

```diff
@@ -1,5944 +1,6099 @@
 00000000: 2222 220d 0a52 6561 6420 616e 6420 7772  """..Read and wr
 00000010: 6974 6520 5a49 5020 6669 6c65 732e 0d0a  ite ZIP files...
-00000020: 0d0a 5858 5820 7265 6665 7265 6e63 6573  ..XXX references
-00000030: 2074 6f20 7574 662d 3820 6e65 6564 2066   to utf-8 need f
-00000040: 7572 7468 6572 2069 6e76 6573 7469 6761  urther investiga
-00000050: 7469 6f6e 2e0d 0a22 2222 0d0a 696d 706f  tion..."""..impo
-00000060: 7274 2062 696e 6173 6369 690d 0a69 6d70  rt binascii..imp
-00000070: 6f72 7420 636f 6e74 6578 746c 6962 0d0a  ort contextlib..
-00000080: 696d 706f 7274 2069 6d70 6f72 746c 6962  import importlib
-00000090: 2e75 7469 6c0d 0a69 6d70 6f72 7420 696f  .util..import io
-000000a0: 0d0a 696d 706f 7274 2069 7465 7274 6f6f  ..import itertoo
-000000b0: 6c73 0d0a 696d 706f 7274 206f 730d 0a69  ls..import os..i
-000000c0: 6d70 6f72 7420 706f 7369 7870 6174 680d  mport posixpath.
-000000d0: 0a69 6d70 6f72 7420 7368 7574 696c 0d0a  .import shutil..
-000000e0: 696d 706f 7274 2073 7461 740d 0a69 6d70  import stat..imp
-000000f0: 6f72 7420 7374 7275 6374 0d0a 696d 706f  ort struct..impo
-00000100: 7274 2073 7973 0d0a 696d 706f 7274 2074  rt sys..import t
-00000110: 6872 6561 6469 6e67 0d0a 696d 706f 7274  hreading..import
-00000120: 2074 696d 650d 0a66 726f 6d20 6f70 6572   time..from oper
-00000130: 6174 6f72 2069 6d70 6f72 7420 6174 7472  ator import attr
-00000140: 6765 7474 6572 0d0a 0d0a 7472 793a 0d0a  getter....try:..
-00000150: 2020 2020 696d 706f 7274 207a 6c69 6220      import zlib 
-00000160: 2023 2057 6520 6d61 7920 6e65 6564 2069   # We may need i
-00000170: 7473 2063 6f6d 7072 6573 7369 6f6e 206d  ts compression m
-00000180: 6574 686f 640d 0a0d 0a20 2020 2063 7263  ethod....    crc
-00000190: 3332 203d 207a 6c69 622e 6372 6333 320d  32 = zlib.crc32.
-000001a0: 0a65 7863 6570 7420 496d 706f 7274 4572  .except ImportEr
-000001b0: 726f 723a 0d0a 2020 2020 7a6c 6962 203d  ror:..    zlib =
-000001c0: 204e 6f6e 650d 0a20 2020 2063 7263 3332   None..    crc32
-000001d0: 203d 2062 696e 6173 6369 692e 6372 6333   = binascii.crc3
-000001e0: 320d 0a0d 0a74 7279 3a0d 0a20 2020 2069  2....try:..    i
-000001f0: 6d70 6f72 7420 627a 3220 2023 2057 6520  mport bz2  # We 
-00000200: 6d61 7920 6e65 6564 2069 7473 2063 6f6d  may need its com
-00000210: 7072 6573 7369 6f6e 206d 6574 686f 640d  pression method.
-00000220: 0a65 7863 6570 7420 496d 706f 7274 4572  .except ImportEr
-00000230: 726f 723a 0d0a 2020 2020 627a 3220 3d20  ror:..    bz2 = 
-00000240: 4e6f 6e65 0d0a 0d0a 7472 793a 0d0a 2020  None....try:..  
-00000250: 2020 696d 706f 7274 206c 7a6d 6120 2023    import lzma  #
-00000260: 2057 6520 6d61 7920 6e65 6564 2069 7473   We may need its
-00000270: 2063 6f6d 7072 6573 7369 6f6e 206d 6574   compression met
-00000280: 686f 640d 0a65 7863 6570 7420 496d 706f  hod..except Impo
-00000290: 7274 4572 726f 723a 0d0a 2020 2020 6c7a  rtError:..    lz
-000002a0: 6d61 203d 204e 6f6e 650d 0a0d 0a5f 5f61  ma = None....__a
-000002b0: 6c6c 5f5f 203d 205b 0d0a 2020 2020 2242  ll__ = [..    "B
-000002c0: 6164 5a69 7046 696c 6522 2c0d 0a20 2020  adZipFile",..   
-000002d0: 2022 4261 645a 6970 6669 6c65 222c 0d0a   "BadZipfile",..
-000002e0: 2020 2020 2265 7272 6f72 222c 0d0a 2020      "error",..  
-000002f0: 2020 225a 4950 5f53 544f 5245 4422 2c0d    "ZIP_STORED",.
-00000300: 0a20 2020 2022 5a49 505f 4445 464c 4154  .    "ZIP_DEFLAT
-00000310: 4544 222c 0d0a 2020 2020 225a 4950 5f42  ED",..    "ZIP_B
-00000320: 5a49 5032 222c 0d0a 2020 2020 225a 4950  ZIP2",..    "ZIP
-00000330: 5f4c 5a4d 4122 2c0d 0a20 2020 2022 6973  _LZMA",..    "is
-00000340: 5f7a 6970 6669 6c65 222c 0d0a 2020 2020  _zipfile",..    
-00000350: 225a 6970 496e 666f 222c 0d0a 2020 2020  "ZipInfo",..    
-00000360: 225a 6970 4669 6c65 222c 0d0a 2020 2020  "ZipFile",..    
-00000370: 2250 795a 6970 4669 6c65 222c 0d0a 2020  "PyZipFile",..  
-00000380: 2020 224c 6172 6765 5a69 7046 696c 6522    "LargeZipFile"
-00000390: 2c0d 0a20 2020 2022 5061 7468 222c 0d0a  ,..    "Path",..
-000003a0: 5d0d 0a0d 0a0d 0a63 6c61 7373 2042 6164  ]......class Bad
-000003b0: 5a69 7046 696c 6528 4578 6365 7074 696f  ZipFile(Exceptio
-000003c0: 6e29 3a0d 0a20 2020 2070 6173 730d 0a0d  n):..    pass...
-000003d0: 0a0d 0a63 6c61 7373 204c 6172 6765 5a69  ...class LargeZi
-000003e0: 7046 696c 6528 4578 6365 7074 696f 6e29  pFile(Exception)
-000003f0: 3a0d 0a20 2020 2022 2222 0d0a 2020 2020  :..    """..    
-00000400: 5261 6973 6564 2077 6865 6e20 7772 6974  Raised when writ
-00000410: 696e 6720 6120 7a69 7066 696c 652c 2074  ing a zipfile, t
-00000420: 6865 207a 6970 6669 6c65 2072 6571 7569  he zipfile requi
-00000430: 7265 7320 5a49 5036 3420 6578 7465 6e73  res ZIP64 extens
-00000440: 696f 6e73 0d0a 2020 2020 616e 6420 7468  ions..    and th
-00000450: 6f73 6520 6578 7465 6e73 696f 6e73 2061  ose extensions a
-00000460: 7265 2064 6973 6162 6c65 642e 0d0a 2020  re disabled...  
-00000470: 2020 2222 220d 0a0d 0a0d 0a65 7272 6f72    """......error
-00000480: 203d 2042 6164 5a69 7066 696c 6520 3d20   = BadZipfile = 
-00000490: 4261 645a 6970 4669 6c65 2020 2320 5072  BadZipFile  # Pr
-000004a0: 652d 332e 3220 636f 6d70 6174 6962 696c  e-3.2 compatibil
-000004b0: 6974 7920 6e61 6d65 730d 0a0d 0a5a 4950  ity names....ZIP
-000004c0: 3634 5f4c 494d 4954 203d 2028 3120 3c3c  64_LIMIT = (1 <<
-000004d0: 2033 3129 202d 2031 0d0a 5a49 505f 4649   31) - 1..ZIP_FI
-000004e0: 4c45 434f 554e 545f 4c49 4d49 5420 3d20  LECOUNT_LIMIT = 
-000004f0: 2831 203c 3c20 3136 2920 2d20 310d 0a5a  (1 << 16) - 1..Z
-00000500: 4950 5f4d 4158 5f43 4f4d 4d45 4e54 203d  IP_MAX_COMMENT =
-00000510: 2028 3120 3c3c 2031 3629 202d 2031 0d0a   (1 << 16) - 1..
-00000520: 0d0a 2320 636f 6e73 7461 6e74 7320 666f  ..# constants fo
-00000530: 7220 5a69 7020 6669 6c65 2063 6f6d 7072  r Zip file compr
-00000540: 6573 7369 6f6e 206d 6574 686f 6473 0d0a  ession methods..
-00000550: 5a49 505f 5354 4f52 4544 203d 2030 0d0a  ZIP_STORED = 0..
-00000560: 5a49 505f 4445 464c 4154 4544 203d 2038  ZIP_DEFLATED = 8
-00000570: 0d0a 5a49 505f 425a 4950 3220 3d20 3132  ..ZIP_BZIP2 = 12
-00000580: 0d0a 5a49 505f 4c5a 4d41 203d 2031 340d  ..ZIP_LZMA = 14.
-00000590: 0a23 204f 7468 6572 205a 4950 2063 6f6d  .# Other ZIP com
-000005a0: 7072 6573 7369 6f6e 206d 6574 686f 6473  pression methods
-000005b0: 206e 6f74 2073 7570 706f 7274 6564 0d0a   not supported..
-000005c0: 0d0a 4445 4641 554c 545f 5645 5253 494f  ..DEFAULT_VERSIO
-000005d0: 4e20 3d20 3230 0d0a 5a49 5036 345f 5645  N = 20..ZIP64_VE
-000005e0: 5253 494f 4e20 3d20 3435 0d0a 425a 4950  RSION = 45..BZIP
-000005f0: 325f 5645 5253 494f 4e20 3d20 3436 0d0a  2_VERSION = 46..
-00000600: 4c5a 4d41 5f56 4552 5349 4f4e 203d 2036  LZMA_VERSION = 6
-00000610: 330d 0a23 2077 6520 7265 636f 676e 697a  3..# we recogniz
-00000620: 6520 2862 7574 206e 6f74 206e 6563 6573  e (but not neces
-00000630: 7361 7269 6c79 2073 7570 706f 7274 2920  sarily support) 
-00000640: 616c 6c20 6665 6174 7572 6573 2075 7020  all features up 
-00000650: 746f 2074 6861 7420 7665 7273 696f 6e0d  to that version.
-00000660: 0a4d 4158 5f45 5854 5241 4354 5f56 4552  .MAX_EXTRACT_VER
-00000670: 5349 4f4e 203d 2036 330d 0a0d 0a23 2042  SION = 63....# B
-00000680: 656c 6f77 2061 7265 2073 6f6d 6520 666f  elow are some fo
-00000690: 726d 6174 7320 616e 6420 6173 736f 6369  rmats and associ
-000006a0: 6174 6564 2064 6174 6120 666f 7220 7265  ated data for re
-000006b0: 6164 696e 672f 7772 6974 696e 6720 6865  ading/writing he
-000006c0: 6164 6572 7320 7573 696e 670d 0a23 2074  aders using..# t
-000006d0: 6865 2073 7472 7563 7420 6d6f 6475 6c65  he struct module
-000006e0: 2e20 2054 6865 206e 616d 6573 2061 6e64  .  The names and
-000006f0: 2073 7472 7563 7475 7265 7320 6f66 2068   structures of h
-00000700: 6561 6465 7273 2f72 6563 6f72 6473 2061  eaders/records a
-00000710: 7265 2074 686f 7365 2075 7365 640d 0a23  re those used..#
-00000720: 2069 6e20 7468 6520 504b 5741 5245 2064   in the PKWARE d
-00000730: 6573 6372 6970 7469 6f6e 206f 6620 7468  escription of th
-00000740: 6520 5a49 5020 6669 6c65 2066 6f72 6d61  e ZIP file forma
-00000750: 743a 0d0a 2320 2020 2020 6874 7470 3a2f  t:..#     http:/
-00000760: 2f77 7777 2e70 6b77 6172 652e 636f 6d2f  /www.pkware.com/
-00000770: 646f 6375 6d65 6e74 732f 6361 7365 7374  documents/casest
-00000780: 7564 6965 732f 4150 504e 4f54 452e 5458  udies/APPNOTE.TX
-00000790: 540d 0a23 2028 5552 4c20 7661 6c69 6420  T..# (URL valid 
-000007a0: 6173 206f 6620 4a61 6e75 6172 7920 3230  as of January 20
-000007b0: 3038 290d 0a0d 0a23 2054 6865 2022 656e  08)....# The "en
-000007c0: 6420 6f66 2063 656e 7472 616c 2064 6972  d of central dir
-000007d0: 6563 746f 7279 2220 7374 7275 6374 7572  ectory" structur
-000007e0: 652c 206d 6167 6963 206e 756d 6265 722c  e, magic number,
-000007f0: 2073 697a 652c 2061 6e64 2069 6e64 6963   size, and indic
-00000800: 6573 0d0a 2320 2873 6563 7469 6f6e 2056  es..# (section V
-00000810: 2e49 2069 6e20 7468 6520 666f 726d 6174  .I in the format
-00000820: 2064 6f63 756d 656e 7429 0d0a 7374 7275   document)..stru
-00000830: 6374 456e 6441 7263 6869 7665 203d 2062  ctEndArchive = b
-00000840: 223c 3473 3448 324c 4822 0d0a 7374 7269  "<4s4H2LH"..stri
-00000850: 6e67 456e 6441 7263 6869 7665 203d 2062  ngEndArchive = b
-00000860: 2250 4b5c 3030 355c 3030 3622 0d0a 7369  "PK\005\006"..si
-00000870: 7a65 456e 6443 656e 7444 6972 203d 2073  zeEndCentDir = s
-00000880: 7472 7563 742e 6361 6c63 7369 7a65 2873  truct.calcsize(s
-00000890: 7472 7563 7445 6e64 4172 6368 6976 6529  tructEndArchive)
-000008a0: 0d0a 0d0a 5f45 4344 5f53 4947 4e41 5455  ...._ECD_SIGNATU
-000008b0: 5245 203d 2030 0d0a 5f45 4344 5f44 4953  RE = 0.._ECD_DIS
-000008c0: 4b5f 4e55 4d42 4552 203d 2031 0d0a 5f45  K_NUMBER = 1.._E
-000008d0: 4344 5f44 4953 4b5f 5354 4152 5420 3d20  CD_DISK_START = 
-000008e0: 320d 0a5f 4543 445f 454e 5452 4945 535f  2.._ECD_ENTRIES_
-000008f0: 5448 4953 5f44 4953 4b20 3d20 330d 0a5f  THIS_DISK = 3.._
-00000900: 4543 445f 454e 5452 4945 535f 544f 5441  ECD_ENTRIES_TOTA
-00000910: 4c20 3d20 340d 0a5f 4543 445f 5349 5a45  L = 4.._ECD_SIZE
-00000920: 203d 2035 0d0a 5f45 4344 5f4f 4646 5345   = 5.._ECD_OFFSE
-00000930: 5420 3d20 360d 0a5f 4543 445f 434f 4d4d  T = 6.._ECD_COMM
-00000940: 454e 545f 5349 5a45 203d 2037 0d0a 2320  ENT_SIZE = 7..# 
-00000950: 5468 6573 6520 6c61 7374 2074 776f 2069  These last two i
-00000960: 6e64 6963 6573 2061 7265 206e 6f74 2070  ndices are not p
-00000970: 6172 7420 6f66 2074 6865 2073 7472 7563  art of the struc
-00000980: 7475 7265 2061 7320 6465 6669 6e65 6420  ture as defined 
-00000990: 696e 2074 6865 0d0a 2320 7370 6563 2c20  in the..# spec, 
-000009a0: 6275 7420 7468 6579 2061 7265 2075 7365  but they are use
-000009b0: 6420 696e 7465 726e 616c 6c79 2062 7920  d internally by 
-000009c0: 7468 6973 206d 6f64 756c 6520 6173 2061  this module as a
-000009d0: 2063 6f6e 7665 6e69 656e 6365 0d0a 5f45   convenience.._E
-000009e0: 4344 5f43 4f4d 4d45 4e54 203d 2038 0d0a  CD_COMMENT = 8..
-000009f0: 5f45 4344 5f4c 4f43 4154 494f 4e20 3d20  _ECD_LOCATION = 
-00000a00: 390d 0a0d 0a23 2054 6865 2022 6365 6e74  9....# The "cent
-00000a10: 7261 6c20 6469 7265 6374 6f72 7922 2073  ral directory" s
-00000a20: 7472 7563 7475 7265 2c20 6d61 6769 6320  tructure, magic 
-00000a30: 6e75 6d62 6572 2c20 7369 7a65 2c20 616e  number, size, an
-00000a40: 6420 696e 6469 6365 730d 0a23 206f 6620  d indices..# of 
-00000a50: 656e 7472 6965 7320 696e 2074 6865 2073  entries in the s
-00000a60: 7472 7563 7475 7265 2028 7365 6374 696f  tructure (sectio
-00000a70: 6e20 562e 4620 696e 2074 6865 2066 6f72  n V.F in the for
-00000a80: 6d61 7420 646f 6375 6d65 6e74 290d 0a73  mat document)..s
-00000a90: 7472 7563 7443 656e 7472 616c 4469 7220  tructCentralDir 
-00000aa0: 3d20 223c 3473 3442 3448 4c32 4c35 4832  = "<4s4B4HL2L5H2
-00000ab0: 4c22 0d0a 7374 7269 6e67 4365 6e74 7261  L"..stringCentra
-00000ac0: 6c44 6972 203d 2062 2250 4b5c 3030 315c  lDir = b"PK\001\
-00000ad0: 3030 3222 0d0a 7369 7a65 4365 6e74 7261  002"..sizeCentra
-00000ae0: 6c44 6972 203d 2073 7472 7563 742e 6361  lDir = struct.ca
-00000af0: 6c63 7369 7a65 2873 7472 7563 7443 656e  lcsize(structCen
-00000b00: 7472 616c 4469 7229 0d0a 0d0a 2320 696e  tralDir)....# in
-00000b10: 6465 7865 7320 6f66 2065 6e74 7269 6573  dexes of entries
-00000b20: 2069 6e20 7468 6520 6365 6e74 7261 6c20   in the central 
-00000b30: 6469 7265 6374 6f72 7920 7374 7275 6374  directory struct
-00000b40: 7572 650d 0a5f 4344 5f53 4947 4e41 5455  ure.._CD_SIGNATU
-00000b50: 5245 203d 2030 0d0a 5f43 445f 4352 4541  RE = 0.._CD_CREA
-00000b60: 5445 5f56 4552 5349 4f4e 203d 2031 0d0a  TE_VERSION = 1..
-00000b70: 5f43 445f 4352 4541 5445 5f53 5953 5445  _CD_CREATE_SYSTE
-00000b80: 4d20 3d20 320d 0a5f 4344 5f45 5854 5241  M = 2.._CD_EXTRA
-00000b90: 4354 5f56 4552 5349 4f4e 203d 2033 0d0a  CT_VERSION = 3..
-00000ba0: 5f43 445f 4558 5452 4143 545f 5359 5354  _CD_EXTRACT_SYST
-00000bb0: 454d 203d 2034 0d0a 5f43 445f 464c 4147  EM = 4.._CD_FLAG
-00000bc0: 5f42 4954 5320 3d20 350d 0a5f 4344 5f43  _BITS = 5.._CD_C
-00000bd0: 4f4d 5052 4553 535f 5459 5045 203d 2036  OMPRESS_TYPE = 6
-00000be0: 0d0a 5f43 445f 5449 4d45 203d 2037 0d0a  .._CD_TIME = 7..
-00000bf0: 5f43 445f 4441 5445 203d 2038 0d0a 5f43  _CD_DATE = 8.._C
-00000c00: 445f 4352 4320 3d20 390d 0a5f 4344 5f43  D_CRC = 9.._CD_C
-00000c10: 4f4d 5052 4553 5345 445f 5349 5a45 203d  OMPRESSED_SIZE =
-00000c20: 2031 300d 0a5f 4344 5f55 4e43 4f4d 5052   10.._CD_UNCOMPR
-00000c30: 4553 5345 445f 5349 5a45 203d 2031 310d  ESSED_SIZE = 11.
-00000c40: 0a5f 4344 5f46 494c 454e 414d 455f 4c45  ._CD_FILENAME_LE
-00000c50: 4e47 5448 203d 2031 320d 0a5f 4344 5f45  NGTH = 12.._CD_E
-00000c60: 5854 5241 5f46 4945 4c44 5f4c 454e 4754  XTRA_FIELD_LENGT
-00000c70: 4820 3d20 3133 0d0a 5f43 445f 434f 4d4d  H = 13.._CD_COMM
-00000c80: 454e 545f 4c45 4e47 5448 203d 2031 340d  ENT_LENGTH = 14.
-00000c90: 0a5f 4344 5f44 4953 4b5f 4e55 4d42 4552  ._CD_DISK_NUMBER
-00000ca0: 5f53 5441 5254 203d 2031 350d 0a5f 4344  _START = 15.._CD
-00000cb0: 5f49 4e54 4552 4e41 4c5f 4649 4c45 5f41  _INTERNAL_FILE_A
-00000cc0: 5454 5249 4255 5445 5320 3d20 3136 0d0a  TTRIBUTES = 16..
-00000cd0: 5f43 445f 4558 5445 524e 414c 5f46 494c  _CD_EXTERNAL_FIL
-00000ce0: 455f 4154 5452 4942 5554 4553 203d 2031  E_ATTRIBUTES = 1
-00000cf0: 370d 0a5f 4344 5f4c 4f43 414c 5f48 4541  7.._CD_LOCAL_HEA
-00000d00: 4445 525f 4f46 4653 4554 203d 2031 380d  DER_OFFSET = 18.
-00000d10: 0a0d 0a23 2054 6865 2022 6c6f 6361 6c20  ...# The "local 
-00000d20: 6669 6c65 2068 6561 6465 7222 2073 7472  file header" str
-00000d30: 7563 7475 7265 2c20 6d61 6769 6320 6e75  ucture, magic nu
-00000d40: 6d62 6572 2c20 7369 7a65 2c20 616e 6420  mber, size, and 
-00000d50: 696e 6469 6365 730d 0a23 2028 7365 6374  indices..# (sect
-00000d60: 696f 6e20 562e 4120 696e 2074 6865 2066  ion V.A in the f
-00000d70: 6f72 6d61 7420 646f 6375 6d65 6e74 290d  ormat document).
-00000d80: 0a73 7472 7563 7446 696c 6548 6561 6465  .structFileHeade
-00000d90: 7220 3d20 223c 3473 3242 3448 4c32 4c32  r = "<4s2B4HL2L2
-00000da0: 4822 0d0a 7374 7269 6e67 4669 6c65 4865  H"..stringFileHe
-00000db0: 6164 6572 203d 2062 2250 4b5c 3030 335c  ader = b"PK\003\
-00000dc0: 3030 3422 0d0a 7369 7a65 4669 6c65 4865  004"..sizeFileHe
-00000dd0: 6164 6572 203d 2073 7472 7563 742e 6361  ader = struct.ca
-00000de0: 6c63 7369 7a65 2873 7472 7563 7446 696c  lcsize(structFil
-00000df0: 6548 6561 6465 7229 0d0a 0d0a 5f46 485f  eHeader)...._FH_
-00000e00: 5349 474e 4154 5552 4520 3d20 300d 0a5f  SIGNATURE = 0.._
-00000e10: 4648 5f45 5854 5241 4354 5f56 4552 5349  FH_EXTRACT_VERSI
-00000e20: 4f4e 203d 2031 0d0a 5f46 485f 4558 5452  ON = 1.._FH_EXTR
-00000e30: 4143 545f 5359 5354 454d 203d 2032 0d0a  ACT_SYSTEM = 2..
-00000e40: 5f46 485f 4745 4e45 5241 4c5f 5055 5250  _FH_GENERAL_PURP
-00000e50: 4f53 455f 464c 4147 5f42 4954 5320 3d20  OSE_FLAG_BITS = 
-00000e60: 330d 0a5f 4648 5f43 4f4d 5052 4553 5349  3.._FH_COMPRESSI
-00000e70: 4f4e 5f4d 4554 484f 4420 3d20 340d 0a5f  ON_METHOD = 4.._
-00000e80: 4648 5f4c 4153 545f 4d4f 445f 5449 4d45  FH_LAST_MOD_TIME
-00000e90: 203d 2035 0d0a 5f46 485f 4c41 5354 5f4d   = 5.._FH_LAST_M
-00000ea0: 4f44 5f44 4154 4520 3d20 360d 0a5f 4648  OD_DATE = 6.._FH
-00000eb0: 5f43 5243 203d 2037 0d0a 5f46 485f 434f  _CRC = 7.._FH_CO
-00000ec0: 4d50 5245 5353 4544 5f53 495a 4520 3d20  MPRESSED_SIZE = 
-00000ed0: 380d 0a5f 4648 5f55 4e43 4f4d 5052 4553  8.._FH_UNCOMPRES
-00000ee0: 5345 445f 5349 5a45 203d 2039 0d0a 5f46  SED_SIZE = 9.._F
-00000ef0: 485f 4649 4c45 4e41 4d45 5f4c 454e 4754  H_FILENAME_LENGT
-00000f00: 4820 3d20 3130 0d0a 5f46 485f 4558 5452  H = 10.._FH_EXTR
-00000f10: 415f 4649 454c 445f 4c45 4e47 5448 203d  A_FIELD_LENGTH =
-00000f20: 2031 310d 0a0d 0a23 2054 6865 2022 5a69   11....# The "Zi
-00000f30: 7036 3420 656e 6420 6f66 2063 656e 7472  p64 end of centr
-00000f40: 616c 2064 6972 6563 746f 7279 206c 6f63  al directory loc
-00000f50: 6174 6f72 2220 7374 7275 6374 7572 652c  ator" structure,
-00000f60: 206d 6167 6963 206e 756d 6265 722c 2061   magic number, a
-00000f70: 6e64 2073 697a 650d 0a73 7472 7563 7445  nd size..structE
-00000f80: 6e64 4172 6368 6976 6536 344c 6f63 6174  ndArchive64Locat
-00000f90: 6f72 203d 2022 3c34 734c 514c 220d 0a73  or = "<4sLQL"..s
-00000fa0: 7472 696e 6745 6e64 4172 6368 6976 6536  tringEndArchive6
-00000fb0: 344c 6f63 6174 6f72 203d 2062 2250 4b5c  4Locator = b"PK\
-00000fc0: 7830 365c 7830 3722 0d0a 7369 7a65 456e  x06\x07"..sizeEn
-00000fd0: 6443 656e 7444 6972 3634 4c6f 6361 746f  dCentDir64Locato
-00000fe0: 7220 3d20 7374 7275 6374 2e63 616c 6373  r = struct.calcs
-00000ff0: 697a 6528 7374 7275 6374 456e 6441 7263  ize(structEndArc
-00001000: 6869 7665 3634 4c6f 6361 746f 7229 0d0a  hive64Locator)..
-00001010: 0d0a 2320 5468 6520 225a 6970 3634 2065  ..# The "Zip64 e
-00001020: 6e64 206f 6620 6365 6e74 7261 6c20 6469  nd of central di
-00001030: 7265 6374 6f72 7922 2072 6563 6f72 642c  rectory" record,
-00001040: 206d 6167 6963 206e 756d 6265 722c 2073   magic number, s
-00001050: 697a 652c 2061 6e64 2069 6e64 6963 6573  ize, and indices
-00001060: 0d0a 2320 2873 6563 7469 6f6e 2056 2e47  ..# (section V.G
-00001070: 2069 6e20 7468 6520 666f 726d 6174 2064   in the format d
-00001080: 6f63 756d 656e 7429 0d0a 7374 7275 6374  ocument)..struct
-00001090: 456e 6441 7263 6869 7665 3634 203d 2022  EndArchive64 = "
-000010a0: 3c34 7351 3248 324c 3451 220d 0a73 7472  <4sQ2H2L4Q"..str
-000010b0: 696e 6745 6e64 4172 6368 6976 6536 3420  ingEndArchive64 
-000010c0: 3d20 6222 504b 5c78 3036 5c78 3036 220d  = b"PK\x06\x06".
-000010d0: 0a73 697a 6545 6e64 4365 6e74 4469 7236  .sizeEndCentDir6
-000010e0: 3420 3d20 7374 7275 6374 2e63 616c 6373  4 = struct.calcs
-000010f0: 697a 6528 7374 7275 6374 456e 6441 7263  ize(structEndArc
-00001100: 6869 7665 3634 290d 0a0d 0a5f 4344 3634  hive64)...._CD64
-00001110: 5f53 4947 4e41 5455 5245 203d 2030 0d0a  _SIGNATURE = 0..
-00001120: 5f43 4436 345f 4449 5245 4354 4f52 595f  _CD64_DIRECTORY_
-00001130: 5245 4353 495a 4520 3d20 310d 0a5f 4344  RECSIZE = 1.._CD
-00001140: 3634 5f43 5245 4154 455f 5645 5253 494f  64_CREATE_VERSIO
-00001150: 4e20 3d20 320d 0a5f 4344 3634 5f45 5854  N = 2.._CD64_EXT
-00001160: 5241 4354 5f56 4552 5349 4f4e 203d 2033  RACT_VERSION = 3
-00001170: 0d0a 5f43 4436 345f 4449 534b 5f4e 554d  .._CD64_DISK_NUM
-00001180: 4245 5220 3d20 340d 0a5f 4344 3634 5f44  BER = 4.._CD64_D
-00001190: 4953 4b5f 4e55 4d42 4552 5f53 5441 5254  ISK_NUMBER_START
-000011a0: 203d 2035 0d0a 5f43 4436 345f 4e55 4d42   = 5.._CD64_NUMB
-000011b0: 4552 5f45 4e54 5249 4553 5f54 4849 535f  ER_ENTRIES_THIS_
-000011c0: 4449 534b 203d 2036 0d0a 5f43 4436 345f  DISK = 6.._CD64_
-000011d0: 4e55 4d42 4552 5f45 4e54 5249 4553 5f54  NUMBER_ENTRIES_T
-000011e0: 4f54 414c 203d 2037 0d0a 5f43 4436 345f  OTAL = 7.._CD64_
-000011f0: 4449 5245 4354 4f52 595f 5349 5a45 203d  DIRECTORY_SIZE =
-00001200: 2038 0d0a 5f43 4436 345f 4f46 4653 4554   8.._CD64_OFFSET
-00001210: 5f53 5441 5254 5f43 454e 5444 4952 203d  _START_CENTDIR =
-00001220: 2039 0d0a 0d0a 5f44 445f 5349 474e 4154   9...._DD_SIGNAT
-00001230: 5552 4520 3d20 3078 3038 3037 3442 3530  URE = 0x08074B50
-00001240: 0d0a 0d0a 5f45 5854 5241 5f46 4945 4c44  ...._EXTRA_FIELD
-00001250: 5f53 5452 5543 5420 3d20 7374 7275 6374  _STRUCT = struct
-00001260: 2e53 7472 7563 7428 223c 4848 2229 0d0a  .Struct("<HH")..
-00001270: 0d0a 0d0a 6465 6620 5f73 7472 6970 5f65  ....def _strip_e
-00001280: 7874 7261 2865 7874 7261 2c20 7869 6473  xtra(extra, xids
-00001290: 293a 0d0a 2020 2020 2320 5265 6d6f 7665  ):..    # Remove
-000012a0: 2045 7874 7261 2046 6965 6c64 7320 7769   Extra Fields wi
-000012b0: 7468 2073 7065 6369 6669 6564 2049 4473  th specified IDs
-000012c0: 2e0d 0a20 2020 2075 6e70 6163 6b20 3d20  ...    unpack = 
-000012d0: 5f45 5854 5241 5f46 4945 4c44 5f53 5452  _EXTRA_FIELD_STR
-000012e0: 5543 542e 756e 7061 636b 0d0a 2020 2020  UCT.unpack..    
-000012f0: 6d6f 6469 6669 6564 203d 2046 616c 7365  modified = False
-00001300: 0d0a 2020 2020 6275 6666 6572 203d 205b  ..    buffer = [
-00001310: 5d0d 0a20 2020 2073 7461 7274 203d 2069  ]..    start = i
-00001320: 203d 2030 0d0a 2020 2020 7768 696c 6520   = 0..    while 
-00001330: 6920 2b20 3420 3c3d 206c 656e 2865 7874  i + 4 <= len(ext
-00001340: 7261 293a 0d0a 2020 2020 2020 2020 7869  ra):..        xi
-00001350: 642c 2078 6c65 6e20 3d20 756e 7061 636b  d, xlen = unpack
-00001360: 2865 7874 7261 5b69 203a 2069 202b 2034  (extra[i : i + 4
-00001370: 5d29 0d0a 2020 2020 2020 2020 6a20 3d20  ])..        j = 
-00001380: 6920 2b20 3420 2b20 786c 656e 0d0a 2020  i + 4 + xlen..  
-00001390: 2020 2020 2020 6966 2078 6964 2069 6e20        if xid in 
-000013a0: 7869 6473 3a0d 0a20 2020 2020 2020 2020  xids:..         
-000013b0: 2020 2069 6620 6920 213d 2073 7461 7274     if i != start
-000013c0: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
-000013d0: 2020 2062 7566 6665 722e 6170 7065 6e64     buffer.append
-000013e0: 2865 7874 7261 5b73 7461 7274 3a69 5d29  (extra[start:i])
-000013f0: 0d0a 2020 2020 2020 2020 2020 2020 7374  ..            st
-00001400: 6172 7420 3d20 6a0d 0a20 2020 2020 2020  art = j..       
-00001410: 2020 2020 206d 6f64 6966 6965 6420 3d20       modified = 
-00001420: 5472 7565 0d0a 2020 2020 2020 2020 6920  True..        i 
-00001430: 3d20 6a0d 0a20 2020 2069 6620 6e6f 7420  = j..    if not 
-00001440: 6d6f 6469 6669 6564 3a0d 0a20 2020 2020  modified:..     
-00001450: 2020 2072 6574 7572 6e20 6578 7472 610d     return extra.
-00001460: 0a20 2020 2072 6574 7572 6e20 6222 222e  .    return b"".
-00001470: 6a6f 696e 2862 7566 6665 7229 0d0a 0d0a  join(buffer)....
-00001480: 0d0a 6465 6620 5f63 6865 636b 5f7a 6970  ..def _check_zip
-00001490: 6669 6c65 2866 7029 3a0d 0a20 2020 2074  file(fp):..    t
-000014a0: 7279 3a0d 0a20 2020 2020 2020 2069 6620  ry:..        if 
-000014b0: 5f45 6e64 5265 6344 6174 6128 6670 293a  _EndRecData(fp):
-000014c0: 0d0a 2020 2020 2020 2020 2020 2020 7265  ..            re
-000014d0: 7475 726e 2054 7275 6520 2023 2066 696c  turn True  # fil
-000014e0: 6520 6861 7320 636f 7272 6563 7420 6d61  e has correct ma
-000014f0: 6769 6320 6e75 6d62 6572 0d0a 2020 2020  gic number..    
-00001500: 6578 6365 7074 204f 5345 7272 6f72 3a0d  except OSError:.
-00001510: 0a20 2020 2020 2020 2070 6173 730d 0a20  .        pass.. 
-00001520: 2020 2072 6574 7572 6e20 4661 6c73 650d     return False.
-00001530: 0a0d 0a0d 0a64 6566 2069 735f 7a69 7066  .....def is_zipf
-00001540: 696c 6528 6669 6c65 6e61 6d65 293a 0d0a  ile(filename):..
-00001550: 2020 2020 2222 2251 7569 636b 6c79 2073      """Quickly s
-00001560: 6565 2069 6620 6120 6669 6c65 2069 7320  ee if a file is 
-00001570: 6120 5a49 5020 6669 6c65 2062 7920 6368  a ZIP file by ch
-00001580: 6563 6b69 6e67 2074 6865 206d 6167 6963  ecking the magic
-00001590: 206e 756d 6265 722e 0d0a 0d0a 2020 2020   number.....    
-000015a0: 5468 6520 6669 6c65 6e61 6d65 2061 7267  The filename arg
-000015b0: 756d 656e 7420 6d61 7920 6265 2061 2066  ument may be a f
-000015c0: 696c 6520 6f72 2066 696c 652d 6c69 6b65  ile or file-like
-000015d0: 206f 626a 6563 7420 746f 6f2e 0d0a 2020   object too...  
-000015e0: 2020 2222 220d 0a20 2020 2072 6573 756c    """..    resul
-000015f0: 7420 3d20 4661 6c73 650d 0a20 2020 2074  t = False..    t
-00001600: 7279 3a0d 0a20 2020 2020 2020 2069 6620  ry:..        if 
-00001610: 6861 7361 7474 7228 6669 6c65 6e61 6d65  hasattr(filename
-00001620: 2c20 2272 6561 6422 293a 0d0a 2020 2020  , "read"):..    
-00001630: 2020 2020 2020 2020 7265 7375 6c74 203d          result =
-00001640: 205f 6368 6563 6b5f 7a69 7066 696c 6528   _check_zipfile(
-00001650: 6670 3d66 696c 656e 616d 6529 0d0a 2020  fp=filename)..  
-00001660: 2020 2020 2020 656c 7365 3a0d 0a20 2020        else:..   
-00001670: 2020 2020 2020 2020 2077 6974 6820 6f70           with op
-00001680: 656e 2866 696c 656e 616d 652c 2022 7262  en(filename, "rb
-00001690: 2229 2061 7320 6670 3a0d 0a20 2020 2020  ") as fp:..     
-000016a0: 2020 2020 2020 2020 2020 2072 6573 756c             resul
-000016b0: 7420 3d20 5f63 6865 636b 5f7a 6970 6669  t = _check_zipfi
-000016c0: 6c65 2866 7029 0d0a 2020 2020 6578 6365  le(fp)..    exce
-000016d0: 7074 204f 5345 7272 6f72 3a0d 0a20 2020  pt OSError:..   
-000016e0: 2020 2020 2070 6173 730d 0a20 2020 2072       pass..    r
-000016f0: 6574 7572 6e20 7265 7375 6c74 0d0a 0d0a  eturn result....
-00001700: 0d0a 6465 6620 5f45 6e64 5265 6344 6174  ..def _EndRecDat
-00001710: 6136 3428 6670 696e 2c20 6f66 6673 6574  a64(fpin, offset
-00001720: 2c20 656e 6472 6563 293a 0d0a 2020 2020  , endrec):..    
-00001730: 2222 2252 6561 6420 7468 6520 5a49 5036  """Read the ZIP6
-00001740: 3420 656e 642d 6f66 2d61 7263 6869 7665  4 end-of-archive
-00001750: 2072 6563 6f72 6473 2061 6e64 2075 7365   records and use
-00001760: 2074 6861 7420 746f 2075 7064 6174 6520   that to update 
-00001770: 656e 6472 6563 2e22 2222 0d0a 2020 2020  endrec."""..    
-00001780: 7472 793a 0d0a 2020 2020 2020 2020 6670  try:..        fp
-00001790: 696e 2e73 6565 6b28 6f66 6673 6574 202d  in.seek(offset -
-000017a0: 2073 697a 6545 6e64 4365 6e74 4469 7236   sizeEndCentDir6
-000017b0: 344c 6f63 6174 6f72 2c20 3229 0d0a 2020  4Locator, 2)..  
-000017c0: 2020 6578 6365 7074 204f 5345 7272 6f72    except OSError
-000017d0: 3a0d 0a20 2020 2020 2020 2023 2049 6620  :..        # If 
-000017e0: 7468 6520 7365 656b 2066 6169 6c73 2c20  the seek fails, 
-000017f0: 7468 6520 6669 6c65 2069 7320 6e6f 7420  the file is not 
-00001800: 6c61 7267 6520 656e 6f75 6768 2074 6f20  large enough to 
-00001810: 636f 6e74 6169 6e20 6120 5a49 5036 340d  contain a ZIP64.
-00001820: 0a20 2020 2020 2020 2023 2065 6e64 2d6f  .        # end-o
-00001830: 662d 6172 6368 6976 6520 7265 636f 7264  f-archive record
-00001840: 2c20 736f 206a 7573 7420 7265 7475 726e  , so just return
-00001850: 2074 6865 2065 6e64 2072 6563 6f72 6420   the end record 
-00001860: 7765 2077 6572 6520 6769 7665 6e2e 0d0a  we were given...
-00001870: 2020 2020 2020 2020 7265 7475 726e 2065          return e
-00001880: 6e64 7265 630d 0a0d 0a20 2020 2064 6174  ndrec....    dat
-00001890: 6120 3d20 6670 696e 2e72 6561 6428 7369  a = fpin.read(si
-000018a0: 7a65 456e 6443 656e 7444 6972 3634 4c6f  zeEndCentDir64Lo
-000018b0: 6361 746f 7229 0d0a 2020 2020 6966 206c  cator)..    if l
-000018c0: 656e 2864 6174 6129 2021 3d20 7369 7a65  en(data) != size
-000018d0: 456e 6443 656e 7444 6972 3634 4c6f 6361  EndCentDir64Loca
-000018e0: 746f 723a 0d0a 2020 2020 2020 2020 7265  tor:..        re
-000018f0: 7475 726e 2065 6e64 7265 630d 0a20 2020  turn endrec..   
-00001900: 2073 6967 2c20 6469 736b 6e6f 2c20 7265   sig, diskno, re
-00001910: 6c6f 6666 2c20 6469 736b 7320 3d20 7374  loff, disks = st
-00001920: 7275 6374 2e75 6e70 6163 6b28 7374 7275  ruct.unpack(stru
-00001930: 6374 456e 6441 7263 6869 7665 3634 4c6f  ctEndArchive64Lo
-00001940: 6361 746f 722c 2064 6174 6129 0d0a 2020  cator, data)..  
-00001950: 2020 6966 2073 6967 2021 3d20 7374 7269    if sig != stri
-00001960: 6e67 456e 6441 7263 6869 7665 3634 4c6f  ngEndArchive64Lo
-00001970: 6361 746f 723a 0d0a 2020 2020 2020 2020  cator:..        
-00001980: 7265 7475 726e 2065 6e64 7265 630d 0a0d  return endrec...
-00001990: 0a20 2020 2069 6620 6469 736b 6e6f 2021  .    if diskno !
-000019a0: 3d20 3020 6f72 2064 6973 6b73 203e 2031  = 0 or disks > 1
-000019b0: 3a0d 0a20 2020 2020 2020 2072 6169 7365  :..        raise
-000019c0: 2042 6164 5a69 7046 696c 6528 227a 6970   BadZipFile("zip
-000019d0: 6669 6c65 7320 7468 6174 2073 7061 6e20  files that span 
-000019e0: 6d75 6c74 6970 6c65 2064 6973 6b73 2061  multiple disks a
-000019f0: 7265 206e 6f74 2073 7570 706f 7274 6564  re not supported
-00001a00: 2229 0d0a 0d0a 2020 2020 2320 4173 7375  ")....    # Assu
-00001a10: 6d65 206e 6f20 277a 6970 3634 2065 7874  me no 'zip64 ext
-00001a20: 656e 7369 626c 6520 6461 7461 270d 0a20  ensible data'.. 
-00001a30: 2020 2066 7069 6e2e 7365 656b 286f 6666     fpin.seek(off
-00001a40: 7365 7420 2d20 7369 7a65 456e 6443 656e  set - sizeEndCen
-00001a50: 7444 6972 3634 4c6f 6361 746f 7220 2d20  tDir64Locator - 
-00001a60: 7369 7a65 456e 6443 656e 7444 6972 3634  sizeEndCentDir64
-00001a70: 2c20 3229 0d0a 2020 2020 6461 7461 203d  , 2)..    data =
-00001a80: 2066 7069 6e2e 7265 6164 2873 697a 6545   fpin.read(sizeE
-00001a90: 6e64 4365 6e74 4469 7236 3429 0d0a 2020  ndCentDir64)..  
-00001aa0: 2020 6966 206c 656e 2864 6174 6129 2021    if len(data) !
-00001ab0: 3d20 7369 7a65 456e 6443 656e 7444 6972  = sizeEndCentDir
-00001ac0: 3634 3a0d 0a20 2020 2020 2020 2072 6574  64:..        ret
-00001ad0: 7572 6e20 656e 6472 6563 0d0a 2020 2020  urn endrec..    
-00001ae0: 280d 0a20 2020 2020 2020 2073 6967 2c0d  (..        sig,.
-00001af0: 0a20 2020 2020 2020 2073 7a2c 0d0a 2020  .        sz,..  
-00001b00: 2020 2020 2020 6372 6561 7465 5f76 6572        create_ver
-00001b10: 7369 6f6e 2c0d 0a20 2020 2020 2020 2072  sion,..        r
-00001b20: 6561 645f 7665 7273 696f 6e2c 0d0a 2020  ead_version,..  
-00001b30: 2020 2020 2020 6469 736b 5f6e 756d 2c0d        disk_num,.
-00001b40: 0a20 2020 2020 2020 2064 6973 6b5f 6469  .        disk_di
-00001b50: 722c 0d0a 2020 2020 2020 2020 6469 7263  r,..        dirc
-00001b60: 6f75 6e74 2c0d 0a20 2020 2020 2020 2064  ount,..        d
-00001b70: 6972 636f 756e 7432 2c0d 0a20 2020 2020  ircount2,..     
-00001b80: 2020 2064 6972 7369 7a65 2c0d 0a20 2020     dirsize,..   
-00001b90: 2020 2020 2064 6972 6f66 6673 6574 2c0d       diroffset,.
-00001ba0: 0a20 2020 2029 203d 2073 7472 7563 742e  .    ) = struct.
-00001bb0: 756e 7061 636b 2873 7472 7563 7445 6e64  unpack(structEnd
-00001bc0: 4172 6368 6976 6536 342c 2064 6174 6129  Archive64, data)
-00001bd0: 0d0a 2020 2020 6966 2073 6967 2021 3d20  ..    if sig != 
-00001be0: 7374 7269 6e67 456e 6441 7263 6869 7665  stringEndArchive
-00001bf0: 3634 3a0d 0a20 2020 2020 2020 2072 6574  64:..        ret
-00001c00: 7572 6e20 656e 6472 6563 0d0a 0d0a 2020  urn endrec....  
-00001c10: 2020 2320 5570 6461 7465 2074 6865 206f    # Update the o
-00001c20: 7269 6769 6e61 6c20 656e 6472 6563 2075  riginal endrec u
-00001c30: 7369 6e67 2064 6174 6120 6672 6f6d 2074  sing data from t
-00001c40: 6865 205a 4950 3634 2072 6563 6f72 640d  he ZIP64 record.
-00001c50: 0a20 2020 2065 6e64 7265 635b 5f45 4344  .    endrec[_ECD
-00001c60: 5f53 4947 4e41 5455 5245 5d20 3d20 7369  _SIGNATURE] = si
-00001c70: 670d 0a20 2020 2065 6e64 7265 635b 5f45  g..    endrec[_E
-00001c80: 4344 5f44 4953 4b5f 4e55 4d42 4552 5d20  CD_DISK_NUMBER] 
-00001c90: 3d20 6469 736b 5f6e 756d 0d0a 2020 2020  = disk_num..    
-00001ca0: 656e 6472 6563 5b5f 4543 445f 4449 534b  endrec[_ECD_DISK
-00001cb0: 5f53 5441 5254 5d20 3d20 6469 736b 5f64  _START] = disk_d
-00001cc0: 6972 0d0a 2020 2020 656e 6472 6563 5b5f  ir..    endrec[_
-00001cd0: 4543 445f 454e 5452 4945 535f 5448 4953  ECD_ENTRIES_THIS
-00001ce0: 5f44 4953 4b5d 203d 2064 6972 636f 756e  _DISK] = dircoun
-00001cf0: 740d 0a20 2020 2065 6e64 7265 635b 5f45  t..    endrec[_E
-00001d00: 4344 5f45 4e54 5249 4553 5f54 4f54 414c  CD_ENTRIES_TOTAL
-00001d10: 5d20 3d20 6469 7263 6f75 6e74 320d 0a20  ] = dircount2.. 
-00001d20: 2020 2065 6e64 7265 635b 5f45 4344 5f53     endrec[_ECD_S
-00001d30: 495a 455d 203d 2064 6972 7369 7a65 0d0a  IZE] = dirsize..
-00001d40: 2020 2020 656e 6472 6563 5b5f 4543 445f      endrec[_ECD_
-00001d50: 4f46 4653 4554 5d20 3d20 6469 726f 6666  OFFSET] = diroff
-00001d60: 7365 740d 0a20 2020 2072 6574 7572 6e20  set..    return 
-00001d70: 656e 6472 6563 0d0a 0d0a 0d0a 6465 6620  endrec......def 
-00001d80: 5f45 6e64 5265 6344 6174 6128 6670 696e  _EndRecData(fpin
-00001d90: 293a 0d0a 2020 2020 2222 2252 6574 7572  ):..    """Retur
-00001da0: 6e20 6461 7461 2066 726f 6d20 7468 6520  n data from the 
-00001db0: 2245 6e64 206f 6620 4365 6e74 7261 6c20  "End of Central 
-00001dc0: 4469 7265 6374 6f72 7922 2072 6563 6f72  Directory" recor
-00001dd0: 642c 206f 7220 4e6f 6e65 2e0d 0a0d 0a20  d, or None..... 
-00001de0: 2020 2054 6865 2064 6174 6120 6973 2061     The data is a
-00001df0: 206c 6973 7420 6f66 2074 6865 206e 696e   list of the nin
-00001e00: 6520 6974 656d 7320 696e 2074 6865 205a  e items in the Z
-00001e10: 4950 2022 456e 6420 6f66 2063 656e 7472  IP "End of centr
-00001e20: 616c 2064 6972 220d 0a20 2020 2072 6563  al dir"..    rec
-00001e30: 6f72 6420 666f 6c6c 6f77 6564 2062 7920  ord followed by 
-00001e40: 6120 7465 6e74 6820 6974 656d 2c20 7468  a tenth item, th
-00001e50: 6520 6669 6c65 2073 6565 6b20 6f66 6673  e file seek offs
-00001e60: 6574 206f 6620 7468 6973 2072 6563 6f72  et of this recor
-00001e70: 642e 0d0a 2020 2020 2222 220d 0a20 2020  d...    """..   
-00001e80: 2023 2044 6574 6572 6d69 6e65 2066 696c   # Determine fil
-00001e90: 6520 7369 7a65 0d0a 2020 2020 6670 696e  e size..    fpin
-00001ea0: 2e73 6565 6b28 302c 2032 290d 0a20 2020  .seek(0, 2)..   
-00001eb0: 2066 696c 6573 697a 6520 3d20 6670 696e   filesize = fpin
-00001ec0: 2e74 656c 6c28 290d 0a0d 0a20 2020 2023  .tell()....    #
-00001ed0: 2043 6865 636b 2074 6f20 7365 6520 6966   Check to see if
-00001ee0: 2074 6869 7320 6973 205a 4950 2066 696c   this is ZIP fil
-00001ef0: 6520 7769 7468 206e 6f20 6172 6368 6976  e with no archiv
-00001f00: 6520 636f 6d6d 656e 7420 2874 6865 0d0a  e comment (the..
-00001f10: 2020 2020 2320 2265 6e64 206f 6620 6365      # "end of ce
-00001f20: 6e74 7261 6c20 6469 7265 6374 6f72 7922  ntral directory"
-00001f30: 2073 7472 7563 7475 7265 2073 686f 756c   structure shoul
-00001f40: 6420 6265 2074 6865 206c 6173 7420 6974  d be the last it
-00001f50: 656d 2069 6e20 7468 650d 0a20 2020 2023  em in the..    #
-00001f60: 2066 696c 6520 6966 2074 6869 7320 6973   file if this is
-00001f70: 2074 6865 2063 6173 6529 2e0d 0a20 2020   the case)...   
-00001f80: 2074 7279 3a0d 0a20 2020 2020 2020 2066   try:..        f
-00001f90: 7069 6e2e 7365 656b 282d 7369 7a65 456e  pin.seek(-sizeEn
-00001fa0: 6443 656e 7444 6972 2c20 3229 0d0a 2020  dCentDir, 2)..  
-00001fb0: 2020 6578 6365 7074 204f 5345 7272 6f72    except OSError
-00001fc0: 3a0d 0a20 2020 2020 2020 2072 6574 7572  :..        retur
-00001fd0: 6e20 4e6f 6e65 0d0a 2020 2020 6461 7461  n None..    data
-00001fe0: 203d 2066 7069 6e2e 7265 6164 2829 0d0a   = fpin.read()..
-00001ff0: 2020 2020 6966 2028 0d0a 2020 2020 2020      if (..      
-00002000: 2020 6c65 6e28 6461 7461 2920 3d3d 2073    len(data) == s
-00002010: 697a 6545 6e64 4365 6e74 4469 720d 0a20  izeEndCentDir.. 
-00002020: 2020 2020 2020 2061 6e64 2064 6174 615b         and data[
-00002030: 303a 345d 203d 3d20 7374 7269 6e67 456e  0:4] == stringEn
-00002040: 6441 7263 6869 7665 0d0a 2020 2020 2020  dArchive..      
-00002050: 2020 616e 6420 6461 7461 5b2d 323a 5d20    and data[-2:] 
-00002060: 3d3d 2062 225c 3030 305c 3030 3022 0d0a  == b"\000\000"..
-00002070: 2020 2020 293a 0d0a 2020 2020 2020 2020      ):..        
-00002080: 2320 7468 6520 7369 676e 6174 7572 6520  # the signature 
-00002090: 6973 2063 6f72 7265 6374 2061 6e64 2074  is correct and t
-000020a0: 6865 7265 2773 206e 6f20 636f 6d6d 656e  here's no commen
-000020b0: 742c 2075 6e70 6163 6b20 7374 7275 6374  t, unpack struct
-000020c0: 7572 650d 0a20 2020 2020 2020 2065 6e64  ure..        end
-000020d0: 7265 6320 3d20 7374 7275 6374 2e75 6e70  rec = struct.unp
-000020e0: 6163 6b28 7374 7275 6374 456e 6441 7263  ack(structEndArc
-000020f0: 6869 7665 2c20 6461 7461 290d 0a20 2020  hive, data)..   
-00002100: 2020 2020 2065 6e64 7265 6320 3d20 6c69       endrec = li
-00002110: 7374 2865 6e64 7265 6329 0d0a 0d0a 2020  st(endrec)....  
-00002120: 2020 2020 2020 2320 4170 7065 6e64 2061        # Append a
-00002130: 2062 6c61 6e6b 2063 6f6d 6d65 6e74 2061   blank comment a
-00002140: 6e64 2072 6563 6f72 6420 7374 6172 7420  nd record start 
-00002150: 6f66 6673 6574 0d0a 2020 2020 2020 2020  offset..        
-00002160: 656e 6472 6563 2e61 7070 656e 6428 6222  endrec.append(b"
-00002170: 2229 0d0a 2020 2020 2020 2020 656e 6472  ")..        endr
-00002180: 6563 2e61 7070 656e 6428 6669 6c65 7369  ec.append(filesi
-00002190: 7a65 202d 2073 697a 6545 6e64 4365 6e74  ze - sizeEndCent
-000021a0: 4469 7229 0d0a 0d0a 2020 2020 2020 2020  Dir)....        
-000021b0: 2320 5472 7920 746f 2072 6561 6420 7468  # Try to read th
-000021c0: 6520 225a 6970 3634 2065 6e64 206f 6620  e "Zip64 end of 
-000021d0: 6365 6e74 7261 6c20 6469 7265 6374 6f72  central director
-000021e0: 7922 2073 7472 7563 7475 7265 0d0a 2020  y" structure..  
-000021f0: 2020 2020 2020 7265 7475 726e 205f 456e        return _En
-00002200: 6452 6563 4461 7461 3634 2866 7069 6e2c  dRecData64(fpin,
-00002210: 202d 7369 7a65 456e 6443 656e 7444 6972   -sizeEndCentDir
-00002220: 2c20 656e 6472 6563 290d 0a0d 0a20 2020  , endrec)....   
-00002230: 2023 2045 6974 6865 7220 7468 6973 2069   # Either this i
-00002240: 7320 6e6f 7420 6120 5a49 5020 6669 6c65  s not a ZIP file
-00002250: 2c20 6f72 2069 7420 6973 2061 205a 4950  , or it is a ZIP
-00002260: 2066 696c 6520 7769 7468 2061 6e20 6172   file with an ar
-00002270: 6368 6976 650d 0a20 2020 2023 2063 6f6d  chive..    # com
-00002280: 6d65 6e74 2e20 2053 6561 7263 6820 7468  ment.  Search th
-00002290: 6520 656e 6420 6f66 2074 6865 2066 696c  e end of the fil
-000022a0: 6520 666f 7220 7468 6520 2265 6e64 206f  e for the "end o
-000022b0: 6620 6365 6e74 7261 6c20 6469 7265 6374  f central direct
-000022c0: 6f72 7922 0d0a 2020 2020 2320 7265 636f  ory"..    # reco
-000022d0: 7264 2073 6967 6e61 7475 7265 2e20 5468  rd signature. Th
-000022e0: 6520 636f 6d6d 656e 7420 6973 2074 6865  e comment is the
-000022f0: 206c 6173 7420 6974 656d 2069 6e20 7468   last item in th
-00002300: 6520 5a49 5020 6669 6c65 2061 6e64 206d  e ZIP file and m
-00002310: 6179 2062 650d 0a20 2020 2023 2075 7020  ay be..    # up 
-00002320: 746f 2036 344b 206c 6f6e 672e 2020 4974  to 64K long.  It
-00002330: 2069 7320 6173 7375 6d65 6420 7468 6174   is assumed that
-00002340: 2074 6865 2022 656e 6420 6f66 2063 656e   the "end of cen
-00002350: 7472 616c 2064 6972 6563 746f 7279 2220  tral directory" 
-00002360: 6d61 6769 630d 0a20 2020 2023 206e 756d  magic..    # num
-00002370: 6265 7220 646f 6573 206e 6f74 2061 7070  ber does not app
-00002380: 6561 7220 696e 2074 6865 2063 6f6d 6d65  ear in the comme
-00002390: 6e74 2e0d 0a20 2020 206d 6178 436f 6d6d  nt...    maxComm
-000023a0: 656e 7453 7461 7274 203d 206d 6178 2866  entStart = max(f
-000023b0: 696c 6573 697a 6520 2d20 2831 203c 3c20  ilesize - (1 << 
-000023c0: 3136 2920 2d20 7369 7a65 456e 6443 656e  16) - sizeEndCen
-000023d0: 7444 6972 2c20 3029 0d0a 2020 2020 6670  tDir, 0)..    fp
-000023e0: 696e 2e73 6565 6b28 6d61 7843 6f6d 6d65  in.seek(maxComme
-000023f0: 6e74 5374 6172 742c 2030 290d 0a20 2020  ntStart, 0)..   
-00002400: 2064 6174 6120 3d20 6670 696e 2e72 6561   data = fpin.rea
-00002410: 6428 290d 0a20 2020 2073 7461 7274 203d  d()..    start =
-00002420: 2064 6174 612e 7266 696e 6428 7374 7269   data.rfind(stri
-00002430: 6e67 456e 6441 7263 6869 7665 290d 0a20  ngEndArchive).. 
-00002440: 2020 2069 6620 7374 6172 7420 3e3d 2030     if start >= 0
-00002450: 3a0d 0a20 2020 2020 2020 2023 2066 6f75  :..        # fou
-00002460: 6e64 2074 6865 206d 6167 6963 206e 756d  nd the magic num
-00002470: 6265 723b 2061 7474 656d 7074 2074 6f20  ber; attempt to 
-00002480: 756e 7061 636b 2061 6e64 2069 6e74 6572  unpack and inter
-00002490: 7072 6574 0d0a 2020 2020 2020 2020 7265  pret..        re
-000024a0: 6344 6174 6120 3d20 6461 7461 5b73 7461  cData = data[sta
-000024b0: 7274 203a 2073 7461 7274 202b 2073 697a  rt : start + siz
-000024c0: 6545 6e64 4365 6e74 4469 725d 0d0a 2020  eEndCentDir]..  
-000024d0: 2020 2020 2020 6966 206c 656e 2872 6563        if len(rec
-000024e0: 4461 7461 2920 213d 2073 697a 6545 6e64  Data) != sizeEnd
-000024f0: 4365 6e74 4469 723a 0d0a 2020 2020 2020  CentDir:..      
-00002500: 2020 2020 2020 2320 5a69 7020 6669 6c65        # Zip file
-00002510: 2069 7320 636f 7272 7570 7465 642e 0d0a   is corrupted...
-00002520: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-00002530: 726e 204e 6f6e 650d 0a20 2020 2020 2020  rn None..       
-00002540: 2065 6e64 7265 6320 3d20 6c69 7374 2873   endrec = list(s
-00002550: 7472 7563 742e 756e 7061 636b 2873 7472  truct.unpack(str
-00002560: 7563 7445 6e64 4172 6368 6976 652c 2072  uctEndArchive, r
-00002570: 6563 4461 7461 2929 0d0a 2020 2020 2020  ecData))..      
-00002580: 2020 636f 6d6d 656e 7453 697a 6520 3d20    commentSize = 
-00002590: 656e 6472 6563 5b5f 4543 445f 434f 4d4d  endrec[_ECD_COMM
-000025a0: 454e 545f 5349 5a45 5d20 2023 2061 7320  ENT_SIZE]  # as 
-000025b0: 636c 6169 6d65 6420 6279 2074 6865 207a  claimed by the z
-000025c0: 6970 2066 696c 650d 0a20 2020 2020 2020  ip file..       
-000025d0: 2063 6f6d 6d65 6e74 203d 2064 6174 615b   comment = data[
-000025e0: 0d0a 2020 2020 2020 2020 2020 2020 7374  ..            st
-000025f0: 6172 7420 2b20 7369 7a65 456e 6443 656e  art + sizeEndCen
-00002600: 7444 6972 203a 2073 7461 7274 202b 2073  tDir : start + s
-00002610: 697a 6545 6e64 4365 6e74 4469 7220 2b20  izeEndCentDir + 
-00002620: 636f 6d6d 656e 7453 697a 650d 0a20 2020  commentSize..   
-00002630: 2020 2020 205d 0d0a 2020 2020 2020 2020       ]..        
-00002640: 656e 6472 6563 2e61 7070 656e 6428 636f  endrec.append(co
-00002650: 6d6d 656e 7429 0d0a 2020 2020 2020 2020  mment)..        
-00002660: 656e 6472 6563 2e61 7070 656e 6428 6d61  endrec.append(ma
-00002670: 7843 6f6d 6d65 6e74 5374 6172 7420 2b20  xCommentStart + 
-00002680: 7374 6172 7429 0d0a 0d0a 2020 2020 2020  start)....      
-00002690: 2020 2320 5472 7920 746f 2072 6561 6420    # Try to read 
-000026a0: 7468 6520 225a 6970 3634 2065 6e64 206f  the "Zip64 end o
-000026b0: 6620 6365 6e74 7261 6c20 6469 7265 6374  f central direct
-000026c0: 6f72 7922 2073 7472 7563 7475 7265 0d0a  ory" structure..
-000026d0: 2020 2020 2020 2020 7265 7475 726e 205f          return _
-000026e0: 456e 6452 6563 4461 7461 3634 2866 7069  EndRecData64(fpi
-000026f0: 6e2c 206d 6178 436f 6d6d 656e 7453 7461  n, maxCommentSta
-00002700: 7274 202b 2073 7461 7274 202d 2066 696c  rt + start - fil
-00002710: 6573 697a 652c 2065 6e64 7265 6329 0d0a  esize, endrec)..
-00002720: 0d0a 2020 2020 2320 556e 6162 6c65 2074  ..    # Unable t
-00002730: 6f20 6669 6e64 2061 2076 616c 6964 2065  o find a valid e
-00002740: 6e64 206f 6620 6365 6e74 7261 6c20 6469  nd of central di
-00002750: 7265 6374 6f72 7920 7374 7275 6374 7572  rectory structur
-00002760: 650d 0a20 2020 2072 6574 7572 6e20 4e6f  e..    return No
-00002770: 6e65 0d0a 0d0a 0d0a 636c 6173 7320 5a69  ne......class Zi
-00002780: 7049 6e66 6f3a 0d0a 2020 2020 2222 2243  pInfo:..    """C
-00002790: 6c61 7373 2077 6974 6820 6174 7472 6962  lass with attrib
-000027a0: 7574 6573 2064 6573 6372 6962 696e 6720  utes describing 
-000027b0: 6561 6368 2066 696c 6520 696e 2074 6865  each file in the
-000027c0: 205a 4950 2061 7263 6869 7665 2e22 2222   ZIP archive."""
-000027d0: 0d0a 0d0a 2020 2020 5f5f 736c 6f74 735f  ....    __slots_
-000027e0: 5f20 3d20 280d 0a20 2020 2020 2020 2022  _ = (..        "
-000027f0: 6f72 6967 5f66 696c 656e 616d 6522 2c0d  orig_filename",.
-00002800: 0a20 2020 2020 2020 2022 6669 6c65 6e61  .        "filena
-00002810: 6d65 222c 0d0a 2020 2020 2020 2020 2264  me",..        "d
-00002820: 6174 655f 7469 6d65 222c 0d0a 2020 2020  ate_time",..    
-00002830: 2020 2020 2263 6f6d 7072 6573 735f 7479      "compress_ty
-00002840: 7065 222c 0d0a 2020 2020 2020 2020 225f  pe",..        "_
-00002850: 636f 6d70 7265 7373 6c65 7665 6c22 2c0d  compresslevel",.
-00002860: 0a20 2020 2020 2020 2022 636f 6d6d 656e  .        "commen
-00002870: 7422 2c0d 0a20 2020 2020 2020 2022 6578  t",..        "ex
-00002880: 7472 6122 2c0d 0a20 2020 2020 2020 2022  tra",..        "
-00002890: 6372 6561 7465 5f73 7973 7465 6d22 2c0d  create_system",.
-000028a0: 0a20 2020 2020 2020 2022 6372 6561 7465  .        "create
-000028b0: 5f76 6572 7369 6f6e 222c 0d0a 2020 2020  _version",..    
-000028c0: 2020 2020 2265 7874 7261 6374 5f76 6572      "extract_ver
-000028d0: 7369 6f6e 222c 0d0a 2020 2020 2020 2020  sion",..        
-000028e0: 2272 6573 6572 7665 6422 2c0d 0a20 2020  "reserved",..   
-000028f0: 2020 2020 2022 666c 6167 5f62 6974 7322       "flag_bits"
-00002900: 2c0d 0a20 2020 2020 2020 2022 766f 6c75  ,..        "volu
-00002910: 6d65 222c 0d0a 2020 2020 2020 2020 2269  me",..        "i
-00002920: 6e74 6572 6e61 6c5f 6174 7472 222c 0d0a  nternal_attr",..
-00002930: 2020 2020 2020 2020 2265 7874 6572 6e61          "externa
-00002940: 6c5f 6174 7472 222c 0d0a 2020 2020 2020  l_attr",..      
-00002950: 2020 2268 6561 6465 725f 6f66 6673 6574    "header_offset
-00002960: 222c 0d0a 2020 2020 2020 2020 2243 5243  ",..        "CRC
-00002970: 222c 0d0a 2020 2020 2020 2020 2263 6f6d  ",..        "com
-00002980: 7072 6573 735f 7369 7a65 222c 0d0a 2020  press_size",..  
-00002990: 2020 2020 2020 2266 696c 655f 7369 7a65        "file_size
-000029a0: 222c 0d0a 2020 2020 2020 2020 225f 7261  ",..        "_ra
-000029b0: 775f 7469 6d65 222c 0d0a 2020 2020 290d  w_time",..    ).
-000029c0: 0a0d 0a20 2020 2064 6566 205f 5f69 6e69  ...    def __ini
-000029d0: 745f 5f28 0d0a 2020 2020 2020 2020 7365  t__(..        se
-000029e0: 6c66 2c0d 0a20 2020 2020 2020 2066 696c  lf,..        fil
-000029f0: 656e 616d 653d 224e 6f4e 616d 6522 2c0d  ename="NoName",.
-00002a00: 0a20 2020 2020 2020 2064 6174 655f 7469  .        date_ti
-00002a10: 6d65 3d28 3139 3830 2c20 312c 2031 2c20  me=(1980, 1, 1, 
-00002a20: 302c 2030 2c20 3029 2c0d 0a20 2020 2029  0, 0, 0),..    )
-00002a30: 202d 3e20 4e6f 6e65 3a0d 0a20 2020 2020   -> None:..     
-00002a40: 2020 2073 656c 662e 6f72 6967 5f66 696c     self.orig_fil
-00002a50: 656e 616d 6520 3d20 6669 6c65 6e61 6d65  ename = filename
-00002a60: 2020 2320 4f72 6967 696e 616c 2066 696c    # Original fil
-00002a70: 6520 6e61 6d65 2069 6e20 6172 6368 6976  e name in archiv
-00002a80: 650d 0a0d 0a20 2020 2020 2020 2023 2054  e....        # T
-00002a90: 6572 6d69 6e61 7465 2074 6865 2066 696c  erminate the fil
-00002aa0: 6520 6e61 6d65 2061 7420 7468 6520 6669  e name at the fi
-00002ab0: 7273 7420 6e75 6c6c 2062 7974 652e 2020  rst null byte.  
-00002ac0: 4e75 6c6c 2062 7974 6573 2069 6e20 6669  Null bytes in fi
-00002ad0: 6c65 0d0a 2020 2020 2020 2020 2320 6e61  le..        # na
-00002ae0: 6d65 7320 6172 6520 7573 6564 2061 7320  mes are used as 
-00002af0: 7472 6963 6b73 2062 7920 7669 7275 7365  tricks by viruse
-00002b00: 7320 696e 2061 7263 6869 7665 732e 0d0a  s in archives...
-00002b10: 2020 2020 2020 2020 6e75 6c6c 5f62 7974          null_byt
-00002b20: 6520 3d20 6669 6c65 6e61 6d65 2e66 696e  e = filename.fin
-00002b30: 6428 6368 7228 3029 290d 0a20 2020 2020  d(chr(0))..     
-00002b40: 2020 2069 6620 6e75 6c6c 5f62 7974 6520     if null_byte 
-00002b50: 3e3d 2030 3a0d 0a20 2020 2020 2020 2020  >= 0:..         
-00002b60: 2020 2066 696c 656e 616d 6520 3d20 6669     filename = fi
-00002b70: 6c65 6e61 6d65 5b30 3a6e 756c 6c5f 6279  lename[0:null_by
-00002b80: 7465 5d0d 0a20 2020 2020 2020 2023 2054  te]..        # T
-00002b90: 6869 7320 6973 2075 7365 6420 746f 2065  his is used to e
-00002ba0: 6e73 7572 6520 7061 7468 7320 696e 2067  nsure paths in g
-00002bb0: 656e 6572 6174 6564 205a 4950 2066 696c  enerated ZIP fil
-00002bc0: 6573 2061 6c77 6179 7320 7573 650d 0a20  es always use.. 
-00002bd0: 2020 2020 2020 2023 2066 6f72 7761 7264         # forward
-00002be0: 2073 6c61 7368 6573 2061 7320 7468 6520   slashes as the 
-00002bf0: 6469 7265 6374 6f72 7920 7365 7061 7261  directory separa
-00002c00: 746f 722c 2061 7320 7265 7175 6972 6564  tor, as required
-00002c10: 2062 7920 7468 650d 0a20 2020 2020 2020   by the..       
-00002c20: 2023 205a 4950 2066 6f72 6d61 7420 7370   # ZIP format sp
-00002c30: 6563 6966 6963 6174 696f 6e2e 0d0a 2020  ecification...  
-00002c40: 2020 2020 2020 6966 206f 732e 7365 7020        if os.sep 
-00002c50: 213d 2022 2f22 2061 6e64 206f 732e 7365  != "/" and os.se
-00002c60: 7020 696e 2066 696c 656e 616d 653a 0d0a  p in filename:..
-00002c70: 2020 2020 2020 2020 2020 2020 6669 6c65              file
-00002c80: 6e61 6d65 203d 2066 696c 656e 616d 652e  name = filename.
-00002c90: 7265 706c 6163 6528 6f73 2e73 6570 2c20  replace(os.sep, 
-00002ca0: 222f 2229 0d0a 0d0a 2020 2020 2020 2020  "/")....        
-00002cb0: 7365 6c66 2e66 696c 656e 616d 6520 3d20  self.filename = 
-00002cc0: 6669 6c65 6e61 6d65 2020 2320 4e6f 726d  filename  # Norm
-00002cd0: 616c 697a 6564 2066 696c 6520 6e61 6d65  alized file name
-00002ce0: 0d0a 2020 2020 2020 2020 7365 6c66 2e64  ..        self.d
-00002cf0: 6174 655f 7469 6d65 203d 2064 6174 655f  ate_time = date_
-00002d00: 7469 6d65 2020 2320 7965 6172 2c20 6d6f  time  # year, mo
-00002d10: 6e74 682c 2064 6179 2c20 686f 7572 2c20  nth, day, hour, 
-00002d20: 6d69 6e2c 2073 6563 0d0a 0d0a 2020 2020  min, sec....    
-00002d30: 2020 2020 6966 2064 6174 655f 7469 6d65      if date_time
-00002d40: 5b30 5d20 3c20 3139 3830 3a0d 0a20 2020  [0] < 1980:..   
-00002d50: 2020 2020 2020 2020 2072 6169 7365 2056           raise V
-00002d60: 616c 7565 4572 726f 7228 225a 4950 2064  alueError("ZIP d
-00002d70: 6f65 7320 6e6f 7420 7375 7070 6f72 7420  oes not support 
-00002d80: 7469 6d65 7374 616d 7073 2062 6566 6f72  timestamps befor
-00002d90: 6520 3139 3830 2229 0d0a 0d0a 2020 2020  e 1980")....    
-00002da0: 2020 2020 2320 5374 616e 6461 7264 2076      # Standard v
-00002db0: 616c 7565 733a 0d0a 2020 2020 2020 2020  alues:..        
-00002dc0: 7365 6c66 2e63 6f6d 7072 6573 735f 7479  self.compress_ty
-00002dd0: 7065 203d 205a 4950 5f53 544f 5245 4420  pe = ZIP_STORED 
-00002de0: 2023 2054 7970 6520 6f66 2063 6f6d 7072   # Type of compr
-00002df0: 6573 7369 6f6e 2066 6f72 2074 6865 2066  ession for the f
-00002e00: 696c 650d 0a20 2020 2020 2020 2073 656c  ile..        sel
-00002e10: 662e 5f63 6f6d 7072 6573 736c 6576 656c  f._compresslevel
-00002e20: 203d 204e 6f6e 6520 2023 204c 6576 656c   = None  # Level
-00002e30: 2066 6f72 2074 6865 2063 6f6d 7072 6573   for the compres
-00002e40: 736f 720d 0a20 2020 2020 2020 2073 656c  sor..        sel
-00002e50: 662e 636f 6d6d 656e 7420 3d20 6222 2220  f.comment = b"" 
-00002e60: 2023 2043 6f6d 6d65 6e74 2066 6f72 2065   # Comment for e
-00002e70: 6163 6820 6669 6c65 0d0a 2020 2020 2020  ach file..      
-00002e80: 2020 7365 6c66 2e65 7874 7261 203d 2062    self.extra = b
-00002e90: 2222 2020 2320 5a49 5020 6578 7472 6120  ""  # ZIP extra 
-00002ea0: 6461 7461 0d0a 2020 2020 2020 2020 6966  data..        if
-00002eb0: 2073 7973 2e70 6c61 7466 6f72 6d20 3d3d   sys.platform ==
-00002ec0: 2022 7769 6e33 3222 3a0d 0a20 2020 2020   "win32":..     
-00002ed0: 2020 2020 2020 2073 656c 662e 6372 6561         self.crea
-00002ee0: 7465 5f73 7973 7465 6d20 3d20 3020 2023  te_system = 0  #
-00002ef0: 2053 7973 7465 6d20 7768 6963 6820 6372   System which cr
-00002f00: 6561 7465 6420 5a49 5020 6172 6368 6976  eated ZIP archiv
-00002f10: 650d 0a20 2020 2020 2020 2065 6c73 653a  e..        else:
-00002f20: 0d0a 2020 2020 2020 2020 2020 2020 2320  ..            # 
-00002f30: 4173 7375 6d65 2065 7665 7279 7468 696e  Assume everythin
-00002f40: 6720 656c 7365 2069 7320 756e 6978 2d79  g else is unix-y
-00002f50: 0d0a 2020 2020 2020 2020 2020 2020 7365  ..            se
-00002f60: 6c66 2e63 7265 6174 655f 7379 7374 656d  lf.create_system
-00002f70: 203d 2033 2020 2320 5379 7374 656d 2077   = 3  # System w
-00002f80: 6869 6368 2063 7265 6174 6564 205a 4950  hich created ZIP
-00002f90: 2061 7263 6869 7665 0d0a 2020 2020 2020   archive..      
-00002fa0: 2020 7365 6c66 2e63 7265 6174 655f 7665    self.create_ve
-00002fb0: 7273 696f 6e20 3d20 280d 0a20 2020 2020  rsion = (..     
-00002fc0: 2020 2020 2020 2044 4546 4155 4c54 5f56         DEFAULT_V
-00002fd0: 4552 5349 4f4e 2020 2320 5665 7273 696f  ERSION  # Versio
-00002fe0: 6e20 7768 6963 6820 6372 6561 7465 6420  n which created 
-00002ff0: 5a49 5020 6172 6368 6976 650d 0a20 2020  ZIP archive..   
-00003000: 2020 2020 2029 0d0a 2020 2020 2020 2020       )..        
-00003010: 7365 6c66 2e65 7874 7261 6374 5f76 6572  self.extract_ver
-00003020: 7369 6f6e 203d 2028 0d0a 2020 2020 2020  sion = (..      
-00003030: 2020 2020 2020 4445 4641 554c 545f 5645        DEFAULT_VE
-00003040: 5253 494f 4e20 2023 2056 6572 7369 6f6e  RSION  # Version
-00003050: 206e 6565 6465 6420 746f 2065 7874 7261   needed to extra
-00003060: 6374 2061 7263 6869 7665 0d0a 2020 2020  ct archive..    
-00003070: 2020 2020 290d 0a20 2020 2020 2020 2073      )..        s
-00003080: 656c 662e 7265 7365 7276 6564 203d 2030  elf.reserved = 0
-00003090: 2020 2320 4d75 7374 2062 6520 7a65 726f    # Must be zero
-000030a0: 0d0a 2020 2020 2020 2020 7365 6c66 2e66  ..        self.f
-000030b0: 6c61 675f 6269 7473 203d 2030 2020 2320  lag_bits = 0  # 
-000030c0: 5a49 5020 666c 6167 2062 6974 730d 0a20  ZIP flag bits.. 
-000030d0: 2020 2020 2020 2073 656c 662e 766f 6c75         self.volu
-000030e0: 6d65 203d 2030 2020 2320 566f 6c75 6d65  me = 0  # Volume
-000030f0: 206e 756d 6265 7220 6f66 2066 696c 6520   number of file 
-00003100: 6865 6164 6572 0d0a 2020 2020 2020 2020  header..        
-00003110: 7365 6c66 2e69 6e74 6572 6e61 6c5f 6174  self.internal_at
-00003120: 7472 203d 2030 2020 2320 496e 7465 726e  tr = 0  # Intern
-00003130: 616c 2061 7474 7269 6275 7465 730d 0a20  al attributes.. 
-00003140: 2020 2020 2020 2073 656c 662e 6578 7465         self.exte
-00003150: 726e 616c 5f61 7474 7220 3d20 3020 2023  rnal_attr = 0  #
-00003160: 2045 7874 6572 6e61 6c20 6669 6c65 2061   External file a
-00003170: 7474 7269 6275 7465 730d 0a20 2020 2020  ttributes..     
-00003180: 2020 2073 656c 662e 636f 6d70 7265 7373     self.compress
-00003190: 5f73 697a 6520 3d20 3020 2023 2053 697a  _size = 0  # Siz
-000031a0: 6520 6f66 2074 6865 2063 6f6d 7072 6573  e of the compres
-000031b0: 7365 6420 6669 6c65 0d0a 2020 2020 2020  sed file..      
-000031c0: 2020 7365 6c66 2e66 696c 655f 7369 7a65    self.file_size
-000031d0: 203d 2030 2020 2320 5369 7a65 206f 6620   = 0  # Size of 
-000031e0: 7468 6520 756e 636f 6d70 7265 7373 6564  the uncompressed
-000031f0: 2066 696c 650d 0a20 2020 2020 2020 2023   file..        #
-00003200: 204f 7468 6572 2061 7474 7269 6275 7465   Other attribute
-00003210: 7320 6172 6520 7365 7420 6279 2063 6c61  s are set by cla
-00003220: 7373 205a 6970 4669 6c65 3a0d 0a20 2020  ss ZipFile:..   
-00003230: 2020 2020 2023 2068 6561 6465 725f 6f66       # header_of
-00003240: 6673 6574 2020 2020 2020 2020 2042 7974  fset         Byt
-00003250: 6520 6f66 6673 6574 2074 6f20 7468 6520  e offset to the 
-00003260: 6669 6c65 2068 6561 6465 720d 0a20 2020  file header..   
-00003270: 2020 2020 2023 2043 5243 2020 2020 2020       # CRC      
-00003280: 2020 2020 2020 2020 2020 2020 2043 5243               CRC
-00003290: 2d33 3220 6f66 2074 6865 2075 6e63 6f6d  -32 of the uncom
-000032a0: 7072 6573 7365 6420 6669 6c65 0d0a 0d0a  pressed file....
-000032b0: 2020 2020 6465 6620 5f5f 7265 7072 5f5f      def __repr__
-000032c0: 2873 656c 6629 202d 3e20 7374 723a 0d0a  (self) -> str:..
-000032d0: 2020 2020 2020 2020 7265 7375 6c74 203d          result =
-000032e0: 205b 6622 3c7b 7365 6c66 2e5f 5f63 6c61   [f"<{self.__cla
-000032f0: 7373 5f5f 2e5f 5f6e 616d 655f 5f7d 2066  ss__.__name__} f
-00003300: 696c 656e 616d 653d 7b73 656c 662e 6669  ilename={self.fi
-00003310: 6c65 6e61 6d65 2172 7d22 5d0d 0a20 2020  lename!r}"]..   
-00003320: 2020 2020 2069 6620 7365 6c66 2e63 6f6d       if self.com
-00003330: 7072 6573 735f 7479 7065 2021 3d20 5a49  press_type != ZI
-00003340: 505f 5354 4f52 4544 3a0d 0a20 2020 2020  P_STORED:..     
-00003350: 2020 2020 2020 2072 6573 756c 742e 6170         result.ap
-00003360: 7065 6e64 280d 0a20 2020 2020 2020 2020  pend(..         
-00003370: 2020 2020 2020 2022 2063 6f6d 7072 6573         " compres
-00003380: 735f 7479 7065 3d25 7322 0d0a 2020 2020  s_type=%s"..    
-00003390: 2020 2020 2020 2020 2020 2020 2520 636f              % co
-000033a0: 6d70 7265 7373 6f72 5f6e 616d 6573 2e67  mpressor_names.g
-000033b0: 6574 2873 656c 662e 636f 6d70 7265 7373  et(self.compress
-000033c0: 5f74 7970 652c 2073 656c 662e 636f 6d70  _type, self.comp
-000033d0: 7265 7373 5f74 7970 6529 2c0d 0a20 2020  ress_type),..   
-000033e0: 2020 2020 2020 2020 2029 0d0a 2020 2020           )..    
-000033f0: 2020 2020 6869 203d 2073 656c 662e 6578      hi = self.ex
-00003400: 7465 726e 616c 5f61 7474 7220 3e3e 2031  ternal_attr >> 1
-00003410: 360d 0a20 2020 2020 2020 206c 6f20 3d20  6..        lo = 
-00003420: 7365 6c66 2e65 7874 6572 6e61 6c5f 6174  self.external_at
-00003430: 7472 2026 2030 7846 4646 460d 0a20 2020  tr & 0xFFFF..   
-00003440: 2020 2020 2069 6620 6869 3a0d 0a20 2020       if hi:..   
-00003450: 2020 2020 2020 2020 2072 6573 756c 742e           result.
-00003460: 6170 7065 6e64 2822 2066 696c 656d 6f64  append(" filemod
-00003470: 653d 2572 2220 2520 7374 6174 2e66 696c  e=%r" % stat.fil
-00003480: 656d 6f64 6528 6869 2929 0d0a 2020 2020  emode(hi))..    
-00003490: 2020 2020 6966 206c 6f3a 0d0a 2020 2020      if lo:..    
-000034a0: 2020 2020 2020 2020 7265 7375 6c74 2e61          result.a
-000034b0: 7070 656e 6428 2220 6578 7465 726e 616c  ppend(" external
-000034c0: 5f61 7474 723d 2523 7822 2025 206c 6f29  _attr=%#x" % lo)
-000034d0: 0d0a 2020 2020 2020 2020 6973 6469 7220  ..        isdir 
-000034e0: 3d20 7365 6c66 2e69 735f 6469 7228 290d  = self.is_dir().
-000034f0: 0a20 2020 2020 2020 2069 6620 6e6f 7420  .        if not 
-00003500: 6973 6469 7220 6f72 2073 656c 662e 6669  isdir or self.fi
-00003510: 6c65 5f73 697a 653a 0d0a 2020 2020 2020  le_size:..      
-00003520: 2020 2020 2020 7265 7375 6c74 2e61 7070        result.app
-00003530: 656e 6428 2220 6669 6c65 5f73 697a 653d  end(" file_size=
-00003540: 2572 2220 2520 7365 6c66 2e66 696c 655f  %r" % self.file_
-00003550: 7369 7a65 290d 0a20 2020 2020 2020 2069  size)..        i
-00003560: 6620 286e 6f74 2069 7364 6972 206f 7220  f (not isdir or 
-00003570: 7365 6c66 2e63 6f6d 7072 6573 735f 7369  self.compress_si
-00003580: 7a65 2920 616e 6420 280d 0a20 2020 2020  ze) and (..     
-00003590: 2020 2020 2020 2073 656c 662e 636f 6d70         self.comp
-000035a0: 7265 7373 5f74 7970 6520 213d 205a 4950  ress_type != ZIP
-000035b0: 5f53 544f 5245 440d 0a20 2020 2020 2020  _STORED..       
-000035c0: 2020 2020 206f 7220 7365 6c66 2e66 696c       or self.fil
-000035d0: 655f 7369 7a65 2021 3d20 7365 6c66 2e63  e_size != self.c
-000035e0: 6f6d 7072 6573 735f 7369 7a65 0d0a 2020  ompress_size..  
-000035f0: 2020 2020 2020 293a 0d0a 2020 2020 2020        ):..      
-00003600: 2020 2020 2020 7265 7375 6c74 2e61 7070        result.app
-00003610: 656e 6428 2220 636f 6d70 7265 7373 5f73  end(" compress_s
-00003620: 697a 653d 2572 2220 2520 7365 6c66 2e63  ize=%r" % self.c
-00003630: 6f6d 7072 6573 735f 7369 7a65 290d 0a20  ompress_size).. 
-00003640: 2020 2020 2020 2072 6573 756c 742e 6170         result.ap
-00003650: 7065 6e64 2822 3e22 290d 0a20 2020 2020  pend(">")..     
-00003660: 2020 2072 6574 7572 6e20 2222 2e6a 6f69     return "".joi
-00003670: 6e28 7265 7375 6c74 290d 0a0d 0a20 2020  n(result)....   
-00003680: 2064 6566 2046 696c 6548 6561 6465 7228   def FileHeader(
-00003690: 7365 6c66 2c20 7a69 7036 343d 4e6f 6e65  self, zip64=None
-000036a0: 293a 0d0a 2020 2020 2020 2020 2222 2252  ):..        """R
-000036b0: 6574 7572 6e20 7468 6520 7065 722d 6669  eturn the per-fi
-000036c0: 6c65 2068 6561 6465 7220 6173 2061 2062  le header as a b
-000036d0: 7974 6573 206f 626a 6563 742e 2222 220d  ytes object.""".
-000036e0: 0a20 2020 2020 2020 2064 7420 3d20 7365  .        dt = se
-000036f0: 6c66 2e64 6174 655f 7469 6d65 0d0a 2020  lf.date_time..  
-00003700: 2020 2020 2020 646f 7364 6174 6520 3d20        dosdate = 
-00003710: 2864 745b 305d 202d 2031 3938 3029 203c  (dt[0] - 1980) <
-00003720: 3c20 3920 7c20 6474 5b31 5d20 3c3c 2035  < 9 | dt[1] << 5
-00003730: 207c 2064 745b 325d 0d0a 2020 2020 2020   | dt[2]..      
-00003740: 2020 646f 7374 696d 6520 3d20 6474 5b33    dostime = dt[3
-00003750: 5d20 3c3c 2031 3120 7c20 6474 5b34 5d20  ] << 11 | dt[4] 
-00003760: 3c3c 2035 207c 2028 6474 5b35 5d20 2f2f  << 5 | (dt[5] //
-00003770: 2032 290d 0a20 2020 2020 2020 2069 6620   2)..        if 
-00003780: 7365 6c66 2e66 6c61 675f 6269 7473 2026  self.flag_bits &
-00003790: 2030 7830 383a 0d0a 2020 2020 2020 2020   0x08:..        
-000037a0: 2020 2020 2320 5365 7420 7468 6573 6520      # Set these 
-000037b0: 746f 207a 6572 6f20 6265 6361 7573 6520  to zero because 
-000037c0: 7765 2077 7269 7465 2074 6865 6d20 6166  we write them af
-000037d0: 7465 7220 7468 6520 6669 6c65 2064 6174  ter the file dat
-000037e0: 610d 0a20 2020 2020 2020 2020 2020 2043  a..            C
-000037f0: 5243 203d 2063 6f6d 7072 6573 735f 7369  RC = compress_si
-00003800: 7a65 203d 2066 696c 655f 7369 7a65 203d  ze = file_size =
-00003810: 2030 0d0a 2020 2020 2020 2020 656c 7365   0..        else
-00003820: 3a0d 0a20 2020 2020 2020 2020 2020 2043  :..            C
-00003830: 5243 203d 2073 656c 662e 4352 430d 0a20  RC = self.CRC.. 
-00003840: 2020 2020 2020 2020 2020 2063 6f6d 7072             compr
-00003850: 6573 735f 7369 7a65 203d 2073 656c 662e  ess_size = self.
-00003860: 636f 6d70 7265 7373 5f73 697a 650d 0a20  compress_size.. 
-00003870: 2020 2020 2020 2020 2020 2066 696c 655f             file_
-00003880: 7369 7a65 203d 2073 656c 662e 6669 6c65  size = self.file
-00003890: 5f73 697a 650d 0a0d 0a20 2020 2020 2020  _size....       
-000038a0: 2065 7874 7261 203d 2073 656c 662e 6578   extra = self.ex
-000038b0: 7472 610d 0a0d 0a20 2020 2020 2020 206d  tra....        m
-000038c0: 696e 5f76 6572 7369 6f6e 203d 2030 0d0a  in_version = 0..
-000038d0: 2020 2020 2020 2020 6966 207a 6970 3634          if zip64
-000038e0: 2069 7320 4e6f 6e65 3a0d 0a20 2020 2020   is None:..     
-000038f0: 2020 2020 2020 207a 6970 3634 203d 2066         zip64 = f
-00003900: 696c 655f 7369 7a65 203e 205a 4950 3634  ile_size > ZIP64
-00003910: 5f4c 494d 4954 206f 7220 636f 6d70 7265  _LIMIT or compre
-00003920: 7373 5f73 697a 6520 3e20 5a49 5036 345f  ss_size > ZIP64_
-00003930: 4c49 4d49 540d 0a20 2020 2020 2020 2069  LIMIT..        i
-00003940: 6620 7a69 7036 343a 0d0a 2020 2020 2020  f zip64:..      
-00003950: 2020 2020 2020 666d 7420 3d20 223c 4848        fmt = "<HH
-00003960: 5151 220d 0a20 2020 2020 2020 2020 2020  QQ"..           
-00003970: 2065 7874 7261 203d 2065 7874 7261 202b   extra = extra +
-00003980: 2073 7472 7563 742e 7061 636b 280d 0a20   struct.pack(.. 
-00003990: 2020 2020 2020 2020 2020 2020 2020 2066                 f
-000039a0: 6d74 2c0d 0a20 2020 2020 2020 2020 2020  mt,..           
-000039b0: 2020 2020 2031 2c0d 0a20 2020 2020 2020       1,..       
-000039c0: 2020 2020 2020 2020 2073 7472 7563 742e           struct.
-000039d0: 6361 6c63 7369 7a65 2866 6d74 2920 2d20  calcsize(fmt) - 
-000039e0: 342c 0d0a 2020 2020 2020 2020 2020 2020  4,..            
-000039f0: 2020 2020 6669 6c65 5f73 697a 652c 0d0a      file_size,..
-00003a00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00003a10: 636f 6d70 7265 7373 5f73 697a 652c 0d0a  compress_size,..
-00003a20: 2020 2020 2020 2020 2020 2020 290d 0a20              ).. 
-00003a30: 2020 2020 2020 2069 6620 6669 6c65 5f73         if file_s
-00003a40: 697a 6520 3e20 5a49 5036 345f 4c49 4d49  ize > ZIP64_LIMI
-00003a50: 5420 6f72 2063 6f6d 7072 6573 735f 7369  T or compress_si
-00003a60: 7a65 203e 205a 4950 3634 5f4c 494d 4954  ze > ZIP64_LIMIT
-00003a70: 3a0d 0a20 2020 2020 2020 2020 2020 2069  :..            i
-00003a80: 6620 6e6f 7420 7a69 7036 343a 0d0a 2020  f not zip64:..  
-00003a90: 2020 2020 2020 2020 2020 2020 2020 7261                ra
-00003aa0: 6973 6520 4c61 7267 655a 6970 4669 6c65  ise LargeZipFile
-00003ab0: 2822 4669 6c65 7369 7a65 2077 6f75 6c64  ("Filesize would
-00003ac0: 2072 6571 7569 7265 205a 4950 3634 2065   require ZIP64 e
-00003ad0: 7874 656e 7369 6f6e 7322 290d 0a20 2020  xtensions")..   
-00003ae0: 2020 2020 2020 2020 2023 2046 696c 6520           # File 
-00003af0: 6973 206c 6172 6765 7220 7468 616e 2077  is larger than w
-00003b00: 6861 7420 6669 7473 2069 6e74 6f20 6120  hat fits into a 
-00003b10: 3420 6279 7465 2069 6e74 6567 6572 2c0d  4 byte integer,.
-00003b20: 0a20 2020 2020 2020 2020 2020 2023 2066  .            # f
-00003b30: 616c 6c20 6261 636b 2074 6f20 7468 6520  all back to the 
-00003b40: 5a49 5036 3420 6578 7465 6e73 696f 6e0d  ZIP64 extension.
-00003b50: 0a20 2020 2020 2020 2020 2020 2066 696c  .            fil
-00003b60: 655f 7369 7a65 203d 2030 7846 4646 4646  e_size = 0xFFFFF
-00003b70: 4646 460d 0a20 2020 2020 2020 2020 2020  FFF..           
-00003b80: 2063 6f6d 7072 6573 735f 7369 7a65 203d   compress_size =
-00003b90: 2030 7846 4646 4646 4646 460d 0a20 2020   0xFFFFFFFF..   
-00003ba0: 2020 2020 2020 2020 206d 696e 5f76 6572           min_ver
-00003bb0: 7369 6f6e 203d 205a 4950 3634 5f56 4552  sion = ZIP64_VER
-00003bc0: 5349 4f4e 0d0a 0d0a 2020 2020 2020 2020  SION....        
-00003bd0: 6966 2073 656c 662e 636f 6d70 7265 7373  if self.compress
-00003be0: 5f74 7970 6520 3d3d 205a 4950 5f42 5a49  _type == ZIP_BZI
-00003bf0: 5032 3a0d 0a20 2020 2020 2020 2020 2020  P2:..           
-00003c00: 206d 696e 5f76 6572 7369 6f6e 203d 206d   min_version = m
-00003c10: 6178 2842 5a49 5032 5f56 4552 5349 4f4e  ax(BZIP2_VERSION
-00003c20: 2c20 6d69 6e5f 7665 7273 696f 6e29 0d0a  , min_version)..
-00003c30: 2020 2020 2020 2020 656c 6966 2073 656c          elif sel
-00003c40: 662e 636f 6d70 7265 7373 5f74 7970 6520  f.compress_type 
-00003c50: 3d3d 205a 4950 5f4c 5a4d 413a 0d0a 2020  == ZIP_LZMA:..  
-00003c60: 2020 2020 2020 2020 2020 6d69 6e5f 7665            min_ve
-00003c70: 7273 696f 6e20 3d20 6d61 7828 4c5a 4d41  rsion = max(LZMA
-00003c80: 5f56 4552 5349 4f4e 2c20 6d69 6e5f 7665  _VERSION, min_ve
-00003c90: 7273 696f 6e29 0d0a 0d0a 2020 2020 2020  rsion)....      
-00003ca0: 2020 7365 6c66 2e65 7874 7261 6374 5f76    self.extract_v
-00003cb0: 6572 7369 6f6e 203d 206d 6178 286d 696e  ersion = max(min
-00003cc0: 5f76 6572 7369 6f6e 2c20 7365 6c66 2e65  _version, self.e
-00003cd0: 7874 7261 6374 5f76 6572 7369 6f6e 290d  xtract_version).
-00003ce0: 0a20 2020 2020 2020 2073 656c 662e 6372  .        self.cr
-00003cf0: 6561 7465 5f76 6572 7369 6f6e 203d 206d  eate_version = m
-00003d00: 6178 286d 696e 5f76 6572 7369 6f6e 2c20  ax(min_version, 
-00003d10: 7365 6c66 2e63 7265 6174 655f 7665 7273  self.create_vers
-00003d20: 696f 6e29 0d0a 2020 2020 2020 2020 6669  ion)..        fi
-00003d30: 6c65 6e61 6d65 2c20 666c 6167 5f62 6974  lename, flag_bit
-00003d40: 7320 3d20 7365 6c66 2e5f 656e 636f 6465  s = self._encode
-00003d50: 4669 6c65 6e61 6d65 466c 6167 7328 290d  FilenameFlags().
-00003d60: 0a20 2020 2020 2020 2068 6561 6465 7220  .        header 
-00003d70: 3d20 7374 7275 6374 2e70 6163 6b28 0d0a  = struct.pack(..
-00003d80: 2020 2020 2020 2020 2020 2020 7374 7275              stru
-00003d90: 6374 4669 6c65 4865 6164 6572 2c0d 0a20  ctFileHeader,.. 
-00003da0: 2020 2020 2020 2020 2020 2073 7472 696e             strin
-00003db0: 6746 696c 6548 6561 6465 722c 0d0a 2020  gFileHeader,..  
-00003dc0: 2020 2020 2020 2020 2020 7365 6c66 2e65            self.e
-00003dd0: 7874 7261 6374 5f76 6572 7369 6f6e 2c0d  xtract_version,.
-00003de0: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-00003df0: 662e 7265 7365 7276 6564 2c0d 0a20 2020  f.reserved,..   
-00003e00: 2020 2020 2020 2020 2066 6c61 675f 6269           flag_bi
-00003e10: 7473 2c0d 0a20 2020 2020 2020 2020 2020  ts,..           
-00003e20: 2073 656c 662e 636f 6d70 7265 7373 5f74   self.compress_t
-00003e30: 7970 652c 0d0a 2020 2020 2020 2020 2020  ype,..          
-00003e40: 2020 646f 7374 696d 652c 0d0a 2020 2020    dostime,..    
-00003e50: 2020 2020 2020 2020 646f 7364 6174 652c          dosdate,
-00003e60: 0d0a 2020 2020 2020 2020 2020 2020 4352  ..            CR
-00003e70: 432c 0d0a 2020 2020 2020 2020 2020 2020  C,..            
-00003e80: 636f 6d70 7265 7373 5f73 697a 652c 0d0a  compress_size,..
-00003e90: 2020 2020 2020 2020 2020 2020 6669 6c65              file
-00003ea0: 5f73 697a 652c 0d0a 2020 2020 2020 2020  _size,..        
-00003eb0: 2020 2020 6c65 6e28 6669 6c65 6e61 6d65      len(filename
-00003ec0: 292c 0d0a 2020 2020 2020 2020 2020 2020  ),..            
-00003ed0: 6c65 6e28 6578 7472 6129 2c0d 0a20 2020  len(extra),..   
-00003ee0: 2020 2020 2029 0d0a 2020 2020 2020 2020       )..        
-00003ef0: 7265 7475 726e 2068 6561 6465 7220 2b20  return header + 
-00003f00: 6669 6c65 6e61 6d65 202b 2065 7874 7261  filename + extra
-00003f10: 0d0a 0d0a 2020 2020 6465 6620 5f65 6e63  ....    def _enc
-00003f20: 6f64 6546 696c 656e 616d 6546 6c61 6773  odeFilenameFlags
-00003f30: 2873 656c 6629 3a0d 0a20 2020 2020 2020  (self):..       
-00003f40: 2074 7279 3a0d 0a20 2020 2020 2020 2020   try:..         
-00003f50: 2020 2072 6574 7572 6e20 7365 6c66 2e66     return self.f
-00003f60: 696c 656e 616d 652e 656e 636f 6465 2822  ilename.encode("
-00003f70: 6173 6369 6922 292c 2073 656c 662e 666c  ascii"), self.fl
-00003f80: 6167 5f62 6974 730d 0a20 2020 2020 2020  ag_bits..       
-00003f90: 2065 7863 6570 7420 556e 6963 6f64 6545   except UnicodeE
-00003fa0: 6e63 6f64 6545 7272 6f72 3a0d 0a20 2020  ncodeError:..   
-00003fb0: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
-00003fc0: 7365 6c66 2e66 696c 656e 616d 652e 656e  self.filename.en
-00003fd0: 636f 6465 2822 7574 662d 3822 292c 2073  code("utf-8"), s
-00003fe0: 656c 662e 666c 6167 5f62 6974 7320 7c20  elf.flag_bits | 
-00003ff0: 3078 3830 300d 0a0d 0a20 2020 2064 6566  0x800....    def
-00004000: 205f 6465 636f 6465 4578 7472 6128 7365   _decodeExtra(se
-00004010: 6c66 293a 0d0a 2020 2020 2020 2020 2320  lf):..        # 
-00004020: 5472 7920 746f 2064 6563 6f64 6520 7468  Try to decode th
-00004030: 6520 6578 7472 6120 6669 656c 642e 0d0a  e extra field...
-00004040: 2020 2020 2020 2020 6578 7472 6120 3d20          extra = 
-00004050: 7365 6c66 2e65 7874 7261 0d0a 2020 2020  self.extra..    
-00004060: 2020 2020 756e 7061 636b 203d 2073 7472      unpack = str
-00004070: 7563 742e 756e 7061 636b 0d0a 2020 2020  uct.unpack..    
-00004080: 2020 2020 7768 696c 6520 6c65 6e28 6578      while len(ex
-00004090: 7472 6129 203e 3d20 343a 0d0a 2020 2020  tra) >= 4:..    
-000040a0: 2020 2020 2020 2020 7470 2c20 6c6e 203d          tp, ln =
-000040b0: 2075 6e70 6163 6b28 223c 4848 222c 2065   unpack("<HH", e
-000040c0: 7874 7261 5b3a 345d 290d 0a20 2020 2020  xtra[:4])..     
-000040d0: 2020 2020 2020 2069 6620 6c6e 202b 2034         if ln + 4
-000040e0: 203e 206c 656e 2865 7874 7261 293a 0d0a   > len(extra):..
-000040f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004100: 7261 6973 6520 4261 645a 6970 4669 6c65  raise BadZipFile
-00004110: 280d 0a20 2020 2020 2020 2020 2020 2020  (..             
-00004120: 2020 2020 2020 2022 436f 7272 7570 7420         "Corrupt 
-00004130: 6578 7472 6120 6669 656c 6420 2530 3478  extra field %04x
-00004140: 2028 7369 7a65 3d25 6429 2220 2520 2874   (size=%d)" % (t
-00004150: 702c 206c 6e29 2c0d 0a20 2020 2020 2020  p, ln),..       
-00004160: 2020 2020 2020 2020 2029 0d0a 2020 2020           )..    
-00004170: 2020 2020 2020 2020 6966 2074 7020 3d3d          if tp ==
-00004180: 2030 7830 3030 313a 0d0a 2020 2020 2020   0x0001:..      
-00004190: 2020 2020 2020 2020 2020 6461 7461 203d            data =
-000041a0: 2065 7874 7261 5b34 203a 206c 6e20 2b20   extra[4 : ln + 
-000041b0: 345d 0d0a 2020 2020 2020 2020 2020 2020  4]..            
-000041c0: 2020 2020 2320 5a49 5036 3420 6578 7465      # ZIP64 exte
-000041d0: 6e73 696f 6e20 286c 6172 6765 2066 696c  nsion (large fil
-000041e0: 6573 2061 6e64 2f6f 7220 6c61 7267 6520  es and/or large 
-000041f0: 6172 6368 6976 6573 290d 0a20 2020 2020  archives)..     
-00004200: 2020 2020 2020 2020 2020 2074 7279 3a0d             try:.
-00004210: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00004220: 2020 2020 2069 6620 7365 6c66 2e66 696c       if self.fil
-00004230: 655f 7369 7a65 2069 6e20 2830 7846 4646  e_size in (0xFFF
-00004240: 465f 4646 4646 5f46 4646 465f 4646 4646  F_FFFF_FFFF_FFFF
-00004250: 2c20 3078 4646 4646 5f46 4646 4629 3a0d  , 0xFFFF_FFFF):.
-00004260: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00004270: 2020 2020 2020 2020 2066 6965 6c64 203d           field =
-00004280: 2022 4669 6c65 2073 697a 6522 0d0a 2020   "File size"..  
-00004290: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000042a0: 2020 2020 2020 2873 656c 662e 6669 6c65        (self.file
-000042b0: 5f73 697a 652c 2920 3d20 756e 7061 636b  _size,) = unpack
-000042c0: 2822 3c51 222c 2064 6174 615b 3a38 5d29  ("<Q", data[:8])
-000042d0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-000042e0: 2020 2020 2020 2020 2020 6461 7461 203d            data =
-000042f0: 2064 6174 615b 383a 5d0d 0a20 2020 2020   data[8:]..     
-00004300: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-00004310: 6620 7365 6c66 2e63 6f6d 7072 6573 735f  f self.compress_
-00004320: 7369 7a65 203d 3d20 3078 4646 4646 5f46  size == 0xFFFF_F
-00004330: 4646 463a 0d0a 2020 2020 2020 2020 2020  FFF:..          
-00004340: 2020 2020 2020 2020 2020 2020 2020 6669                fi
-00004350: 656c 6420 3d20 2243 6f6d 7072 6573 7320  eld = "Compress 
-00004360: 7369 7a65 220d 0a20 2020 2020 2020 2020  size"..         
-00004370: 2020 2020 2020 2020 2020 2020 2020 2028                 (
-00004380: 7365 6c66 2e63 6f6d 7072 6573 735f 7369  self.compress_si
-00004390: 7a65 2c29 203d 2075 6e70 6163 6b28 223c  ze,) = unpack("<
-000043a0: 5122 2c20 6461 7461 5b3a 385d 290d 0a20  Q", data[:8]).. 
-000043b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000043c0: 2020 2020 2020 2064 6174 6120 3d20 6461         data = da
-000043d0: 7461 5b38 3a5d 0d0a 2020 2020 2020 2020  ta[8:]..        
-000043e0: 2020 2020 2020 2020 2020 2020 6966 2073              if s
-000043f0: 656c 662e 6865 6164 6572 5f6f 6666 7365  elf.header_offse
-00004400: 7420 3d3d 2030 7846 4646 465f 4646 4646  t == 0xFFFF_FFFF
-00004410: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
-00004420: 2020 2020 2020 2020 2020 2066 6965 6c64             field
-00004430: 203d 2022 4865 6164 6572 206f 6666 7365   = "Header offse
-00004440: 7422 0d0a 2020 2020 2020 2020 2020 2020  t"..            
-00004450: 2020 2020 2020 2020 2020 2020 2873 656c              (sel
-00004460: 662e 6865 6164 6572 5f6f 6666 7365 742c  f.header_offset,
-00004470: 2920 3d20 756e 7061 636b 2822 3c51 222c  ) = unpack("<Q",
-00004480: 2064 6174 615b 3a38 5d29 0d0a 2020 2020   data[:8])..    
-00004490: 2020 2020 2020 2020 2020 2020 6578 6365              exce
-000044a0: 7074 2073 7472 7563 742e 6572 726f 723a  pt struct.error:
-000044b0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-000044c0: 2020 2020 2020 7261 6973 6520 4261 645a        raise BadZ
-000044d0: 6970 4669 6c65 280d 0a20 2020 2020 2020  ipFile(..       
-000044e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000044f0: 2066 2243 6f72 7275 7074 207a 6970 3634   f"Corrupt zip64
-00004500: 2065 7874 7261 2066 6965 6c64 2e20 2220   extra field. " 
-00004510: 6622 7b66 6965 6c64 7d20 6e6f 7420 666f  f"{field} not fo
-00004520: 756e 642e 222c 0d0a 2020 2020 2020 2020  und.",..        
-00004530: 2020 2020 2020 2020 2020 2020 2920 6672              ) fr
-00004540: 6f6d 204e 6f6e 650d 0a0d 0a20 2020 2020  om None....     
-00004550: 2020 2020 2020 2065 7874 7261 203d 2065         extra = e
-00004560: 7874 7261 5b6c 6e20 2b20 3420 3a5d 0d0a  xtra[ln + 4 :]..
-00004570: 0d0a 2020 2020 4063 6c61 7373 6d65 7468  ..    @classmeth
-00004580: 6f64 0d0a 2020 2020 6465 6620 6672 6f6d  od..    def from
-00004590: 5f66 696c 6528 636c 732c 2066 696c 656e  _file(cls, filen
-000045a0: 616d 652c 2061 7263 6e61 6d65 3d4e 6f6e  ame, arcname=Non
-000045b0: 652c 202a 2c20 7374 7269 6374 5f74 696d  e, *, strict_tim
-000045c0: 6573 7461 6d70 733d 5472 7565 293a 0d0a  estamps=True):..
-000045d0: 2020 2020 2020 2020 2222 2243 6f6e 7374          """Const
-000045e0: 7275 6374 2061 6e20 6170 7072 6f70 7269  ruct an appropri
-000045f0: 6174 6520 5a69 7049 6e66 6f20 666f 7220  ate ZipInfo for 
-00004600: 6120 6669 6c65 206f 6e20 7468 6520 6669  a file on the fi
-00004610: 6c65 7379 7374 656d 2e0d 0a0d 0a20 2020  lesystem.....   
-00004620: 2020 2020 2066 696c 656e 616d 6520 7368       filename sh
-00004630: 6f75 6c64 2062 6520 7468 6520 7061 7468  ould be the path
-00004640: 2074 6f20 6120 6669 6c65 206f 7220 6469   to a file or di
-00004650: 7265 6374 6f72 7920 6f6e 2074 6865 2066  rectory on the f
-00004660: 696c 6573 7973 7465 6d2e 0d0a 0d0a 2020  ilesystem.....  
-00004670: 2020 2020 2020 6172 636e 616d 6520 6973        arcname is
-00004680: 2074 6865 206e 616d 6520 7768 6963 6820   the name which 
-00004690: 6974 2077 696c 6c20 6861 7665 2077 6974  it will have wit
-000046a0: 6869 6e20 7468 6520 6172 6368 6976 6520  hin the archive 
-000046b0: 2862 7920 6465 6661 756c 742c 0d0a 2020  (by default,..  
-000046c0: 2020 2020 2020 7468 6973 2077 696c 6c20        this will 
-000046d0: 6265 2074 6865 2073 616d 6520 6173 2066  be the same as f
-000046e0: 696c 656e 616d 652c 2062 7574 2077 6974  ilename, but wit
-000046f0: 686f 7574 2061 2064 7269 7665 206c 6574  hout a drive let
-00004700: 7465 7220 616e 6420 7769 7468 0d0a 2020  ter and with..  
-00004710: 2020 2020 2020 6c65 6164 696e 6720 7061        leading pa
-00004720: 7468 2073 6570 6172 6174 6f72 7320 7265  th separators re
-00004730: 6d6f 7665 6429 2e0d 0a20 2020 2020 2020  moved)...       
-00004740: 2022 2222 0d0a 2020 2020 2020 2020 6966   """..        if
-00004750: 2069 7369 6e73 7461 6e63 6528 6669 6c65   isinstance(file
-00004760: 6e61 6d65 2c20 6f73 2e50 6174 684c 696b  name, os.PathLik
-00004770: 6529 3a0d 0a20 2020 2020 2020 2020 2020  e):..           
-00004780: 2066 696c 656e 616d 6520 3d20 6f73 2e66   filename = os.f
-00004790: 7370 6174 6828 6669 6c65 6e61 6d65 290d  spath(filename).
-000047a0: 0a20 2020 2020 2020 2073 7420 3d20 6f73  .        st = os
-000047b0: 2e73 7461 7428 6669 6c65 6e61 6d65 290d  .stat(filename).
-000047c0: 0a20 2020 2020 2020 2069 7364 6972 203d  .        isdir =
-000047d0: 2073 7461 742e 535f 4953 4449 5228 7374   stat.S_ISDIR(st
-000047e0: 2e73 745f 6d6f 6465 290d 0a20 2020 2020  .st_mode)..     
-000047f0: 2020 206d 7469 6d65 203d 2074 696d 652e     mtime = time.
-00004800: 6c6f 6361 6c74 696d 6528 7374 2e73 745f  localtime(st.st_
-00004810: 6d74 696d 6529 0d0a 2020 2020 2020 2020  mtime)..        
-00004820: 6461 7465 5f74 696d 6520 3d20 6d74 696d  date_time = mtim
-00004830: 655b 303a 365d 0d0a 2020 2020 2020 2020  e[0:6]..        
-00004840: 6966 206e 6f74 2073 7472 6963 745f 7469  if not strict_ti
-00004850: 6d65 7374 616d 7073 2061 6e64 2064 6174  mestamps and dat
-00004860: 655f 7469 6d65 5b30 5d20 3c20 3139 3830  e_time[0] < 1980
-00004870: 3a0d 0a20 2020 2020 2020 2020 2020 2064  :..            d
-00004880: 6174 655f 7469 6d65 203d 2028 3139 3830  ate_time = (1980
-00004890: 2c20 312c 2031 2c20 302c 2030 2c20 3029  , 1, 1, 0, 0, 0)
-000048a0: 0d0a 2020 2020 2020 2020 656c 6966 206e  ..        elif n
-000048b0: 6f74 2073 7472 6963 745f 7469 6d65 7374  ot strict_timest
-000048c0: 616d 7073 2061 6e64 2064 6174 655f 7469  amps and date_ti
-000048d0: 6d65 5b30 5d20 3e20 3231 3037 3a0d 0a20  me[0] > 2107:.. 
-000048e0: 2020 2020 2020 2020 2020 2064 6174 655f             date_
-000048f0: 7469 6d65 203d 2028 3231 3037 2c20 3132  time = (2107, 12
-00004900: 2c20 3331 2c20 3233 2c20 3539 2c20 3539  , 31, 23, 59, 59
-00004910: 290d 0a20 2020 2020 2020 2023 2043 7265  )..        # Cre
-00004920: 6174 6520 5a69 7049 6e66 6f20 696e 7374  ate ZipInfo inst
-00004930: 616e 6365 2074 6f20 7374 6f72 6520 6669  ance to store fi
-00004940: 6c65 2069 6e66 6f72 6d61 7469 6f6e 0d0a  le information..
-00004950: 2020 2020 2020 2020 6966 2061 7263 6e61          if arcna
-00004960: 6d65 2069 7320 4e6f 6e65 3a0d 0a20 2020  me is None:..   
-00004970: 2020 2020 2020 2020 2061 7263 6e61 6d65           arcname
-00004980: 203d 2066 696c 656e 616d 650d 0a20 2020   = filename..   
-00004990: 2020 2020 2061 7263 6e61 6d65 203d 206f       arcname = o
-000049a0: 732e 7061 7468 2e6e 6f72 6d70 6174 6828  s.path.normpath(
-000049b0: 6f73 2e70 6174 682e 7370 6c69 7464 7269  os.path.splitdri
-000049c0: 7665 2861 7263 6e61 6d65 295b 315d 290d  ve(arcname)[1]).
-000049d0: 0a20 2020 2020 2020 2077 6869 6c65 2061  .        while a
-000049e0: 7263 6e61 6d65 5b30 5d20 696e 2028 6f73  rcname[0] in (os
-000049f0: 2e73 6570 2c20 6f73 2e61 6c74 7365 7029  .sep, os.altsep)
-00004a00: 3a0d 0a20 2020 2020 2020 2020 2020 2061  :..            a
-00004a10: 7263 6e61 6d65 203d 2061 7263 6e61 6d65  rcname = arcname
-00004a20: 5b31 3a5d 0d0a 2020 2020 2020 2020 6966  [1:]..        if
-00004a30: 2069 7364 6972 3a0d 0a20 2020 2020 2020   isdir:..       
-00004a40: 2020 2020 2061 7263 6e61 6d65 202b 3d20       arcname += 
-00004a50: 222f 220d 0a20 2020 2020 2020 207a 696e  "/"..        zin
-00004a60: 666f 203d 2063 6c73 2861 7263 6e61 6d65  fo = cls(arcname
-00004a70: 2c20 6461 7465 5f74 696d 6529 0d0a 2020  , date_time)..  
-00004a80: 2020 2020 2020 7a69 6e66 6f2e 6578 7465        zinfo.exte
-00004a90: 726e 616c 5f61 7474 7220 3d20 2873 742e  rnal_attr = (st.
-00004aa0: 7374 5f6d 6f64 6520 2620 3078 4646 4646  st_mode & 0xFFFF
-00004ab0: 2920 3c3c 2031 3620 2023 2055 6e69 7820  ) << 16  # Unix 
-00004ac0: 6174 7472 6962 7574 6573 0d0a 2020 2020  attributes..    
-00004ad0: 2020 2020 6966 2069 7364 6972 3a0d 0a20      if isdir:.. 
-00004ae0: 2020 2020 2020 2020 2020 207a 696e 666f             zinfo
-00004af0: 2e66 696c 655f 7369 7a65 203d 2030 0d0a  .file_size = 0..
-00004b00: 2020 2020 2020 2020 2020 2020 7a69 6e66              zinf
-00004b10: 6f2e 6578 7465 726e 616c 5f61 7474 7220  o.external_attr 
-00004b20: 7c3d 2030 7831 3020 2023 204d 532d 444f  |= 0x10  # MS-DO
-00004b30: 5320 6469 7265 6374 6f72 7920 666c 6167  S directory flag
-00004b40: 0d0a 2020 2020 2020 2020 656c 7365 3a0d  ..        else:.
-00004b50: 0a20 2020 2020 2020 2020 2020 207a 696e  .            zin
-00004b60: 666f 2e66 696c 655f 7369 7a65 203d 2073  fo.file_size = s
-00004b70: 742e 7374 5f73 697a 650d 0a0d 0a20 2020  t.st_size....   
-00004b80: 2020 2020 2072 6574 7572 6e20 7a69 6e66       return zinf
-00004b90: 6f0d 0a0d 0a20 2020 2064 6566 2069 735f  o....    def is_
-00004ba0: 6469 7228 7365 6c66 293a 0d0a 2020 2020  dir(self):..    
-00004bb0: 2020 2020 2222 2252 6574 7572 6e20 5472      """Return Tr
-00004bc0: 7565 2069 6620 7468 6973 2061 7263 6869  ue if this archi
-00004bd0: 7665 206d 656d 6265 7220 6973 2061 2064  ve member is a d
-00004be0: 6972 6563 746f 7279 2e22 2222 0d0a 2020  irectory."""..  
-00004bf0: 2020 2020 2020 7265 7475 726e 2073 656c        return sel
-00004c00: 662e 6669 6c65 6e61 6d65 5b2d 315d 203d  f.filename[-1] =
-00004c10: 3d20 222f 220d 0a0d 0a0d 0a23 205a 4950  = "/"......# ZIP
-00004c20: 2065 6e63 7279 7074 696f 6e20 7573 6573   encryption uses
-00004c30: 2074 6865 2043 5243 3332 206f 6e65 2d62   the CRC32 one-b
-00004c40: 7974 6520 7072 696d 6974 6976 6520 666f  yte primitive fo
-00004c50: 7220 7363 7261 6d62 6c69 6e67 2073 6f6d  r scrambling som
-00004c60: 650d 0a23 2069 6e74 6572 6e61 6c20 6b65  e..# internal ke
-00004c70: 7973 2e20 5765 206e 6f74 6963 6564 2074  ys. We noticed t
-00004c80: 6861 7420 6120 6469 7265 6374 2069 6d70  hat a direct imp
-00004c90: 6c65 6d65 6e74 6174 696f 6e20 6973 2066  lementation is f
-00004ca0: 6173 7465 7220 7468 616e 0d0a 2320 7265  aster than..# re
-00004cb0: 6c79 696e 6720 6f6e 2062 696e 6173 6369  lying on binasci
-00004cc0: 692e 6372 6333 3228 292e 0d0a 0d0a 5f63  i.crc32()....._c
-00004cd0: 7263 7461 626c 6520 3d20 4e6f 6e65 0d0a  rctable = None..
-00004ce0: 0d0a 0d0a 6465 6620 5f67 656e 5f63 7263  ....def _gen_crc
-00004cf0: 2863 7263 293a 0d0a 2020 2020 666f 7220  (crc):..    for 
-00004d00: 5f6a 2069 6e20 7261 6e67 6528 3829 3a0d  _j in range(8):.
-00004d10: 0a20 2020 2020 2020 2069 6620 6372 6320  .        if crc 
-00004d20: 2620 313a 0d0a 2020 2020 2020 2020 2020  & 1:..          
-00004d30: 2020 6372 6320 3d20 2863 7263 203e 3e20    crc = (crc >> 
-00004d40: 3129 205e 2030 7845 4442 3838 3332 300d  1) ^ 0xEDB88320.
-00004d50: 0a20 2020 2020 2020 2065 6c73 653a 0d0a  .        else:..
-00004d60: 2020 2020 2020 2020 2020 2020 6372 6320              crc 
-00004d70: 3e3e 3d20 310d 0a20 2020 2072 6574 7572  >>= 1..    retur
-00004d80: 6e20 6372 630d 0a0d 0a0d 0a23 205a 4950  n crc......# ZIP
-00004d90: 2073 7570 706f 7274 7320 6120 7061 7373   supports a pass
-00004da0: 776f 7264 2d62 6173 6564 2066 6f72 6d20  word-based form 
-00004db0: 6f66 2065 6e63 7279 7074 696f 6e2e 2045  of encryption. E
-00004dc0: 7665 6e20 7468 6f75 6768 206b 6e6f 776e  ven though known
-00004dd0: 0d0a 2320 706c 6169 6e74 6578 7420 6174  ..# plaintext at
-00004de0: 7461 636b 7320 6861 7665 2062 6565 6e20  tacks have been 
-00004df0: 666f 756e 6420 6167 6169 6e73 7420 6974  found against it
-00004e00: 2c20 6974 2069 7320 7374 696c 6c20 7573  , it is still us
-00004e10: 6566 756c 0d0a 2320 746f 2062 6520 6162  eful..# to be ab
-00004e20: 6c65 2074 6f20 6765 7420 6461 7461 206f  le to get data o
-00004e30: 7574 206f 6620 7375 6368 2061 2066 696c  ut of such a fil
-00004e40: 652e 0d0a 230d 0a23 2055 7361 6765 3a0d  e...#..# Usage:.
-00004e50: 0a0d 0a0d 0a64 6566 205f 5a69 7044 6563  .....def _ZipDec
-00004e60: 7279 7074 6572 2870 7764 293a 0d0a 2020  rypter(pwd):..  
-00004e70: 2020 6b65 7930 203d 2033 3035 3431 3938    key0 = 3054198
-00004e80: 3936 0d0a 2020 2020 6b65 7931 203d 2035  96..    key1 = 5
-00004e90: 3931 3735 3130 3439 0d0a 2020 2020 6b65  91751049..    ke
-00004ea0: 7932 203d 2038 3738 3038 3231 3932 0d0a  y2 = 878082192..
-00004eb0: 0d0a 2020 2020 676c 6f62 616c 205f 6372  ..    global _cr
-00004ec0: 6374 6162 6c65 0d0a 2020 2020 6966 205f  ctable..    if _
-00004ed0: 6372 6374 6162 6c65 2069 7320 4e6f 6e65  crctable is None
-00004ee0: 3a0d 0a20 2020 2020 2020 205f 6372 6374  :..        _crct
-00004ef0: 6162 6c65 203d 206c 6973 7428 6d61 7028  able = list(map(
-00004f00: 5f67 656e 5f63 7263 2c20 7261 6e67 6528  _gen_crc, range(
-00004f10: 3235 3629 2929 0d0a 2020 2020 6372 6374  256)))..    crct
-00004f20: 6162 6c65 203d 205f 6372 6374 6162 6c65  able = _crctable
-00004f30: 0d0a 0d0a 2020 2020 6465 6620 6372 6333  ....    def crc3
-00004f40: 3228 6368 2c20 6372 6329 3a0d 0a20 2020  2(ch, crc):..   
-00004f50: 2020 2020 2022 2222 436f 6d70 7574 6520       """Compute 
-00004f60: 7468 6520 4352 4333 3220 7072 696d 6974  the CRC32 primit
-00004f70: 6976 6520 6f6e 206f 6e65 2062 7974 652e  ive on one byte.
-00004f80: 2222 220d 0a20 2020 2020 2020 2072 6574  """..        ret
-00004f90: 7572 6e20 2863 7263 203e 3e20 3829 205e  urn (crc >> 8) ^
-00004fa0: 2063 7263 7461 626c 655b 2863 7263 205e   crctable[(crc ^
-00004fb0: 2063 6829 2026 2030 7846 465d 0d0a 0d0a   ch) & 0xFF]....
-00004fc0: 2020 2020 6465 6620 7570 6461 7465 5f6b      def update_k
-00004fd0: 6579 7328 6329 3a0d 0a20 2020 2020 2020  eys(c):..       
-00004fe0: 206e 6f6e 6c6f 6361 6c20 6b65 7930 2c20   nonlocal key0, 
-00004ff0: 6b65 7931 2c20 6b65 7932 0d0a 2020 2020  key1, key2..    
-00005000: 2020 2020 6b65 7930 203d 2063 7263 3332      key0 = crc32
-00005010: 2863 2c20 6b65 7930 290d 0a20 2020 2020  (c, key0)..     
-00005020: 2020 206b 6579 3120 3d20 286b 6579 3120     key1 = (key1 
-00005030: 2b20 286b 6579 3020 2620 3078 4646 2929  + (key0 & 0xFF))
-00005040: 2026 2030 7846 4646 4646 4646 460d 0a20   & 0xFFFFFFFF.. 
-00005050: 2020 2020 2020 206b 6579 3120 3d20 286b         key1 = (k
-00005060: 6579 3120 2a20 3133 3437 3735 3831 3320  ey1 * 134775813 
-00005070: 2b20 3129 2026 2030 7846 4646 4646 4646  + 1) & 0xFFFFFFF
-00005080: 460d 0a20 2020 2020 2020 206b 6579 3220  F..        key2 
-00005090: 3d20 6372 6333 3228 6b65 7931 203e 3e20  = crc32(key1 >> 
-000050a0: 3234 2c20 6b65 7932 290d 0a0d 0a20 2020  24, key2)....   
-000050b0: 2066 6f72 2070 2069 6e20 7077 643a 0d0a   for p in pwd:..
-000050c0: 2020 2020 2020 2020 7570 6461 7465 5f6b          update_k
-000050d0: 6579 7328 7029 0d0a 0d0a 2020 2020 6465  eys(p)....    de
-000050e0: 6620 6465 6372 7970 7465 7228 6461 7461  f decrypter(data
-000050f0: 293a 0d0a 2020 2020 2020 2020 2222 2244  ):..        """D
-00005100: 6563 7279 7074 2061 2062 7974 6573 206f  ecrypt a bytes o
-00005110: 626a 6563 742e 2222 220d 0a20 2020 2020  bject."""..     
-00005120: 2020 2072 6573 756c 7420 3d20 6279 7465     result = byte
-00005130: 6172 7261 7928 290d 0a20 2020 2020 2020  array()..       
-00005140: 2061 7070 656e 6420 3d20 7265 7375 6c74   append = result
-00005150: 2e61 7070 656e 640d 0a20 2020 2020 2020  .append..       
-00005160: 2066 6f72 2063 2069 6e20 6461 7461 3a0d   for c in data:.
-00005170: 0a20 2020 2020 2020 2020 2020 206b 203d  .            k =
-00005180: 206b 6579 3220 7c20 320d 0a20 2020 2020   key2 | 2..     
-00005190: 2020 2020 2020 2063 205e 3d20 2828 6b20         c ^= ((k 
-000051a0: 2a20 286b 205e 2031 2929 203e 3e20 3829  * (k ^ 1)) >> 8)
-000051b0: 2026 2030 7846 460d 0a20 2020 2020 2020   & 0xFF..       
-000051c0: 2020 2020 2075 7064 6174 655f 6b65 7973       update_keys
-000051d0: 2863 290d 0a20 2020 2020 2020 2020 2020  (c)..           
-000051e0: 2061 7070 656e 6428 6329 0d0a 2020 2020   append(c)..    
-000051f0: 2020 2020 7265 7475 726e 2062 7974 6573      return bytes
-00005200: 2872 6573 756c 7429 0d0a 0d0a 2020 2020  (result)....    
-00005210: 7265 7475 726e 2064 6563 7279 7074 6572  return decrypter
-00005220: 0d0a 0d0a 0d0a 636c 6173 7320 4c5a 4d41  ......class LZMA
-00005230: 436f 6d70 7265 7373 6f72 3a0d 0a20 2020  Compressor:..   
-00005240: 2064 6566 205f 5f69 6e69 745f 5f28 7365   def __init__(se
-00005250: 6c66 2920 2d3e 204e 6f6e 653a 0d0a 2020  lf) -> None:..  
-00005260: 2020 2020 2020 7365 6c66 2e5f 636f 6d70        self._comp
-00005270: 203d 204e 6f6e 650d 0a0d 0a20 2020 2064   = None....    d
-00005280: 6566 205f 696e 6974 2873 656c 6629 3a0d  ef _init(self):.
-00005290: 0a20 2020 2020 2020 2070 726f 7073 203d  .        props =
-000052a0: 206c 7a6d 612e 5f65 6e63 6f64 655f 6669   lzma._encode_fi
-000052b0: 6c74 6572 5f70 726f 7065 7274 6965 7328  lter_properties(
-000052c0: 7b22 6964 223a 206c 7a6d 612e 4649 4c54  {"id": lzma.FILT
-000052d0: 4552 5f4c 5a4d 4131 7d29 0d0a 2020 2020  ER_LZMA1})..    
-000052e0: 2020 2020 7365 6c66 2e5f 636f 6d70 203d      self._comp =
-000052f0: 206c 7a6d 612e 4c5a 4d41 436f 6d70 7265   lzma.LZMACompre
-00005300: 7373 6f72 280d 0a20 2020 2020 2020 2020  ssor(..         
-00005310: 2020 206c 7a6d 612e 464f 524d 4154 5f52     lzma.FORMAT_R
-00005320: 4157 2c0d 0a20 2020 2020 2020 2020 2020  AW,..           
-00005330: 2066 696c 7465 7273 3d5b 6c7a 6d61 2e5f   filters=[lzma._
-00005340: 6465 636f 6465 5f66 696c 7465 725f 7072  decode_filter_pr
-00005350: 6f70 6572 7469 6573 286c 7a6d 612e 4649  operties(lzma.FI
-00005360: 4c54 4552 5f4c 5a4d 4131 2c20 7072 6f70  LTER_LZMA1, prop
-00005370: 7329 5d2c 0d0a 2020 2020 2020 2020 290d  s)],..        ).
-00005380: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-00005390: 7374 7275 6374 2e70 6163 6b28 223c 4242  struct.pack("<BB
-000053a0: 4822 2c20 392c 2034 2c20 6c65 6e28 7072  H", 9, 4, len(pr
-000053b0: 6f70 7329 2920 2b20 7072 6f70 730d 0a0d  ops)) + props...
-000053c0: 0a20 2020 2064 6566 2063 6f6d 7072 6573  .    def compres
-000053d0: 7328 7365 6c66 2c20 6461 7461 293a 0d0a  s(self, data):..
-000053e0: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
-000053f0: 5f63 6f6d 7020 6973 204e 6f6e 653a 0d0a  _comp is None:..
-00005400: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-00005410: 726e 2073 656c 662e 5f69 6e69 7428 2920  rn self._init() 
-00005420: 2b20 7365 6c66 2e5f 636f 6d70 2e63 6f6d  + self._comp.com
-00005430: 7072 6573 7328 6461 7461 290d 0a20 2020  press(data)..   
-00005440: 2020 2020 2072 6574 7572 6e20 7365 6c66       return self
-00005450: 2e5f 636f 6d70 2e63 6f6d 7072 6573 7328  ._comp.compress(
-00005460: 6461 7461 290d 0a0d 0a20 2020 2064 6566  data)....    def
-00005470: 2066 6c75 7368 2873 656c 6629 3a0d 0a20   flush(self):.. 
-00005480: 2020 2020 2020 2069 6620 7365 6c66 2e5f         if self._
-00005490: 636f 6d70 2069 7320 4e6f 6e65 3a0d 0a20  comp is None:.. 
-000054a0: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-000054b0: 6e20 7365 6c66 2e5f 696e 6974 2829 202b  n self._init() +
-000054c0: 2073 656c 662e 5f63 6f6d 702e 666c 7573   self._comp.flus
-000054d0: 6828 290d 0a20 2020 2020 2020 2072 6574  h()..        ret
-000054e0: 7572 6e20 7365 6c66 2e5f 636f 6d70 2e66  urn self._comp.f
-000054f0: 6c75 7368 2829 0d0a 0d0a 0d0a 636c 6173  lush()......clas
-00005500: 7320 4c5a 4d41 4465 636f 6d70 7265 7373  s LZMADecompress
-00005510: 6f72 3a0d 0a20 2020 2064 6566 205f 5f69  or:..    def __i
-00005520: 6e69 745f 5f28 7365 6c66 2920 2d3e 204e  nit__(self) -> N
-00005530: 6f6e 653a 0d0a 2020 2020 2020 2020 7365  one:..        se
-00005540: 6c66 2e5f 6465 636f 6d70 203d 204e 6f6e  lf._decomp = Non
-00005550: 650d 0a20 2020 2020 2020 2073 656c 662e  e..        self.
-00005560: 5f75 6e63 6f6e 7375 6d65 6420 3d20 6222  _unconsumed = b"
-00005570: 220d 0a20 2020 2020 2020 2073 656c 662e  "..        self.
-00005580: 656f 6620 3d20 4661 6c73 650d 0a0d 0a20  eof = False.... 
-00005590: 2020 2064 6566 2064 6563 6f6d 7072 6573     def decompres
-000055a0: 7328 7365 6c66 2c20 6461 7461 293a 0d0a  s(self, data):..
-000055b0: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
-000055c0: 5f64 6563 6f6d 7020 6973 204e 6f6e 653a  _decomp is None:
-000055d0: 0d0a 2020 2020 2020 2020 2020 2020 7365  ..            se
-000055e0: 6c66 2e5f 756e 636f 6e73 756d 6564 202b  lf._unconsumed +
-000055f0: 3d20 6461 7461 0d0a 2020 2020 2020 2020  = data..        
-00005600: 2020 2020 6966 206c 656e 2873 656c 662e      if len(self.
-00005610: 5f75 6e63 6f6e 7375 6d65 6429 203c 3d20  _unconsumed) <= 
-00005620: 343a 0d0a 2020 2020 2020 2020 2020 2020  4:..            
-00005630: 2020 2020 7265 7475 726e 2062 2222 0d0a      return b""..
-00005640: 2020 2020 2020 2020 2020 2020 2870 7369              (psi
-00005650: 7a65 2c29 203d 2073 7472 7563 742e 756e  ze,) = struct.un
-00005660: 7061 636b 2822 3c48 222c 2073 656c 662e  pack("<H", self.
-00005670: 5f75 6e63 6f6e 7375 6d65 645b 323a 345d  _unconsumed[2:4]
-00005680: 290d 0a20 2020 2020 2020 2020 2020 2069  )..            i
-00005690: 6620 6c65 6e28 7365 6c66 2e5f 756e 636f  f len(self._unco
-000056a0: 6e73 756d 6564 2920 3c3d 2034 202b 2070  nsumed) <= 4 + p
-000056b0: 7369 7a65 3a0d 0a20 2020 2020 2020 2020  size:..         
-000056c0: 2020 2020 2020 2072 6574 7572 6e20 6222         return b"
-000056d0: 220d 0a0d 0a20 2020 2020 2020 2020 2020  "....           
-000056e0: 2073 656c 662e 5f64 6563 6f6d 7020 3d20   self._decomp = 
-000056f0: 6c7a 6d61 2e4c 5a4d 4144 6563 6f6d 7072  lzma.LZMADecompr
-00005700: 6573 736f 7228 0d0a 2020 2020 2020 2020  essor(..        
-00005710: 2020 2020 2020 2020 6c7a 6d61 2e46 4f52          lzma.FOR
-00005720: 4d41 545f 5241 572c 0d0a 2020 2020 2020  MAT_RAW,..      
-00005730: 2020 2020 2020 2020 2020 6669 6c74 6572            filter
-00005740: 733d 5b0d 0a20 2020 2020 2020 2020 2020  s=[..           
-00005750: 2020 2020 2020 2020 206c 7a6d 612e 5f64           lzma._d
-00005760: 6563 6f64 655f 6669 6c74 6572 5f70 726f  ecode_filter_pro
-00005770: 7065 7274 6965 7328 0d0a 2020 2020 2020  perties(..      
-00005780: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005790: 2020 6c7a 6d61 2e46 494c 5445 525f 4c5a    lzma.FILTER_LZ
-000057a0: 4d41 312c 0d0a 2020 2020 2020 2020 2020  MA1,..          
-000057b0: 2020 2020 2020 2020 2020 2020 2020 7365                se
-000057c0: 6c66 2e5f 756e 636f 6e73 756d 6564 5b34  lf._unconsumed[4
-000057d0: 203a 2034 202b 2070 7369 7a65 5d2c 0d0a   : 4 + psize],..
-000057e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000057f0: 2020 2020 292c 0d0a 2020 2020 2020 2020      ),..        
-00005800: 2020 2020 2020 2020 5d2c 0d0a 2020 2020          ],..    
-00005810: 2020 2020 2020 2020 290d 0a20 2020 2020          )..     
-00005820: 2020 2020 2020 2064 6174 6120 3d20 7365         data = se
-00005830: 6c66 2e5f 756e 636f 6e73 756d 6564 5b34  lf._unconsumed[4
-00005840: 202b 2070 7369 7a65 203a 5d0d 0a20 2020   + psize :]..   
-00005850: 2020 2020 2020 2020 2064 656c 2073 656c           del sel
-00005860: 662e 5f75 6e63 6f6e 7375 6d65 640d 0a0d  f._unconsumed...
-00005870: 0a20 2020 2020 2020 2072 6573 756c 7420  .        result 
-00005880: 3d20 7365 6c66 2e5f 6465 636f 6d70 2e64  = self._decomp.d
-00005890: 6563 6f6d 7072 6573 7328 6461 7461 290d  ecompress(data).
-000058a0: 0a20 2020 2020 2020 2073 656c 662e 656f  .        self.eo
-000058b0: 6620 3d20 7365 6c66 2e5f 6465 636f 6d70  f = self._decomp
-000058c0: 2e65 6f66 0d0a 2020 2020 2020 2020 7265  .eof..        re
-000058d0: 7475 726e 2072 6573 756c 740d 0a0d 0a0d  turn result.....
-000058e0: 0a63 6f6d 7072 6573 736f 725f 6e61 6d65  .compressor_name
-000058f0: 7320 3d20 7b0d 0a20 2020 2030 3a20 2273  s = {..    0: "s
-00005900: 746f 7265 222c 0d0a 2020 2020 313a 2022  tore",..    1: "
-00005910: 7368 7269 6e6b 222c 0d0a 2020 2020 323a  shrink",..    2:
-00005920: 2022 7265 6475 6365 222c 0d0a 2020 2020   "reduce",..    
-00005930: 333a 2022 7265 6475 6365 222c 0d0a 2020  3: "reduce",..  
-00005940: 2020 343a 2022 7265 6475 6365 222c 0d0a    4: "reduce",..
-00005950: 2020 2020 353a 2022 7265 6475 6365 222c      5: "reduce",
-00005960: 0d0a 2020 2020 363a 2022 696d 706c 6f64  ..    6: "implod
-00005970: 6522 2c0d 0a20 2020 2037 3a20 2274 6f6b  e",..    7: "tok
-00005980: 656e 697a 6522 2c0d 0a20 2020 2038 3a20  enize",..    8: 
-00005990: 2264 6566 6c61 7465 222c 0d0a 2020 2020  "deflate",..    
-000059a0: 393a 2022 6465 666c 6174 6536 3422 2c0d  9: "deflate64",.
-000059b0: 0a20 2020 2031 303a 2022 696d 706c 6f64  .    10: "implod
-000059c0: 6522 2c0d 0a20 2020 2031 323a 2022 627a  e",..    12: "bz
-000059d0: 6970 3222 2c0d 0a20 2020 2031 343a 2022  ip2",..    14: "
-000059e0: 6c7a 6d61 222c 0d0a 2020 2020 3138 3a20  lzma",..    18: 
-000059f0: 2274 6572 7365 222c 0d0a 2020 2020 3139  "terse",..    19
-00005a00: 3a20 226c 7a37 3722 2c0d 0a20 2020 2039  : "lz77",..    9
-00005a10: 373a 2022 7761 7670 6163 6b22 2c0d 0a20  7: "wavpack",.. 
-00005a20: 2020 2039 383a 2022 7070 6d64 222c 0d0a     98: "ppmd",..
-00005a30: 7d0d 0a0d 0a0d 0a64 6566 205f 6368 6563  }......def _chec
-00005a40: 6b5f 636f 6d70 7265 7373 696f 6e28 636f  k_compression(co
-00005a50: 6d70 7265 7373 696f 6e29 3a0d 0a20 2020  mpression):..   
-00005a60: 2069 6620 636f 6d70 7265 7373 696f 6e20   if compression 
-00005a70: 3d3d 205a 4950 5f53 544f 5245 443a 0d0a  == ZIP_STORED:..
-00005a80: 2020 2020 2020 2020 7061 7373 0d0a 2020          pass..  
-00005a90: 2020 656c 6966 2063 6f6d 7072 6573 7369    elif compressi
-00005aa0: 6f6e 203d 3d20 5a49 505f 4445 464c 4154  on == ZIP_DEFLAT
-00005ab0: 4544 3a0d 0a20 2020 2020 2020 2069 6620  ED:..        if 
-00005ac0: 6e6f 7420 7a6c 6962 3a0d 0a20 2020 2020  not zlib:..     
-00005ad0: 2020 2020 2020 2072 6169 7365 2052 756e         raise Run
-00005ae0: 7469 6d65 4572 726f 7228 0d0a 2020 2020  timeError(..    
-00005af0: 2020 2020 2020 2020 2020 2020 2243 6f6d              "Com
-00005b00: 7072 6573 7369 6f6e 2072 6571 7569 7265  pression require
-00005b10: 7320 7468 6520 286d 6973 7369 6e67 2920  s the (missing) 
-00005b20: 7a6c 6962 206d 6f64 756c 6522 2c0d 0a20  zlib module",.. 
-00005b30: 2020 2020 2020 2020 2020 2029 0d0a 2020             )..  
-00005b40: 2020 656c 6966 2063 6f6d 7072 6573 7369    elif compressi
-00005b50: 6f6e 203d 3d20 5a49 505f 425a 4950 323a  on == ZIP_BZIP2:
-00005b60: 0d0a 2020 2020 2020 2020 6966 206e 6f74  ..        if not
-00005b70: 2062 7a32 3a0d 0a20 2020 2020 2020 2020   bz2:..         
-00005b80: 2020 2072 6169 7365 2052 756e 7469 6d65     raise Runtime
-00005b90: 4572 726f 7228 2243 6f6d 7072 6573 7369  Error("Compressi
-00005ba0: 6f6e 2072 6571 7569 7265 7320 7468 6520  on requires the 
-00005bb0: 286d 6973 7369 6e67 2920 627a 3220 6d6f  (missing) bz2 mo
-00005bc0: 6475 6c65 2229 0d0a 2020 2020 656c 6966  dule")..    elif
-00005bd0: 2063 6f6d 7072 6573 7369 6f6e 203d 3d20   compression == 
-00005be0: 5a49 505f 4c5a 4d41 3a0d 0a20 2020 2020  ZIP_LZMA:..     
-00005bf0: 2020 2069 6620 6e6f 7420 6c7a 6d61 3a0d     if not lzma:.
-00005c00: 0a20 2020 2020 2020 2020 2020 2072 6169  .            rai
-00005c10: 7365 2052 756e 7469 6d65 4572 726f 7228  se RuntimeError(
-00005c20: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00005c30: 2020 2243 6f6d 7072 6573 7369 6f6e 2072    "Compression r
-00005c40: 6571 7569 7265 7320 7468 6520 286d 6973  equires the (mis
-00005c50: 7369 6e67 2920 6c7a 6d61 206d 6f64 756c  sing) lzma modul
-00005c60: 6522 2c0d 0a20 2020 2020 2020 2020 2020  e",..           
-00005c70: 2029 0d0a 2020 2020 656c 7365 3a0d 0a20   )..    else:.. 
-00005c80: 2020 2020 2020 2072 6169 7365 204e 6f74         raise Not
-00005c90: 496d 706c 656d 656e 7465 6445 7272 6f72  ImplementedError
-00005ca0: 2822 5468 6174 2063 6f6d 7072 6573 7369  ("That compressi
-00005cb0: 6f6e 206d 6574 686f 6420 6973 206e 6f74  on method is not
-00005cc0: 2073 7570 706f 7274 6564 2229 0d0a 0d0a   supported")....
-00005cd0: 0d0a 6465 6620 5f67 6574 5f63 6f6d 7072  ..def _get_compr
-00005ce0: 6573 736f 7228 636f 6d70 7265 7373 5f74  essor(compress_t
-00005cf0: 7970 652c 2063 6f6d 7072 6573 736c 6576  ype, compresslev
-00005d00: 656c 3d4e 6f6e 6529 3a0d 0a20 2020 2069  el=None):..    i
-00005d10: 6620 636f 6d70 7265 7373 5f74 7970 6520  f compress_type 
-00005d20: 3d3d 205a 4950 5f44 4546 4c41 5445 443a  == ZIP_DEFLATED:
-00005d30: 0d0a 2020 2020 2020 2020 6966 2063 6f6d  ..        if com
-00005d40: 7072 6573 736c 6576 656c 2069 7320 6e6f  presslevel is no
-00005d50: 7420 4e6f 6e65 3a0d 0a20 2020 2020 2020  t None:..       
-00005d60: 2020 2020 2072 6574 7572 6e20 7a6c 6962       return zlib
-00005d70: 2e63 6f6d 7072 6573 736f 626a 2863 6f6d  .compressobj(com
-00005d80: 7072 6573 736c 6576 656c 2c20 7a6c 6962  presslevel, zlib
-00005d90: 2e44 4546 4c41 5445 442c 202d 3135 290d  .DEFLATED, -15).
-00005da0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-00005db0: 7a6c 6962 2e63 6f6d 7072 6573 736f 626a  zlib.compressobj
-00005dc0: 287a 6c69 622e 5a5f 4445 4641 554c 545f  (zlib.Z_DEFAULT_
-00005dd0: 434f 4d50 5245 5353 494f 4e2c 207a 6c69  COMPRESSION, zli
-00005de0: 622e 4445 464c 4154 4544 2c20 2d31 3529  b.DEFLATED, -15)
-00005df0: 0d0a 2020 2020 656c 6966 2063 6f6d 7072  ..    elif compr
-00005e00: 6573 735f 7479 7065 203d 3d20 5a49 505f  ess_type == ZIP_
-00005e10: 425a 4950 323a 0d0a 2020 2020 2020 2020  BZIP2:..        
-00005e20: 6966 2063 6f6d 7072 6573 736c 6576 656c  if compresslevel
-00005e30: 2069 7320 6e6f 7420 4e6f 6e65 3a0d 0a20   is not None:.. 
-00005e40: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-00005e50: 6e20 627a 322e 425a 3243 6f6d 7072 6573  n bz2.BZ2Compres
-00005e60: 736f 7228 636f 6d70 7265 7373 6c65 7665  sor(compressleve
-00005e70: 6c29 0d0a 2020 2020 2020 2020 7265 7475  l)..        retu
-00005e80: 726e 2062 7a32 2e42 5a32 436f 6d70 7265  rn bz2.BZ2Compre
-00005e90: 7373 6f72 2829 0d0a 2020 2020 2320 636f  ssor()..    # co
-00005ea0: 6d70 7265 7373 6c65 7665 6c20 6973 2069  mpresslevel is i
-00005eb0: 676e 6f72 6564 2066 6f72 205a 4950 5f4c  gnored for ZIP_L
-00005ec0: 5a4d 410d 0a20 2020 2065 6c69 6620 636f  ZMA..    elif co
-00005ed0: 6d70 7265 7373 5f74 7970 6520 3d3d 205a  mpress_type == Z
-00005ee0: 4950 5f4c 5a4d 413a 0d0a 2020 2020 2020  IP_LZMA:..      
-00005ef0: 2020 7265 7475 726e 204c 5a4d 4143 6f6d    return LZMACom
-00005f00: 7072 6573 736f 7228 290d 0a20 2020 2065  pressor()..    e
-00005f10: 6c73 653a 0d0a 2020 2020 2020 2020 7265  lse:..        re
-00005f20: 7475 726e 204e 6f6e 650d 0a0d 0a0d 0a64  turn None......d
-00005f30: 6566 205f 6765 745f 6465 636f 6d70 7265  ef _get_decompre
-00005f40: 7373 6f72 2863 6f6d 7072 6573 735f 7479  ssor(compress_ty
-00005f50: 7065 293a 0d0a 2020 2020 5f63 6865 636b  pe):..    _check
-00005f60: 5f63 6f6d 7072 6573 7369 6f6e 2863 6f6d  _compression(com
-00005f70: 7072 6573 735f 7479 7065 290d 0a20 2020  press_type)..   
-00005f80: 2069 6620 636f 6d70 7265 7373 5f74 7970   if compress_typ
-00005f90: 6520 3d3d 205a 4950 5f53 544f 5245 443a  e == ZIP_STORED:
-00005fa0: 0d0a 2020 2020 2020 2020 7265 7475 726e  ..        return
-00005fb0: 204e 6f6e 650d 0a20 2020 2065 6c69 6620   None..    elif 
-00005fc0: 636f 6d70 7265 7373 5f74 7970 6520 3d3d  compress_type ==
-00005fd0: 205a 4950 5f44 4546 4c41 5445 443a 0d0a   ZIP_DEFLATED:..
-00005fe0: 2020 2020 2020 2020 7265 7475 726e 207a          return z
-00005ff0: 6c69 622e 6465 636f 6d70 7265 7373 6f62  lib.decompressob
-00006000: 6a28 2d31 3529 0d0a 2020 2020 656c 6966  j(-15)..    elif
-00006010: 2063 6f6d 7072 6573 735f 7479 7065 203d   compress_type =
-00006020: 3d20 5a49 505f 425a 4950 323a 0d0a 2020  = ZIP_BZIP2:..  
-00006030: 2020 2020 2020 7265 7475 726e 2062 7a32        return bz2
-00006040: 2e42 5a32 4465 636f 6d70 7265 7373 6f72  .BZ2Decompressor
-00006050: 2829 0d0a 2020 2020 656c 6966 2063 6f6d  ()..    elif com
-00006060: 7072 6573 735f 7479 7065 203d 3d20 5a49  press_type == ZI
-00006070: 505f 4c5a 4d41 3a0d 0a20 2020 2020 2020  P_LZMA:..       
-00006080: 2072 6574 7572 6e20 4c5a 4d41 4465 636f   return LZMADeco
-00006090: 6d70 7265 7373 6f72 2829 0d0a 2020 2020  mpressor()..    
-000060a0: 656c 7365 3a0d 0a20 2020 2020 2020 2064  else:..        d
-000060b0: 6573 6372 203d 2063 6f6d 7072 6573 736f  escr = compresso
-000060c0: 725f 6e61 6d65 732e 6765 7428 636f 6d70  r_names.get(comp
-000060d0: 7265 7373 5f74 7970 6529 0d0a 2020 2020  ress_type)..    
-000060e0: 2020 2020 6966 2064 6573 6372 3a0d 0a20      if descr:.. 
-000060f0: 2020 2020 2020 2020 2020 2072 6169 7365             raise
-00006100: 204e 6f74 496d 706c 656d 656e 7465 6445   NotImplementedE
-00006110: 7272 6f72 280d 0a20 2020 2020 2020 2020  rror(..         
-00006120: 2020 2020 2020 2022 636f 6d70 7265 7373         "compress
-00006130: 696f 6e20 7479 7065 2025 6420 2825 7329  ion type %d (%s)
-00006140: 2220 2520 2863 6f6d 7072 6573 735f 7479  " % (compress_ty
-00006150: 7065 2c20 6465 7363 7229 2c0d 0a20 2020  pe, descr),..   
-00006160: 2020 2020 2020 2020 2029 0d0a 2020 2020           )..    
-00006170: 2020 2020 656c 7365 3a0d 0a20 2020 2020      else:..     
-00006180: 2020 2020 2020 2072 6169 7365 204e 6f74         raise Not
-00006190: 496d 706c 656d 656e 7465 6445 7272 6f72  ImplementedError
-000061a0: 2822 636f 6d70 7265 7373 696f 6e20 7479  ("compression ty
-000061b0: 7065 2025 6422 2025 2028 636f 6d70 7265  pe %d" % (compre
-000061c0: 7373 5f74 7970 652c 2929 0d0a 0d0a 0d0a  ss_type,))......
-000061d0: 636c 6173 7320 5f53 6861 7265 6446 696c  class _SharedFil
-000061e0: 653a 0d0a 2020 2020 6465 6620 5f5f 696e  e:..    def __in
-000061f0: 6974 5f5f 2873 656c 662c 2066 696c 652c  it__(self, file,
-00006200: 2070 6f73 2c20 636c 6f73 652c 206c 6f63   pos, close, loc
-00006210: 6b2c 2077 7269 7469 6e67 2920 2d3e 204e  k, writing) -> N
-00006220: 6f6e 653a 0d0a 2020 2020 2020 2020 7365  one:..        se
-00006230: 6c66 2e5f 6669 6c65 203d 2066 696c 650d  lf._file = file.
-00006240: 0a20 2020 2020 2020 2073 656c 662e 5f70  .        self._p
-00006250: 6f73 203d 2070 6f73 0d0a 2020 2020 2020  os = pos..      
-00006260: 2020 7365 6c66 2e5f 636c 6f73 6520 3d20    self._close = 
-00006270: 636c 6f73 650d 0a20 2020 2020 2020 2073  close..        s
-00006280: 656c 662e 5f6c 6f63 6b20 3d20 6c6f 636b  elf._lock = lock
-00006290: 0d0a 2020 2020 2020 2020 7365 6c66 2e5f  ..        self._
-000062a0: 7772 6974 696e 6720 3d20 7772 6974 696e  writing = writin
-000062b0: 670d 0a20 2020 2020 2020 2073 656c 662e  g..        self.
-000062c0: 7365 656b 6162 6c65 203d 2066 696c 652e  seekable = file.
-000062d0: 7365 656b 6162 6c65 0d0a 2020 2020 2020  seekable..      
-000062e0: 2020 7365 6c66 2e74 656c 6c20 3d20 6669    self.tell = fi
-000062f0: 6c65 2e74 656c 6c0d 0a0d 0a20 2020 2064  le.tell....    d
-00006300: 6566 2073 6565 6b28 7365 6c66 2c20 6f66  ef seek(self, of
-00006310: 6673 6574 2c20 7768 656e 6365 3d30 293a  fset, whence=0):
-00006320: 0d0a 2020 2020 2020 2020 7769 7468 2073  ..        with s
-00006330: 656c 662e 5f6c 6f63 6b3a 0d0a 2020 2020  elf._lock:..    
-00006340: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
-00006350: 5f77 7269 7469 6e67 2829 3a0d 0a20 2020  _writing():..   
-00006360: 2020 2020 2020 2020 2020 2020 2072 6169               rai
-00006370: 7365 2056 616c 7565 4572 726f 7228 0d0a  se ValueError(..
-00006380: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006390: 2020 2020 2243 616e 2774 2072 6570 6f73      "Can't repos
-000063a0: 6974 696f 6e20 696e 2074 6865 205a 4950  ition in the ZIP
-000063b0: 2066 696c 6520 7768 696c 6520 220d 0a20   file while ".. 
-000063c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000063d0: 2020 2022 7468 6572 6520 6973 2061 6e20     "there is an 
-000063e0: 6f70 656e 2077 7269 7469 6e67 2068 616e  open writing han
-000063f0: 646c 6520 6f6e 2069 742e 2022 0d0a 2020  dle on it. "..  
-00006400: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006410: 2020 2243 6c6f 7365 2074 6865 2077 7269    "Close the wri
-00006420: 7469 6e67 2068 616e 646c 6520 6265 666f  ting handle befo
-00006430: 7265 2074 7279 696e 6720 746f 2072 6561  re trying to rea
-00006440: 642e 222c 0d0a 2020 2020 2020 2020 2020  d.",..          
-00006450: 2020 2020 2020 290d 0a20 2020 2020 2020        )..       
-00006460: 2020 2020 2073 656c 662e 5f66 696c 652e       self._file.
-00006470: 7365 656b 286f 6666 7365 742c 2077 6865  seek(offset, whe
-00006480: 6e63 6529 0d0a 2020 2020 2020 2020 2020  nce)..          
-00006490: 2020 7365 6c66 2e5f 706f 7320 3d20 7365    self._pos = se
-000064a0: 6c66 2e5f 6669 6c65 2e74 656c 6c28 290d  lf._file.tell().
-000064b0: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
-000064c0: 7572 6e20 7365 6c66 2e5f 706f 730d 0a0d  urn self._pos...
-000064d0: 0a20 2020 2064 6566 2072 6561 6428 7365  .    def read(se
-000064e0: 6c66 2c20 6e3d 2d31 293a 0d0a 2020 2020  lf, n=-1):..    
-000064f0: 2020 2020 7769 7468 2073 656c 662e 5f6c      with self._l
-00006500: 6f63 6b3a 0d0a 2020 2020 2020 2020 2020  ock:..          
-00006510: 2020 6966 2073 656c 662e 5f77 7269 7469    if self._writi
-00006520: 6e67 2829 3a0d 0a20 2020 2020 2020 2020  ng():..         
-00006530: 2020 2020 2020 2072 6169 7365 2056 616c         raise Val
-00006540: 7565 4572 726f 7228 0d0a 2020 2020 2020  ueError(..      
-00006550: 2020 2020 2020 2020 2020 2020 2020 2243                "C
-00006560: 616e 2774 2072 6561 6420 6672 6f6d 2074  an't read from t
-00006570: 6865 205a 4950 2066 696c 6520 7768 696c  he ZIP file whil
-00006580: 6520 7468 6572 6520 220d 0a20 2020 2020  e there "..     
-00006590: 2020 2020 2020 2020 2020 2020 2020 2022                 "
-000065a0: 6973 2061 6e20 6f70 656e 2077 7269 7469  is an open writi
-000065b0: 6e67 2068 616e 646c 6520 6f6e 2069 742e  ng handle on it.
-000065c0: 2022 0d0a 2020 2020 2020 2020 2020 2020   "..            
-000065d0: 2020 2020 2020 2020 2243 6c6f 7365 2074          "Close t
-000065e0: 6865 2077 7269 7469 6e67 2068 616e 646c  he writing handl
-000065f0: 6520 6265 666f 7265 2074 7279 696e 6720  e before trying 
-00006600: 746f 2072 6561 642e 222c 0d0a 2020 2020  to read.",..    
-00006610: 2020 2020 2020 2020 2020 2020 290d 0a20              ).. 
-00006620: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-00006630: 5f66 696c 652e 7365 656b 2873 656c 662e  _file.seek(self.
-00006640: 5f70 6f73 290d 0a20 2020 2020 2020 2020  _pos)..         
-00006650: 2020 2064 6174 6120 3d20 7365 6c66 2e5f     data = self._
-00006660: 6669 6c65 2e72 6561 6428 6e29 0d0a 2020  file.read(n)..  
-00006670: 2020 2020 2020 2020 2020 7365 6c66 2e5f            self._
-00006680: 706f 7320 3d20 7365 6c66 2e5f 6669 6c65  pos = self._file
-00006690: 2e74 656c 6c28 290d 0a20 2020 2020 2020  .tell()..       
-000066a0: 2020 2020 2072 6574 7572 6e20 6461 7461       return data
-000066b0: 0d0a 0d0a 2020 2020 6465 6620 636c 6f73  ....    def clos
-000066c0: 6528 7365 6c66 293a 0d0a 2020 2020 2020  e(self):..      
-000066d0: 2020 6966 2073 656c 662e 5f66 696c 6520    if self._file 
-000066e0: 6973 206e 6f74 204e 6f6e 653a 0d0a 2020  is not None:..  
-000066f0: 2020 2020 2020 2020 2020 6669 6c65 6f62            fileob
-00006700: 6a20 3d20 7365 6c66 2e5f 6669 6c65 0d0a  j = self._file..
-00006710: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00006720: 2e5f 6669 6c65 203d 204e 6f6e 650d 0a20  ._file = None.. 
-00006730: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-00006740: 5f63 6c6f 7365 2866 696c 656f 626a 290d  _close(fileobj).
-00006750: 0a0d 0a0d 0a23 2050 726f 7669 6465 2074  .....# Provide t
-00006760: 6865 2074 656c 6c20 6d65 7468 6f64 2066  he tell method f
-00006770: 6f72 2075 6e73 6565 6b61 626c 6520 7374  or unseekable st
-00006780: 7265 616d 0d0a 636c 6173 7320 5f54 656c  ream..class _Tel
-00006790: 6c61 626c 653a 0d0a 2020 2020 6465 6620  lable:..    def 
-000067a0: 5f5f 696e 6974 5f5f 2873 656c 662c 2066  __init__(self, f
-000067b0: 7029 202d 3e20 4e6f 6e65 3a0d 0a20 2020  p) -> None:..   
-000067c0: 2020 2020 2073 656c 662e 6670 203d 2066       self.fp = f
-000067d0: 700d 0a20 2020 2020 2020 2073 656c 662e  p..        self.
-000067e0: 6f66 6673 6574 203d 2030 0d0a 0d0a 2020  offset = 0....  
-000067f0: 2020 6465 6620 7772 6974 6528 7365 6c66    def write(self
-00006800: 2c20 6461 7461 293a 0d0a 2020 2020 2020  , data):..      
-00006810: 2020 6e20 3d20 7365 6c66 2e66 702e 7772    n = self.fp.wr
-00006820: 6974 6528 6461 7461 290d 0a20 2020 2020  ite(data)..     
-00006830: 2020 2073 656c 662e 6f66 6673 6574 202b     self.offset +
-00006840: 3d20 6e0d 0a20 2020 2020 2020 2072 6574  = n..        ret
-00006850: 7572 6e20 6e0d 0a0d 0a20 2020 2064 6566  urn n....    def
-00006860: 2074 656c 6c28 7365 6c66 293a 0d0a 2020   tell(self):..  
-00006870: 2020 2020 2020 7265 7475 726e 2073 656c        return sel
-00006880: 662e 6f66 6673 6574 0d0a 0d0a 2020 2020  f.offset....    
-00006890: 6465 6620 666c 7573 6828 7365 6c66 293a  def flush(self):
-000068a0: 0d0a 2020 2020 2020 2020 7365 6c66 2e66  ..        self.f
-000068b0: 702e 666c 7573 6828 290d 0a0d 0a20 2020  p.flush()....   
-000068c0: 2064 6566 2063 6c6f 7365 2873 656c 6629   def close(self)
-000068d0: 3a0d 0a20 2020 2020 2020 2073 656c 662e  :..        self.
-000068e0: 6670 2e63 6c6f 7365 2829 0d0a 0d0a 0d0a  fp.close()......
-000068f0: 636c 6173 7320 5a69 7045 7874 4669 6c65  class ZipExtFile
-00006900: 2869 6f2e 4275 6666 6572 6564 494f 4261  (io.BufferedIOBa
-00006910: 7365 293a 0d0a 2020 2020 2222 2246 696c  se):..    """Fil
-00006920: 652d 6c69 6b65 206f 626a 6563 7420 666f  e-like object fo
-00006930: 7220 7265 6164 696e 6720 616e 2061 7263  r reading an arc
-00006940: 6869 7665 206d 656d 6265 722e 0d0a 2020  hive member...  
-00006950: 2020 4973 2072 6574 7572 6e65 6420 6279    Is returned by
-00006960: 205a 6970 4669 6c65 2e6f 7065 6e28 292e   ZipFile.open().
-00006970: 0d0a 2020 2020 2222 220d 0a0d 0a20 2020  ..    """....   
-00006980: 2023 204d 6178 2073 697a 6520 7375 7070   # Max size supp
-00006990: 6f72 7465 6420 6279 2064 6563 6f6d 7072  orted by decompr
-000069a0: 6573 736f 722e 0d0a 2020 2020 4d41 585f  essor...    MAX_
-000069b0: 4e20 3d20 3120 3c3c 2033 3120 2d20 310d  N = 1 << 31 - 1.
-000069c0: 0a0d 0a20 2020 2023 2052 6561 6420 6672  ...    # Read fr
-000069d0: 6f6d 2063 6f6d 7072 6573 7365 6420 6669  om compressed fi
-000069e0: 6c65 7320 696e 2034 6b20 626c 6f63 6b73  les in 4k blocks
-000069f0: 2e0d 0a20 2020 204d 494e 5f52 4541 445f  ...    MIN_READ_
-00006a00: 5349 5a45 203d 2034 3039 360d 0a0d 0a20  SIZE = 4096.... 
-00006a10: 2020 2023 2043 6875 6e6b 2073 697a 6520     # Chunk size 
-00006a20: 746f 2072 6561 6420 6475 7269 6e67 2073  to read during s
-00006a30: 6565 6b0d 0a20 2020 204d 4158 5f53 4545  eek..    MAX_SEE
-00006a40: 4b5f 5245 4144 203d 2031 203c 3c20 3234  K_READ = 1 << 24
-00006a50: 0d0a 0d0a 2020 2020 6465 6620 5f5f 696e  ....    def __in
-00006a60: 6974 5f5f 280d 0a20 2020 2020 2020 2073  it__(..        s
-00006a70: 656c 662c 0d0a 2020 2020 2020 2020 6669  elf,..        fi
-00006a80: 6c65 6f62 6a2c 0d0a 2020 2020 2020 2020  leobj,..        
-00006a90: 6d6f 6465 2c0d 0a20 2020 2020 2020 207a  mode,..        z
-00006aa0: 6970 696e 666f 2c0d 0a20 2020 2020 2020  ipinfo,..       
-00006ab0: 2070 7764 3d4e 6f6e 652c 0d0a 2020 2020   pwd=None,..    
-00006ac0: 2020 2020 636c 6f73 655f 6669 6c65 6f62      close_fileob
-00006ad0: 6a3d 4661 6c73 652c 0d0a 2020 2020 2920  j=False,..    ) 
-00006ae0: 2d3e 204e 6f6e 653a 0d0a 2020 2020 2020  -> None:..      
-00006af0: 2020 7365 6c66 2e5f 6669 6c65 6f62 6a20    self._fileobj 
-00006b00: 3d20 6669 6c65 6f62 6a0d 0a20 2020 2020  = fileobj..     
-00006b10: 2020 2073 656c 662e 5f70 7764 203d 2070     self._pwd = p
-00006b20: 7764 0d0a 2020 2020 2020 2020 7365 6c66  wd..        self
-00006b30: 2e5f 636c 6f73 655f 6669 6c65 6f62 6a20  ._close_fileobj 
-00006b40: 3d20 636c 6f73 655f 6669 6c65 6f62 6a0d  = close_fileobj.
-00006b50: 0a0d 0a20 2020 2020 2020 2073 656c 662e  ...        self.
-00006b60: 5f63 6f6d 7072 6573 735f 7479 7065 203d  _compress_type =
-00006b70: 207a 6970 696e 666f 2e63 6f6d 7072 6573   zipinfo.compres
-00006b80: 735f 7479 7065 0d0a 2020 2020 2020 2020  s_type..        
-00006b90: 7365 6c66 2e5f 636f 6d70 7265 7373 5f6c  self._compress_l
-00006ba0: 6566 7420 3d20 7a69 7069 6e66 6f2e 636f  eft = zipinfo.co
-00006bb0: 6d70 7265 7373 5f73 697a 650d 0a20 2020  mpress_size..   
-00006bc0: 2020 2020 2073 656c 662e 5f6c 6566 7420       self._left 
-00006bd0: 3d20 7a69 7069 6e66 6f2e 6669 6c65 5f73  = zipinfo.file_s
-00006be0: 697a 650d 0a0d 0a20 2020 2020 2020 2073  ize....        s
-00006bf0: 656c 662e 5f64 6563 6f6d 7072 6573 736f  elf._decompresso
-00006c00: 7220 3d20 5f67 6574 5f64 6563 6f6d 7072  r = _get_decompr
-00006c10: 6573 736f 7228 7365 6c66 2e5f 636f 6d70  essor(self._comp
-00006c20: 7265 7373 5f74 7970 6529 0d0a 0d0a 2020  ress_type)....  
-00006c30: 2020 2020 2020 7365 6c66 2e5f 656f 6620        self._eof 
-00006c40: 3d20 4661 6c73 650d 0a20 2020 2020 2020  = False..       
-00006c50: 2073 656c 662e 5f72 6561 6462 7566 6665   self._readbuffe
-00006c60: 7220 3d20 6222 220d 0a20 2020 2020 2020  r = b""..       
-00006c70: 2073 656c 662e 5f6f 6666 7365 7420 3d20   self._offset = 
-00006c80: 300d 0a0d 0a20 2020 2020 2020 2073 656c  0....        sel
-00006c90: 662e 6e65 776c 696e 6573 203d 204e 6f6e  f.newlines = Non
-00006ca0: 650d 0a0d 0a20 2020 2020 2020 2073 656c  e....        sel
-00006cb0: 662e 6d6f 6465 203d 206d 6f64 650d 0a20  f.mode = mode.. 
-00006cc0: 2020 2020 2020 2073 656c 662e 6e61 6d65         self.name
-00006cd0: 203d 207a 6970 696e 666f 2e66 696c 656e   = zipinfo.filen
-00006ce0: 616d 650d 0a0d 0a20 2020 2020 2020 2069  ame....        i
-00006cf0: 6620 6861 7361 7474 7228 7a69 7069 6e66  f hasattr(zipinf
-00006d00: 6f2c 2022 4352 4322 293a 0d0a 2020 2020  o, "CRC"):..    
-00006d10: 2020 2020 2020 2020 7365 6c66 2e5f 6578          self._ex
-00006d20: 7065 6374 6564 5f63 7263 203d 207a 6970  pected_crc = zip
-00006d30: 696e 666f 2e43 5243 0d0a 2020 2020 2020  info.CRC..      
-00006d40: 2020 2020 2020 7365 6c66 2e5f 7275 6e6e        self._runn
-00006d50: 696e 675f 6372 6320 3d20 6372 6333 3228  ing_crc = crc32(
-00006d60: 6222 2229 0d0a 2020 2020 2020 2020 656c  b"")..        el
-00006d70: 7365 3a0d 0a20 2020 2020 2020 2020 2020  se:..           
-00006d80: 2073 656c 662e 5f65 7870 6563 7465 645f   self._expected_
-00006d90: 6372 6320 3d20 4e6f 6e65 0d0a 0d0a 2020  crc = None....  
-00006da0: 2020 2020 2020 7365 6c66 2e5f 7365 656b        self._seek
-00006db0: 6162 6c65 203d 2046 616c 7365 0d0a 2020  able = False..  
-00006dc0: 2020 2020 2020 7472 793a 0d0a 2020 2020        try:..    
-00006dd0: 2020 2020 2020 2020 6966 2066 696c 656f          if fileo
-00006de0: 626a 2e73 6565 6b61 626c 6528 293a 0d0a  bj.seekable():..
-00006df0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006e00: 7365 6c66 2e5f 6f72 6967 5f63 6f6d 7072  self._orig_compr
-00006e10: 6573 735f 7374 6172 7420 3d20 6669 6c65  ess_start = file
-00006e20: 6f62 6a2e 7465 6c6c 2829 0d0a 2020 2020  obj.tell()..    
-00006e30: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00006e40: 2e5f 6f72 6967 5f63 6f6d 7072 6573 735f  ._orig_compress_
-00006e50: 7369 7a65 203d 207a 6970 696e 666f 2e63  size = zipinfo.c
-00006e60: 6f6d 7072 6573 735f 7369 7a65 0d0a 2020  ompress_size..  
-00006e70: 2020 2020 2020 2020 2020 2020 2020 7365                se
-00006e80: 6c66 2e5f 6f72 6967 5f66 696c 655f 7369  lf._orig_file_si
-00006e90: 7a65 203d 207a 6970 696e 666f 2e66 696c  ze = zipinfo.fil
-00006ea0: 655f 7369 7a65 0d0a 2020 2020 2020 2020  e_size..        
-00006eb0: 2020 2020 2020 2020 7365 6c66 2e5f 6f72          self._or
-00006ec0: 6967 5f73 7461 7274 5f63 7263 203d 2073  ig_start_crc = s
-00006ed0: 656c 662e 5f72 756e 6e69 6e67 5f63 7263  elf._running_crc
+00000020: 0d0a 5059 5448 4f4e 2053 4f46 5457 4152  ..PYTHON SOFTWAR
+00000030: 4520 464f 554e 4441 5449 4f4e 204c 4943  E FOUNDATION LIC
+00000040: 454e 5345 2056 4552 5349 4f4e 2032 0d0a  ENSE VERSION 2..
+00000050: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00000060: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00000070: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 0d0a 0d0a  ------------....
+00000080: 312e 2054 6869 7320 4c49 4345 4e53 4520  1. This LICENSE 
+00000090: 4147 5245 454d 454e 5420 6973 2062 6574  AGREEMENT is bet
+000000a0: 7765 656e 2074 6865 2050 7974 686f 6e20  ween the Python 
+000000b0: 536f 6674 7761 7265 2046 6f75 6e64 6174  Software Foundat
+000000c0: 696f 6e0d 0a28 2250 5346 2229 2c20 616e  ion..("PSF"), an
+000000d0: 6420 7468 6520 496e 6469 7669 6475 616c  d the Individual
+000000e0: 206f 7220 4f72 6761 6e69 7a61 7469 6f6e   or Organization
+000000f0: 2028 224c 6963 656e 7365 6522 2920 6163   ("Licensee") ac
+00000100: 6365 7373 696e 6720 616e 640d 0a6f 7468  cessing and..oth
+00000110: 6572 7769 7365 2075 7369 6e67 2074 6869  erwise using thi
+00000120: 7320 736f 6674 7761 7265 2028 2250 7974  s software ("Pyt
+00000130: 686f 6e22 2920 696e 2073 6f75 7263 6520  hon") in source 
+00000140: 6f72 2062 696e 6172 7920 666f 726d 2061  or binary form a
+00000150: 6e64 0d0a 6974 7320 6173 736f 6369 6174  nd..its associat
+00000160: 6564 2064 6f63 756d 656e 7461 7469 6f6e  ed documentation
+00000170: 2e0d 0a0d 0a32 2e20 5375 626a 6563 7420  .....2. Subject 
+00000180: 746f 2074 6865 2074 6572 6d73 2061 6e64  to the terms and
+00000190: 2063 6f6e 6469 7469 6f6e 7320 6f66 2074   conditions of t
+000001a0: 6869 7320 4c69 6365 6e73 6520 4167 7265  his License Agre
+000001b0: 656d 656e 742c 2050 5346 2068 6572 6562  ement, PSF hereb
+000001c0: 790d 0a67 7261 6e74 7320 4c69 6365 6e73  y..grants Licens
+000001d0: 6565 2061 206e 6f6e 6578 636c 7573 6976  ee a nonexclusiv
+000001e0: 652c 2072 6f79 616c 7479 2d66 7265 652c  e, royalty-free,
+000001f0: 2077 6f72 6c64 2d77 6964 6520 6c69 6365   world-wide lice
+00000200: 6e73 6520 746f 2072 6570 726f 6475 6365  nse to reproduce
+00000210: 2c0d 0a61 6e61 6c79 7a65 2c20 7465 7374  ,..analyze, test
+00000220: 2c20 7065 7266 6f72 6d20 616e 642f 6f72  , perform and/or
+00000230: 2064 6973 706c 6179 2070 7562 6c69 636c   display publicl
+00000240: 792c 2070 7265 7061 7265 2064 6572 6976  y, prepare deriv
+00000250: 6174 6976 6520 776f 726b 732c 0d0a 6469  ative works,..di
+00000260: 7374 7269 6275 7465 2c20 616e 6420 6f74  stribute, and ot
+00000270: 6865 7277 6973 6520 7573 6520 5079 7468  herwise use Pyth
+00000280: 6f6e 2061 6c6f 6e65 206f 7220 696e 2061  on alone or in a
+00000290: 6e79 2064 6572 6976 6174 6976 6520 7665  ny derivative ve
+000002a0: 7273 696f 6e2c 0d0a 7072 6f76 6964 6564  rsion,..provided
+000002b0: 2c20 686f 7765 7665 722c 2074 6861 7420  , however, that 
+000002c0: 5053 4627 7320 4c69 6365 6e73 6520 4167  PSF's License Ag
+000002d0: 7265 656d 656e 7420 616e 6420 5053 4627  reement and PSF'
+000002e0: 7320 6e6f 7469 6365 206f 6620 636f 7079  s notice of copy
+000002f0: 7269 6768 742c 0d0a 692e 652e 2c20 2243  right,..i.e., "C
+00000300: 6f70 7972 6967 6874 2028 6329 2032 3030  opyright (c) 200
+00000310: 312c 2032 3030 322c 2032 3030 332c 2032  1, 2002, 2003, 2
+00000320: 3030 342c 2032 3030 352c 2032 3030 362c  004, 2005, 2006,
+00000330: 2032 3030 372c 2032 3030 382c 2032 3030   2007, 2008, 200
+00000340: 392c 2032 3031 302c 0d0a 3230 3131 2c20  9, 2010,..2011, 
+00000350: 3230 3132 2c20 3230 3133 2c20 3230 3134  2012, 2013, 2014
+00000360: 2c20 3230 3135 2c20 3230 3136 2c20 3230  , 2015, 2016, 20
+00000370: 3137 2c20 3230 3138 2c20 3230 3139 2c20  17, 2018, 2019, 
+00000380: 3230 3230 2c20 3230 3231 2c20 3230 3232  2020, 2021, 2022
+00000390: 2c20 3230 3233 2050 7974 686f 6e20 536f  , 2023 Python So
+000003a0: 6674 7761 7265 2046 6f75 6e64 6174 696f  ftware Foundatio
+000003b0: 6e3b 0d0a 416c 6c20 5269 6768 7473 2052  n;..All Rights R
+000003c0: 6573 6572 7665 6422 2061 7265 2072 6574  eserved" are ret
+000003d0: 6169 6e65 6420 696e 2050 7974 686f 6e20  ained in Python 
+000003e0: 616c 6f6e 6520 6f72 2069 6e20 616e 7920  alone or in any 
+000003f0: 6465 7269 7661 7469 7665 2076 6572 7369  derivative versi
+00000400: 6f6e 0d0a 7072 6570 6172 6564 2062 7920  on..prepared by 
+00000410: 4c69 6365 6e73 6565 2e0d 0a0d 0a33 2e20  Licensee.....3. 
+00000420: 496e 2074 6865 2065 7665 6e74 204c 6963  In the event Lic
+00000430: 656e 7365 6520 7072 6570 6172 6573 2061  ensee prepares a
+00000440: 2064 6572 6976 6174 6976 6520 776f 726b   derivative work
+00000450: 2074 6861 7420 6973 2062 6173 6564 206f   that is based o
+00000460: 6e0d 0a6f 7220 696e 636f 7270 6f72 6174  n..or incorporat
+00000470: 6573 2050 7974 686f 6e20 6f72 2061 6e79  es Python or any
+00000480: 2070 6172 7420 7468 6572 656f 662c 2061   part thereof, a
+00000490: 6e64 2077 616e 7473 2074 6f20 6d61 6b65  nd wants to make
+000004a0: 0d0a 7468 6520 6465 7269 7661 7469 7665  ..the derivative
+000004b0: 2077 6f72 6b20 6176 6169 6c61 626c 6520   work available 
+000004c0: 746f 206f 7468 6572 7320 6173 2070 726f  to others as pro
+000004d0: 7669 6465 6420 6865 7265 696e 2c20 7468  vided herein, th
+000004e0: 656e 0d0a 4c69 6365 6e73 6565 2068 6572  en..Licensee her
+000004f0: 6562 7920 6167 7265 6573 2074 6f20 696e  eby agrees to in
+00000500: 636c 7564 6520 696e 2061 6e79 2073 7563  clude in any suc
+00000510: 6820 776f 726b 2061 2062 7269 6566 2073  h work a brief s
+00000520: 756d 6d61 7279 206f 660d 0a74 6865 2063  ummary of..the c
+00000530: 6861 6e67 6573 206d 6164 6520 746f 2050  hanges made to P
+00000540: 7974 686f 6e2e 0d0a 0d0a 342e 2050 5346  ython.....4. PSF
+00000550: 2069 7320 6d61 6b69 6e67 2050 7974 686f   is making Pytho
+00000560: 6e20 6176 6169 6c61 626c 6520 746f 204c  n available to L
+00000570: 6963 656e 7365 6520 6f6e 2061 6e20 2241  icensee on an "A
+00000580: 5320 4953 220d 0a62 6173 6973 2e20 2050  S IS"..basis.  P
+00000590: 5346 204d 414b 4553 204e 4f20 5245 5052  SF MAKES NO REPR
+000005a0: 4553 454e 5441 5449 4f4e 5320 4f52 2057  ESENTATIONS OR W
+000005b0: 4152 5241 4e54 4945 532c 2045 5850 5245  ARRANTIES, EXPRE
+000005c0: 5353 204f 520d 0a49 4d50 4c49 4544 2e20  SS OR..IMPLIED. 
+000005d0: 2042 5920 5741 5920 4f46 2045 5841 4d50   BY WAY OF EXAMP
+000005e0: 4c45 2c20 4255 5420 4e4f 5420 4c49 4d49  LE, BUT NOT LIMI
+000005f0: 5441 5449 4f4e 2c20 5053 4620 4d41 4b45  TATION, PSF MAKE
+00000600: 5320 4e4f 2041 4e44 0d0a 4449 5343 4c41  S NO AND..DISCLA
+00000610: 494d 5320 414e 5920 5245 5052 4553 454e  IMS ANY REPRESEN
+00000620: 5441 5449 4f4e 204f 5220 5741 5252 414e  TATION OR WARRAN
+00000630: 5459 204f 4620 4d45 5243 4841 4e54 4142  TY OF MERCHANTAB
+00000640: 494c 4954 5920 4f52 2046 4954 4e45 5353  ILITY OR FITNESS
+00000650: 0d0a 464f 5220 414e 5920 5041 5254 4943  ..FOR ANY PARTIC
+00000660: 554c 4152 2050 5552 504f 5345 204f 5220  ULAR PURPOSE OR 
+00000670: 5448 4154 2054 4845 2055 5345 204f 4620  THAT THE USE OF 
+00000680: 5059 5448 4f4e 2057 494c 4c20 4e4f 540d  PYTHON WILL NOT.
+00000690: 0a49 4e46 5249 4e47 4520 414e 5920 5448  .INFRINGE ANY TH
+000006a0: 4952 4420 5041 5254 5920 5249 4748 5453  IRD PARTY RIGHTS
+000006b0: 2e0d 0a0d 0a35 2e20 5053 4620 5348 414c  .....5. PSF SHAL
+000006c0: 4c20 4e4f 5420 4245 204c 4941 424c 4520  L NOT BE LIABLE 
+000006d0: 544f 204c 4943 454e 5345 4520 4f52 2041  TO LICENSEE OR A
+000006e0: 4e59 204f 5448 4552 2055 5345 5253 204f  NY OTHER USERS O
+000006f0: 4620 5059 5448 4f4e 0d0a 464f 5220 414e  F PYTHON..FOR AN
+00000700: 5920 494e 4349 4445 4e54 414c 2c20 5350  Y INCIDENTAL, SP
+00000710: 4543 4941 4c2c 204f 5220 434f 4e53 4551  ECIAL, OR CONSEQ
+00000720: 5545 4e54 4941 4c20 4441 4d41 4745 5320  UENTIAL DAMAGES 
+00000730: 4f52 204c 4f53 5320 4153 0d0a 4120 5245  OR LOSS AS..A RE
+00000740: 5355 4c54 204f 4620 4d4f 4449 4659 494e  SULT OF MODIFYIN
+00000750: 472c 2044 4953 5452 4942 5554 494e 472c  G, DISTRIBUTING,
+00000760: 204f 5220 4f54 4845 5257 4953 4520 5553   OR OTHERWISE US
+00000770: 494e 4720 5059 5448 4f4e 2c0d 0a4f 5220  ING PYTHON,..OR 
+00000780: 414e 5920 4445 5249 5641 5449 5645 2054  ANY DERIVATIVE T
+00000790: 4845 5245 4f46 2c20 4556 454e 2049 4620  HEREOF, EVEN IF 
+000007a0: 4144 5649 5345 4420 4f46 2054 4845 2050  ADVISED OF THE P
+000007b0: 4f53 5349 4249 4c49 5459 2054 4845 5245  OSSIBILITY THERE
+000007c0: 4f46 2e0d 0a0d 0a36 2e20 5468 6973 204c  OF.....6. This L
+000007d0: 6963 656e 7365 2041 6772 6565 6d65 6e74  icense Agreement
+000007e0: 2077 696c 6c20 6175 746f 6d61 7469 6361   will automatica
+000007f0: 6c6c 7920 7465 726d 696e 6174 6520 7570  lly terminate up
+00000800: 6f6e 2061 206d 6174 6572 6961 6c0d 0a62  on a material..b
+00000810: 7265 6163 6820 6f66 2069 7473 2074 6572  reach of its ter
+00000820: 6d73 2061 6e64 2063 6f6e 6469 7469 6f6e  ms and condition
+00000830: 732e 0d0a 0d0a 372e 204e 6f74 6869 6e67  s.....7. Nothing
+00000840: 2069 6e20 7468 6973 204c 6963 656e 7365   in this License
+00000850: 2041 6772 6565 6d65 6e74 2073 6861 6c6c   Agreement shall
+00000860: 2062 6520 6465 656d 6564 2074 6f20 6372   be deemed to cr
+00000870: 6561 7465 2061 6e79 0d0a 7265 6c61 7469  eate any..relati
+00000880: 6f6e 7368 6970 206f 6620 6167 656e 6379  onship of agency
+00000890: 2c20 7061 7274 6e65 7273 6869 702c 206f  , partnership, o
+000008a0: 7220 6a6f 696e 7420 7665 6e74 7572 6520  r joint venture 
+000008b0: 6265 7477 6565 6e20 5053 4620 616e 640d  between PSF and.
+000008c0: 0a4c 6963 656e 7365 652e 2020 5468 6973  .Licensee.  This
+000008d0: 204c 6963 656e 7365 2041 6772 6565 6d65   License Agreeme
+000008e0: 6e74 2064 6f65 7320 6e6f 7420 6772 616e  nt does not gran
+000008f0: 7420 7065 726d 6973 7369 6f6e 2074 6f20  t permission to 
+00000900: 7573 6520 5053 460d 0a74 7261 6465 6d61  use PSF..tradema
+00000910: 726b 7320 6f72 2074 7261 6465 206e 616d  rks or trade nam
+00000920: 6520 696e 2061 2074 7261 6465 6d61 726b  e in a trademark
+00000930: 2073 656e 7365 2074 6f20 656e 646f 7273   sense to endors
+00000940: 6520 6f72 2070 726f 6d6f 7465 0d0a 7072  e or promote..pr
+00000950: 6f64 7563 7473 206f 7220 7365 7276 6963  oducts or servic
+00000960: 6573 206f 6620 4c69 6365 6e73 6565 2c20  es of Licensee, 
+00000970: 6f72 2061 6e79 2074 6869 7264 2070 6172  or any third par
+00000980: 7479 2e0d 0a0d 0a38 2e20 4279 2063 6f70  ty.....8. By cop
+00000990: 7969 6e67 2c20 696e 7374 616c 6c69 6e67  ying, installing
+000009a0: 206f 7220 6f74 6865 7277 6973 6520 7573   or otherwise us
+000009b0: 696e 6720 5079 7468 6f6e 2c20 4c69 6365  ing Python, Lice
+000009c0: 6e73 6565 0d0a 6167 7265 6573 2074 6f20  nsee..agrees to 
+000009d0: 6265 2062 6f75 6e64 2062 7920 7468 6520  be bound by the 
+000009e0: 7465 726d 7320 616e 6420 636f 6e64 6974  terms and condit
+000009f0: 696f 6e73 206f 6620 7468 6973 204c 6963  ions of this Lic
+00000a00: 656e 7365 0d0a 4167 7265 656d 656e 742e  ense..Agreement.
+00000a10: 0d0a 2222 220d 0a69 6d70 6f72 7420 6269  .."""..import bi
+00000a20: 6e61 7363 6969 0d0a 696d 706f 7274 2063  nascii..import c
+00000a30: 6f6e 7465 7874 6c69 620d 0a69 6d70 6f72  ontextlib..impor
+00000a40: 7420 696d 706f 7274 6c69 622e 7574 696c  t importlib.util
+00000a50: 0d0a 696d 706f 7274 2069 6f0d 0a69 6d70  ..import io..imp
+00000a60: 6f72 7420 6974 6572 746f 6f6c 730d 0a69  ort itertools..i
+00000a70: 6d70 6f72 7420 6f73 0d0a 696d 706f 7274  mport os..import
+00000a80: 2070 6f73 6978 7061 7468 0d0a 696d 706f   posixpath..impo
+00000a90: 7274 2073 6875 7469 6c0d 0a69 6d70 6f72  rt shutil..impor
+00000aa0: 7420 7374 6174 0d0a 696d 706f 7274 2073  t stat..import s
+00000ab0: 7472 7563 740d 0a69 6d70 6f72 7420 7379  truct..import sy
+00000ac0: 730d 0a69 6d70 6f72 7420 7468 7265 6164  s..import thread
+00000ad0: 696e 670d 0a69 6d70 6f72 7420 7469 6d65  ing..import time
+00000ae0: 0d0a 6672 6f6d 206f 7065 7261 746f 7220  ..from operator 
+00000af0: 696d 706f 7274 2061 7474 7267 6574 7465  import attrgette
+00000b00: 720d 0a0d 0a74 7279 3a0d 0a20 2020 2069  r....try:..    i
+00000b10: 6d70 6f72 7420 7a6c 6962 2020 2320 5765  mport zlib  # We
+00000b20: 206d 6179 206e 6565 6420 6974 7320 636f   may need its co
+00000b30: 6d70 7265 7373 696f 6e20 6d65 7468 6f64  mpression method
+00000b40: 0d0a 0d0a 2020 2020 6372 6333 3220 3d20  ....    crc32 = 
+00000b50: 7a6c 6962 2e63 7263 3332 0d0a 6578 6365  zlib.crc32..exce
+00000b60: 7074 2049 6d70 6f72 7445 7272 6f72 3a0d  pt ImportError:.
+00000b70: 0a20 2020 207a 6c69 6220 3d20 4e6f 6e65  .    zlib = None
+00000b80: 0d0a 2020 2020 6372 6333 3220 3d20 6269  ..    crc32 = bi
+00000b90: 6e61 7363 6969 2e63 7263 3332 0d0a 0d0a  nascii.crc32....
+00000ba0: 7472 793a 0d0a 2020 2020 696d 706f 7274  try:..    import
+00000bb0: 2062 7a32 2020 2320 5765 206d 6179 206e   bz2  # We may n
+00000bc0: 6565 6420 6974 7320 636f 6d70 7265 7373  eed its compress
+00000bd0: 696f 6e20 6d65 7468 6f64 0d0a 6578 6365  ion method..exce
+00000be0: 7074 2049 6d70 6f72 7445 7272 6f72 3a0d  pt ImportError:.
+00000bf0: 0a20 2020 2062 7a32 203d 204e 6f6e 650d  .    bz2 = None.
+00000c00: 0a0d 0a74 7279 3a0d 0a20 2020 2069 6d70  ...try:..    imp
+00000c10: 6f72 7420 6c7a 6d61 2020 2320 5765 206d  ort lzma  # We m
+00000c20: 6179 206e 6565 6420 6974 7320 636f 6d70  ay need its comp
+00000c30: 7265 7373 696f 6e20 6d65 7468 6f64 0d0a  ression method..
+00000c40: 6578 6365 7074 2049 6d70 6f72 7445 7272  except ImportErr
+00000c50: 6f72 3a0d 0a20 2020 206c 7a6d 6120 3d20  or:..    lzma = 
+00000c60: 4e6f 6e65 0d0a 0d0a 5f5f 616c 6c5f 5f20  None....__all__ 
+00000c70: 3d20 5b0d 0a20 2020 2022 4261 645a 6970  = [..    "BadZip
+00000c80: 4669 6c65 222c 0d0a 2020 2020 2242 6164  File",..    "Bad
+00000c90: 5a69 7066 696c 6522 2c0d 0a20 2020 2022  Zipfile",..    "
+00000ca0: 6572 726f 7222 2c0d 0a20 2020 2022 5a49  error",..    "ZI
+00000cb0: 505f 5354 4f52 4544 222c 0d0a 2020 2020  P_STORED",..    
+00000cc0: 225a 4950 5f44 4546 4c41 5445 4422 2c0d  "ZIP_DEFLATED",.
+00000cd0: 0a20 2020 2022 5a49 505f 425a 4950 3222  .    "ZIP_BZIP2"
+00000ce0: 2c0d 0a20 2020 2022 5a49 505f 4c5a 4d41  ,..    "ZIP_LZMA
+00000cf0: 222c 0d0a 2020 2020 2269 735f 7a69 7066  ",..    "is_zipf
+00000d00: 696c 6522 2c0d 0a20 2020 2022 5a69 7049  ile",..    "ZipI
+00000d10: 6e66 6f22 2c0d 0a20 2020 2022 5a69 7046  nfo",..    "ZipF
+00000d20: 696c 6522 2c0d 0a20 2020 2022 5079 5a69  ile",..    "PyZi
+00000d30: 7046 696c 6522 2c0d 0a20 2020 2022 4c61  pFile",..    "La
+00000d40: 7267 655a 6970 4669 6c65 222c 0d0a 2020  rgeZipFile",..  
+00000d50: 2020 2250 6174 6822 2c0d 0a5d 0d0a 0d0a    "Path",..]....
+00000d60: 0d0a 636c 6173 7320 4261 645a 6970 4669  ..class BadZipFi
+00000d70: 6c65 2845 7863 6570 7469 6f6e 293a 0d0a  le(Exception):..
+00000d80: 2020 2020 7061 7373 0d0a 0d0a 0d0a 636c      pass......cl
+00000d90: 6173 7320 4c61 7267 655a 6970 4669 6c65  ass LargeZipFile
+00000da0: 2845 7863 6570 7469 6f6e 293a 0d0a 2020  (Exception):..  
+00000db0: 2020 2222 220d 0a20 2020 2052 6169 7365    """..    Raise
+00000dc0: 6420 7768 656e 2077 7269 7469 6e67 2061  d when writing a
+00000dd0: 207a 6970 6669 6c65 2c20 7468 6520 7a69   zipfile, the zi
+00000de0: 7066 696c 6520 7265 7175 6972 6573 205a  pfile requires Z
+00000df0: 4950 3634 2065 7874 656e 7369 6f6e 730d  IP64 extensions.
+00000e00: 0a20 2020 2061 6e64 2074 686f 7365 2065  .    and those e
+00000e10: 7874 656e 7369 6f6e 7320 6172 6520 6469  xtensions are di
+00000e20: 7361 626c 6564 2e0d 0a20 2020 2022 2222  sabled...    """
+00000e30: 0d0a 0d0a 0d0a 6572 726f 7220 3d20 4261  ......error = Ba
+00000e40: 645a 6970 6669 6c65 203d 2042 6164 5a69  dZipfile = BadZi
+00000e50: 7046 696c 6520 2023 2050 7265 2d33 2e32  pFile  # Pre-3.2
+00000e60: 2063 6f6d 7061 7469 6269 6c69 7479 206e   compatibility n
+00000e70: 616d 6573 0d0a 0d0a 5a49 5036 345f 4c49  ames....ZIP64_LI
+00000e80: 4d49 5420 3d20 2831 203c 3c20 3331 2920  MIT = (1 << 31) 
+00000e90: 2d20 310d 0a5a 4950 5f46 494c 4543 4f55  - 1..ZIP_FILECOU
+00000ea0: 4e54 5f4c 494d 4954 203d 2028 3120 3c3c  NT_LIMIT = (1 <<
+00000eb0: 2031 3629 202d 2031 0d0a 5a49 505f 4d41   16) - 1..ZIP_MA
+00000ec0: 585f 434f 4d4d 454e 5420 3d20 2831 203c  X_COMMENT = (1 <
+00000ed0: 3c20 3136 2920 2d20 310d 0a0d 0a23 2063  < 16) - 1....# c
+00000ee0: 6f6e 7374 616e 7473 2066 6f72 205a 6970  onstants for Zip
+00000ef0: 2066 696c 6520 636f 6d70 7265 7373 696f   file compressio
+00000f00: 6e20 6d65 7468 6f64 730d 0a5a 4950 5f53  n methods..ZIP_S
+00000f10: 544f 5245 4420 3d20 300d 0a5a 4950 5f44  TORED = 0..ZIP_D
+00000f20: 4546 4c41 5445 4420 3d20 380d 0a5a 4950  EFLATED = 8..ZIP
+00000f30: 5f42 5a49 5032 203d 2031 320d 0a5a 4950  _BZIP2 = 12..ZIP
+00000f40: 5f4c 5a4d 4120 3d20 3134 0d0a 2320 4f74  _LZMA = 14..# Ot
+00000f50: 6865 7220 5a49 5020 636f 6d70 7265 7373  her ZIP compress
+00000f60: 696f 6e20 6d65 7468 6f64 7320 6e6f 7420  ion methods not 
+00000f70: 7375 7070 6f72 7465 640d 0a0d 0a44 4546  supported....DEF
+00000f80: 4155 4c54 5f56 4552 5349 4f4e 203d 2032  AULT_VERSION = 2
+00000f90: 300d 0a5a 4950 3634 5f56 4552 5349 4f4e  0..ZIP64_VERSION
+00000fa0: 203d 2034 350d 0a42 5a49 5032 5f56 4552   = 45..BZIP2_VER
+00000fb0: 5349 4f4e 203d 2034 360d 0a4c 5a4d 415f  SION = 46..LZMA_
+00000fc0: 5645 5253 494f 4e20 3d20 3633 0d0a 2320  VERSION = 63..# 
+00000fd0: 7765 2072 6563 6f67 6e69 7a65 2028 6275  we recognize (bu
+00000fe0: 7420 6e6f 7420 6e65 6365 7373 6172 696c  t not necessaril
+00000ff0: 7920 7375 7070 6f72 7429 2061 6c6c 2066  y support) all f
+00001000: 6561 7475 7265 7320 7570 2074 6f20 7468  eatures up to th
+00001010: 6174 2076 6572 7369 6f6e 0d0a 4d41 585f  at version..MAX_
+00001020: 4558 5452 4143 545f 5645 5253 494f 4e20  EXTRACT_VERSION 
+00001030: 3d20 3633 0d0a 0d0a 2320 4265 6c6f 7720  = 63....# Below 
+00001040: 6172 6520 736f 6d65 2066 6f72 6d61 7473  are some formats
+00001050: 2061 6e64 2061 7373 6f63 6961 7465 6420   and associated 
+00001060: 6461 7461 2066 6f72 2072 6561 6469 6e67  data for reading
+00001070: 2f77 7269 7469 6e67 2068 6561 6465 7273  /writing headers
+00001080: 2075 7369 6e67 0d0a 2320 7468 6520 7374   using..# the st
+00001090: 7275 6374 206d 6f64 756c 652e 2020 5468  ruct module.  Th
+000010a0: 6520 6e61 6d65 7320 616e 6420 7374 7275  e names and stru
+000010b0: 6374 7572 6573 206f 6620 6865 6164 6572  ctures of header
+000010c0: 732f 7265 636f 7264 7320 6172 6520 7468  s/records are th
+000010d0: 6f73 6520 7573 6564 0d0a 2320 696e 2074  ose used..# in t
+000010e0: 6865 2050 4b57 4152 4520 6465 7363 7269  he PKWARE descri
+000010f0: 7074 696f 6e20 6f66 2074 6865 205a 4950  ption of the ZIP
+00001100: 2066 696c 6520 666f 726d 6174 3a0d 0a23   file format:..#
+00001110: 2020 2020 2068 7474 703a 2f2f 7777 772e       http://www.
+00001120: 706b 7761 7265 2e63 6f6d 2f64 6f63 756d  pkware.com/docum
+00001130: 656e 7473 2f63 6173 6573 7475 6469 6573  ents/casestudies
+00001140: 2f41 5050 4e4f 5445 2e54 5854 0d0a 2320  /APPNOTE.TXT..# 
+00001150: 2855 524c 2076 616c 6964 2061 7320 6f66  (URL valid as of
+00001160: 204a 616e 7561 7279 2032 3030 3829 0d0a   January 2008)..
+00001170: 0d0a 2320 5468 6520 2265 6e64 206f 6620  ..# The "end of 
+00001180: 6365 6e74 7261 6c20 6469 7265 6374 6f72  central director
+00001190: 7922 2073 7472 7563 7475 7265 2c20 6d61  y" structure, ma
+000011a0: 6769 6320 6e75 6d62 6572 2c20 7369 7a65  gic number, size
+000011b0: 2c20 616e 6420 696e 6469 6365 730d 0a23  , and indices..#
+000011c0: 2028 7365 6374 696f 6e20 562e 4920 696e   (section V.I in
+000011d0: 2074 6865 2066 6f72 6d61 7420 646f 6375   the format docu
+000011e0: 6d65 6e74 290d 0a73 7472 7563 7445 6e64  ment)..structEnd
+000011f0: 4172 6368 6976 6520 3d20 6222 3c34 7334  Archive = b"<4s4
+00001200: 4832 4c48 220d 0a73 7472 696e 6745 6e64  H2LH"..stringEnd
+00001210: 4172 6368 6976 6520 3d20 6222 504b 5c30  Archive = b"PK\0
+00001220: 3035 5c30 3036 220d 0a73 697a 6545 6e64  05\006"..sizeEnd
+00001230: 4365 6e74 4469 7220 3d20 7374 7275 6374  CentDir = struct
+00001240: 2e63 616c 6373 697a 6528 7374 7275 6374  .calcsize(struct
+00001250: 456e 6441 7263 6869 7665 290d 0a0d 0a5f  EndArchive)...._
+00001260: 4543 445f 5349 474e 4154 5552 4520 3d20  ECD_SIGNATURE = 
+00001270: 300d 0a5f 4543 445f 4449 534b 5f4e 554d  0.._ECD_DISK_NUM
+00001280: 4245 5220 3d20 310d 0a5f 4543 445f 4449  BER = 1.._ECD_DI
+00001290: 534b 5f53 5441 5254 203d 2032 0d0a 5f45  SK_START = 2.._E
+000012a0: 4344 5f45 4e54 5249 4553 5f54 4849 535f  CD_ENTRIES_THIS_
+000012b0: 4449 534b 203d 2033 0d0a 5f45 4344 5f45  DISK = 3.._ECD_E
+000012c0: 4e54 5249 4553 5f54 4f54 414c 203d 2034  NTRIES_TOTAL = 4
+000012d0: 0d0a 5f45 4344 5f53 495a 4520 3d20 350d  .._ECD_SIZE = 5.
+000012e0: 0a5f 4543 445f 4f46 4653 4554 203d 2036  ._ECD_OFFSET = 6
+000012f0: 0d0a 5f45 4344 5f43 4f4d 4d45 4e54 5f53  .._ECD_COMMENT_S
+00001300: 495a 4520 3d20 370d 0a23 2054 6865 7365  IZE = 7..# These
+00001310: 206c 6173 7420 7477 6f20 696e 6469 6365   last two indice
+00001320: 7320 6172 6520 6e6f 7420 7061 7274 206f  s are not part o
+00001330: 6620 7468 6520 7374 7275 6374 7572 6520  f the structure 
+00001340: 6173 2064 6566 696e 6564 2069 6e20 7468  as defined in th
+00001350: 650d 0a23 2073 7065 632c 2062 7574 2074  e..# spec, but t
+00001360: 6865 7920 6172 6520 7573 6564 2069 6e74  hey are used int
+00001370: 6572 6e61 6c6c 7920 6279 2074 6869 7320  ernally by this 
+00001380: 6d6f 6475 6c65 2061 7320 6120 636f 6e76  module as a conv
+00001390: 656e 6965 6e63 650d 0a5f 4543 445f 434f  enience.._ECD_CO
+000013a0: 4d4d 454e 5420 3d20 380d 0a5f 4543 445f  MMENT = 8.._ECD_
+000013b0: 4c4f 4341 5449 4f4e 203d 2039 0d0a 0d0a  LOCATION = 9....
+000013c0: 2320 5468 6520 2263 656e 7472 616c 2064  # The "central d
+000013d0: 6972 6563 746f 7279 2220 7374 7275 6374  irectory" struct
+000013e0: 7572 652c 206d 6167 6963 206e 756d 6265  ure, magic numbe
+000013f0: 722c 2073 697a 652c 2061 6e64 2069 6e64  r, size, and ind
+00001400: 6963 6573 0d0a 2320 6f66 2065 6e74 7269  ices..# of entri
+00001410: 6573 2069 6e20 7468 6520 7374 7275 6374  es in the struct
+00001420: 7572 6520 2873 6563 7469 6f6e 2056 2e46  ure (section V.F
+00001430: 2069 6e20 7468 6520 666f 726d 6174 2064   in the format d
+00001440: 6f63 756d 656e 7429 0d0a 7374 7275 6374  ocument)..struct
+00001450: 4365 6e74 7261 6c44 6972 203d 2022 3c34  CentralDir = "<4
+00001460: 7334 4234 484c 324c 3548 324c 220d 0a73  s4B4HL2L5H2L"..s
+00001470: 7472 696e 6743 656e 7472 616c 4469 7220  tringCentralDir 
+00001480: 3d20 6222 504b 5c30 3031 5c30 3032 220d  = b"PK\001\002".
+00001490: 0a73 697a 6543 656e 7472 616c 4469 7220  .sizeCentralDir 
+000014a0: 3d20 7374 7275 6374 2e63 616c 6373 697a  = struct.calcsiz
+000014b0: 6528 7374 7275 6374 4365 6e74 7261 6c44  e(structCentralD
+000014c0: 6972 290d 0a0d 0a23 2069 6e64 6578 6573  ir)....# indexes
+000014d0: 206f 6620 656e 7472 6965 7320 696e 2074   of entries in t
+000014e0: 6865 2063 656e 7472 616c 2064 6972 6563  he central direc
+000014f0: 746f 7279 2073 7472 7563 7475 7265 0d0a  tory structure..
+00001500: 5f43 445f 5349 474e 4154 5552 4520 3d20  _CD_SIGNATURE = 
+00001510: 300d 0a5f 4344 5f43 5245 4154 455f 5645  0.._CD_CREATE_VE
+00001520: 5253 494f 4e20 3d20 310d 0a5f 4344 5f43  RSION = 1.._CD_C
+00001530: 5245 4154 455f 5359 5354 454d 203d 2032  REATE_SYSTEM = 2
+00001540: 0d0a 5f43 445f 4558 5452 4143 545f 5645  .._CD_EXTRACT_VE
+00001550: 5253 494f 4e20 3d20 330d 0a5f 4344 5f45  RSION = 3.._CD_E
+00001560: 5854 5241 4354 5f53 5953 5445 4d20 3d20  XTRACT_SYSTEM = 
+00001570: 340d 0a5f 4344 5f46 4c41 475f 4249 5453  4.._CD_FLAG_BITS
+00001580: 203d 2035 0d0a 5f43 445f 434f 4d50 5245   = 5.._CD_COMPRE
+00001590: 5353 5f54 5950 4520 3d20 360d 0a5f 4344  SS_TYPE = 6.._CD
+000015a0: 5f54 494d 4520 3d20 370d 0a5f 4344 5f44  _TIME = 7.._CD_D
+000015b0: 4154 4520 3d20 380d 0a5f 4344 5f43 5243  ATE = 8.._CD_CRC
+000015c0: 203d 2039 0d0a 5f43 445f 434f 4d50 5245   = 9.._CD_COMPRE
+000015d0: 5353 4544 5f53 495a 4520 3d20 3130 0d0a  SSED_SIZE = 10..
+000015e0: 5f43 445f 554e 434f 4d50 5245 5353 4544  _CD_UNCOMPRESSED
+000015f0: 5f53 495a 4520 3d20 3131 0d0a 5f43 445f  _SIZE = 11.._CD_
+00001600: 4649 4c45 4e41 4d45 5f4c 454e 4754 4820  FILENAME_LENGTH 
+00001610: 3d20 3132 0d0a 5f43 445f 4558 5452 415f  = 12.._CD_EXTRA_
+00001620: 4649 454c 445f 4c45 4e47 5448 203d 2031  FIELD_LENGTH = 1
+00001630: 330d 0a5f 4344 5f43 4f4d 4d45 4e54 5f4c  3.._CD_COMMENT_L
+00001640: 454e 4754 4820 3d20 3134 0d0a 5f43 445f  ENGTH = 14.._CD_
+00001650: 4449 534b 5f4e 554d 4245 525f 5354 4152  DISK_NUMBER_STAR
+00001660: 5420 3d20 3135 0d0a 5f43 445f 494e 5445  T = 15.._CD_INTE
+00001670: 524e 414c 5f46 494c 455f 4154 5452 4942  RNAL_FILE_ATTRIB
+00001680: 5554 4553 203d 2031 360d 0a5f 4344 5f45  UTES = 16.._CD_E
+00001690: 5854 4552 4e41 4c5f 4649 4c45 5f41 5454  XTERNAL_FILE_ATT
+000016a0: 5249 4255 5445 5320 3d20 3137 0d0a 5f43  RIBUTES = 17.._C
+000016b0: 445f 4c4f 4341 4c5f 4845 4144 4552 5f4f  D_LOCAL_HEADER_O
+000016c0: 4646 5345 5420 3d20 3138 0d0a 0d0a 2320  FFSET = 18....# 
+000016d0: 5468 6520 226c 6f63 616c 2066 696c 6520  The "local file 
+000016e0: 6865 6164 6572 2220 7374 7275 6374 7572  header" structur
+000016f0: 652c 206d 6167 6963 206e 756d 6265 722c  e, magic number,
+00001700: 2073 697a 652c 2061 6e64 2069 6e64 6963   size, and indic
+00001710: 6573 0d0a 2320 2873 6563 7469 6f6e 2056  es..# (section V
+00001720: 2e41 2069 6e20 7468 6520 666f 726d 6174  .A in the format
+00001730: 2064 6f63 756d 656e 7429 0d0a 7374 7275   document)..stru
+00001740: 6374 4669 6c65 4865 6164 6572 203d 2022  ctFileHeader = "
+00001750: 3c34 7332 4234 484c 324c 3248 220d 0a73  <4s2B4HL2L2H"..s
+00001760: 7472 696e 6746 696c 6548 6561 6465 7220  tringFileHeader 
+00001770: 3d20 6222 504b 5c30 3033 5c30 3034 220d  = b"PK\003\004".
+00001780: 0a73 697a 6546 696c 6548 6561 6465 7220  .sizeFileHeader 
+00001790: 3d20 7374 7275 6374 2e63 616c 6373 697a  = struct.calcsiz
+000017a0: 6528 7374 7275 6374 4669 6c65 4865 6164  e(structFileHead
+000017b0: 6572 290d 0a0d 0a5f 4648 5f53 4947 4e41  er)...._FH_SIGNA
+000017c0: 5455 5245 203d 2030 0d0a 5f46 485f 4558  TURE = 0.._FH_EX
+000017d0: 5452 4143 545f 5645 5253 494f 4e20 3d20  TRACT_VERSION = 
+000017e0: 310d 0a5f 4648 5f45 5854 5241 4354 5f53  1.._FH_EXTRACT_S
+000017f0: 5953 5445 4d20 3d20 320d 0a5f 4648 5f47  YSTEM = 2.._FH_G
+00001800: 454e 4552 414c 5f50 5552 504f 5345 5f46  ENERAL_PURPOSE_F
+00001810: 4c41 475f 4249 5453 203d 2033 0d0a 5f46  LAG_BITS = 3.._F
+00001820: 485f 434f 4d50 5245 5353 494f 4e5f 4d45  H_COMPRESSION_ME
+00001830: 5448 4f44 203d 2034 0d0a 5f46 485f 4c41  THOD = 4.._FH_LA
+00001840: 5354 5f4d 4f44 5f54 494d 4520 3d20 350d  ST_MOD_TIME = 5.
+00001850: 0a5f 4648 5f4c 4153 545f 4d4f 445f 4441  ._FH_LAST_MOD_DA
+00001860: 5445 203d 2036 0d0a 5f46 485f 4352 4320  TE = 6.._FH_CRC 
+00001870: 3d20 370d 0a5f 4648 5f43 4f4d 5052 4553  = 7.._FH_COMPRES
+00001880: 5345 445f 5349 5a45 203d 2038 0d0a 5f46  SED_SIZE = 8.._F
+00001890: 485f 554e 434f 4d50 5245 5353 4544 5f53  H_UNCOMPRESSED_S
+000018a0: 495a 4520 3d20 390d 0a5f 4648 5f46 494c  IZE = 9.._FH_FIL
+000018b0: 454e 414d 455f 4c45 4e47 5448 203d 2031  ENAME_LENGTH = 1
+000018c0: 300d 0a5f 4648 5f45 5854 5241 5f46 4945  0.._FH_EXTRA_FIE
+000018d0: 4c44 5f4c 454e 4754 4820 3d20 3131 0d0a  LD_LENGTH = 11..
+000018e0: 0d0a 2320 5468 6520 225a 6970 3634 2065  ..# The "Zip64 e
+000018f0: 6e64 206f 6620 6365 6e74 7261 6c20 6469  nd of central di
+00001900: 7265 6374 6f72 7920 6c6f 6361 746f 7222  rectory locator"
+00001910: 2073 7472 7563 7475 7265 2c20 6d61 6769   structure, magi
+00001920: 6320 6e75 6d62 6572 2c20 616e 6420 7369  c number, and si
+00001930: 7a65 0d0a 7374 7275 6374 456e 6441 7263  ze..structEndArc
+00001940: 6869 7665 3634 4c6f 6361 746f 7220 3d20  hive64Locator = 
+00001950: 223c 3473 4c51 4c22 0d0a 7374 7269 6e67  "<4sLQL"..string
+00001960: 456e 6441 7263 6869 7665 3634 4c6f 6361  EndArchive64Loca
+00001970: 746f 7220 3d20 6222 504b 5c78 3036 5c78  tor = b"PK\x06\x
+00001980: 3037 220d 0a73 697a 6545 6e64 4365 6e74  07"..sizeEndCent
+00001990: 4469 7236 344c 6f63 6174 6f72 203d 2073  Dir64Locator = s
+000019a0: 7472 7563 742e 6361 6c63 7369 7a65 2873  truct.calcsize(s
+000019b0: 7472 7563 7445 6e64 4172 6368 6976 6536  tructEndArchive6
+000019c0: 344c 6f63 6174 6f72 290d 0a0d 0a23 2054  4Locator)....# T
+000019d0: 6865 2022 5a69 7036 3420 656e 6420 6f66  he "Zip64 end of
+000019e0: 2063 656e 7472 616c 2064 6972 6563 746f   central directo
+000019f0: 7279 2220 7265 636f 7264 2c20 6d61 6769  ry" record, magi
+00001a00: 6320 6e75 6d62 6572 2c20 7369 7a65 2c20  c number, size, 
+00001a10: 616e 6420 696e 6469 6365 730d 0a23 2028  and indices..# (
+00001a20: 7365 6374 696f 6e20 562e 4720 696e 2074  section V.G in t
+00001a30: 6865 2066 6f72 6d61 7420 646f 6375 6d65  he format docume
+00001a40: 6e74 290d 0a73 7472 7563 7445 6e64 4172  nt)..structEndAr
+00001a50: 6368 6976 6536 3420 3d20 223c 3473 5132  chive64 = "<4sQ2
+00001a60: 4832 4c34 5122 0d0a 7374 7269 6e67 456e  H2L4Q"..stringEn
+00001a70: 6441 7263 6869 7665 3634 203d 2062 2250  dArchive64 = b"P
+00001a80: 4b5c 7830 365c 7830 3622 0d0a 7369 7a65  K\x06\x06"..size
+00001a90: 456e 6443 656e 7444 6972 3634 203d 2073  EndCentDir64 = s
+00001aa0: 7472 7563 742e 6361 6c63 7369 7a65 2873  truct.calcsize(s
+00001ab0: 7472 7563 7445 6e64 4172 6368 6976 6536  tructEndArchive6
+00001ac0: 3429 0d0a 0d0a 5f43 4436 345f 5349 474e  4)...._CD64_SIGN
+00001ad0: 4154 5552 4520 3d20 300d 0a5f 4344 3634  ATURE = 0.._CD64
+00001ae0: 5f44 4952 4543 544f 5259 5f52 4543 5349  _DIRECTORY_RECSI
+00001af0: 5a45 203d 2031 0d0a 5f43 4436 345f 4352  ZE = 1.._CD64_CR
+00001b00: 4541 5445 5f56 4552 5349 4f4e 203d 2032  EATE_VERSION = 2
+00001b10: 0d0a 5f43 4436 345f 4558 5452 4143 545f  .._CD64_EXTRACT_
+00001b20: 5645 5253 494f 4e20 3d20 330d 0a5f 4344  VERSION = 3.._CD
+00001b30: 3634 5f44 4953 4b5f 4e55 4d42 4552 203d  64_DISK_NUMBER =
+00001b40: 2034 0d0a 5f43 4436 345f 4449 534b 5f4e   4.._CD64_DISK_N
+00001b50: 554d 4245 525f 5354 4152 5420 3d20 350d  UMBER_START = 5.
+00001b60: 0a5f 4344 3634 5f4e 554d 4245 525f 454e  ._CD64_NUMBER_EN
+00001b70: 5452 4945 535f 5448 4953 5f44 4953 4b20  TRIES_THIS_DISK 
+00001b80: 3d20 360d 0a5f 4344 3634 5f4e 554d 4245  = 6.._CD64_NUMBE
+00001b90: 525f 454e 5452 4945 535f 544f 5441 4c20  R_ENTRIES_TOTAL 
+00001ba0: 3d20 370d 0a5f 4344 3634 5f44 4952 4543  = 7.._CD64_DIREC
+00001bb0: 544f 5259 5f53 495a 4520 3d20 380d 0a5f  TORY_SIZE = 8.._
+00001bc0: 4344 3634 5f4f 4646 5345 545f 5354 4152  CD64_OFFSET_STAR
+00001bd0: 545f 4345 4e54 4449 5220 3d20 390d 0a0d  T_CENTDIR = 9...
+00001be0: 0a5f 4444 5f53 4947 4e41 5455 5245 203d  ._DD_SIGNATURE =
+00001bf0: 2030 7830 3830 3734 4235 300d 0a0d 0a5f   0x08074B50...._
+00001c00: 4558 5452 415f 4649 454c 445f 5354 5255  EXTRA_FIELD_STRU
+00001c10: 4354 203d 2073 7472 7563 742e 5374 7275  CT = struct.Stru
+00001c20: 6374 2822 3c48 4822 290d 0a0d 0a0d 0a64  ct("<HH")......d
+00001c30: 6566 205f 7374 7269 705f 6578 7472 6128  ef _strip_extra(
+00001c40: 6578 7472 612c 2078 6964 7329 3a0d 0a20  extra, xids):.. 
+00001c50: 2020 2023 2052 656d 6f76 6520 4578 7472     # Remove Extr
+00001c60: 6120 4669 656c 6473 2077 6974 6820 7370  a Fields with sp
+00001c70: 6563 6966 6965 6420 4944 732e 0d0a 2020  ecified IDs...  
+00001c80: 2020 756e 7061 636b 203d 205f 4558 5452    unpack = _EXTR
+00001c90: 415f 4649 454c 445f 5354 5255 4354 2e75  A_FIELD_STRUCT.u
+00001ca0: 6e70 6163 6b0d 0a20 2020 206d 6f64 6966  npack..    modif
+00001cb0: 6965 6420 3d20 4661 6c73 650d 0a20 2020  ied = False..   
+00001cc0: 2062 7566 6665 7220 3d20 5b5d 0d0a 2020   buffer = []..  
+00001cd0: 2020 7374 6172 7420 3d20 6920 3d20 300d    start = i = 0.
+00001ce0: 0a20 2020 2077 6869 6c65 2069 202b 2034  .    while i + 4
+00001cf0: 203c 3d20 6c65 6e28 6578 7472 6129 3a0d   <= len(extra):.
+00001d00: 0a20 2020 2020 2020 2078 6964 2c20 786c  .        xid, xl
+00001d10: 656e 203d 2075 6e70 6163 6b28 6578 7472  en = unpack(extr
+00001d20: 615b 6920 3a20 6920 2b20 345d 290d 0a20  a[i : i + 4]).. 
+00001d30: 2020 2020 2020 206a 203d 2069 202b 2034         j = i + 4
+00001d40: 202b 2078 6c65 6e0d 0a20 2020 2020 2020   + xlen..       
+00001d50: 2069 6620 7869 6420 696e 2078 6964 733a   if xid in xids:
+00001d60: 0d0a 2020 2020 2020 2020 2020 2020 6966  ..            if
+00001d70: 2069 2021 3d20 7374 6172 743a 0d0a 2020   i != start:..  
+00001d80: 2020 2020 2020 2020 2020 2020 2020 6275                bu
+00001d90: 6666 6572 2e61 7070 656e 6428 6578 7472  ffer.append(extr
+00001da0: 615b 7374 6172 743a 695d 290d 0a20 2020  a[start:i])..   
+00001db0: 2020 2020 2020 2020 2073 7461 7274 203d           start =
+00001dc0: 206a 0d0a 2020 2020 2020 2020 2020 2020   j..            
+00001dd0: 6d6f 6469 6669 6564 203d 2054 7275 650d  modified = True.
+00001de0: 0a20 2020 2020 2020 2069 203d 206a 0d0a  .        i = j..
+00001df0: 2020 2020 6966 206e 6f74 206d 6f64 6966      if not modif
+00001e00: 6965 643a 0d0a 2020 2020 2020 2020 7265  ied:..        re
+00001e10: 7475 726e 2065 7874 7261 0d0a 2020 2020  turn extra..    
+00001e20: 7265 7475 726e 2062 2222 2e6a 6f69 6e28  return b"".join(
+00001e30: 6275 6666 6572 290d 0a0d 0a0d 0a64 6566  buffer)......def
+00001e40: 205f 6368 6563 6b5f 7a69 7066 696c 6528   _check_zipfile(
+00001e50: 6670 293a 0d0a 2020 2020 7472 793a 0d0a  fp):..    try:..
+00001e60: 2020 2020 2020 2020 6966 205f 456e 6452          if _EndR
+00001e70: 6563 4461 7461 2866 7029 3a0d 0a20 2020  ecData(fp):..   
+00001e80: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+00001e90: 5472 7565 2020 2320 6669 6c65 2068 6173  True  # file has
+00001ea0: 2063 6f72 7265 6374 206d 6167 6963 206e   correct magic n
+00001eb0: 756d 6265 720d 0a20 2020 2065 7863 6570  umber..    excep
+00001ec0: 7420 4f53 4572 726f 723a 0d0a 2020 2020  t OSError:..    
+00001ed0: 2020 2020 7061 7373 0d0a 2020 2020 7265      pass..    re
+00001ee0: 7475 726e 2046 616c 7365 0d0a 0d0a 0d0a  turn False......
+00001ef0: 6465 6620 6973 5f7a 6970 6669 6c65 2866  def is_zipfile(f
+00001f00: 696c 656e 616d 6529 3a0d 0a20 2020 2022  ilename):..    "
+00001f10: 2222 5175 6963 6b6c 7920 7365 6520 6966  ""Quickly see if
+00001f20: 2061 2066 696c 6520 6973 2061 205a 4950   a file is a ZIP
+00001f30: 2066 696c 6520 6279 2063 6865 636b 696e   file by checkin
+00001f40: 6720 7468 6520 6d61 6769 6320 6e75 6d62  g the magic numb
+00001f50: 6572 2e0d 0a0d 0a20 2020 2054 6865 2066  er.....    The f
+00001f60: 696c 656e 616d 6520 6172 6775 6d65 6e74  ilename argument
+00001f70: 206d 6179 2062 6520 6120 6669 6c65 206f   may be a file o
+00001f80: 7220 6669 6c65 2d6c 696b 6520 6f62 6a65  r file-like obje
+00001f90: 6374 2074 6f6f 2e0d 0a20 2020 2022 2222  ct too...    """
+00001fa0: 0d0a 2020 2020 7265 7375 6c74 203d 2046  ..    result = F
+00001fb0: 616c 7365 0d0a 2020 2020 7472 793a 0d0a  alse..    try:..
+00001fc0: 2020 2020 2020 2020 6966 2068 6173 6174          if hasat
+00001fd0: 7472 2866 696c 656e 616d 652c 2022 7265  tr(filename, "re
+00001fe0: 6164 2229 3a0d 0a20 2020 2020 2020 2020  ad"):..         
+00001ff0: 2020 2072 6573 756c 7420 3d20 5f63 6865     result = _che
+00002000: 636b 5f7a 6970 6669 6c65 2866 703d 6669  ck_zipfile(fp=fi
+00002010: 6c65 6e61 6d65 290d 0a20 2020 2020 2020  lename)..       
+00002020: 2065 6c73 653a 0d0a 2020 2020 2020 2020   else:..        
+00002030: 2020 2020 7769 7468 206f 7065 6e28 6669      with open(fi
+00002040: 6c65 6e61 6d65 2c20 2272 6222 2920 6173  lename, "rb") as
+00002050: 2066 703a 0d0a 2020 2020 2020 2020 2020   fp:..          
+00002060: 2020 2020 2020 7265 7375 6c74 203d 205f        result = _
+00002070: 6368 6563 6b5f 7a69 7066 696c 6528 6670  check_zipfile(fp
+00002080: 290d 0a20 2020 2065 7863 6570 7420 4f53  )..    except OS
+00002090: 4572 726f 723a 0d0a 2020 2020 2020 2020  Error:..        
+000020a0: 7061 7373 0d0a 2020 2020 7265 7475 726e  pass..    return
+000020b0: 2072 6573 756c 740d 0a0d 0a0d 0a64 6566   result......def
+000020c0: 205f 456e 6452 6563 4461 7461 3634 2866   _EndRecData64(f
+000020d0: 7069 6e2c 206f 6666 7365 742c 2065 6e64  pin, offset, end
+000020e0: 7265 6329 3a0d 0a20 2020 2022 2222 5265  rec):..    """Re
+000020f0: 6164 2074 6865 205a 4950 3634 2065 6e64  ad the ZIP64 end
+00002100: 2d6f 662d 6172 6368 6976 6520 7265 636f  -of-archive reco
+00002110: 7264 7320 616e 6420 7573 6520 7468 6174  rds and use that
+00002120: 2074 6f20 7570 6461 7465 2065 6e64 7265   to update endre
+00002130: 632e 2222 220d 0a20 2020 2074 7279 3a0d  c."""..    try:.
+00002140: 0a20 2020 2020 2020 2066 7069 6e2e 7365  .        fpin.se
+00002150: 656b 286f 6666 7365 7420 2d20 7369 7a65  ek(offset - size
+00002160: 456e 6443 656e 7444 6972 3634 4c6f 6361  EndCentDir64Loca
+00002170: 746f 722c 2032 290d 0a20 2020 2065 7863  tor, 2)..    exc
+00002180: 6570 7420 4f53 4572 726f 723a 0d0a 2020  ept OSError:..  
+00002190: 2020 2020 2020 2320 4966 2074 6865 2073        # If the s
+000021a0: 6565 6b20 6661 696c 732c 2074 6865 2066  eek fails, the f
+000021b0: 696c 6520 6973 206e 6f74 206c 6172 6765  ile is not large
+000021c0: 2065 6e6f 7567 6820 746f 2063 6f6e 7461   enough to conta
+000021d0: 696e 2061 205a 4950 3634 0d0a 2020 2020  in a ZIP64..    
+000021e0: 2020 2020 2320 656e 642d 6f66 2d61 7263      # end-of-arc
+000021f0: 6869 7665 2072 6563 6f72 642c 2073 6f20  hive record, so 
+00002200: 6a75 7374 2072 6574 7572 6e20 7468 6520  just return the 
+00002210: 656e 6420 7265 636f 7264 2077 6520 7765  end record we we
+00002220: 7265 2067 6976 656e 2e0d 0a20 2020 2020  re given...     
+00002230: 2020 2072 6574 7572 6e20 656e 6472 6563     return endrec
+00002240: 0d0a 0d0a 2020 2020 6461 7461 203d 2066  ....    data = f
+00002250: 7069 6e2e 7265 6164 2873 697a 6545 6e64  pin.read(sizeEnd
+00002260: 4365 6e74 4469 7236 344c 6f63 6174 6f72  CentDir64Locator
+00002270: 290d 0a20 2020 2069 6620 6c65 6e28 6461  )..    if len(da
+00002280: 7461 2920 213d 2073 697a 6545 6e64 4365  ta) != sizeEndCe
+00002290: 6e74 4469 7236 344c 6f63 6174 6f72 3a0d  ntDir64Locator:.
+000022a0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+000022b0: 656e 6472 6563 0d0a 2020 2020 7369 672c  endrec..    sig,
+000022c0: 2064 6973 6b6e 6f2c 2072 656c 6f66 662c   diskno, reloff,
+000022d0: 2064 6973 6b73 203d 2073 7472 7563 742e   disks = struct.
+000022e0: 756e 7061 636b 2873 7472 7563 7445 6e64  unpack(structEnd
+000022f0: 4172 6368 6976 6536 344c 6f63 6174 6f72  Archive64Locator
+00002300: 2c20 6461 7461 290d 0a20 2020 2069 6620  , data)..    if 
+00002310: 7369 6720 213d 2073 7472 696e 6745 6e64  sig != stringEnd
+00002320: 4172 6368 6976 6536 344c 6f63 6174 6f72  Archive64Locator
+00002330: 3a0d 0a20 2020 2020 2020 2072 6574 7572  :..        retur
+00002340: 6e20 656e 6472 6563 0d0a 0d0a 2020 2020  n endrec....    
+00002350: 6966 2064 6973 6b6e 6f20 213d 2030 206f  if diskno != 0 o
+00002360: 7220 6469 736b 7320 3e20 313a 0d0a 2020  r disks > 1:..  
+00002370: 2020 2020 2020 7261 6973 6520 4261 645a        raise BadZ
+00002380: 6970 4669 6c65 2822 7a69 7066 696c 6573  ipFile("zipfiles
+00002390: 2074 6861 7420 7370 616e 206d 756c 7469   that span multi
+000023a0: 706c 6520 6469 736b 7320 6172 6520 6e6f  ple disks are no
+000023b0: 7420 7375 7070 6f72 7465 6422 290d 0a0d  t supported")...
+000023c0: 0a20 2020 2023 2041 7373 756d 6520 6e6f  .    # Assume no
+000023d0: 2027 7a69 7036 3420 6578 7465 6e73 6962   'zip64 extensib
+000023e0: 6c65 2064 6174 6127 0d0a 2020 2020 6670  le data'..    fp
+000023f0: 696e 2e73 6565 6b28 6f66 6673 6574 202d  in.seek(offset -
+00002400: 2073 697a 6545 6e64 4365 6e74 4469 7236   sizeEndCentDir6
+00002410: 344c 6f63 6174 6f72 202d 2073 697a 6545  4Locator - sizeE
+00002420: 6e64 4365 6e74 4469 7236 342c 2032 290d  ndCentDir64, 2).
+00002430: 0a20 2020 2064 6174 6120 3d20 6670 696e  .    data = fpin
+00002440: 2e72 6561 6428 7369 7a65 456e 6443 656e  .read(sizeEndCen
+00002450: 7444 6972 3634 290d 0a20 2020 2069 6620  tDir64)..    if 
+00002460: 6c65 6e28 6461 7461 2920 213d 2073 697a  len(data) != siz
+00002470: 6545 6e64 4365 6e74 4469 7236 343a 0d0a  eEndCentDir64:..
+00002480: 2020 2020 2020 2020 7265 7475 726e 2065          return e
+00002490: 6e64 7265 630d 0a20 2020 2028 0d0a 2020  ndrec..    (..  
+000024a0: 2020 2020 2020 7369 672c 0d0a 2020 2020        sig,..    
+000024b0: 2020 2020 737a 2c0d 0a20 2020 2020 2020      sz,..       
+000024c0: 2063 7265 6174 655f 7665 7273 696f 6e2c   create_version,
+000024d0: 0d0a 2020 2020 2020 2020 7265 6164 5f76  ..        read_v
+000024e0: 6572 7369 6f6e 2c0d 0a20 2020 2020 2020  ersion,..       
+000024f0: 2064 6973 6b5f 6e75 6d2c 0d0a 2020 2020   disk_num,..    
+00002500: 2020 2020 6469 736b 5f64 6972 2c0d 0a20      disk_dir,.. 
+00002510: 2020 2020 2020 2064 6972 636f 756e 742c         dircount,
+00002520: 0d0a 2020 2020 2020 2020 6469 7263 6f75  ..        dircou
+00002530: 6e74 322c 0d0a 2020 2020 2020 2020 6469  nt2,..        di
+00002540: 7273 697a 652c 0d0a 2020 2020 2020 2020  rsize,..        
+00002550: 6469 726f 6666 7365 742c 0d0a 2020 2020  diroffset,..    
+00002560: 2920 3d20 7374 7275 6374 2e75 6e70 6163  ) = struct.unpac
+00002570: 6b28 7374 7275 6374 456e 6441 7263 6869  k(structEndArchi
+00002580: 7665 3634 2c20 6461 7461 290d 0a20 2020  ve64, data)..   
+00002590: 2069 6620 7369 6720 213d 2073 7472 696e   if sig != strin
+000025a0: 6745 6e64 4172 6368 6976 6536 343a 0d0a  gEndArchive64:..
+000025b0: 2020 2020 2020 2020 7265 7475 726e 2065          return e
+000025c0: 6e64 7265 630d 0a0d 0a20 2020 2023 2055  ndrec....    # U
+000025d0: 7064 6174 6520 7468 6520 6f72 6967 696e  pdate the origin
+000025e0: 616c 2065 6e64 7265 6320 7573 696e 6720  al endrec using 
+000025f0: 6461 7461 2066 726f 6d20 7468 6520 5a49  data from the ZI
+00002600: 5036 3420 7265 636f 7264 0d0a 2020 2020  P64 record..    
+00002610: 656e 6472 6563 5b5f 4543 445f 5349 474e  endrec[_ECD_SIGN
+00002620: 4154 5552 455d 203d 2073 6967 0d0a 2020  ATURE] = sig..  
+00002630: 2020 656e 6472 6563 5b5f 4543 445f 4449    endrec[_ECD_DI
+00002640: 534b 5f4e 554d 4245 525d 203d 2064 6973  SK_NUMBER] = dis
+00002650: 6b5f 6e75 6d0d 0a20 2020 2065 6e64 7265  k_num..    endre
+00002660: 635b 5f45 4344 5f44 4953 4b5f 5354 4152  c[_ECD_DISK_STAR
+00002670: 545d 203d 2064 6973 6b5f 6469 720d 0a20  T] = disk_dir.. 
+00002680: 2020 2065 6e64 7265 635b 5f45 4344 5f45     endrec[_ECD_E
+00002690: 4e54 5249 4553 5f54 4849 535f 4449 534b  NTRIES_THIS_DISK
+000026a0: 5d20 3d20 6469 7263 6f75 6e74 0d0a 2020  ] = dircount..  
+000026b0: 2020 656e 6472 6563 5b5f 4543 445f 454e    endrec[_ECD_EN
+000026c0: 5452 4945 535f 544f 5441 4c5d 203d 2064  TRIES_TOTAL] = d
+000026d0: 6972 636f 756e 7432 0d0a 2020 2020 656e  ircount2..    en
+000026e0: 6472 6563 5b5f 4543 445f 5349 5a45 5d20  drec[_ECD_SIZE] 
+000026f0: 3d20 6469 7273 697a 650d 0a20 2020 2065  = dirsize..    e
+00002700: 6e64 7265 635b 5f45 4344 5f4f 4646 5345  ndrec[_ECD_OFFSE
+00002710: 545d 203d 2064 6972 6f66 6673 6574 0d0a  T] = diroffset..
+00002720: 2020 2020 7265 7475 726e 2065 6e64 7265      return endre
+00002730: 630d 0a0d 0a0d 0a64 6566 205f 456e 6452  c......def _EndR
+00002740: 6563 4461 7461 2866 7069 6e29 3a0d 0a20  ecData(fpin):.. 
+00002750: 2020 2022 2222 5265 7475 726e 2064 6174     """Return dat
+00002760: 6120 6672 6f6d 2074 6865 2022 456e 6420  a from the "End 
+00002770: 6f66 2043 656e 7472 616c 2044 6972 6563  of Central Direc
+00002780: 746f 7279 2220 7265 636f 7264 2c20 6f72  tory" record, or
+00002790: 204e 6f6e 652e 0d0a 0d0a 2020 2020 5468   None.....    Th
+000027a0: 6520 6461 7461 2069 7320 6120 6c69 7374  e data is a list
+000027b0: 206f 6620 7468 6520 6e69 6e65 2069 7465   of the nine ite
+000027c0: 6d73 2069 6e20 7468 6520 5a49 5020 2245  ms in the ZIP "E
+000027d0: 6e64 206f 6620 6365 6e74 7261 6c20 6469  nd of central di
+000027e0: 7222 0d0a 2020 2020 7265 636f 7264 2066  r"..    record f
+000027f0: 6f6c 6c6f 7765 6420 6279 2061 2074 656e  ollowed by a ten
+00002800: 7468 2069 7465 6d2c 2074 6865 2066 696c  th item, the fil
+00002810: 6520 7365 656b 206f 6666 7365 7420 6f66  e seek offset of
+00002820: 2074 6869 7320 7265 636f 7264 2e0d 0a20   this record... 
+00002830: 2020 2022 2222 0d0a 2020 2020 2320 4465     """..    # De
+00002840: 7465 726d 696e 6520 6669 6c65 2073 697a  termine file siz
+00002850: 650d 0a20 2020 2066 7069 6e2e 7365 656b  e..    fpin.seek
+00002860: 2830 2c20 3229 0d0a 2020 2020 6669 6c65  (0, 2)..    file
+00002870: 7369 7a65 203d 2066 7069 6e2e 7465 6c6c  size = fpin.tell
+00002880: 2829 0d0a 0d0a 2020 2020 2320 4368 6563  ()....    # Chec
+00002890: 6b20 746f 2073 6565 2069 6620 7468 6973  k to see if this
+000028a0: 2069 7320 5a49 5020 6669 6c65 2077 6974   is ZIP file wit
+000028b0: 6820 6e6f 2061 7263 6869 7665 2063 6f6d  h no archive com
+000028c0: 6d65 6e74 2028 7468 650d 0a20 2020 2023  ment (the..    #
+000028d0: 2022 656e 6420 6f66 2063 656e 7472 616c   "end of central
+000028e0: 2064 6972 6563 746f 7279 2220 7374 7275   directory" stru
+000028f0: 6374 7572 6520 7368 6f75 6c64 2062 6520  cture should be 
+00002900: 7468 6520 6c61 7374 2069 7465 6d20 696e  the last item in
+00002910: 2074 6865 0d0a 2020 2020 2320 6669 6c65   the..    # file
+00002920: 2069 6620 7468 6973 2069 7320 7468 6520   if this is the 
+00002930: 6361 7365 292e 0d0a 2020 2020 7472 793a  case)...    try:
+00002940: 0d0a 2020 2020 2020 2020 6670 696e 2e73  ..        fpin.s
+00002950: 6565 6b28 2d73 697a 6545 6e64 4365 6e74  eek(-sizeEndCent
+00002960: 4469 722c 2032 290d 0a20 2020 2065 7863  Dir, 2)..    exc
+00002970: 6570 7420 4f53 4572 726f 723a 0d0a 2020  ept OSError:..  
+00002980: 2020 2020 2020 7265 7475 726e 204e 6f6e        return Non
+00002990: 650d 0a20 2020 2064 6174 6120 3d20 6670  e..    data = fp
+000029a0: 696e 2e72 6561 6428 290d 0a20 2020 2069  in.read()..    i
+000029b0: 6620 280d 0a20 2020 2020 2020 206c 656e  f (..        len
+000029c0: 2864 6174 6129 203d 3d20 7369 7a65 456e  (data) == sizeEn
+000029d0: 6443 656e 7444 6972 0d0a 2020 2020 2020  dCentDir..      
+000029e0: 2020 616e 6420 6461 7461 5b30 3a34 5d20    and data[0:4] 
+000029f0: 3d3d 2073 7472 696e 6745 6e64 4172 6368  == stringEndArch
+00002a00: 6976 650d 0a20 2020 2020 2020 2061 6e64  ive..        and
+00002a10: 2064 6174 615b 2d32 3a5d 203d 3d20 6222   data[-2:] == b"
+00002a20: 5c30 3030 5c30 3030 220d 0a20 2020 2029  \000\000"..    )
+00002a30: 3a0d 0a20 2020 2020 2020 2023 2074 6865  :..        # the
+00002a40: 2073 6967 6e61 7475 7265 2069 7320 636f   signature is co
+00002a50: 7272 6563 7420 616e 6420 7468 6572 6527  rrect and there'
+00002a60: 7320 6e6f 2063 6f6d 6d65 6e74 2c20 756e  s no comment, un
+00002a70: 7061 636b 2073 7472 7563 7475 7265 0d0a  pack structure..
+00002a80: 2020 2020 2020 2020 656e 6472 6563 203d          endrec =
+00002a90: 2073 7472 7563 742e 756e 7061 636b 2873   struct.unpack(s
+00002aa0: 7472 7563 7445 6e64 4172 6368 6976 652c  tructEndArchive,
+00002ab0: 2064 6174 6129 0d0a 2020 2020 2020 2020   data)..        
+00002ac0: 656e 6472 6563 203d 206c 6973 7428 656e  endrec = list(en
+00002ad0: 6472 6563 290d 0a0d 0a20 2020 2020 2020  drec)....       
+00002ae0: 2023 2041 7070 656e 6420 6120 626c 616e   # Append a blan
+00002af0: 6b20 636f 6d6d 656e 7420 616e 6420 7265  k comment and re
+00002b00: 636f 7264 2073 7461 7274 206f 6666 7365  cord start offse
+00002b10: 740d 0a20 2020 2020 2020 2065 6e64 7265  t..        endre
+00002b20: 632e 6170 7065 6e64 2862 2222 290d 0a20  c.append(b"").. 
+00002b30: 2020 2020 2020 2065 6e64 7265 632e 6170         endrec.ap
+00002b40: 7065 6e64 2866 696c 6573 697a 6520 2d20  pend(filesize - 
+00002b50: 7369 7a65 456e 6443 656e 7444 6972 290d  sizeEndCentDir).
+00002b60: 0a0d 0a20 2020 2020 2020 2023 2054 7279  ...        # Try
+00002b70: 2074 6f20 7265 6164 2074 6865 2022 5a69   to read the "Zi
+00002b80: 7036 3420 656e 6420 6f66 2063 656e 7472  p64 end of centr
+00002b90: 616c 2064 6972 6563 746f 7279 2220 7374  al directory" st
+00002ba0: 7275 6374 7572 650d 0a20 2020 2020 2020  ructure..       
+00002bb0: 2072 6574 7572 6e20 5f45 6e64 5265 6344   return _EndRecD
+00002bc0: 6174 6136 3428 6670 696e 2c20 2d73 697a  ata64(fpin, -siz
+00002bd0: 6545 6e64 4365 6e74 4469 722c 2065 6e64  eEndCentDir, end
+00002be0: 7265 6329 0d0a 0d0a 2020 2020 2320 4569  rec)....    # Ei
+00002bf0: 7468 6572 2074 6869 7320 6973 206e 6f74  ther this is not
+00002c00: 2061 205a 4950 2066 696c 652c 206f 7220   a ZIP file, or 
+00002c10: 6974 2069 7320 6120 5a49 5020 6669 6c65  it is a ZIP file
+00002c20: 2077 6974 6820 616e 2061 7263 6869 7665   with an archive
+00002c30: 0d0a 2020 2020 2320 636f 6d6d 656e 742e  ..    # comment.
+00002c40: 2020 5365 6172 6368 2074 6865 2065 6e64    Search the end
+00002c50: 206f 6620 7468 6520 6669 6c65 2066 6f72   of the file for
+00002c60: 2074 6865 2022 656e 6420 6f66 2063 656e   the "end of cen
+00002c70: 7472 616c 2064 6972 6563 746f 7279 220d  tral directory".
+00002c80: 0a20 2020 2023 2072 6563 6f72 6420 7369  .    # record si
+00002c90: 676e 6174 7572 652e 2054 6865 2063 6f6d  gnature. The com
+00002ca0: 6d65 6e74 2069 7320 7468 6520 6c61 7374  ment is the last
+00002cb0: 2069 7465 6d20 696e 2074 6865 205a 4950   item in the ZIP
+00002cc0: 2066 696c 6520 616e 6420 6d61 7920 6265   file and may be
+00002cd0: 0d0a 2020 2020 2320 7570 2074 6f20 3634  ..    # up to 64
+00002ce0: 4b20 6c6f 6e67 2e20 2049 7420 6973 2061  K long.  It is a
+00002cf0: 7373 756d 6564 2074 6861 7420 7468 6520  ssumed that the 
+00002d00: 2265 6e64 206f 6620 6365 6e74 7261 6c20  "end of central 
+00002d10: 6469 7265 6374 6f72 7922 206d 6167 6963  directory" magic
+00002d20: 0d0a 2020 2020 2320 6e75 6d62 6572 2064  ..    # number d
+00002d30: 6f65 7320 6e6f 7420 6170 7065 6172 2069  oes not appear i
+00002d40: 6e20 7468 6520 636f 6d6d 656e 742e 0d0a  n the comment...
+00002d50: 2020 2020 6d61 7843 6f6d 6d65 6e74 5374      maxCommentSt
+00002d60: 6172 7420 3d20 6d61 7828 6669 6c65 7369  art = max(filesi
+00002d70: 7a65 202d 2028 3120 3c3c 2031 3629 202d  ze - (1 << 16) -
+00002d80: 2073 697a 6545 6e64 4365 6e74 4469 722c   sizeEndCentDir,
+00002d90: 2030 290d 0a20 2020 2066 7069 6e2e 7365   0)..    fpin.se
+00002da0: 656b 286d 6178 436f 6d6d 656e 7453 7461  ek(maxCommentSta
+00002db0: 7274 2c20 3029 0d0a 2020 2020 6461 7461  rt, 0)..    data
+00002dc0: 203d 2066 7069 6e2e 7265 6164 2829 0d0a   = fpin.read()..
+00002dd0: 2020 2020 7374 6172 7420 3d20 6461 7461      start = data
+00002de0: 2e72 6669 6e64 2873 7472 696e 6745 6e64  .rfind(stringEnd
+00002df0: 4172 6368 6976 6529 0d0a 2020 2020 6966  Archive)..    if
+00002e00: 2073 7461 7274 203e 3d20 303a 0d0a 2020   start >= 0:..  
+00002e10: 2020 2020 2020 2320 666f 756e 6420 7468        # found th
+00002e20: 6520 6d61 6769 6320 6e75 6d62 6572 3b20  e magic number; 
+00002e30: 6174 7465 6d70 7420 746f 2075 6e70 6163  attempt to unpac
+00002e40: 6b20 616e 6420 696e 7465 7270 7265 740d  k and interpret.
+00002e50: 0a20 2020 2020 2020 2072 6563 4461 7461  .        recData
+00002e60: 203d 2064 6174 615b 7374 6172 7420 3a20   = data[start : 
+00002e70: 7374 6172 7420 2b20 7369 7a65 456e 6443  start + sizeEndC
+00002e80: 656e 7444 6972 5d0d 0a20 2020 2020 2020  entDir]..       
+00002e90: 2069 6620 6c65 6e28 7265 6344 6174 6129   if len(recData)
+00002ea0: 2021 3d20 7369 7a65 456e 6443 656e 7444   != sizeEndCentD
+00002eb0: 6972 3a0d 0a20 2020 2020 2020 2020 2020  ir:..           
+00002ec0: 2023 205a 6970 2066 696c 6520 6973 2063   # Zip file is c
+00002ed0: 6f72 7275 7074 6564 2e0d 0a20 2020 2020  orrupted...     
+00002ee0: 2020 2020 2020 2072 6574 7572 6e20 4e6f         return No
+00002ef0: 6e65 0d0a 2020 2020 2020 2020 656e 6472  ne..        endr
+00002f00: 6563 203d 206c 6973 7428 7374 7275 6374  ec = list(struct
+00002f10: 2e75 6e70 6163 6b28 7374 7275 6374 456e  .unpack(structEn
+00002f20: 6441 7263 6869 7665 2c20 7265 6344 6174  dArchive, recDat
+00002f30: 6129 290d 0a20 2020 2020 2020 2063 6f6d  a))..        com
+00002f40: 6d65 6e74 5369 7a65 203d 2065 6e64 7265  mentSize = endre
+00002f50: 635b 5f45 4344 5f43 4f4d 4d45 4e54 5f53  c[_ECD_COMMENT_S
+00002f60: 495a 455d 2020 2320 6173 2063 6c61 696d  IZE]  # as claim
+00002f70: 6564 2062 7920 7468 6520 7a69 7020 6669  ed by the zip fi
+00002f80: 6c65 0d0a 2020 2020 2020 2020 636f 6d6d  le..        comm
+00002f90: 656e 7420 3d20 6461 7461 5b0d 0a20 2020  ent = data[..   
+00002fa0: 2020 2020 2020 2020 2073 7461 7274 202b           start +
+00002fb0: 2073 697a 6545 6e64 4365 6e74 4469 7220   sizeEndCentDir 
+00002fc0: 3a20 7374 6172 7420 2b20 7369 7a65 456e  : start + sizeEn
+00002fd0: 6443 656e 7444 6972 202b 2063 6f6d 6d65  dCentDir + comme
+00002fe0: 6e74 5369 7a65 0d0a 2020 2020 2020 2020  ntSize..        
+00002ff0: 5d0d 0a20 2020 2020 2020 2065 6e64 7265  ]..        endre
+00003000: 632e 6170 7065 6e64 2863 6f6d 6d65 6e74  c.append(comment
+00003010: 290d 0a20 2020 2020 2020 2065 6e64 7265  )..        endre
+00003020: 632e 6170 7065 6e64 286d 6178 436f 6d6d  c.append(maxComm
+00003030: 656e 7453 7461 7274 202b 2073 7461 7274  entStart + start
+00003040: 290d 0a0d 0a20 2020 2020 2020 2023 2054  )....        # T
+00003050: 7279 2074 6f20 7265 6164 2074 6865 2022  ry to read the "
+00003060: 5a69 7036 3420 656e 6420 6f66 2063 656e  Zip64 end of cen
+00003070: 7472 616c 2064 6972 6563 746f 7279 2220  tral directory" 
+00003080: 7374 7275 6374 7572 650d 0a20 2020 2020  structure..     
+00003090: 2020 2072 6574 7572 6e20 5f45 6e64 5265     return _EndRe
+000030a0: 6344 6174 6136 3428 6670 696e 2c20 6d61  cData64(fpin, ma
+000030b0: 7843 6f6d 6d65 6e74 5374 6172 7420 2b20  xCommentStart + 
+000030c0: 7374 6172 7420 2d20 6669 6c65 7369 7a65  start - filesize
+000030d0: 2c20 656e 6472 6563 290d 0a0d 0a20 2020  , endrec)....   
+000030e0: 2023 2055 6e61 626c 6520 746f 2066 696e   # Unable to fin
+000030f0: 6420 6120 7661 6c69 6420 656e 6420 6f66  d a valid end of
+00003100: 2063 656e 7472 616c 2064 6972 6563 746f   central directo
+00003110: 7279 2073 7472 7563 7475 7265 0d0a 2020  ry structure..  
+00003120: 2020 7265 7475 726e 204e 6f6e 650d 0a0d    return None...
+00003130: 0a0d 0a63 6c61 7373 205a 6970 496e 666f  ...class ZipInfo
+00003140: 3a0d 0a20 2020 2022 2222 436c 6173 7320  :..    """Class 
+00003150: 7769 7468 2061 7474 7269 6275 7465 7320  with attributes 
+00003160: 6465 7363 7269 6269 6e67 2065 6163 6820  describing each 
+00003170: 6669 6c65 2069 6e20 7468 6520 5a49 5020  file in the ZIP 
+00003180: 6172 6368 6976 652e 2222 220d 0a0d 0a20  archive.""".... 
+00003190: 2020 205f 5f73 6c6f 7473 5f5f 203d 2028     __slots__ = (
+000031a0: 0d0a 2020 2020 2020 2020 226f 7269 675f  ..        "orig_
+000031b0: 6669 6c65 6e61 6d65 222c 0d0a 2020 2020  filename",..    
+000031c0: 2020 2020 2266 696c 656e 616d 6522 2c0d      "filename",.
+000031d0: 0a20 2020 2020 2020 2022 6461 7465 5f74  .        "date_t
+000031e0: 696d 6522 2c0d 0a20 2020 2020 2020 2022  ime",..        "
+000031f0: 636f 6d70 7265 7373 5f74 7970 6522 2c0d  compress_type",.
+00003200: 0a20 2020 2020 2020 2022 5f63 6f6d 7072  .        "_compr
+00003210: 6573 736c 6576 656c 222c 0d0a 2020 2020  esslevel",..    
+00003220: 2020 2020 2263 6f6d 6d65 6e74 222c 0d0a      "comment",..
+00003230: 2020 2020 2020 2020 2265 7874 7261 222c          "extra",
+00003240: 0d0a 2020 2020 2020 2020 2263 7265 6174  ..        "creat
+00003250: 655f 7379 7374 656d 222c 0d0a 2020 2020  e_system",..    
+00003260: 2020 2020 2263 7265 6174 655f 7665 7273      "create_vers
+00003270: 696f 6e22 2c0d 0a20 2020 2020 2020 2022  ion",..        "
+00003280: 6578 7472 6163 745f 7665 7273 696f 6e22  extract_version"
+00003290: 2c0d 0a20 2020 2020 2020 2022 7265 7365  ,..        "rese
+000032a0: 7276 6564 222c 0d0a 2020 2020 2020 2020  rved",..        
+000032b0: 2266 6c61 675f 6269 7473 222c 0d0a 2020  "flag_bits",..  
+000032c0: 2020 2020 2020 2276 6f6c 756d 6522 2c0d        "volume",.
+000032d0: 0a20 2020 2020 2020 2022 696e 7465 726e  .        "intern
+000032e0: 616c 5f61 7474 7222 2c0d 0a20 2020 2020  al_attr",..     
+000032f0: 2020 2022 6578 7465 726e 616c 5f61 7474     "external_att
+00003300: 7222 2c0d 0a20 2020 2020 2020 2022 6865  r",..        "he
+00003310: 6164 6572 5f6f 6666 7365 7422 2c0d 0a20  ader_offset",.. 
+00003320: 2020 2020 2020 2022 4352 4322 2c0d 0a20         "CRC",.. 
+00003330: 2020 2020 2020 2022 636f 6d70 7265 7373         "compress
+00003340: 5f73 697a 6522 2c0d 0a20 2020 2020 2020  _size",..       
+00003350: 2022 6669 6c65 5f73 697a 6522 2c0d 0a20   "file_size",.. 
+00003360: 2020 2020 2020 2022 5f72 6177 5f74 696d         "_raw_tim
+00003370: 6522 2c0d 0a20 2020 2029 0d0a 0d0a 2020  e",..    )....  
+00003380: 2020 6465 6620 5f5f 696e 6974 5f5f 280d    def __init__(.
+00003390: 0a20 2020 2020 2020 2073 656c 662c 0d0a  .        self,..
+000033a0: 2020 2020 2020 2020 6669 6c65 6e61 6d65          filename
+000033b0: 3d22 4e6f 4e61 6d65 222c 0d0a 2020 2020  ="NoName",..    
+000033c0: 2020 2020 6461 7465 5f74 696d 653d 2831      date_time=(1
+000033d0: 3938 302c 2031 2c20 312c 2030 2c20 302c  980, 1, 1, 0, 0,
+000033e0: 2030 292c 0d0a 2020 2020 2920 2d3e 204e   0),..    ) -> N
+000033f0: 6f6e 653a 0d0a 2020 2020 2020 2020 7365  one:..        se
+00003400: 6c66 2e6f 7269 675f 6669 6c65 6e61 6d65  lf.orig_filename
+00003410: 203d 2066 696c 656e 616d 6520 2023 204f   = filename  # O
+00003420: 7269 6769 6e61 6c20 6669 6c65 206e 616d  riginal file nam
+00003430: 6520 696e 2061 7263 6869 7665 0d0a 0d0a  e in archive....
+00003440: 2020 2020 2020 2020 2320 5465 726d 696e          # Termin
+00003450: 6174 6520 7468 6520 6669 6c65 206e 616d  ate the file nam
+00003460: 6520 6174 2074 6865 2066 6972 7374 206e  e at the first n
+00003470: 756c 6c20 6279 7465 2e20 204e 756c 6c20  ull byte.  Null 
+00003480: 6279 7465 7320 696e 2066 696c 650d 0a20  bytes in file.. 
+00003490: 2020 2020 2020 2023 206e 616d 6573 2061         # names a
+000034a0: 7265 2075 7365 6420 6173 2074 7269 636b  re used as trick
+000034b0: 7320 6279 2076 6972 7573 6573 2069 6e20  s by viruses in 
+000034c0: 6172 6368 6976 6573 2e0d 0a20 2020 2020  archives...     
+000034d0: 2020 206e 756c 6c5f 6279 7465 203d 2066     null_byte = f
+000034e0: 696c 656e 616d 652e 6669 6e64 2863 6872  ilename.find(chr
+000034f0: 2830 2929 0d0a 2020 2020 2020 2020 6966  (0))..        if
+00003500: 206e 756c 6c5f 6279 7465 203e 3d20 303a   null_byte >= 0:
+00003510: 0d0a 2020 2020 2020 2020 2020 2020 6669  ..            fi
+00003520: 6c65 6e61 6d65 203d 2066 696c 656e 616d  lename = filenam
+00003530: 655b 303a 6e75 6c6c 5f62 7974 655d 0d0a  e[0:null_byte]..
+00003540: 2020 2020 2020 2020 2320 5468 6973 2069          # This i
+00003550: 7320 7573 6564 2074 6f20 656e 7375 7265  s used to ensure
+00003560: 2070 6174 6873 2069 6e20 6765 6e65 7261   paths in genera
+00003570: 7465 6420 5a49 5020 6669 6c65 7320 616c  ted ZIP files al
+00003580: 7761 7973 2075 7365 0d0a 2020 2020 2020  ways use..      
+00003590: 2020 2320 666f 7277 6172 6420 736c 6173    # forward slas
+000035a0: 6865 7320 6173 2074 6865 2064 6972 6563  hes as the direc
+000035b0: 746f 7279 2073 6570 6172 6174 6f72 2c20  tory separator, 
+000035c0: 6173 2072 6571 7569 7265 6420 6279 2074  as required by t
+000035d0: 6865 0d0a 2020 2020 2020 2020 2320 5a49  he..        # ZI
+000035e0: 5020 666f 726d 6174 2073 7065 6369 6669  P format specifi
+000035f0: 6361 7469 6f6e 2e0d 0a20 2020 2020 2020  cation...       
+00003600: 2069 6620 6f73 2e73 6570 2021 3d20 222f   if os.sep != "/
+00003610: 2220 616e 6420 6f73 2e73 6570 2069 6e20  " and os.sep in 
+00003620: 6669 6c65 6e61 6d65 3a0d 0a20 2020 2020  filename:..     
+00003630: 2020 2020 2020 2066 696c 656e 616d 6520         filename 
+00003640: 3d20 6669 6c65 6e61 6d65 2e72 6570 6c61  = filename.repla
+00003650: 6365 286f 732e 7365 702c 2022 2f22 290d  ce(os.sep, "/").
+00003660: 0a0d 0a20 2020 2020 2020 2073 656c 662e  ...        self.
+00003670: 6669 6c65 6e61 6d65 203d 2066 696c 656e  filename = filen
+00003680: 616d 6520 2023 204e 6f72 6d61 6c69 7a65  ame  # Normalize
+00003690: 6420 6669 6c65 206e 616d 650d 0a20 2020  d file name..   
+000036a0: 2020 2020 2073 656c 662e 6461 7465 5f74       self.date_t
+000036b0: 696d 6520 3d20 6461 7465 5f74 696d 6520  ime = date_time 
+000036c0: 2023 2079 6561 722c 206d 6f6e 7468 2c20   # year, month, 
+000036d0: 6461 792c 2068 6f75 722c 206d 696e 2c20  day, hour, min, 
+000036e0: 7365 630d 0a0d 0a20 2020 2020 2020 2069  sec....        i
+000036f0: 6620 6461 7465 5f74 696d 655b 305d 203c  f date_time[0] <
+00003700: 2031 3938 303a 0d0a 2020 2020 2020 2020   1980:..        
+00003710: 2020 2020 7261 6973 6520 5661 6c75 6545      raise ValueE
+00003720: 7272 6f72 2822 5a49 5020 646f 6573 206e  rror("ZIP does n
+00003730: 6f74 2073 7570 706f 7274 2074 696d 6573  ot support times
+00003740: 7461 6d70 7320 6265 666f 7265 2031 3938  tamps before 198
+00003750: 3022 290d 0a0d 0a20 2020 2020 2020 2023  0")....        #
+00003760: 2053 7461 6e64 6172 6420 7661 6c75 6573   Standard values
+00003770: 3a0d 0a20 2020 2020 2020 2073 656c 662e  :..        self.
+00003780: 636f 6d70 7265 7373 5f74 7970 6520 3d20  compress_type = 
+00003790: 5a49 505f 5354 4f52 4544 2020 2320 5479  ZIP_STORED  # Ty
+000037a0: 7065 206f 6620 636f 6d70 7265 7373 696f  pe of compressio
+000037b0: 6e20 666f 7220 7468 6520 6669 6c65 0d0a  n for the file..
+000037c0: 2020 2020 2020 2020 7365 6c66 2e5f 636f          self._co
+000037d0: 6d70 7265 7373 6c65 7665 6c20 3d20 4e6f  mpresslevel = No
+000037e0: 6e65 2020 2320 4c65 7665 6c20 666f 7220  ne  # Level for 
+000037f0: 7468 6520 636f 6d70 7265 7373 6f72 0d0a  the compressor..
+00003800: 2020 2020 2020 2020 7365 6c66 2e63 6f6d          self.com
+00003810: 6d65 6e74 203d 2062 2222 2020 2320 436f  ment = b""  # Co
+00003820: 6d6d 656e 7420 666f 7220 6561 6368 2066  mment for each f
+00003830: 696c 650d 0a20 2020 2020 2020 2073 656c  ile..        sel
+00003840: 662e 6578 7472 6120 3d20 6222 2220 2023  f.extra = b""  #
+00003850: 205a 4950 2065 7874 7261 2064 6174 610d   ZIP extra data.
+00003860: 0a20 2020 2020 2020 2069 6620 7379 732e  .        if sys.
+00003870: 706c 6174 666f 726d 203d 3d20 2277 696e  platform == "win
+00003880: 3332 223a 0d0a 2020 2020 2020 2020 2020  32":..          
+00003890: 2020 7365 6c66 2e63 7265 6174 655f 7379    self.create_sy
+000038a0: 7374 656d 203d 2030 2020 2320 5379 7374  stem = 0  # Syst
+000038b0: 656d 2077 6869 6368 2063 7265 6174 6564  em which created
+000038c0: 205a 4950 2061 7263 6869 7665 0d0a 2020   ZIP archive..  
+000038d0: 2020 2020 2020 656c 7365 3a0d 0a20 2020        else:..   
+000038e0: 2020 2020 2020 2020 2023 2041 7373 756d           # Assum
+000038f0: 6520 6576 6572 7974 6869 6e67 2065 6c73  e everything els
+00003900: 6520 6973 2075 6e69 782d 790d 0a20 2020  e is unix-y..   
+00003910: 2020 2020 2020 2020 2073 656c 662e 6372           self.cr
+00003920: 6561 7465 5f73 7973 7465 6d20 3d20 3320  eate_system = 3 
+00003930: 2023 2053 7973 7465 6d20 7768 6963 6820   # System which 
+00003940: 6372 6561 7465 6420 5a49 5020 6172 6368  created ZIP arch
+00003950: 6976 650d 0a20 2020 2020 2020 2073 656c  ive..        sel
+00003960: 662e 6372 6561 7465 5f76 6572 7369 6f6e  f.create_version
+00003970: 203d 2028 0d0a 2020 2020 2020 2020 2020   = (..          
+00003980: 2020 4445 4641 554c 545f 5645 5253 494f    DEFAULT_VERSIO
+00003990: 4e20 2023 2056 6572 7369 6f6e 2077 6869  N  # Version whi
+000039a0: 6368 2063 7265 6174 6564 205a 4950 2061  ch created ZIP a
+000039b0: 7263 6869 7665 0d0a 2020 2020 2020 2020  rchive..        
+000039c0: 290d 0a20 2020 2020 2020 2073 656c 662e  )..        self.
+000039d0: 6578 7472 6163 745f 7665 7273 696f 6e20  extract_version 
+000039e0: 3d20 280d 0a20 2020 2020 2020 2020 2020  = (..           
+000039f0: 2044 4546 4155 4c54 5f56 4552 5349 4f4e   DEFAULT_VERSION
+00003a00: 2020 2320 5665 7273 696f 6e20 6e65 6564    # Version need
+00003a10: 6564 2074 6f20 6578 7472 6163 7420 6172  ed to extract ar
+00003a20: 6368 6976 650d 0a20 2020 2020 2020 2029  chive..        )
+00003a30: 0d0a 2020 2020 2020 2020 7365 6c66 2e72  ..        self.r
+00003a40: 6573 6572 7665 6420 3d20 3020 2023 204d  eserved = 0  # M
+00003a50: 7573 7420 6265 207a 6572 6f0d 0a20 2020  ust be zero..   
+00003a60: 2020 2020 2073 656c 662e 666c 6167 5f62       self.flag_b
+00003a70: 6974 7320 3d20 3020 2023 205a 4950 2066  its = 0  # ZIP f
+00003a80: 6c61 6720 6269 7473 0d0a 2020 2020 2020  lag bits..      
+00003a90: 2020 7365 6c66 2e76 6f6c 756d 6520 3d20    self.volume = 
+00003aa0: 3020 2023 2056 6f6c 756d 6520 6e75 6d62  0  # Volume numb
+00003ab0: 6572 206f 6620 6669 6c65 2068 6561 6465  er of file heade
+00003ac0: 720d 0a20 2020 2020 2020 2073 656c 662e  r..        self.
+00003ad0: 696e 7465 726e 616c 5f61 7474 7220 3d20  internal_attr = 
+00003ae0: 3020 2023 2049 6e74 6572 6e61 6c20 6174  0  # Internal at
+00003af0: 7472 6962 7574 6573 0d0a 2020 2020 2020  tributes..      
+00003b00: 2020 7365 6c66 2e65 7874 6572 6e61 6c5f    self.external_
+00003b10: 6174 7472 203d 2030 2020 2320 4578 7465  attr = 0  # Exte
+00003b20: 726e 616c 2066 696c 6520 6174 7472 6962  rnal file attrib
+00003b30: 7574 6573 0d0a 2020 2020 2020 2020 7365  utes..        se
+00003b40: 6c66 2e63 6f6d 7072 6573 735f 7369 7a65  lf.compress_size
+00003b50: 203d 2030 2020 2320 5369 7a65 206f 6620   = 0  # Size of 
+00003b60: 7468 6520 636f 6d70 7265 7373 6564 2066  the compressed f
+00003b70: 696c 650d 0a20 2020 2020 2020 2073 656c  ile..        sel
+00003b80: 662e 6669 6c65 5f73 697a 6520 3d20 3020  f.file_size = 0 
+00003b90: 2023 2053 697a 6520 6f66 2074 6865 2075   # Size of the u
+00003ba0: 6e63 6f6d 7072 6573 7365 6420 6669 6c65  ncompressed file
+00003bb0: 0d0a 2020 2020 2020 2020 2320 4f74 6865  ..        # Othe
+00003bc0: 7220 6174 7472 6962 7574 6573 2061 7265  r attributes are
+00003bd0: 2073 6574 2062 7920 636c 6173 7320 5a69   set by class Zi
+00003be0: 7046 696c 653a 0d0a 2020 2020 2020 2020  pFile:..        
+00003bf0: 2320 6865 6164 6572 5f6f 6666 7365 7420  # header_offset 
+00003c00: 2020 2020 2020 2020 4279 7465 206f 6666          Byte off
+00003c10: 7365 7420 746f 2074 6865 2066 696c 6520  set to the file 
+00003c20: 6865 6164 6572 0d0a 2020 2020 2020 2020  header..        
+00003c30: 2320 4352 4320 2020 2020 2020 2020 2020  # CRC           
+00003c40: 2020 2020 2020 2020 4352 432d 3332 206f          CRC-32 o
+00003c50: 6620 7468 6520 756e 636f 6d70 7265 7373  f the uncompress
+00003c60: 6564 2066 696c 650d 0a0d 0a20 2020 2064  ed file....    d
+00003c70: 6566 205f 5f72 6570 725f 5f28 7365 6c66  ef __repr__(self
+00003c80: 2920 2d3e 2073 7472 3a0d 0a20 2020 2020  ) -> str:..     
+00003c90: 2020 2072 6573 756c 7420 3d20 5b66 223c     result = [f"<
+00003ca0: 7b73 656c 662e 5f5f 636c 6173 735f 5f2e  {self.__class__.
+00003cb0: 5f5f 6e61 6d65 5f5f 7d20 6669 6c65 6e61  __name__} filena
+00003cc0: 6d65 3d7b 7365 6c66 2e66 696c 656e 616d  me={self.filenam
+00003cd0: 6521 727d 225d 0d0a 2020 2020 2020 2020  e!r}"]..        
+00003ce0: 6966 2073 656c 662e 636f 6d70 7265 7373  if self.compress
+00003cf0: 5f74 7970 6520 213d 205a 4950 5f53 544f  _type != ZIP_STO
+00003d00: 5245 443a 0d0a 2020 2020 2020 2020 2020  RED:..          
+00003d10: 2020 7265 7375 6c74 2e61 7070 656e 6428    result.append(
+00003d20: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00003d30: 2020 2220 636f 6d70 7265 7373 5f74 7970    " compress_typ
+00003d40: 653d 2573 220d 0a20 2020 2020 2020 2020  e=%s"..         
+00003d50: 2020 2020 2020 2025 2063 6f6d 7072 6573         % compres
+00003d60: 736f 725f 6e61 6d65 732e 6765 7428 7365  sor_names.get(se
+00003d70: 6c66 2e63 6f6d 7072 6573 735f 7479 7065  lf.compress_type
+00003d80: 2c20 7365 6c66 2e63 6f6d 7072 6573 735f  , self.compress_
+00003d90: 7479 7065 292c 0d0a 2020 2020 2020 2020  type),..        
+00003da0: 2020 2020 290d 0a20 2020 2020 2020 2068      )..        h
+00003db0: 6920 3d20 7365 6c66 2e65 7874 6572 6e61  i = self.externa
+00003dc0: 6c5f 6174 7472 203e 3e20 3136 0d0a 2020  l_attr >> 16..  
+00003dd0: 2020 2020 2020 6c6f 203d 2073 656c 662e        lo = self.
+00003de0: 6578 7465 726e 616c 5f61 7474 7220 2620  external_attr & 
+00003df0: 3078 4646 4646 0d0a 2020 2020 2020 2020  0xFFFF..        
+00003e00: 6966 2068 693a 0d0a 2020 2020 2020 2020  if hi:..        
+00003e10: 2020 2020 7265 7375 6c74 2e61 7070 656e      result.appen
+00003e20: 6428 2220 6669 6c65 6d6f 6465 3d25 7222  d(" filemode=%r"
+00003e30: 2025 2073 7461 742e 6669 6c65 6d6f 6465   % stat.filemode
+00003e40: 2868 6929 290d 0a20 2020 2020 2020 2069  (hi))..        i
+00003e50: 6620 6c6f 3a0d 0a20 2020 2020 2020 2020  f lo:..         
+00003e60: 2020 2072 6573 756c 742e 6170 7065 6e64     result.append
+00003e70: 2822 2065 7874 6572 6e61 6c5f 6174 7472  (" external_attr
+00003e80: 3d25 2378 2220 2520 6c6f 290d 0a20 2020  =%#x" % lo)..   
+00003e90: 2020 2020 2069 7364 6972 203d 2073 656c       isdir = sel
+00003ea0: 662e 6973 5f64 6972 2829 0d0a 2020 2020  f.is_dir()..    
+00003eb0: 2020 2020 6966 206e 6f74 2069 7364 6972      if not isdir
+00003ec0: 206f 7220 7365 6c66 2e66 696c 655f 7369   or self.file_si
+00003ed0: 7a65 3a0d 0a20 2020 2020 2020 2020 2020  ze:..           
+00003ee0: 2072 6573 756c 742e 6170 7065 6e64 2822   result.append("
+00003ef0: 2066 696c 655f 7369 7a65 3d25 7222 2025   file_size=%r" %
+00003f00: 2073 656c 662e 6669 6c65 5f73 697a 6529   self.file_size)
+00003f10: 0d0a 2020 2020 2020 2020 6966 2028 6e6f  ..        if (no
+00003f20: 7420 6973 6469 7220 6f72 2073 656c 662e  t isdir or self.
+00003f30: 636f 6d70 7265 7373 5f73 697a 6529 2061  compress_size) a
+00003f40: 6e64 2028 0d0a 2020 2020 2020 2020 2020  nd (..          
+00003f50: 2020 7365 6c66 2e63 6f6d 7072 6573 735f    self.compress_
+00003f60: 7479 7065 2021 3d20 5a49 505f 5354 4f52  type != ZIP_STOR
+00003f70: 4544 0d0a 2020 2020 2020 2020 2020 2020  ED..            
+00003f80: 6f72 2073 656c 662e 6669 6c65 5f73 697a  or self.file_siz
+00003f90: 6520 213d 2073 656c 662e 636f 6d70 7265  e != self.compre
+00003fa0: 7373 5f73 697a 650d 0a20 2020 2020 2020  ss_size..       
+00003fb0: 2029 3a0d 0a20 2020 2020 2020 2020 2020   ):..           
+00003fc0: 2072 6573 756c 742e 6170 7065 6e64 2822   result.append("
+00003fd0: 2063 6f6d 7072 6573 735f 7369 7a65 3d25   compress_size=%
+00003fe0: 7222 2025 2073 656c 662e 636f 6d70 7265  r" % self.compre
+00003ff0: 7373 5f73 697a 6529 0d0a 2020 2020 2020  ss_size)..      
+00004000: 2020 7265 7375 6c74 2e61 7070 656e 6428    result.append(
+00004010: 223e 2229 0d0a 2020 2020 2020 2020 7265  ">")..        re
+00004020: 7475 726e 2022 222e 6a6f 696e 2872 6573  turn "".join(res
+00004030: 756c 7429 0d0a 0d0a 2020 2020 6465 6620  ult)....    def 
+00004040: 4669 6c65 4865 6164 6572 2873 656c 662c  FileHeader(self,
+00004050: 207a 6970 3634 3d4e 6f6e 6529 3a0d 0a20   zip64=None):.. 
+00004060: 2020 2020 2020 2022 2222 5265 7475 726e         """Return
+00004070: 2074 6865 2070 6572 2d66 696c 6520 6865   the per-file he
+00004080: 6164 6572 2061 7320 6120 6279 7465 7320  ader as a bytes 
+00004090: 6f62 6a65 6374 2e22 2222 0d0a 2020 2020  object."""..    
+000040a0: 2020 2020 6474 203d 2073 656c 662e 6461      dt = self.da
+000040b0: 7465 5f74 696d 650d 0a20 2020 2020 2020  te_time..       
+000040c0: 2064 6f73 6461 7465 203d 2028 6474 5b30   dosdate = (dt[0
+000040d0: 5d20 2d20 3139 3830 2920 3c3c 2039 207c  ] - 1980) << 9 |
+000040e0: 2064 745b 315d 203c 3c20 3520 7c20 6474   dt[1] << 5 | dt
+000040f0: 5b32 5d0d 0a20 2020 2020 2020 2064 6f73  [2]..        dos
+00004100: 7469 6d65 203d 2064 745b 335d 203c 3c20  time = dt[3] << 
+00004110: 3131 207c 2064 745b 345d 203c 3c20 3520  11 | dt[4] << 5 
+00004120: 7c20 2864 745b 355d 202f 2f20 3229 0d0a  | (dt[5] // 2)..
+00004130: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
+00004140: 666c 6167 5f62 6974 7320 2620 3078 3038  flag_bits & 0x08
+00004150: 3a0d 0a20 2020 2020 2020 2020 2020 2023  :..            #
+00004160: 2053 6574 2074 6865 7365 2074 6f20 7a65   Set these to ze
+00004170: 726f 2062 6563 6175 7365 2077 6520 7772  ro because we wr
+00004180: 6974 6520 7468 656d 2061 6674 6572 2074  ite them after t
+00004190: 6865 2066 696c 6520 6461 7461 0d0a 2020  he file data..  
+000041a0: 2020 2020 2020 2020 2020 4352 4320 3d20            CRC = 
+000041b0: 636f 6d70 7265 7373 5f73 697a 6520 3d20  compress_size = 
+000041c0: 6669 6c65 5f73 697a 6520 3d20 300d 0a20  file_size = 0.. 
+000041d0: 2020 2020 2020 2065 6c73 653a 0d0a 2020         else:..  
+000041e0: 2020 2020 2020 2020 2020 4352 4320 3d20            CRC = 
+000041f0: 7365 6c66 2e43 5243 0d0a 2020 2020 2020  self.CRC..      
+00004200: 2020 2020 2020 636f 6d70 7265 7373 5f73        compress_s
+00004210: 697a 6520 3d20 7365 6c66 2e63 6f6d 7072  ize = self.compr
+00004220: 6573 735f 7369 7a65 0d0a 2020 2020 2020  ess_size..      
+00004230: 2020 2020 2020 6669 6c65 5f73 697a 6520        file_size 
+00004240: 3d20 7365 6c66 2e66 696c 655f 7369 7a65  = self.file_size
+00004250: 0d0a 0d0a 2020 2020 2020 2020 6578 7472  ....        extr
+00004260: 6120 3d20 7365 6c66 2e65 7874 7261 0d0a  a = self.extra..
+00004270: 0d0a 2020 2020 2020 2020 6d69 6e5f 7665  ..        min_ve
+00004280: 7273 696f 6e20 3d20 300d 0a20 2020 2020  rsion = 0..     
+00004290: 2020 2069 6620 7a69 7036 3420 6973 204e     if zip64 is N
+000042a0: 6f6e 653a 0d0a 2020 2020 2020 2020 2020  one:..          
+000042b0: 2020 7a69 7036 3420 3d20 6669 6c65 5f73    zip64 = file_s
+000042c0: 697a 6520 3e20 5a49 5036 345f 4c49 4d49  ize > ZIP64_LIMI
+000042d0: 5420 6f72 2063 6f6d 7072 6573 735f 7369  T or compress_si
+000042e0: 7a65 203e 205a 4950 3634 5f4c 494d 4954  ze > ZIP64_LIMIT
+000042f0: 0d0a 2020 2020 2020 2020 6966 207a 6970  ..        if zip
+00004300: 3634 3a0d 0a20 2020 2020 2020 2020 2020  64:..           
+00004310: 2066 6d74 203d 2022 3c48 4851 5122 0d0a   fmt = "<HHQQ"..
+00004320: 2020 2020 2020 2020 2020 2020 6578 7472              extr
+00004330: 6120 3d20 6578 7472 6120 2b20 7374 7275  a = extra + stru
+00004340: 6374 2e70 6163 6b28 0d0a 2020 2020 2020  ct.pack(..      
+00004350: 2020 2020 2020 2020 2020 666d 742c 0d0a            fmt,..
+00004360: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004370: 312c 0d0a 2020 2020 2020 2020 2020 2020  1,..            
+00004380: 2020 2020 7374 7275 6374 2e63 616c 6373      struct.calcs
+00004390: 697a 6528 666d 7429 202d 2034 2c0d 0a20  ize(fmt) - 4,.. 
+000043a0: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+000043b0: 696c 655f 7369 7a65 2c0d 0a20 2020 2020  ile_size,..     
+000043c0: 2020 2020 2020 2020 2020 2063 6f6d 7072             compr
+000043d0: 6573 735f 7369 7a65 2c0d 0a20 2020 2020  ess_size,..     
+000043e0: 2020 2020 2020 2029 0d0a 2020 2020 2020         )..      
+000043f0: 2020 6966 2066 696c 655f 7369 7a65 203e    if file_size >
+00004400: 205a 4950 3634 5f4c 494d 4954 206f 7220   ZIP64_LIMIT or 
+00004410: 636f 6d70 7265 7373 5f73 697a 6520 3e20  compress_size > 
+00004420: 5a49 5036 345f 4c49 4d49 543a 0d0a 2020  ZIP64_LIMIT:..  
+00004430: 2020 2020 2020 2020 2020 6966 206e 6f74            if not
+00004440: 207a 6970 3634 3a0d 0a20 2020 2020 2020   zip64:..       
+00004450: 2020 2020 2020 2020 2072 6169 7365 204c           raise L
+00004460: 6172 6765 5a69 7046 696c 6528 2246 696c  argeZipFile("Fil
+00004470: 6573 697a 6520 776f 756c 6420 7265 7175  esize would requ
+00004480: 6972 6520 5a49 5036 3420 6578 7465 6e73  ire ZIP64 extens
+00004490: 696f 6e73 2229 0d0a 2020 2020 2020 2020  ions")..        
+000044a0: 2020 2020 2320 4669 6c65 2069 7320 6c61      # File is la
+000044b0: 7267 6572 2074 6861 6e20 7768 6174 2066  rger than what f
+000044c0: 6974 7320 696e 746f 2061 2034 2062 7974  its into a 4 byt
+000044d0: 6520 696e 7465 6765 722c 0d0a 2020 2020  e integer,..    
+000044e0: 2020 2020 2020 2020 2320 6661 6c6c 2062          # fall b
+000044f0: 6163 6b20 746f 2074 6865 205a 4950 3634  ack to the ZIP64
+00004500: 2065 7874 656e 7369 6f6e 0d0a 2020 2020   extension..    
+00004510: 2020 2020 2020 2020 6669 6c65 5f73 697a          file_siz
+00004520: 6520 3d20 3078 4646 4646 4646 4646 0d0a  e = 0xFFFFFFFF..
+00004530: 2020 2020 2020 2020 2020 2020 636f 6d70              comp
+00004540: 7265 7373 5f73 697a 6520 3d20 3078 4646  ress_size = 0xFF
+00004550: 4646 4646 4646 0d0a 2020 2020 2020 2020  FFFFFF..        
+00004560: 2020 2020 6d69 6e5f 7665 7273 696f 6e20      min_version 
+00004570: 3d20 5a49 5036 345f 5645 5253 494f 4e0d  = ZIP64_VERSION.
+00004580: 0a0d 0a20 2020 2020 2020 2069 6620 7365  ...        if se
+00004590: 6c66 2e63 6f6d 7072 6573 735f 7479 7065  lf.compress_type
+000045a0: 203d 3d20 5a49 505f 425a 4950 323a 0d0a   == ZIP_BZIP2:..
+000045b0: 2020 2020 2020 2020 2020 2020 6d69 6e5f              min_
+000045c0: 7665 7273 696f 6e20 3d20 6d61 7828 425a  version = max(BZ
+000045d0: 4950 325f 5645 5253 494f 4e2c 206d 696e  IP2_VERSION, min
+000045e0: 5f76 6572 7369 6f6e 290d 0a20 2020 2020  _version)..     
+000045f0: 2020 2065 6c69 6620 7365 6c66 2e63 6f6d     elif self.com
+00004600: 7072 6573 735f 7479 7065 203d 3d20 5a49  press_type == ZI
+00004610: 505f 4c5a 4d41 3a0d 0a20 2020 2020 2020  P_LZMA:..       
+00004620: 2020 2020 206d 696e 5f76 6572 7369 6f6e       min_version
+00004630: 203d 206d 6178 284c 5a4d 415f 5645 5253   = max(LZMA_VERS
+00004640: 494f 4e2c 206d 696e 5f76 6572 7369 6f6e  ION, min_version
+00004650: 290d 0a0d 0a20 2020 2020 2020 2073 656c  )....        sel
+00004660: 662e 6578 7472 6163 745f 7665 7273 696f  f.extract_versio
+00004670: 6e20 3d20 6d61 7828 6d69 6e5f 7665 7273  n = max(min_vers
+00004680: 696f 6e2c 2073 656c 662e 6578 7472 6163  ion, self.extrac
+00004690: 745f 7665 7273 696f 6e29 0d0a 2020 2020  t_version)..    
+000046a0: 2020 2020 7365 6c66 2e63 7265 6174 655f      self.create_
+000046b0: 7665 7273 696f 6e20 3d20 6d61 7828 6d69  version = max(mi
+000046c0: 6e5f 7665 7273 696f 6e2c 2073 656c 662e  n_version, self.
+000046d0: 6372 6561 7465 5f76 6572 7369 6f6e 290d  create_version).
+000046e0: 0a20 2020 2020 2020 2066 696c 656e 616d  .        filenam
+000046f0: 652c 2066 6c61 675f 6269 7473 203d 2073  e, flag_bits = s
+00004700: 656c 662e 5f65 6e63 6f64 6546 696c 656e  elf._encodeFilen
+00004710: 616d 6546 6c61 6773 2829 0d0a 2020 2020  ameFlags()..    
+00004720: 2020 2020 6865 6164 6572 203d 2073 7472      header = str
+00004730: 7563 742e 7061 636b 280d 0a20 2020 2020  uct.pack(..     
+00004740: 2020 2020 2020 2073 7472 7563 7446 696c         structFil
+00004750: 6548 6561 6465 722c 0d0a 2020 2020 2020  eHeader,..      
+00004760: 2020 2020 2020 7374 7269 6e67 4669 6c65        stringFile
+00004770: 4865 6164 6572 2c0d 0a20 2020 2020 2020  Header,..       
+00004780: 2020 2020 2073 656c 662e 6578 7472 6163       self.extrac
+00004790: 745f 7665 7273 696f 6e2c 0d0a 2020 2020  t_version,..    
+000047a0: 2020 2020 2020 2020 7365 6c66 2e72 6573          self.res
+000047b0: 6572 7665 642c 0d0a 2020 2020 2020 2020  erved,..        
+000047c0: 2020 2020 666c 6167 5f62 6974 732c 0d0a      flag_bits,..
+000047d0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+000047e0: 2e63 6f6d 7072 6573 735f 7479 7065 2c0d  .compress_type,.
+000047f0: 0a20 2020 2020 2020 2020 2020 2064 6f73  .            dos
+00004800: 7469 6d65 2c0d 0a20 2020 2020 2020 2020  time,..         
+00004810: 2020 2064 6f73 6461 7465 2c0d 0a20 2020     dosdate,..   
+00004820: 2020 2020 2020 2020 2043 5243 2c0d 0a20           CRC,.. 
+00004830: 2020 2020 2020 2020 2020 2063 6f6d 7072             compr
+00004840: 6573 735f 7369 7a65 2c0d 0a20 2020 2020  ess_size,..     
+00004850: 2020 2020 2020 2066 696c 655f 7369 7a65         file_size
+00004860: 2c0d 0a20 2020 2020 2020 2020 2020 206c  ,..            l
+00004870: 656e 2866 696c 656e 616d 6529 2c0d 0a20  en(filename),.. 
+00004880: 2020 2020 2020 2020 2020 206c 656e 2865             len(e
+00004890: 7874 7261 292c 0d0a 2020 2020 2020 2020  xtra),..        
+000048a0: 290d 0a20 2020 2020 2020 2072 6574 7572  )..        retur
+000048b0: 6e20 6865 6164 6572 202b 2066 696c 656e  n header + filen
+000048c0: 616d 6520 2b20 6578 7472 610d 0a0d 0a20  ame + extra.... 
+000048d0: 2020 2064 6566 205f 656e 636f 6465 4669     def _encodeFi
+000048e0: 6c65 6e61 6d65 466c 6167 7328 7365 6c66  lenameFlags(self
+000048f0: 293a 0d0a 2020 2020 2020 2020 7472 793a  ):..        try:
+00004900: 0d0a 2020 2020 2020 2020 2020 2020 7265  ..            re
+00004910: 7475 726e 2073 656c 662e 6669 6c65 6e61  turn self.filena
+00004920: 6d65 2e65 6e63 6f64 6528 2261 7363 6969  me.encode("ascii
+00004930: 2229 2c20 7365 6c66 2e66 6c61 675f 6269  "), self.flag_bi
+00004940: 7473 0d0a 2020 2020 2020 2020 6578 6365  ts..        exce
+00004950: 7074 2055 6e69 636f 6465 456e 636f 6465  pt UnicodeEncode
+00004960: 4572 726f 723a 0d0a 2020 2020 2020 2020  Error:..        
+00004970: 2020 2020 7265 7475 726e 2073 656c 662e      return self.
+00004980: 6669 6c65 6e61 6d65 2e65 6e63 6f64 6528  filename.encode(
+00004990: 2275 7466 2d38 2229 2c20 7365 6c66 2e66  "utf-8"), self.f
+000049a0: 6c61 675f 6269 7473 207c 2030 7838 3030  lag_bits | 0x800
+000049b0: 0d0a 0d0a 2020 2020 6465 6620 5f64 6563  ....    def _dec
+000049c0: 6f64 6545 7874 7261 2873 656c 6629 3a0d  odeExtra(self):.
+000049d0: 0a20 2020 2020 2020 2023 2054 7279 2074  .        # Try t
+000049e0: 6f20 6465 636f 6465 2074 6865 2065 7874  o decode the ext
+000049f0: 7261 2066 6965 6c64 2e0d 0a20 2020 2020  ra field...     
+00004a00: 2020 2065 7874 7261 203d 2073 656c 662e     extra = self.
+00004a10: 6578 7472 610d 0a20 2020 2020 2020 2075  extra..        u
+00004a20: 6e70 6163 6b20 3d20 7374 7275 6374 2e75  npack = struct.u
+00004a30: 6e70 6163 6b0d 0a20 2020 2020 2020 2077  npack..        w
+00004a40: 6869 6c65 206c 656e 2865 7874 7261 2920  hile len(extra) 
+00004a50: 3e3d 2034 3a0d 0a20 2020 2020 2020 2020  >= 4:..         
+00004a60: 2020 2074 702c 206c 6e20 3d20 756e 7061     tp, ln = unpa
+00004a70: 636b 2822 3c48 4822 2c20 6578 7472 615b  ck("<HH", extra[
+00004a80: 3a34 5d29 0d0a 2020 2020 2020 2020 2020  :4])..          
+00004a90: 2020 6966 206c 6e20 2b20 3420 3e20 6c65    if ln + 4 > le
+00004aa0: 6e28 6578 7472 6129 3a0d 0a20 2020 2020  n(extra):..     
+00004ab0: 2020 2020 2020 2020 2020 2072 6169 7365             raise
+00004ac0: 2042 6164 5a69 7046 696c 6528 0d0a 2020   BadZipFile(..  
+00004ad0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004ae0: 2020 2243 6f72 7275 7074 2065 7874 7261    "Corrupt extra
+00004af0: 2066 6965 6c64 2025 3034 7820 2873 697a   field %04x (siz
+00004b00: 653d 2564 2922 2025 2028 7470 2c20 6c6e  e=%d)" % (tp, ln
+00004b10: 292c 0d0a 2020 2020 2020 2020 2020 2020  ),..            
+00004b20: 2020 2020 290d 0a20 2020 2020 2020 2020      )..         
+00004b30: 2020 2069 6620 7470 203d 3d20 3078 3030     if tp == 0x00
+00004b40: 3031 3a0d 0a20 2020 2020 2020 2020 2020  01:..           
+00004b50: 2020 2020 2064 6174 6120 3d20 6578 7472       data = extr
+00004b60: 615b 3420 3a20 6c6e 202b 2034 5d0d 0a20  a[4 : ln + 4].. 
+00004b70: 2020 2020 2020 2020 2020 2020 2020 2023                 #
+00004b80: 205a 4950 3634 2065 7874 656e 7369 6f6e   ZIP64 extension
+00004b90: 2028 6c61 7267 6520 6669 6c65 7320 616e   (large files an
+00004ba0: 642f 6f72 206c 6172 6765 2061 7263 6869  d/or large archi
+00004bb0: 7665 7329 0d0a 2020 2020 2020 2020 2020  ves)..          
+00004bc0: 2020 2020 2020 7472 793a 0d0a 2020 2020        try:..    
+00004bd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004be0: 6966 2073 656c 662e 6669 6c65 5f73 697a  if self.file_siz
+00004bf0: 6520 696e 2028 3078 4646 4646 5f46 4646  e in (0xFFFF_FFF
+00004c00: 465f 4646 4646 5f46 4646 462c 2030 7846  F_FFFF_FFFF, 0xF
+00004c10: 4646 465f 4646 4646 293a 0d0a 2020 2020  FFF_FFFF):..    
+00004c20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004c30: 2020 2020 6669 656c 6420 3d20 2246 696c      field = "Fil
+00004c40: 6520 7369 7a65 220d 0a20 2020 2020 2020  e size"..       
+00004c50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004c60: 2028 7365 6c66 2e66 696c 655f 7369 7a65   (self.file_size
+00004c70: 2c29 203d 2075 6e70 6163 6b28 223c 5122  ,) = unpack("<Q"
+00004c80: 2c20 6461 7461 5b3a 385d 290d 0a20 2020  , data[:8])..   
+00004c90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004ca0: 2020 2020 2064 6174 6120 3d20 6461 7461       data = data
+00004cb0: 5b38 3a5d 0d0a 2020 2020 2020 2020 2020  [8:]..          
+00004cc0: 2020 2020 2020 2020 2020 6966 2073 656c            if sel
+00004cd0: 662e 636f 6d70 7265 7373 5f73 697a 6520  f.compress_size 
+00004ce0: 3d3d 2030 7846 4646 465f 4646 4646 3a0d  == 0xFFFF_FFFF:.
+00004cf0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00004d00: 2020 2020 2020 2020 2066 6965 6c64 203d           field =
+00004d10: 2022 436f 6d70 7265 7373 2073 697a 6522   "Compress size"
+00004d20: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00004d30: 2020 2020 2020 2020 2020 2873 656c 662e            (self.
+00004d40: 636f 6d70 7265 7373 5f73 697a 652c 2920  compress_size,) 
+00004d50: 3d20 756e 7061 636b 2822 3c51 222c 2064  = unpack("<Q", d
+00004d60: 6174 615b 3a38 5d29 0d0a 2020 2020 2020  ata[:8])..      
+00004d70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004d80: 2020 6461 7461 203d 2064 6174 615b 383a    data = data[8:
+00004d90: 5d0d 0a20 2020 2020 2020 2020 2020 2020  ]..             
+00004da0: 2020 2020 2020 2069 6620 7365 6c66 2e68         if self.h
+00004db0: 6561 6465 725f 6f66 6673 6574 203d 3d20  eader_offset == 
+00004dc0: 3078 4646 4646 5f46 4646 463a 0d0a 2020  0xFFFF_FFFF:..  
+00004dd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004de0: 2020 2020 2020 6669 656c 6420 3d20 2248        field = "H
+00004df0: 6561 6465 7220 6f66 6673 6574 220d 0a20  eader offset".. 
+00004e00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004e10: 2020 2020 2020 2028 7365 6c66 2e68 6561         (self.hea
+00004e20: 6465 725f 6f66 6673 6574 2c29 203d 2075  der_offset,) = u
+00004e30: 6e70 6163 6b28 223c 5122 2c20 6461 7461  npack("<Q", data
+00004e40: 5b3a 385d 290d 0a20 2020 2020 2020 2020  [:8])..         
+00004e50: 2020 2020 2020 2065 7863 6570 7420 7374         except st
+00004e60: 7275 6374 2e65 7272 6f72 3a0d 0a20 2020  ruct.error:..   
+00004e70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004e80: 2072 6169 7365 2042 6164 5a69 7046 696c   raise BadZipFil
+00004e90: 6528 0d0a 2020 2020 2020 2020 2020 2020  e(..            
+00004ea0: 2020 2020 2020 2020 2020 2020 6622 436f              f"Co
+00004eb0: 7272 7570 7420 7a69 7036 3420 6578 7472  rrupt zip64 extr
+00004ec0: 6120 6669 656c 642e 2022 2066 227b 6669  a field. " f"{fi
+00004ed0: 656c 647d 206e 6f74 2066 6f75 6e64 2e22  eld} not found."
+00004ee0: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
+00004ef0: 2020 2020 2020 2029 2066 726f 6d20 4e6f         ) from No
+00004f00: 6e65 0d0a 0d0a 2020 2020 2020 2020 2020  ne....          
+00004f10: 2020 6578 7472 6120 3d20 6578 7472 615b    extra = extra[
+00004f20: 6c6e 202b 2034 203a 5d0d 0a0d 0a20 2020  ln + 4 :]....   
+00004f30: 2040 636c 6173 736d 6574 686f 640d 0a20   @classmethod.. 
+00004f40: 2020 2064 6566 2066 726f 6d5f 6669 6c65     def from_file
+00004f50: 2863 6c73 2c20 6669 6c65 6e61 6d65 2c20  (cls, filename, 
+00004f60: 6172 636e 616d 653d 4e6f 6e65 2c20 2a2c  arcname=None, *,
+00004f70: 2073 7472 6963 745f 7469 6d65 7374 616d   strict_timestam
+00004f80: 7073 3d54 7275 6529 3a0d 0a20 2020 2020  ps=True):..     
+00004f90: 2020 2022 2222 436f 6e73 7472 7563 7420     """Construct 
+00004fa0: 616e 2061 7070 726f 7072 6961 7465 205a  an appropriate Z
+00004fb0: 6970 496e 666f 2066 6f72 2061 2066 696c  ipInfo for a fil
+00004fc0: 6520 6f6e 2074 6865 2066 696c 6573 7973  e on the filesys
+00004fd0: 7465 6d2e 0d0a 0d0a 2020 2020 2020 2020  tem.....        
+00004fe0: 6669 6c65 6e61 6d65 2073 686f 756c 6420  filename should 
+00004ff0: 6265 2074 6865 2070 6174 6820 746f 2061  be the path to a
+00005000: 2066 696c 6520 6f72 2064 6972 6563 746f   file or directo
+00005010: 7279 206f 6e20 7468 6520 6669 6c65 7379  ry on the filesy
+00005020: 7374 656d 2e0d 0a0d 0a20 2020 2020 2020  stem.....       
+00005030: 2061 7263 6e61 6d65 2069 7320 7468 6520   arcname is the 
+00005040: 6e61 6d65 2077 6869 6368 2069 7420 7769  name which it wi
+00005050: 6c6c 2068 6176 6520 7769 7468 696e 2074  ll have within t
+00005060: 6865 2061 7263 6869 7665 2028 6279 2064  he archive (by d
+00005070: 6566 6175 6c74 2c0d 0a20 2020 2020 2020  efault,..       
+00005080: 2074 6869 7320 7769 6c6c 2062 6520 7468   this will be th
+00005090: 6520 7361 6d65 2061 7320 6669 6c65 6e61  e same as filena
+000050a0: 6d65 2c20 6275 7420 7769 7468 6f75 7420  me, but without 
+000050b0: 6120 6472 6976 6520 6c65 7474 6572 2061  a drive letter a
+000050c0: 6e64 2077 6974 680d 0a20 2020 2020 2020  nd with..       
+000050d0: 206c 6561 6469 6e67 2070 6174 6820 7365   leading path se
+000050e0: 7061 7261 746f 7273 2072 656d 6f76 6564  parators removed
+000050f0: 292e 0d0a 2020 2020 2020 2020 2222 220d  )...        """.
+00005100: 0a20 2020 2020 2020 2069 6620 6973 696e  .        if isin
+00005110: 7374 616e 6365 2866 696c 656e 616d 652c  stance(filename,
+00005120: 206f 732e 5061 7468 4c69 6b65 293a 0d0a   os.PathLike):..
+00005130: 2020 2020 2020 2020 2020 2020 6669 6c65              file
+00005140: 6e61 6d65 203d 206f 732e 6673 7061 7468  name = os.fspath
+00005150: 2866 696c 656e 616d 6529 0d0a 2020 2020  (filename)..    
+00005160: 2020 2020 7374 203d 206f 732e 7374 6174      st = os.stat
+00005170: 2866 696c 656e 616d 6529 0d0a 2020 2020  (filename)..    
+00005180: 2020 2020 6973 6469 7220 3d20 7374 6174      isdir = stat
+00005190: 2e53 5f49 5344 4952 2873 742e 7374 5f6d  .S_ISDIR(st.st_m
+000051a0: 6f64 6529 0d0a 2020 2020 2020 2020 6d74  ode)..        mt
+000051b0: 696d 6520 3d20 7469 6d65 2e6c 6f63 616c  ime = time.local
+000051c0: 7469 6d65 2873 742e 7374 5f6d 7469 6d65  time(st.st_mtime
+000051d0: 290d 0a20 2020 2020 2020 2064 6174 655f  )..        date_
+000051e0: 7469 6d65 203d 206d 7469 6d65 5b30 3a36  time = mtime[0:6
+000051f0: 5d0d 0a20 2020 2020 2020 2069 6620 6e6f  ]..        if no
+00005200: 7420 7374 7269 6374 5f74 696d 6573 7461  t strict_timesta
+00005210: 6d70 7320 616e 6420 6461 7465 5f74 696d  mps and date_tim
+00005220: 655b 305d 203c 2031 3938 303a 0d0a 2020  e[0] < 1980:..  
+00005230: 2020 2020 2020 2020 2020 6461 7465 5f74            date_t
+00005240: 696d 6520 3d20 2831 3938 302c 2031 2c20  ime = (1980, 1, 
+00005250: 312c 2030 2c20 302c 2030 290d 0a20 2020  1, 0, 0, 0)..   
+00005260: 2020 2020 2065 6c69 6620 6e6f 7420 7374       elif not st
+00005270: 7269 6374 5f74 696d 6573 7461 6d70 7320  rict_timestamps 
+00005280: 616e 6420 6461 7465 5f74 696d 655b 305d  and date_time[0]
+00005290: 203e 2032 3130 373a 0d0a 2020 2020 2020   > 2107:..      
+000052a0: 2020 2020 2020 6461 7465 5f74 696d 6520        date_time 
+000052b0: 3d20 2832 3130 372c 2031 322c 2033 312c  = (2107, 12, 31,
+000052c0: 2032 332c 2035 392c 2035 3929 0d0a 2020   23, 59, 59)..  
+000052d0: 2020 2020 2020 2320 4372 6561 7465 205a        # Create Z
+000052e0: 6970 496e 666f 2069 6e73 7461 6e63 6520  ipInfo instance 
+000052f0: 746f 2073 746f 7265 2066 696c 6520 696e  to store file in
+00005300: 666f 726d 6174 696f 6e0d 0a20 2020 2020  formation..     
+00005310: 2020 2069 6620 6172 636e 616d 6520 6973     if arcname is
+00005320: 204e 6f6e 653a 0d0a 2020 2020 2020 2020   None:..        
+00005330: 2020 2020 6172 636e 616d 6520 3d20 6669      arcname = fi
+00005340: 6c65 6e61 6d65 0d0a 2020 2020 2020 2020  lename..        
+00005350: 6172 636e 616d 6520 3d20 6f73 2e70 6174  arcname = os.pat
+00005360: 682e 6e6f 726d 7061 7468 286f 732e 7061  h.normpath(os.pa
+00005370: 7468 2e73 706c 6974 6472 6976 6528 6172  th.splitdrive(ar
+00005380: 636e 616d 6529 5b31 5d29 0d0a 2020 2020  cname)[1])..    
+00005390: 2020 2020 7768 696c 6520 6172 636e 616d      while arcnam
+000053a0: 655b 305d 2069 6e20 286f 732e 7365 702c  e[0] in (os.sep,
+000053b0: 206f 732e 616c 7473 6570 293a 0d0a 2020   os.altsep):..  
+000053c0: 2020 2020 2020 2020 2020 6172 636e 616d            arcnam
+000053d0: 6520 3d20 6172 636e 616d 655b 313a 5d0d  e = arcname[1:].
+000053e0: 0a20 2020 2020 2020 2069 6620 6973 6469  .        if isdi
+000053f0: 723a 0d0a 2020 2020 2020 2020 2020 2020  r:..            
+00005400: 6172 636e 616d 6520 2b3d 2022 2f22 0d0a  arcname += "/"..
+00005410: 2020 2020 2020 2020 7a69 6e66 6f20 3d20          zinfo = 
+00005420: 636c 7328 6172 636e 616d 652c 2064 6174  cls(arcname, dat
+00005430: 655f 7469 6d65 290d 0a20 2020 2020 2020  e_time)..       
+00005440: 207a 696e 666f 2e65 7874 6572 6e61 6c5f   zinfo.external_
+00005450: 6174 7472 203d 2028 7374 2e73 745f 6d6f  attr = (st.st_mo
+00005460: 6465 2026 2030 7846 4646 4629 203c 3c20  de & 0xFFFF) << 
+00005470: 3136 2020 2320 556e 6978 2061 7474 7269  16  # Unix attri
+00005480: 6275 7465 730d 0a20 2020 2020 2020 2069  butes..        i
+00005490: 6620 6973 6469 723a 0d0a 2020 2020 2020  f isdir:..      
+000054a0: 2020 2020 2020 7a69 6e66 6f2e 6669 6c65        zinfo.file
+000054b0: 5f73 697a 6520 3d20 300d 0a20 2020 2020  _size = 0..     
+000054c0: 2020 2020 2020 207a 696e 666f 2e65 7874         zinfo.ext
+000054d0: 6572 6e61 6c5f 6174 7472 207c 3d20 3078  ernal_attr |= 0x
+000054e0: 3130 2020 2320 4d53 2d44 4f53 2064 6972  10  # MS-DOS dir
+000054f0: 6563 746f 7279 2066 6c61 670d 0a20 2020  ectory flag..   
+00005500: 2020 2020 2065 6c73 653a 0d0a 2020 2020       else:..    
+00005510: 2020 2020 2020 2020 7a69 6e66 6f2e 6669          zinfo.fi
+00005520: 6c65 5f73 697a 6520 3d20 7374 2e73 745f  le_size = st.st_
+00005530: 7369 7a65 0d0a 0d0a 2020 2020 2020 2020  size....        
+00005540: 7265 7475 726e 207a 696e 666f 0d0a 0d0a  return zinfo....
+00005550: 2020 2020 6465 6620 6973 5f64 6972 2873      def is_dir(s
+00005560: 656c 6629 3a0d 0a20 2020 2020 2020 2022  elf):..        "
+00005570: 2222 5265 7475 726e 2054 7275 6520 6966  ""Return True if
+00005580: 2074 6869 7320 6172 6368 6976 6520 6d65   this archive me
+00005590: 6d62 6572 2069 7320 6120 6469 7265 6374  mber is a direct
+000055a0: 6f72 792e 2222 220d 0a20 2020 2020 2020  ory."""..       
+000055b0: 2072 6574 7572 6e20 7365 6c66 2e66 696c   return self.fil
+000055c0: 656e 616d 655b 2d31 5d20 3d3d 2022 2f22  ename[-1] == "/"
+000055d0: 0d0a 0d0a 0d0a 2320 5a49 5020 656e 6372  ......# ZIP encr
+000055e0: 7970 7469 6f6e 2075 7365 7320 7468 6520  yption uses the 
+000055f0: 4352 4333 3220 6f6e 652d 6279 7465 2070  CRC32 one-byte p
+00005600: 7269 6d69 7469 7665 2066 6f72 2073 6372  rimitive for scr
+00005610: 616d 626c 696e 6720 736f 6d65 0d0a 2320  ambling some..# 
+00005620: 696e 7465 726e 616c 206b 6579 732e 2057  internal keys. W
+00005630: 6520 6e6f 7469 6365 6420 7468 6174 2061  e noticed that a
+00005640: 2064 6972 6563 7420 696d 706c 656d 656e   direct implemen
+00005650: 7461 7469 6f6e 2069 7320 6661 7374 6572  tation is faster
+00005660: 2074 6861 6e0d 0a23 2072 656c 7969 6e67   than..# relying
+00005670: 206f 6e20 6269 6e61 7363 6969 2e63 7263   on binascii.crc
+00005680: 3332 2829 2e0d 0a0d 0a5f 6372 6374 6162  32()....._crctab
+00005690: 6c65 203d 204e 6f6e 650d 0a0d 0a0d 0a64  le = None......d
+000056a0: 6566 205f 6765 6e5f 6372 6328 6372 6329  ef _gen_crc(crc)
+000056b0: 3a0d 0a20 2020 2066 6f72 205f 6a20 696e  :..    for _j in
+000056c0: 2072 616e 6765 2838 293a 0d0a 2020 2020   range(8):..    
+000056d0: 2020 2020 6966 2063 7263 2026 2031 3a0d      if crc & 1:.
+000056e0: 0a20 2020 2020 2020 2020 2020 2063 7263  .            crc
+000056f0: 203d 2028 6372 6320 3e3e 2031 2920 5e20   = (crc >> 1) ^ 
+00005700: 3078 4544 4238 3833 3230 0d0a 2020 2020  0xEDB88320..    
+00005710: 2020 2020 656c 7365 3a0d 0a20 2020 2020      else:..     
+00005720: 2020 2020 2020 2063 7263 203e 3e3d 2031         crc >>= 1
+00005730: 0d0a 2020 2020 7265 7475 726e 2063 7263  ..    return crc
+00005740: 0d0a 0d0a 0d0a 2320 5a49 5020 7375 7070  ......# ZIP supp
+00005750: 6f72 7473 2061 2070 6173 7377 6f72 642d  orts a password-
+00005760: 6261 7365 6420 666f 726d 206f 6620 656e  based form of en
+00005770: 6372 7970 7469 6f6e 2e20 4576 656e 2074  cryption. Even t
+00005780: 686f 7567 6820 6b6e 6f77 6e0d 0a23 2070  hough known..# p
+00005790: 6c61 696e 7465 7874 2061 7474 6163 6b73  laintext attacks
+000057a0: 2068 6176 6520 6265 656e 2066 6f75 6e64   have been found
+000057b0: 2061 6761 696e 7374 2069 742c 2069 7420   against it, it 
+000057c0: 6973 2073 7469 6c6c 2075 7365 6675 6c0d  is still useful.
+000057d0: 0a23 2074 6f20 6265 2061 626c 6520 746f  .# to be able to
+000057e0: 2067 6574 2064 6174 6120 6f75 7420 6f66   get data out of
+000057f0: 2073 7563 6820 6120 6669 6c65 2e0d 0a23   such a file...#
+00005800: 0d0a 2320 5573 6167 653a 0d0a 0d0a 0d0a  ..# Usage:......
+00005810: 6465 6620 5f5a 6970 4465 6372 7970 7465  def _ZipDecrypte
+00005820: 7228 7077 6429 3a0d 0a20 2020 206b 6579  r(pwd):..    key
+00005830: 3020 3d20 3330 3534 3139 3839 360d 0a20  0 = 305419896.. 
+00005840: 2020 206b 6579 3120 3d20 3539 3137 3531     key1 = 591751
+00005850: 3034 390d 0a20 2020 206b 6579 3220 3d20  049..    key2 = 
+00005860: 3837 3830 3832 3139 320d 0a0d 0a20 2020  878082192....   
+00005870: 2067 6c6f 6261 6c20 5f63 7263 7461 626c   global _crctabl
+00005880: 650d 0a20 2020 2069 6620 5f63 7263 7461  e..    if _crcta
+00005890: 626c 6520 6973 204e 6f6e 653a 0d0a 2020  ble is None:..  
+000058a0: 2020 2020 2020 5f63 7263 7461 626c 6520        _crctable 
+000058b0: 3d20 6c69 7374 286d 6170 285f 6765 6e5f  = list(map(_gen_
+000058c0: 6372 632c 2072 616e 6765 2832 3536 2929  crc, range(256))
+000058d0: 290d 0a20 2020 2063 7263 7461 626c 6520  )..    crctable 
+000058e0: 3d20 5f63 7263 7461 626c 650d 0a0d 0a20  = _crctable.... 
+000058f0: 2020 2064 6566 2063 7263 3332 2863 682c     def crc32(ch,
+00005900: 2063 7263 293a 0d0a 2020 2020 2020 2020   crc):..        
+00005910: 2222 2243 6f6d 7075 7465 2074 6865 2043  """Compute the C
+00005920: 5243 3332 2070 7269 6d69 7469 7665 206f  RC32 primitive o
+00005930: 6e20 6f6e 6520 6279 7465 2e22 2222 0d0a  n one byte."""..
+00005940: 2020 2020 2020 2020 7265 7475 726e 2028          return (
+00005950: 6372 6320 3e3e 2038 2920 5e20 6372 6374  crc >> 8) ^ crct
+00005960: 6162 6c65 5b28 6372 6320 5e20 6368 2920  able[(crc ^ ch) 
+00005970: 2620 3078 4646 5d0d 0a0d 0a20 2020 2064  & 0xFF]....    d
+00005980: 6566 2075 7064 6174 655f 6b65 7973 2863  ef update_keys(c
+00005990: 293a 0d0a 2020 2020 2020 2020 6e6f 6e6c  ):..        nonl
+000059a0: 6f63 616c 206b 6579 302c 206b 6579 312c  ocal key0, key1,
+000059b0: 206b 6579 320d 0a20 2020 2020 2020 206b   key2..        k
+000059c0: 6579 3020 3d20 6372 6333 3228 632c 206b  ey0 = crc32(c, k
+000059d0: 6579 3029 0d0a 2020 2020 2020 2020 6b65  ey0)..        ke
+000059e0: 7931 203d 2028 6b65 7931 202b 2028 6b65  y1 = (key1 + (ke
+000059f0: 7930 2026 2030 7846 4629 2920 2620 3078  y0 & 0xFF)) & 0x
+00005a00: 4646 4646 4646 4646 0d0a 2020 2020 2020  FFFFFFFF..      
+00005a10: 2020 6b65 7931 203d 2028 6b65 7931 202a    key1 = (key1 *
+00005a20: 2031 3334 3737 3538 3133 202b 2031 2920   134775813 + 1) 
+00005a30: 2620 3078 4646 4646 4646 4646 0d0a 2020  & 0xFFFFFFFF..  
+00005a40: 2020 2020 2020 6b65 7932 203d 2063 7263        key2 = crc
+00005a50: 3332 286b 6579 3120 3e3e 2032 342c 206b  32(key1 >> 24, k
+00005a60: 6579 3229 0d0a 0d0a 2020 2020 666f 7220  ey2)....    for 
+00005a70: 7020 696e 2070 7764 3a0d 0a20 2020 2020  p in pwd:..     
+00005a80: 2020 2075 7064 6174 655f 6b65 7973 2870     update_keys(p
+00005a90: 290d 0a0d 0a20 2020 2064 6566 2064 6563  )....    def dec
+00005aa0: 7279 7074 6572 2864 6174 6129 3a0d 0a20  rypter(data):.. 
+00005ab0: 2020 2020 2020 2022 2222 4465 6372 7970         """Decryp
+00005ac0: 7420 6120 6279 7465 7320 6f62 6a65 6374  t a bytes object
+00005ad0: 2e22 2222 0d0a 2020 2020 2020 2020 7265  ."""..        re
+00005ae0: 7375 6c74 203d 2062 7974 6561 7272 6179  sult = bytearray
+00005af0: 2829 0d0a 2020 2020 2020 2020 6170 7065  ()..        appe
+00005b00: 6e64 203d 2072 6573 756c 742e 6170 7065  nd = result.appe
+00005b10: 6e64 0d0a 2020 2020 2020 2020 666f 7220  nd..        for 
+00005b20: 6320 696e 2064 6174 613a 0d0a 2020 2020  c in data:..    
+00005b30: 2020 2020 2020 2020 6b20 3d20 6b65 7932          k = key2
+00005b40: 207c 2032 0d0a 2020 2020 2020 2020 2020   | 2..          
+00005b50: 2020 6320 5e3d 2028 286b 202a 2028 6b20    c ^= ((k * (k 
+00005b60: 5e20 3129 2920 3e3e 2038 2920 2620 3078  ^ 1)) >> 8) & 0x
+00005b70: 4646 0d0a 2020 2020 2020 2020 2020 2020  FF..            
+00005b80: 7570 6461 7465 5f6b 6579 7328 6329 0d0a  update_keys(c)..
+00005b90: 2020 2020 2020 2020 2020 2020 6170 7065              appe
+00005ba0: 6e64 2863 290d 0a20 2020 2020 2020 2072  nd(c)..        r
+00005bb0: 6574 7572 6e20 6279 7465 7328 7265 7375  eturn bytes(resu
+00005bc0: 6c74 290d 0a0d 0a20 2020 2072 6574 7572  lt)....    retur
+00005bd0: 6e20 6465 6372 7970 7465 720d 0a0d 0a0d  n decrypter.....
+00005be0: 0a63 6c61 7373 204c 5a4d 4143 6f6d 7072  .class LZMACompr
+00005bf0: 6573 736f 723a 0d0a 2020 2020 6465 6620  essor:..    def 
+00005c00: 5f5f 696e 6974 5f5f 2873 656c 6629 202d  __init__(self) -
+00005c10: 3e20 4e6f 6e65 3a0d 0a20 2020 2020 2020  > None:..       
+00005c20: 2073 656c 662e 5f63 6f6d 7020 3d20 4e6f   self._comp = No
+00005c30: 6e65 0d0a 0d0a 2020 2020 6465 6620 5f69  ne....    def _i
+00005c40: 6e69 7428 7365 6c66 293a 0d0a 2020 2020  nit(self):..    
+00005c50: 2020 2020 7072 6f70 7320 3d20 6c7a 6d61      props = lzma
+00005c60: 2e5f 656e 636f 6465 5f66 696c 7465 725f  ._encode_filter_
+00005c70: 7072 6f70 6572 7469 6573 287b 2269 6422  properties({"id"
+00005c80: 3a20 6c7a 6d61 2e46 494c 5445 525f 4c5a  : lzma.FILTER_LZ
+00005c90: 4d41 317d 290d 0a20 2020 2020 2020 2073  MA1})..        s
+00005ca0: 656c 662e 5f63 6f6d 7020 3d20 6c7a 6d61  elf._comp = lzma
+00005cb0: 2e4c 5a4d 4143 6f6d 7072 6573 736f 7228  .LZMACompressor(
+00005cc0: 0d0a 2020 2020 2020 2020 2020 2020 6c7a  ..            lz
+00005cd0: 6d61 2e46 4f52 4d41 545f 5241 572c 0d0a  ma.FORMAT_RAW,..
+00005ce0: 2020 2020 2020 2020 2020 2020 6669 6c74              filt
+00005cf0: 6572 733d 5b6c 7a6d 612e 5f64 6563 6f64  ers=[lzma._decod
+00005d00: 655f 6669 6c74 6572 5f70 726f 7065 7274  e_filter_propert
+00005d10: 6965 7328 6c7a 6d61 2e46 494c 5445 525f  ies(lzma.FILTER_
+00005d20: 4c5a 4d41 312c 2070 726f 7073 295d 2c0d  LZMA1, props)],.
+00005d30: 0a20 2020 2020 2020 2029 0d0a 2020 2020  .        )..    
+00005d40: 2020 2020 7265 7475 726e 2073 7472 7563      return struc
+00005d50: 742e 7061 636b 2822 3c42 4248 222c 2039  t.pack("<BBH", 9
+00005d60: 2c20 342c 206c 656e 2870 726f 7073 2929  , 4, len(props))
+00005d70: 202b 2070 726f 7073 0d0a 0d0a 2020 2020   + props....    
+00005d80: 6465 6620 636f 6d70 7265 7373 2873 656c  def compress(sel
+00005d90: 662c 2064 6174 6129 3a0d 0a20 2020 2020  f, data):..     
+00005da0: 2020 2069 6620 7365 6c66 2e5f 636f 6d70     if self._comp
+00005db0: 2069 7320 4e6f 6e65 3a0d 0a20 2020 2020   is None:..     
+00005dc0: 2020 2020 2020 2072 6574 7572 6e20 7365         return se
+00005dd0: 6c66 2e5f 696e 6974 2829 202b 2073 656c  lf._init() + sel
+00005de0: 662e 5f63 6f6d 702e 636f 6d70 7265 7373  f._comp.compress
+00005df0: 2864 6174 6129 0d0a 2020 2020 2020 2020  (data)..        
+00005e00: 7265 7475 726e 2073 656c 662e 5f63 6f6d  return self._com
+00005e10: 702e 636f 6d70 7265 7373 2864 6174 6129  p.compress(data)
+00005e20: 0d0a 0d0a 2020 2020 6465 6620 666c 7573  ....    def flus
+00005e30: 6828 7365 6c66 293a 0d0a 2020 2020 2020  h(self):..      
+00005e40: 2020 6966 2073 656c 662e 5f63 6f6d 7020    if self._comp 
+00005e50: 6973 204e 6f6e 653a 0d0a 2020 2020 2020  is None:..      
+00005e60: 2020 2020 2020 7265 7475 726e 2073 656c        return sel
+00005e70: 662e 5f69 6e69 7428 2920 2b20 7365 6c66  f._init() + self
+00005e80: 2e5f 636f 6d70 2e66 6c75 7368 2829 0d0a  ._comp.flush()..
+00005e90: 2020 2020 2020 2020 7265 7475 726e 2073          return s
+00005ea0: 656c 662e 5f63 6f6d 702e 666c 7573 6828  elf._comp.flush(
+00005eb0: 290d 0a0d 0a0d 0a63 6c61 7373 204c 5a4d  )......class LZM
+00005ec0: 4144 6563 6f6d 7072 6573 736f 723a 0d0a  ADecompressor:..
+00005ed0: 2020 2020 6465 6620 5f5f 696e 6974 5f5f      def __init__
+00005ee0: 2873 656c 6629 202d 3e20 4e6f 6e65 3a0d  (self) -> None:.
+00005ef0: 0a20 2020 2020 2020 2073 656c 662e 5f64  .        self._d
+00005f00: 6563 6f6d 7020 3d20 4e6f 6e65 0d0a 2020  ecomp = None..  
+00005f10: 2020 2020 2020 7365 6c66 2e5f 756e 636f        self._unco
+00005f20: 6e73 756d 6564 203d 2062 2222 0d0a 2020  nsumed = b""..  
+00005f30: 2020 2020 2020 7365 6c66 2e65 6f66 203d        self.eof =
+00005f40: 2046 616c 7365 0d0a 0d0a 2020 2020 6465   False....    de
+00005f50: 6620 6465 636f 6d70 7265 7373 2873 656c  f decompress(sel
+00005f60: 662c 2064 6174 6129 3a0d 0a20 2020 2020  f, data):..     
+00005f70: 2020 2069 6620 7365 6c66 2e5f 6465 636f     if self._deco
+00005f80: 6d70 2069 7320 4e6f 6e65 3a0d 0a20 2020  mp is None:..   
+00005f90: 2020 2020 2020 2020 2073 656c 662e 5f75           self._u
+00005fa0: 6e63 6f6e 7375 6d65 6420 2b3d 2064 6174  nconsumed += dat
+00005fb0: 610d 0a20 2020 2020 2020 2020 2020 2069  a..            i
+00005fc0: 6620 6c65 6e28 7365 6c66 2e5f 756e 636f  f len(self._unco
+00005fd0: 6e73 756d 6564 2920 3c3d 2034 3a0d 0a20  nsumed) <= 4:.. 
+00005fe0: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+00005ff0: 6574 7572 6e20 6222 220d 0a20 2020 2020  eturn b""..     
+00006000: 2020 2020 2020 2028 7073 697a 652c 2920         (psize,) 
+00006010: 3d20 7374 7275 6374 2e75 6e70 6163 6b28  = struct.unpack(
+00006020: 223c 4822 2c20 7365 6c66 2e5f 756e 636f  "<H", self._unco
+00006030: 6e73 756d 6564 5b32 3a34 5d29 0d0a 2020  nsumed[2:4])..  
+00006040: 2020 2020 2020 2020 2020 6966 206c 656e            if len
+00006050: 2873 656c 662e 5f75 6e63 6f6e 7375 6d65  (self._unconsume
+00006060: 6429 203c 3d20 3420 2b20 7073 697a 653a  d) <= 4 + psize:
+00006070: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00006080: 2020 7265 7475 726e 2062 2222 0d0a 0d0a    return b""....
+00006090: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+000060a0: 2e5f 6465 636f 6d70 203d 206c 7a6d 612e  ._decomp = lzma.
+000060b0: 4c5a 4d41 4465 636f 6d70 7265 7373 6f72  LZMADecompressor
+000060c0: 280d 0a20 2020 2020 2020 2020 2020 2020  (..             
+000060d0: 2020 206c 7a6d 612e 464f 524d 4154 5f52     lzma.FORMAT_R
+000060e0: 4157 2c0d 0a20 2020 2020 2020 2020 2020  AW,..           
+000060f0: 2020 2020 2066 696c 7465 7273 3d5b 0d0a       filters=[..
+00006100: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006110: 2020 2020 6c7a 6d61 2e5f 6465 636f 6465      lzma._decode
+00006120: 5f66 696c 7465 725f 7072 6f70 6572 7469  _filter_properti
+00006130: 6573 280d 0a20 2020 2020 2020 2020 2020  es(..           
+00006140: 2020 2020 2020 2020 2020 2020 206c 7a6d               lzm
+00006150: 612e 4649 4c54 4552 5f4c 5a4d 4131 2c0d  a.FILTER_LZMA1,.
+00006160: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00006170: 2020 2020 2020 2020 2073 656c 662e 5f75           self._u
+00006180: 6e63 6f6e 7375 6d65 645b 3420 3a20 3420  nconsumed[4 : 4 
+00006190: 2b20 7073 697a 655d 2c0d 0a20 2020 2020  + psize],..     
+000061a0: 2020 2020 2020 2020 2020 2020 2020 2029                 )
+000061b0: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
+000061c0: 2020 205d 2c0d 0a20 2020 2020 2020 2020     ],..         
+000061d0: 2020 2029 0d0a 2020 2020 2020 2020 2020     )..          
+000061e0: 2020 6461 7461 203d 2073 656c 662e 5f75    data = self._u
+000061f0: 6e63 6f6e 7375 6d65 645b 3420 2b20 7073  nconsumed[4 + ps
+00006200: 697a 6520 3a5d 0d0a 2020 2020 2020 2020  ize :]..        
+00006210: 2020 2020 6465 6c20 7365 6c66 2e5f 756e      del self._un
+00006220: 636f 6e73 756d 6564 0d0a 0d0a 2020 2020  consumed....    
+00006230: 2020 2020 7265 7375 6c74 203d 2073 656c      result = sel
+00006240: 662e 5f64 6563 6f6d 702e 6465 636f 6d70  f._decomp.decomp
+00006250: 7265 7373 2864 6174 6129 0d0a 2020 2020  ress(data)..    
+00006260: 2020 2020 7365 6c66 2e65 6f66 203d 2073      self.eof = s
+00006270: 656c 662e 5f64 6563 6f6d 702e 656f 660d  elf._decomp.eof.
+00006280: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+00006290: 7265 7375 6c74 0d0a 0d0a 0d0a 636f 6d70  result......comp
+000062a0: 7265 7373 6f72 5f6e 616d 6573 203d 207b  ressor_names = {
+000062b0: 0d0a 2020 2020 303a 2022 7374 6f72 6522  ..    0: "store"
+000062c0: 2c0d 0a20 2020 2031 3a20 2273 6872 696e  ,..    1: "shrin
+000062d0: 6b22 2c0d 0a20 2020 2032 3a20 2272 6564  k",..    2: "red
+000062e0: 7563 6522 2c0d 0a20 2020 2033 3a20 2272  uce",..    3: "r
+000062f0: 6564 7563 6522 2c0d 0a20 2020 2034 3a20  educe",..    4: 
+00006300: 2272 6564 7563 6522 2c0d 0a20 2020 2035  "reduce",..    5
+00006310: 3a20 2272 6564 7563 6522 2c0d 0a20 2020  : "reduce",..   
+00006320: 2036 3a20 2269 6d70 6c6f 6465 222c 0d0a   6: "implode",..
+00006330: 2020 2020 373a 2022 746f 6b65 6e69 7a65      7: "tokenize
+00006340: 222c 0d0a 2020 2020 383a 2022 6465 666c  ",..    8: "defl
+00006350: 6174 6522 2c0d 0a20 2020 2039 3a20 2264  ate",..    9: "d
+00006360: 6566 6c61 7465 3634 222c 0d0a 2020 2020  eflate64",..    
+00006370: 3130 3a20 2269 6d70 6c6f 6465 222c 0d0a  10: "implode",..
+00006380: 2020 2020 3132 3a20 2262 7a69 7032 222c      12: "bzip2",
+00006390: 0d0a 2020 2020 3134 3a20 226c 7a6d 6122  ..    14: "lzma"
+000063a0: 2c0d 0a20 2020 2031 383a 2022 7465 7273  ,..    18: "ters
+000063b0: 6522 2c0d 0a20 2020 2031 393a 2022 6c7a  e",..    19: "lz
+000063c0: 3737 222c 0d0a 2020 2020 3937 3a20 2277  77",..    97: "w
+000063d0: 6176 7061 636b 222c 0d0a 2020 2020 3938  avpack",..    98
+000063e0: 3a20 2270 706d 6422 2c0d 0a7d 0d0a 0d0a  : "ppmd",..}....
+000063f0: 0d0a 6465 6620 5f63 6865 636b 5f63 6f6d  ..def _check_com
+00006400: 7072 6573 7369 6f6e 2863 6f6d 7072 6573  pression(compres
+00006410: 7369 6f6e 293a 0d0a 2020 2020 6966 2063  sion):..    if c
+00006420: 6f6d 7072 6573 7369 6f6e 203d 3d20 5a49  ompression == ZI
+00006430: 505f 5354 4f52 4544 3a0d 0a20 2020 2020  P_STORED:..     
+00006440: 2020 2070 6173 730d 0a20 2020 2065 6c69     pass..    eli
+00006450: 6620 636f 6d70 7265 7373 696f 6e20 3d3d  f compression ==
+00006460: 205a 4950 5f44 4546 4c41 5445 443a 0d0a   ZIP_DEFLATED:..
+00006470: 2020 2020 2020 2020 6966 206e 6f74 207a          if not z
+00006480: 6c69 623a 0d0a 2020 2020 2020 2020 2020  lib:..          
+00006490: 2020 7261 6973 6520 5275 6e74 696d 6545    raise RuntimeE
+000064a0: 7272 6f72 280d 0a20 2020 2020 2020 2020  rror(..         
+000064b0: 2020 2020 2020 2022 436f 6d70 7265 7373         "Compress
+000064c0: 696f 6e20 7265 7175 6972 6573 2074 6865  ion requires the
+000064d0: 2028 6d69 7373 696e 6729 207a 6c69 6220   (missing) zlib 
+000064e0: 6d6f 6475 6c65 222c 0d0a 2020 2020 2020  module",..      
+000064f0: 2020 2020 2020 290d 0a20 2020 2065 6c69        )..    eli
+00006500: 6620 636f 6d70 7265 7373 696f 6e20 3d3d  f compression ==
+00006510: 205a 4950 5f42 5a49 5032 3a0d 0a20 2020   ZIP_BZIP2:..   
+00006520: 2020 2020 2069 6620 6e6f 7420 627a 323a       if not bz2:
+00006530: 0d0a 2020 2020 2020 2020 2020 2020 7261  ..            ra
+00006540: 6973 6520 5275 6e74 696d 6545 7272 6f72  ise RuntimeError
+00006550: 2822 436f 6d70 7265 7373 696f 6e20 7265  ("Compression re
+00006560: 7175 6972 6573 2074 6865 2028 6d69 7373  quires the (miss
+00006570: 696e 6729 2062 7a32 206d 6f64 756c 6522  ing) bz2 module"
+00006580: 290d 0a20 2020 2065 6c69 6620 636f 6d70  )..    elif comp
+00006590: 7265 7373 696f 6e20 3d3d 205a 4950 5f4c  ression == ZIP_L
+000065a0: 5a4d 413a 0d0a 2020 2020 2020 2020 6966  ZMA:..        if
+000065b0: 206e 6f74 206c 7a6d 613a 0d0a 2020 2020   not lzma:..    
+000065c0: 2020 2020 2020 2020 7261 6973 6520 5275          raise Ru
+000065d0: 6e74 696d 6545 7272 6f72 280d 0a20 2020  ntimeError(..   
+000065e0: 2020 2020 2020 2020 2020 2020 2022 436f               "Co
+000065f0: 6d70 7265 7373 696f 6e20 7265 7175 6972  mpression requir
+00006600: 6573 2074 6865 2028 6d69 7373 696e 6729  es the (missing)
+00006610: 206c 7a6d 6120 6d6f 6475 6c65 222c 0d0a   lzma module",..
+00006620: 2020 2020 2020 2020 2020 2020 290d 0a20              ).. 
+00006630: 2020 2065 6c73 653a 0d0a 2020 2020 2020     else:..      
+00006640: 2020 7261 6973 6520 4e6f 7449 6d70 6c65    raise NotImple
+00006650: 6d65 6e74 6564 4572 726f 7228 2254 6861  mentedError("Tha
+00006660: 7420 636f 6d70 7265 7373 696f 6e20 6d65  t compression me
+00006670: 7468 6f64 2069 7320 6e6f 7420 7375 7070  thod is not supp
+00006680: 6f72 7465 6422 290d 0a0d 0a0d 0a64 6566  orted")......def
+00006690: 205f 6765 745f 636f 6d70 7265 7373 6f72   _get_compressor
+000066a0: 2863 6f6d 7072 6573 735f 7479 7065 2c20  (compress_type, 
+000066b0: 636f 6d70 7265 7373 6c65 7665 6c3d 4e6f  compresslevel=No
+000066c0: 6e65 293a 0d0a 2020 2020 6966 2063 6f6d  ne):..    if com
+000066d0: 7072 6573 735f 7479 7065 203d 3d20 5a49  press_type == ZI
+000066e0: 505f 4445 464c 4154 4544 3a0d 0a20 2020  P_DEFLATED:..   
+000066f0: 2020 2020 2069 6620 636f 6d70 7265 7373       if compress
+00006700: 6c65 7665 6c20 6973 206e 6f74 204e 6f6e  level is not Non
+00006710: 653a 0d0a 2020 2020 2020 2020 2020 2020  e:..            
+00006720: 7265 7475 726e 207a 6c69 622e 636f 6d70  return zlib.comp
+00006730: 7265 7373 6f62 6a28 636f 6d70 7265 7373  ressobj(compress
+00006740: 6c65 7665 6c2c 207a 6c69 622e 4445 464c  level, zlib.DEFL
+00006750: 4154 4544 2c20 2d31 3529 0d0a 2020 2020  ATED, -15)..    
+00006760: 2020 2020 7265 7475 726e 207a 6c69 622e      return zlib.
+00006770: 636f 6d70 7265 7373 6f62 6a28 7a6c 6962  compressobj(zlib
+00006780: 2e5a 5f44 4546 4155 4c54 5f43 4f4d 5052  .Z_DEFAULT_COMPR
+00006790: 4553 5349 4f4e 2c20 7a6c 6962 2e44 4546  ESSION, zlib.DEF
+000067a0: 4c41 5445 442c 202d 3135 290d 0a20 2020  LATED, -15)..   
+000067b0: 2065 6c69 6620 636f 6d70 7265 7373 5f74   elif compress_t
+000067c0: 7970 6520 3d3d 205a 4950 5f42 5a49 5032  ype == ZIP_BZIP2
+000067d0: 3a0d 0a20 2020 2020 2020 2069 6620 636f  :..        if co
+000067e0: 6d70 7265 7373 6c65 7665 6c20 6973 206e  mpresslevel is n
+000067f0: 6f74 204e 6f6e 653a 0d0a 2020 2020 2020  ot None:..      
+00006800: 2020 2020 2020 7265 7475 726e 2062 7a32        return bz2
+00006810: 2e42 5a32 436f 6d70 7265 7373 6f72 2863  .BZ2Compressor(c
+00006820: 6f6d 7072 6573 736c 6576 656c 290d 0a20  ompresslevel).. 
+00006830: 2020 2020 2020 2072 6574 7572 6e20 627a         return bz
+00006840: 322e 425a 3243 6f6d 7072 6573 736f 7228  2.BZ2Compressor(
+00006850: 290d 0a20 2020 2023 2063 6f6d 7072 6573  )..    # compres
+00006860: 736c 6576 656c 2069 7320 6967 6e6f 7265  slevel is ignore
+00006870: 6420 666f 7220 5a49 505f 4c5a 4d41 0d0a  d for ZIP_LZMA..
+00006880: 2020 2020 656c 6966 2063 6f6d 7072 6573      elif compres
+00006890: 735f 7479 7065 203d 3d20 5a49 505f 4c5a  s_type == ZIP_LZ
+000068a0: 4d41 3a0d 0a20 2020 2020 2020 2072 6574  MA:..        ret
+000068b0: 7572 6e20 4c5a 4d41 436f 6d70 7265 7373  urn LZMACompress
+000068c0: 6f72 2829 0d0a 2020 2020 656c 7365 3a0d  or()..    else:.
+000068d0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+000068e0: 4e6f 6e65 0d0a 0d0a 0d0a 6465 6620 5f67  None......def _g
+000068f0: 6574 5f64 6563 6f6d 7072 6573 736f 7228  et_decompressor(
+00006900: 636f 6d70 7265 7373 5f74 7970 6529 3a0d  compress_type):.
+00006910: 0a20 2020 205f 6368 6563 6b5f 636f 6d70  .    _check_comp
+00006920: 7265 7373 696f 6e28 636f 6d70 7265 7373  ression(compress
+00006930: 5f74 7970 6529 0d0a 2020 2020 6966 2063  _type)..    if c
+00006940: 6f6d 7072 6573 735f 7479 7065 203d 3d20  ompress_type == 
+00006950: 5a49 505f 5354 4f52 4544 3a0d 0a20 2020  ZIP_STORED:..   
+00006960: 2020 2020 2072 6574 7572 6e20 4e6f 6e65       return None
+00006970: 0d0a 2020 2020 656c 6966 2063 6f6d 7072  ..    elif compr
+00006980: 6573 735f 7479 7065 203d 3d20 5a49 505f  ess_type == ZIP_
+00006990: 4445 464c 4154 4544 3a0d 0a20 2020 2020  DEFLATED:..     
+000069a0: 2020 2072 6574 7572 6e20 7a6c 6962 2e64     return zlib.d
+000069b0: 6563 6f6d 7072 6573 736f 626a 282d 3135  ecompressobj(-15
+000069c0: 290d 0a20 2020 2065 6c69 6620 636f 6d70  )..    elif comp
+000069d0: 7265 7373 5f74 7970 6520 3d3d 205a 4950  ress_type == ZIP
+000069e0: 5f42 5a49 5032 3a0d 0a20 2020 2020 2020  _BZIP2:..       
+000069f0: 2072 6574 7572 6e20 627a 322e 425a 3244   return bz2.BZ2D
+00006a00: 6563 6f6d 7072 6573 736f 7228 290d 0a20  ecompressor().. 
+00006a10: 2020 2065 6c69 6620 636f 6d70 7265 7373     elif compress
+00006a20: 5f74 7970 6520 3d3d 205a 4950 5f4c 5a4d  _type == ZIP_LZM
+00006a30: 413a 0d0a 2020 2020 2020 2020 7265 7475  A:..        retu
+00006a40: 726e 204c 5a4d 4144 6563 6f6d 7072 6573  rn LZMADecompres
+00006a50: 736f 7228 290d 0a20 2020 2065 6c73 653a  sor()..    else:
+00006a60: 0d0a 2020 2020 2020 2020 6465 7363 7220  ..        descr 
+00006a70: 3d20 636f 6d70 7265 7373 6f72 5f6e 616d  = compressor_nam
+00006a80: 6573 2e67 6574 2863 6f6d 7072 6573 735f  es.get(compress_
+00006a90: 7479 7065 290d 0a20 2020 2020 2020 2069  type)..        i
+00006aa0: 6620 6465 7363 723a 0d0a 2020 2020 2020  f descr:..      
+00006ab0: 2020 2020 2020 7261 6973 6520 4e6f 7449        raise NotI
+00006ac0: 6d70 6c65 6d65 6e74 6564 4572 726f 7228  mplementedError(
+00006ad0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00006ae0: 2020 2263 6f6d 7072 6573 7369 6f6e 2074    "compression t
+00006af0: 7970 6520 2564 2028 2573 2922 2025 2028  ype %d (%s)" % (
+00006b00: 636f 6d70 7265 7373 5f74 7970 652c 2064  compress_type, d
+00006b10: 6573 6372 292c 0d0a 2020 2020 2020 2020  escr),..        
+00006b20: 2020 2020 290d 0a20 2020 2020 2020 2065      )..        e
+00006b30: 6c73 653a 0d0a 2020 2020 2020 2020 2020  lse:..          
+00006b40: 2020 7261 6973 6520 4e6f 7449 6d70 6c65    raise NotImple
+00006b50: 6d65 6e74 6564 4572 726f 7228 2263 6f6d  mentedError("com
+00006b60: 7072 6573 7369 6f6e 2074 7970 6520 2564  pression type %d
+00006b70: 2220 2520 2863 6f6d 7072 6573 735f 7479  " % (compress_ty
+00006b80: 7065 2c29 290d 0a0d 0a0d 0a63 6c61 7373  pe,))......class
+00006b90: 205f 5368 6172 6564 4669 6c65 3a0d 0a20   _SharedFile:.. 
+00006ba0: 2020 2064 6566 205f 5f69 6e69 745f 5f28     def __init__(
+00006bb0: 7365 6c66 2c20 6669 6c65 2c20 706f 732c  self, file, pos,
+00006bc0: 2063 6c6f 7365 2c20 6c6f 636b 2c20 7772   close, lock, wr
+00006bd0: 6974 696e 6729 202d 3e20 4e6f 6e65 3a0d  iting) -> None:.
+00006be0: 0a20 2020 2020 2020 2073 656c 662e 5f66  .        self._f
+00006bf0: 696c 6520 3d20 6669 6c65 0d0a 2020 2020  ile = file..    
+00006c00: 2020 2020 7365 6c66 2e5f 706f 7320 3d20      self._pos = 
+00006c10: 706f 730d 0a20 2020 2020 2020 2073 656c  pos..        sel
+00006c20: 662e 5f63 6c6f 7365 203d 2063 6c6f 7365  f._close = close
+00006c30: 0d0a 2020 2020 2020 2020 7365 6c66 2e5f  ..        self._
+00006c40: 6c6f 636b 203d 206c 6f63 6b0d 0a20 2020  lock = lock..   
+00006c50: 2020 2020 2073 656c 662e 5f77 7269 7469       self._writi
+00006c60: 6e67 203d 2077 7269 7469 6e67 0d0a 2020  ng = writing..  
+00006c70: 2020 2020 2020 7365 6c66 2e73 6565 6b61        self.seeka
+00006c80: 626c 6520 3d20 6669 6c65 2e73 6565 6b61  ble = file.seeka
+00006c90: 626c 650d 0a20 2020 2020 2020 2073 656c  ble..        sel
+00006ca0: 662e 7465 6c6c 203d 2066 696c 652e 7465  f.tell = file.te
+00006cb0: 6c6c 0d0a 0d0a 2020 2020 6465 6620 7365  ll....    def se
+00006cc0: 656b 2873 656c 662c 206f 6666 7365 742c  ek(self, offset,
+00006cd0: 2077 6865 6e63 653d 3029 3a0d 0a20 2020   whence=0):..   
+00006ce0: 2020 2020 2077 6974 6820 7365 6c66 2e5f       with self._
+00006cf0: 6c6f 636b 3a0d 0a20 2020 2020 2020 2020  lock:..         
+00006d00: 2020 2069 6620 7365 6c66 2e5f 7772 6974     if self._writ
+00006d10: 696e 6728 293a 0d0a 2020 2020 2020 2020  ing():..        
+00006d20: 2020 2020 2020 2020 7261 6973 6520 5661          raise Va
+00006d30: 6c75 6545 7272 6f72 280d 0a20 2020 2020  lueError(..     
+00006d40: 2020 2020 2020 2020 2020 2020 2020 2022                 "
+00006d50: 4361 6e27 7420 7265 706f 7369 7469 6f6e  Can't reposition
+00006d60: 2069 6e20 7468 6520 5a49 5020 6669 6c65   in the ZIP file
+00006d70: 2077 6869 6c65 2022 0d0a 2020 2020 2020   while "..      
+00006d80: 2020 2020 2020 2020 2020 2020 2020 2274                "t
+00006d90: 6865 7265 2069 7320 616e 206f 7065 6e20  here is an open 
+00006da0: 7772 6974 696e 6720 6861 6e64 6c65 206f  writing handle o
+00006db0: 6e20 6974 2e20 220d 0a20 2020 2020 2020  n it. "..       
+00006dc0: 2020 2020 2020 2020 2020 2020 2022 436c               "Cl
+00006dd0: 6f73 6520 7468 6520 7772 6974 696e 6720  ose the writing 
+00006de0: 6861 6e64 6c65 2062 6566 6f72 6520 7472  handle before tr
+00006df0: 7969 6e67 2074 6f20 7265 6164 2e22 2c0d  ying to read.",.
+00006e00: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00006e10: 2029 0d0a 2020 2020 2020 2020 2020 2020   )..            
+00006e20: 7365 6c66 2e5f 6669 6c65 2e73 6565 6b28  self._file.seek(
+00006e30: 6f66 6673 6574 2c20 7768 656e 6365 290d  offset, whence).
+00006e40: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+00006e50: 662e 5f70 6f73 203d 2073 656c 662e 5f66  f._pos = self._f
+00006e60: 696c 652e 7465 6c6c 2829 0d0a 2020 2020  ile.tell()..    
+00006e70: 2020 2020 2020 2020 7265 7475 726e 2073          return s
+00006e80: 656c 662e 5f70 6f73 0d0a 0d0a 2020 2020  elf._pos....    
+00006e90: 6465 6620 7265 6164 2873 656c 662c 206e  def read(self, n
+00006ea0: 3d2d 3129 3a0d 0a20 2020 2020 2020 2077  =-1):..        w
+00006eb0: 6974 6820 7365 6c66 2e5f 6c6f 636b 3a0d  ith self._lock:.
+00006ec0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+00006ed0: 7365 6c66 2e5f 7772 6974 696e 6728 293a  self._writing():
 00006ee0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00006ef0: 2020 7365 6c66 2e5f 7365 656b 6162 6c65    self._seekable
-00006f00: 203d 2054 7275 650d 0a20 2020 2020 2020   = True..       
-00006f10: 2065 7863 6570 7420 4174 7472 6962 7574   except Attribut
-00006f20: 6545 7272 6f72 3a0d 0a20 2020 2020 2020  eError:..       
-00006f30: 2020 2020 2070 6173 730d 0a0d 0a20 2020       pass....   
-00006f40: 2020 2020 2073 656c 662e 5f64 6563 7279       self._decry
-00006f50: 7074 6572 203d 204e 6f6e 650d 0a20 2020  pter = None..   
-00006f60: 2020 2020 2069 6620 7077 643a 0d0a 2020       if pwd:..  
-00006f70: 2020 2020 2020 2020 2020 6966 207a 6970            if zip
-00006f80: 696e 666f 2e66 6c61 675f 6269 7473 2026  info.flag_bits &
-00006f90: 2030 7838 3a0d 0a20 2020 2020 2020 2020   0x8:..         
-00006fa0: 2020 2020 2020 2023 2063 6f6d 7061 7265         # compare
-00006fb0: 2061 6761 696e 7374 2074 6865 2066 696c   against the fil
-00006fc0: 6520 7479 7065 2066 726f 6d20 6578 7465  e type from exte
-00006fd0: 6e64 6564 206c 6f63 616c 2068 6561 6465  nded local heade
-00006fe0: 7273 0d0a 2020 2020 2020 2020 2020 2020  rs..            
-00006ff0: 2020 2020 6368 6563 6b5f 6279 7465 203d      check_byte =
-00007000: 2028 7a69 7069 6e66 6f2e 5f72 6177 5f74   (zipinfo._raw_t
-00007010: 696d 6520 3e3e 2038 2920 2620 3078 4646  ime >> 8) & 0xFF
-00007020: 0d0a 2020 2020 2020 2020 2020 2020 656c  ..            el
-00007030: 7365 3a0d 0a20 2020 2020 2020 2020 2020  se:..           
-00007040: 2020 2020 2023 2063 6f6d 7061 7265 2061       # compare a
-00007050: 6761 696e 7374 2074 6865 2043 5243 206f  gainst the CRC o
-00007060: 7468 6572 7769 7365 0d0a 2020 2020 2020  therwise..      
-00007070: 2020 2020 2020 2020 2020 6368 6563 6b5f            check_
-00007080: 6279 7465 203d 2028 7a69 7069 6e66 6f2e  byte = (zipinfo.
-00007090: 4352 4320 3e3e 2032 3429 2026 2030 7846  CRC >> 24) & 0xF
-000070a0: 460d 0a20 2020 2020 2020 2020 2020 2068  F..            h
-000070b0: 203d 2073 656c 662e 5f69 6e69 745f 6465   = self._init_de
-000070c0: 6372 7970 7465 7228 290d 0a20 2020 2020  crypter()..     
-000070d0: 2020 2020 2020 2069 6620 6820 213d 2063         if h != c
-000070e0: 6865 636b 5f62 7974 653a 0d0a 2020 2020  heck_byte:..    
-000070f0: 2020 2020 2020 2020 2020 2020 7261 6973              rais
-00007100: 6520 5275 6e74 696d 6545 7272 6f72 280d  e RuntimeError(.
-00007110: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00007120: 2020 2020 2022 4261 6420 7061 7373 776f       "Bad passwo
-00007130: 7264 2066 6f72 2066 696c 6520 2572 2220  rd for file %r" 
-00007140: 2520 7a69 7069 6e66 6f2e 6f72 6967 5f66  % zipinfo.orig_f
-00007150: 696c 656e 616d 652c 0d0a 2020 2020 2020  ilename,..      
-00007160: 2020 2020 2020 2020 2020 290d 0a0d 0a20            ).... 
-00007170: 2020 2064 6566 205f 696e 6974 5f64 6563     def _init_dec
-00007180: 7279 7074 6572 2873 656c 6629 3a0d 0a20  rypter(self):.. 
-00007190: 2020 2020 2020 2073 656c 662e 5f64 6563         self._dec
-000071a0: 7279 7074 6572 203d 205f 5a69 7044 6563  rypter = _ZipDec
-000071b0: 7279 7074 6572 2873 656c 662e 5f70 7764  rypter(self._pwd
-000071c0: 290d 0a20 2020 2020 2020 2023 2054 6865  )..        # The
-000071d0: 2066 6972 7374 2031 3220 6279 7465 7320   first 12 bytes 
-000071e0: 696e 2074 6865 2063 7970 6865 7220 7374  in the cypher st
-000071f0: 7265 616d 2069 7320 616e 2065 6e63 7279  ream is an encry
-00007200: 7074 696f 6e20 6865 6164 6572 0d0a 2020  ption header..  
-00007210: 2020 2020 2020 2320 2075 7365 6420 746f        #  used to
-00007220: 2073 7472 656e 6774 6865 6e20 7468 6520   strengthen the 
-00007230: 616c 676f 7269 7468 6d2e 2054 6865 2066  algorithm. The f
-00007240: 6972 7374 2031 3120 6279 7465 7320 6172  irst 11 bytes ar
-00007250: 650d 0a20 2020 2020 2020 2023 2020 636f  e..        #  co
-00007260: 6d70 6c65 7465 6c79 2072 616e 646f 6d2c  mpletely random,
-00007270: 2077 6869 6c65 2074 6865 2031 3274 6820   while the 12th 
-00007280: 636f 6e74 6169 6e73 2074 6865 204d 5342  contains the MSB
-00007290: 206f 6620 7468 6520 4352 432c 0d0a 2020   of the CRC,..  
-000072a0: 2020 2020 2020 2320 206f 7220 7468 6520        #  or the 
-000072b0: 4d53 4220 6f66 2074 6865 2066 696c 6520  MSB of the file 
-000072c0: 7469 6d65 2064 6570 656e 6469 6e67 206f  time depending o
-000072d0: 6e20 7468 6520 6865 6164 6572 2074 7970  n the header typ
-000072e0: 650d 0a20 2020 2020 2020 2023 2020 616e  e..        #  an
-000072f0: 6420 6973 2075 7365 6420 746f 2063 6865  d is used to che
-00007300: 636b 2074 6865 2063 6f72 7265 6374 6e65  ck the correctne
-00007310: 7373 206f 6620 7468 6520 7061 7373 776f  ss of the passwo
-00007320: 7264 2e0d 0a20 2020 2020 2020 2068 6561  rd...        hea
-00007330: 6465 7220 3d20 7365 6c66 2e5f 6669 6c65  der = self._file
-00007340: 6f62 6a2e 7265 6164 2831 3229 0d0a 2020  obj.read(12)..  
-00007350: 2020 2020 2020 7365 6c66 2e5f 636f 6d70        self._comp
-00007360: 7265 7373 5f6c 6566 7420 2d3d 2031 320d  ress_left -= 12.
-00007370: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-00007380: 7365 6c66 2e5f 6465 6372 7970 7465 7228  self._decrypter(
-00007390: 6865 6164 6572 295b 3131 5d0d 0a0d 0a20  header)[11].... 
-000073a0: 2020 2064 6566 205f 5f72 6570 725f 5f28     def __repr__(
-000073b0: 7365 6c66 2920 2d3e 2073 7472 3a0d 0a20  self) -> str:.. 
-000073c0: 2020 2020 2020 2072 6573 756c 7420 3d20         result = 
-000073d0: 5b0d 0a20 2020 2020 2020 2020 2020 2066  [..            f
-000073e0: 223c 7b73 656c 662e 5f5f 636c 6173 735f  "<{self.__class_
-000073f0: 5f2e 5f5f 6d6f 6475 6c65 5f5f 7d2e 7b73  _.__module__}.{s
-00007400: 656c 662e 5f5f 636c 6173 735f 5f2e 5f5f  elf.__class__.__
-00007410: 7175 616c 6e61 6d65 5f5f 7d22 2c0d 0a20  qualname__}",.. 
-00007420: 2020 2020 2020 205d 0d0a 2020 2020 2020         ]..      
-00007430: 2020 6966 206e 6f74 2073 656c 662e 636c    if not self.cl
-00007440: 6f73 6564 3a0d 0a20 2020 2020 2020 2020  osed:..         
-00007450: 2020 2072 6573 756c 742e 6170 7065 6e64     result.append
-00007460: 2866 2220 6e61 6d65 3d7b 7365 6c66 2e6e  (f" name={self.n
-00007470: 616d 6521 727d 206d 6f64 653d 7b73 656c  ame!r} mode={sel
-00007480: 662e 6d6f 6465 2172 7d22 290d 0a20 2020  f.mode!r}")..   
-00007490: 2020 2020 2020 2020 2069 6620 7365 6c66           if self
-000074a0: 2e5f 636f 6d70 7265 7373 5f74 7970 6520  ._compress_type 
-000074b0: 213d 205a 4950 5f53 544f 5245 443a 0d0a  != ZIP_STORED:..
-000074c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000074d0: 7265 7375 6c74 2e61 7070 656e 6428 0d0a  result.append(..
-000074e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000074f0: 2020 2020 2220 636f 6d70 7265 7373 5f74      " compress_t
-00007500: 7970 653d 2573 220d 0a20 2020 2020 2020  ype=%s"..       
-00007510: 2020 2020 2020 2020 2020 2020 2025 2063               % c
-00007520: 6f6d 7072 6573 736f 725f 6e61 6d65 732e  ompressor_names.
-00007530: 6765 7428 0d0a 2020 2020 2020 2020 2020  get(..          
-00007540: 2020 2020 2020 2020 2020 2020 2020 7365                se
-00007550: 6c66 2e5f 636f 6d70 7265 7373 5f74 7970  lf._compress_typ
-00007560: 652c 0d0a 2020 2020 2020 2020 2020 2020  e,..            
-00007570: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00007580: 2e5f 636f 6d70 7265 7373 5f74 7970 652c  ._compress_type,
-00007590: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-000075a0: 2020 2020 2020 292c 0d0a 2020 2020 2020        ),..      
-000075b0: 2020 2020 2020 2020 2020 290d 0a20 2020            )..   
-000075c0: 2020 2020 2065 6c73 653a 0d0a 2020 2020       else:..    
-000075d0: 2020 2020 2020 2020 7265 7375 6c74 2e61          result.a
-000075e0: 7070 656e 6428 2220 5b63 6c6f 7365 645d  ppend(" [closed]
-000075f0: 2229 0d0a 2020 2020 2020 2020 7265 7375  ")..        resu
-00007600: 6c74 2e61 7070 656e 6428 223e 2229 0d0a  lt.append(">")..
-00007610: 2020 2020 2020 2020 7265 7475 726e 2022          return "
-00007620: 222e 6a6f 696e 2872 6573 756c 7429 0d0a  ".join(result)..
-00007630: 0d0a 2020 2020 6465 6620 7265 6164 6c69  ..    def readli
-00007640: 6e65 2873 656c 662c 206c 696d 6974 3d2d  ne(self, limit=-
-00007650: 3129 3a0d 0a20 2020 2020 2020 2022 2222  1):..        """
-00007660: 5265 6164 2061 6e64 2072 6574 7572 6e20  Read and return 
-00007670: 6120 6c69 6e65 2066 726f 6d20 7468 6520  a line from the 
-00007680: 7374 7265 616d 2e0d 0a0d 0a20 2020 2020  stream.....     
-00007690: 2020 2049 6620 6c69 6d69 7420 6973 2073     If limit is s
-000076a0: 7065 6369 6669 6564 2c20 6174 206d 6f73  pecified, at mos
-000076b0: 7420 6c69 6d69 7420 6279 7465 7320 7769  t limit bytes wi
-000076c0: 6c6c 2062 6520 7265 6164 2e0d 0a20 2020  ll be read...   
-000076d0: 2020 2020 2022 2222 0d0a 2020 2020 2020       """..      
-000076e0: 2020 6966 206c 696d 6974 203c 2030 3a0d    if limit < 0:.
-000076f0: 0a20 2020 2020 2020 2020 2020 2023 2053  .            # S
-00007700: 686f 7274 6375 7420 636f 6d6d 6f6e 2063  hortcut common c
-00007710: 6173 6520 2d20 6e65 776c 696e 6520 666f  ase - newline fo
-00007720: 756e 6420 696e 2062 7566 6665 722e 0d0a  und in buffer...
-00007730: 2020 2020 2020 2020 2020 2020 6920 3d20              i = 
-00007740: 7365 6c66 2e5f 7265 6164 6275 6666 6572  self._readbuffer
-00007750: 2e66 696e 6428 6222 5c6e 222c 2073 656c  .find(b"\n", sel
-00007760: 662e 5f6f 6666 7365 7429 202b 2031 0d0a  f._offset) + 1..
-00007770: 2020 2020 2020 2020 2020 2020 6966 2069              if i
-00007780: 203e 2030 3a0d 0a20 2020 2020 2020 2020   > 0:..         
-00007790: 2020 2020 2020 206c 696e 6520 3d20 7365         line = se
-000077a0: 6c66 2e5f 7265 6164 6275 6666 6572 5b73  lf._readbuffer[s
-000077b0: 656c 662e 5f6f 6666 7365 7420 3a20 695d  elf._offset : i]
-000077c0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-000077d0: 2020 7365 6c66 2e5f 6f66 6673 6574 203d    self._offset =
-000077e0: 2069 0d0a 2020 2020 2020 2020 2020 2020   i..            
-000077f0: 2020 2020 7265 7475 726e 206c 696e 650d      return line.
-00007800: 0a0d 0a20 2020 2020 2020 2072 6574 7572  ...        retur
-00007810: 6e20 696f 2e42 7566 6665 7265 6449 4f42  n io.BufferedIOB
-00007820: 6173 652e 7265 6164 6c69 6e65 2873 656c  ase.readline(sel
-00007830: 662c 206c 696d 6974 290d 0a0d 0a20 2020  f, limit)....   
-00007840: 2064 6566 2070 6565 6b28 7365 6c66 2c20   def peek(self, 
-00007850: 6e3d 3129 3a0d 0a20 2020 2020 2020 2022  n=1):..        "
-00007860: 2222 5265 7475 726e 7320 6275 6666 6572  ""Returns buffer
-00007870: 6564 2062 7974 6573 2077 6974 686f 7574  ed bytes without
-00007880: 2061 6476 616e 6369 6e67 2074 6865 2070   advancing the p
-00007890: 6f73 6974 696f 6e2e 2222 220d 0a20 2020  osition."""..   
-000078a0: 2020 2020 2069 6620 6e20 3e20 6c65 6e28       if n > len(
-000078b0: 7365 6c66 2e5f 7265 6164 6275 6666 6572  self._readbuffer
-000078c0: 2920 2d20 7365 6c66 2e5f 6f66 6673 6574  ) - self._offset
-000078d0: 3a0d 0a20 2020 2020 2020 2020 2020 2063  :..            c
-000078e0: 6875 6e6b 203d 2073 656c 662e 7265 6164  hunk = self.read
-000078f0: 286e 290d 0a20 2020 2020 2020 2020 2020  (n)..           
-00007900: 2069 6620 6c65 6e28 6368 756e 6b29 203e   if len(chunk) >
-00007910: 2073 656c 662e 5f6f 6666 7365 743a 0d0a   self._offset:..
-00007920: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007930: 7365 6c66 2e5f 7265 6164 6275 6666 6572  self._readbuffer
-00007940: 203d 2063 6875 6e6b 202b 2073 656c 662e   = chunk + self.
-00007950: 5f72 6561 6462 7566 6665 725b 7365 6c66  _readbuffer[self
-00007960: 2e5f 6f66 6673 6574 203a 5d0d 0a20 2020  ._offset :]..   
-00007970: 2020 2020 2020 2020 2020 2020 2073 656c               sel
-00007980: 662e 5f6f 6666 7365 7420 3d20 300d 0a20  f._offset = 0.. 
-00007990: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
-000079a0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-000079b0: 2020 7365 6c66 2e5f 6f66 6673 6574 202d    self._offset -
-000079c0: 3d20 6c65 6e28 6368 756e 6b29 0d0a 0d0a  = len(chunk)....
-000079d0: 2020 2020 2020 2020 2320 5265 7475 726e          # Return
-000079e0: 2075 7020 746f 2035 3132 2062 7974 6573   up to 512 bytes
-000079f0: 2074 6f20 7265 6475 6365 2061 6c6c 6f63   to reduce alloc
-00007a00: 6174 696f 6e20 6f76 6572 6865 6164 2066  ation overhead f
-00007a10: 6f72 2074 6967 6874 206c 6f6f 7073 2e0d  or tight loops..
-00007a20: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-00007a30: 7365 6c66 2e5f 7265 6164 6275 6666 6572  self._readbuffer
-00007a40: 5b73 656c 662e 5f6f 6666 7365 7420 3a20  [self._offset : 
-00007a50: 7365 6c66 2e5f 6f66 6673 6574 202b 2035  self._offset + 5
-00007a60: 3132 5d0d 0a0d 0a20 2020 2064 6566 2072  12]....    def r
-00007a70: 6561 6461 626c 6528 7365 6c66 293a 0d0a  eadable(self):..
-00007a80: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
-00007a90: 636c 6f73 6564 3a0d 0a20 2020 2020 2020  closed:..       
-00007aa0: 2020 2020 2072 6169 7365 2056 616c 7565       raise Value
-00007ab0: 4572 726f 7228 2249 2f4f 206f 7065 7261  Error("I/O opera
-00007ac0: 7469 6f6e 206f 6e20 636c 6f73 6564 2066  tion on closed f
-00007ad0: 696c 652e 2229 0d0a 2020 2020 2020 2020  ile.")..        
-00007ae0: 7265 7475 726e 2054 7275 650d 0a0d 0a20  return True.... 
-00007af0: 2020 2064 6566 2072 6561 6428 7365 6c66     def read(self
-00007b00: 2c20 6e3d 2d31 293a 0d0a 2020 2020 2020  , n=-1):..      
-00007b10: 2020 2222 2252 6561 6420 616e 6420 7265    """Read and re
-00007b20: 7475 726e 2075 7020 746f 206e 2062 7974  turn up to n byt
-00007b30: 6573 2e0d 0a20 2020 2020 2020 2049 6620  es...        If 
-00007b40: 7468 6520 6172 6775 6d65 6e74 2069 7320  the argument is 
-00007b50: 6f6d 6974 7465 642c 204e 6f6e 652c 206f  omitted, None, o
-00007b60: 7220 6e65 6761 7469 7665 2c20 6461 7461  r negative, data
-00007b70: 2069 7320 7265 6164 2061 6e64 2072 6574   is read and ret
-00007b80: 7572 6e65 6420 756e 7469 6c20 454f 4620  urned until EOF 
-00007b90: 6973 2072 6561 6368 6564 2e0d 0a20 2020  is reached...   
-00007ba0: 2020 2020 2022 2222 0d0a 2020 2020 2020       """..      
-00007bb0: 2020 6966 2073 656c 662e 636c 6f73 6564    if self.closed
-00007bc0: 3a0d 0a20 2020 2020 2020 2020 2020 2072  :..            r
-00007bd0: 6169 7365 2056 616c 7565 4572 726f 7228  aise ValueError(
-00007be0: 2272 6561 6420 6672 6f6d 2063 6c6f 7365  "read from close
-00007bf0: 6420 6669 6c65 2e22 290d 0a20 2020 2020  d file.")..     
-00007c00: 2020 2069 6620 6e20 6973 204e 6f6e 6520     if n is None 
-00007c10: 6f72 206e 203c 2030 3a0d 0a20 2020 2020  or n < 0:..     
-00007c20: 2020 2020 2020 2062 7566 203d 2073 656c         buf = sel
-00007c30: 662e 5f72 6561 6462 7566 6665 725b 7365  f._readbuffer[se
-00007c40: 6c66 2e5f 6f66 6673 6574 203a 5d0d 0a20  lf._offset :].. 
-00007c50: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-00007c60: 5f72 6561 6462 7566 6665 7220 3d20 6222  _readbuffer = b"
-00007c70: 220d 0a20 2020 2020 2020 2020 2020 2073  "..            s
-00007c80: 656c 662e 5f6f 6666 7365 7420 3d20 300d  elf._offset = 0.
-00007c90: 0a20 2020 2020 2020 2020 2020 2077 6869  .            whi
-00007ca0: 6c65 206e 6f74 2073 656c 662e 5f65 6f66  le not self._eof
-00007cb0: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
-00007cc0: 2020 2062 7566 202b 3d20 7365 6c66 2e5f     buf += self._
-00007cd0: 7265 6164 3128 7365 6c66 2e4d 4158 5f4e  read1(self.MAX_N
-00007ce0: 290d 0a20 2020 2020 2020 2020 2020 2072  )..            r
-00007cf0: 6574 7572 6e20 6275 660d 0a0d 0a20 2020  eturn buf....   
-00007d00: 2020 2020 2065 6e64 203d 206e 202b 2073       end = n + s
-00007d10: 656c 662e 5f6f 6666 7365 740d 0a20 2020  elf._offset..   
-00007d20: 2020 2020 2069 6620 656e 6420 3c20 6c65       if end < le
-00007d30: 6e28 7365 6c66 2e5f 7265 6164 6275 6666  n(self._readbuff
-00007d40: 6572 293a 0d0a 2020 2020 2020 2020 2020  er):..          
-00007d50: 2020 6275 6620 3d20 7365 6c66 2e5f 7265    buf = self._re
-00007d60: 6164 6275 6666 6572 5b73 656c 662e 5f6f  adbuffer[self._o
-00007d70: 6666 7365 7420 3a20 656e 645d 0d0a 2020  ffset : end]..  
-00007d80: 2020 2020 2020 2020 2020 7365 6c66 2e5f            self._
-00007d90: 6f66 6673 6574 203d 2065 6e64 0d0a 2020  offset = end..  
-00007da0: 2020 2020 2020 2020 2020 7265 7475 726e            return
-00007db0: 2062 7566 0d0a 0d0a 2020 2020 2020 2020   buf....        
-00007dc0: 6e20 3d20 656e 6420 2d20 6c65 6e28 7365  n = end - len(se
-00007dd0: 6c66 2e5f 7265 6164 6275 6666 6572 290d  lf._readbuffer).
-00007de0: 0a20 2020 2020 2020 2062 7566 203d 2073  .        buf = s
-00007df0: 656c 662e 5f72 6561 6462 7566 6665 725b  elf._readbuffer[
-00007e00: 7365 6c66 2e5f 6f66 6673 6574 203a 5d0d  self._offset :].
-00007e10: 0a20 2020 2020 2020 2073 656c 662e 5f72  .        self._r
-00007e20: 6561 6462 7566 6665 7220 3d20 6222 220d  eadbuffer = b"".
-00007e30: 0a20 2020 2020 2020 2073 656c 662e 5f6f  .        self._o
-00007e40: 6666 7365 7420 3d20 300d 0a20 2020 2020  ffset = 0..     
-00007e50: 2020 2077 6869 6c65 206e 203e 2030 2061     while n > 0 a
-00007e60: 6e64 206e 6f74 2073 656c 662e 5f65 6f66  nd not self._eof
-00007e70: 3a0d 0a20 2020 2020 2020 2020 2020 2064  :..            d
-00007e80: 6174 6120 3d20 7365 6c66 2e5f 7265 6164  ata = self._read
-00007e90: 3128 6e29 0d0a 2020 2020 2020 2020 2020  1(n)..          
-00007ea0: 2020 6966 206e 203c 206c 656e 2864 6174    if n < len(dat
-00007eb0: 6129 3a0d 0a20 2020 2020 2020 2020 2020  a):..           
-00007ec0: 2020 2020 2073 656c 662e 5f72 6561 6462       self._readb
-00007ed0: 7566 6665 7220 3d20 6461 7461 0d0a 2020  uffer = data..  
-00007ee0: 2020 2020 2020 2020 2020 2020 2020 7365                se
-00007ef0: 6c66 2e5f 6f66 6673 6574 203d 206e 0d0a  lf._offset = n..
-00007f00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007f10: 6275 6620 2b3d 2064 6174 615b 3a6e 5d0d  buf += data[:n].
-00007f20: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00007f30: 2062 7265 616b 0d0a 2020 2020 2020 2020   break..        
-00007f40: 2020 2020 6275 6620 2b3d 2064 6174 610d      buf += data.
-00007f50: 0a20 2020 2020 2020 2020 2020 206e 202d  .            n -
-00007f60: 3d20 6c65 6e28 6461 7461 290d 0a20 2020  = len(data)..   
-00007f70: 2020 2020 2072 6574 7572 6e20 6275 660d       return buf.
-00007f80: 0a0d 0a20 2020 2064 6566 205f 7570 6461  ...    def _upda
-00007f90: 7465 5f63 7263 2873 656c 662c 206e 6577  te_crc(self, new
-00007fa0: 6461 7461 293a 0d0a 2020 2020 2020 2020  data):..        
-00007fb0: 2320 5570 6461 7465 2074 6865 2043 5243  # Update the CRC
-00007fc0: 2075 7369 6e67 2074 6865 2067 6976 656e   using the given
-00007fd0: 2064 6174 612e 0d0a 2020 2020 2020 2020   data...        
-00007fe0: 6966 2073 656c 662e 5f65 7870 6563 7465  if self._expecte
-00007ff0: 645f 6372 6320 6973 204e 6f6e 653a 0d0a  d_crc is None:..
-00008000: 2020 2020 2020 2020 2020 2020 2320 4e6f              # No
-00008010: 206e 6565 6420 746f 2063 6f6d 7075 7465   need to compute
-00008020: 2074 6865 2043 5243 2069 6620 7765 2064   the CRC if we d
-00008030: 6f6e 2774 2068 6176 6520 6120 7265 6665  on't have a refe
-00008040: 7265 6e63 6520 7661 6c75 650d 0a20 2020  rence value..   
-00008050: 2020 2020 2020 2020 2072 6574 7572 6e0d           return.
-00008060: 0a20 2020 2020 2020 2073 656c 662e 5f72  .        self._r
-00008070: 756e 6e69 6e67 5f63 7263 203d 2063 7263  unning_crc = crc
-00008080: 3332 286e 6577 6461 7461 2c20 7365 6c66  32(newdata, self
-00008090: 2e5f 7275 6e6e 696e 675f 6372 6329 0d0a  ._running_crc)..
-000080a0: 2020 2020 2020 2020 2320 4368 6563 6b20          # Check 
-000080b0: 7468 6520 4352 4320 6966 2077 6527 7265  the CRC if we're
-000080c0: 2061 7420 7468 6520 656e 6420 6f66 2074   at the end of t
-000080d0: 6865 2066 696c 650d 0a20 2020 2020 2020  he file..       
-000080e0: 2069 6620 7365 6c66 2e5f 656f 6620 616e   if self._eof an
-000080f0: 6420 7365 6c66 2e5f 7275 6e6e 696e 675f  d self._running_
-00008100: 6372 6320 213d 2073 656c 662e 5f65 7870  crc != self._exp
-00008110: 6563 7465 645f 6372 633a 0d0a 2020 2020  ected_crc:..    
-00008120: 2020 2020 2020 2020 7261 6973 6520 4261          raise Ba
-00008130: 645a 6970 4669 6c65 2822 4261 6420 4352  dZipFile("Bad CR
-00008140: 432d 3332 2066 6f72 2066 696c 6520 2572  C-32 for file %r
-00008150: 2220 2520 7365 6c66 2e6e 616d 6529 0d0a  " % self.name)..
-00008160: 0d0a 2020 2020 6465 6620 7265 6164 3128  ..    def read1(
-00008170: 7365 6c66 2c20 6e29 3a0d 0a20 2020 2020  self, n):..     
-00008180: 2020 2022 2222 5265 6164 2075 7020 746f     """Read up to
-00008190: 206e 2062 7974 6573 2077 6974 6820 6174   n bytes with at
-000081a0: 206d 6f73 7420 6f6e 6520 7265 6164 2829   most one read()
-000081b0: 2073 7973 7465 6d20 6361 6c6c 2e22 2222   system call."""
-000081c0: 0d0a 2020 2020 2020 2020 6966 206e 2069  ..        if n i
-000081d0: 7320 4e6f 6e65 206f 7220 6e20 3c20 303a  s None or n < 0:
-000081e0: 0d0a 2020 2020 2020 2020 2020 2020 6275  ..            bu
-000081f0: 6620 3d20 7365 6c66 2e5f 7265 6164 6275  f = self._readbu
-00008200: 6666 6572 5b73 656c 662e 5f6f 6666 7365  ffer[self._offse
-00008210: 7420 3a5d 0d0a 2020 2020 2020 2020 2020  t :]..          
-00008220: 2020 7365 6c66 2e5f 7265 6164 6275 6666    self._readbuff
-00008230: 6572 203d 2062 2222 0d0a 2020 2020 2020  er = b""..      
-00008240: 2020 2020 2020 7365 6c66 2e5f 6f66 6673        self._offs
-00008250: 6574 203d 2030 0d0a 2020 2020 2020 2020  et = 0..        
-00008260: 2020 2020 7768 696c 6520 6e6f 7420 7365      while not se
-00008270: 6c66 2e5f 656f 663a 0d0a 2020 2020 2020  lf._eof:..      
-00008280: 2020 2020 2020 2020 2020 6461 7461 203d            data =
-00008290: 2073 656c 662e 5f72 6561 6431 2873 656c   self._read1(sel
-000082a0: 662e 4d41 585f 4e29 0d0a 2020 2020 2020  f.MAX_N)..      
-000082b0: 2020 2020 2020 2020 2020 6966 2064 6174            if dat
-000082c0: 613a 0d0a 2020 2020 2020 2020 2020 2020  a:..            
-000082d0: 2020 2020 2020 2020 6275 6620 2b3d 2064          buf += d
-000082e0: 6174 610d 0a20 2020 2020 2020 2020 2020  ata..           
-000082f0: 2020 2020 2020 2020 2062 7265 616b 0d0a           break..
-00008300: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-00008310: 726e 2062 7566 0d0a 0d0a 2020 2020 2020  rn buf....      
-00008320: 2020 656e 6420 3d20 6e20 2b20 7365 6c66    end = n + self
-00008330: 2e5f 6f66 6673 6574 0d0a 2020 2020 2020  ._offset..      
-00008340: 2020 6966 2065 6e64 203c 206c 656e 2873    if end < len(s
-00008350: 656c 662e 5f72 6561 6462 7566 6665 7229  elf._readbuffer)
-00008360: 3a0d 0a20 2020 2020 2020 2020 2020 2062  :..            b
-00008370: 7566 203d 2073 656c 662e 5f72 6561 6462  uf = self._readb
-00008380: 7566 6665 725b 7365 6c66 2e5f 6f66 6673  uffer[self._offs
-00008390: 6574 203a 2065 6e64 5d0d 0a20 2020 2020  et : end]..     
-000083a0: 2020 2020 2020 2073 656c 662e 5f6f 6666         self._off
-000083b0: 7365 7420 3d20 656e 640d 0a20 2020 2020  set = end..     
-000083c0: 2020 2020 2020 2072 6574 7572 6e20 6275         return bu
-000083d0: 660d 0a0d 0a20 2020 2020 2020 206e 203d  f....        n =
-000083e0: 2065 6e64 202d 206c 656e 2873 656c 662e   end - len(self.
-000083f0: 5f72 6561 6462 7566 6665 7229 0d0a 2020  _readbuffer)..  
-00008400: 2020 2020 2020 6275 6620 3d20 7365 6c66        buf = self
-00008410: 2e5f 7265 6164 6275 6666 6572 5b73 656c  ._readbuffer[sel
-00008420: 662e 5f6f 6666 7365 7420 3a5d 0d0a 2020  f._offset :]..  
-00008430: 2020 2020 2020 7365 6c66 2e5f 7265 6164        self._read
-00008440: 6275 6666 6572 203d 2062 2222 0d0a 2020  buffer = b""..  
-00008450: 2020 2020 2020 7365 6c66 2e5f 6f66 6673        self._offs
-00008460: 6574 203d 2030 0d0a 2020 2020 2020 2020  et = 0..        
-00008470: 6966 206e 203e 2030 3a0d 0a20 2020 2020  if n > 0:..     
-00008480: 2020 2020 2020 2077 6869 6c65 206e 6f74         while not
-00008490: 2073 656c 662e 5f65 6f66 3a0d 0a20 2020   self._eof:..   
-000084a0: 2020 2020 2020 2020 2020 2020 2064 6174               dat
-000084b0: 6120 3d20 7365 6c66 2e5f 7265 6164 3128  a = self._read1(
-000084c0: 6e29 0d0a 2020 2020 2020 2020 2020 2020  n)..            
-000084d0: 2020 2020 6966 206e 203c 206c 656e 2864      if n < len(d
-000084e0: 6174 6129 3a0d 0a20 2020 2020 2020 2020  ata):..         
-000084f0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-00008500: 5f72 6561 6462 7566 6665 7220 3d20 6461  _readbuffer = da
-00008510: 7461 0d0a 2020 2020 2020 2020 2020 2020  ta..            
-00008520: 2020 2020 2020 2020 7365 6c66 2e5f 6f66          self._of
-00008530: 6673 6574 203d 206e 0d0a 2020 2020 2020  fset = n..      
-00008540: 2020 2020 2020 2020 2020 2020 2020 6275                bu
-00008550: 6620 2b3d 2064 6174 615b 3a6e 5d0d 0a20  f += data[:n].. 
-00008560: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008570: 2020 2062 7265 616b 0d0a 2020 2020 2020     break..      
-00008580: 2020 2020 2020 2020 2020 6966 2064 6174            if dat
-00008590: 613a 0d0a 2020 2020 2020 2020 2020 2020  a:..            
-000085a0: 2020 2020 2020 2020 6275 6620 2b3d 2064          buf += d
-000085b0: 6174 610d 0a20 2020 2020 2020 2020 2020  ata..           
-000085c0: 2020 2020 2020 2020 2062 7265 616b 0d0a           break..
-000085d0: 2020 2020 2020 2020 7265 7475 726e 2062          return b
-000085e0: 7566 0d0a 0d0a 2020 2020 6465 6620 5f72  uf....    def _r
-000085f0: 6561 6431 2873 656c 662c 206e 293a 0d0a  ead1(self, n):..
-00008600: 2020 2020 2020 2020 2320 5265 6164 2075          # Read u
-00008610: 7020 746f 206e 2063 6f6d 7072 6573 7365  p to n compresse
-00008620: 6420 6279 7465 7320 7769 7468 2061 7420  d bytes with at 
-00008630: 6d6f 7374 206f 6e65 2072 6561 6428 2920  most one read() 
-00008640: 7379 7374 656d 2063 616c 6c2c 0d0a 2020  system call,..  
-00008650: 2020 2020 2020 2320 6465 6372 7970 7420        # decrypt 
-00008660: 616e 6420 6465 636f 6d70 7265 7373 2074  and decompress t
-00008670: 6865 6d2e 0d0a 2020 2020 2020 2020 6966  hem...        if
-00008680: 2073 656c 662e 5f65 6f66 206f 7220 6e20   self._eof or n 
-00008690: 3c3d 2030 3a0d 0a20 2020 2020 2020 2020  <= 0:..         
-000086a0: 2020 2072 6574 7572 6e20 6222 220d 0a0d     return b""...
-000086b0: 0a20 2020 2020 2020 2023 2052 6561 6420  .        # Read 
-000086c0: 6672 6f6d 2066 696c 652e 0d0a 2020 2020  from file...    
-000086d0: 2020 2020 6966 2073 656c 662e 5f63 6f6d      if self._com
-000086e0: 7072 6573 735f 7479 7065 203d 3d20 5a49  press_type == ZI
-000086f0: 505f 4445 464c 4154 4544 3a0d 0a20 2020  P_DEFLATED:..   
-00008700: 2020 2020 2020 2020 2023 2320 4861 6e64           ## Hand
-00008710: 6c65 2075 6e63 6f6e 7375 6d65 6420 6461  le unconsumed da
-00008720: 7461 2e0d 0a20 2020 2020 2020 2020 2020  ta...           
-00008730: 2064 6174 6120 3d20 7365 6c66 2e5f 6465   data = self._de
-00008740: 636f 6d70 7265 7373 6f72 2e75 6e63 6f6e  compressor.uncon
-00008750: 7375 6d65 645f 7461 696c 0d0a 2020 2020  sumed_tail..    
-00008760: 2020 2020 2020 2020 6966 206e 203e 206c          if n > l
-00008770: 656e 2864 6174 6129 3a0d 0a20 2020 2020  en(data):..     
-00008780: 2020 2020 2020 2020 2020 2064 6174 6120             data 
-00008790: 2b3d 2073 656c 662e 5f72 6561 6432 286e  += self._read2(n
-000087a0: 202d 206c 656e 2864 6174 6129 290d 0a20   - len(data)).. 
-000087b0: 2020 2020 2020 2065 6c73 653a 0d0a 2020         else:..  
-000087c0: 2020 2020 2020 2020 2020 6461 7461 203d            data =
-000087d0: 2073 656c 662e 5f72 6561 6432 286e 290d   self._read2(n).
-000087e0: 0a0d 0a20 2020 2020 2020 2069 6620 7365  ...        if se
-000087f0: 6c66 2e5f 636f 6d70 7265 7373 5f74 7970  lf._compress_typ
-00008800: 6520 3d3d 205a 4950 5f53 544f 5245 443a  e == ZIP_STORED:
-00008810: 0d0a 2020 2020 2020 2020 2020 2020 7365  ..            se
-00008820: 6c66 2e5f 656f 6620 3d20 7365 6c66 2e5f  lf._eof = self._
-00008830: 636f 6d70 7265 7373 5f6c 6566 7420 3c3d  compress_left <=
-00008840: 2030 0d0a 2020 2020 2020 2020 656c 6966   0..        elif
-00008850: 2073 656c 662e 5f63 6f6d 7072 6573 735f   self._compress_
-00008860: 7479 7065 203d 3d20 5a49 505f 4445 464c  type == ZIP_DEFL
-00008870: 4154 4544 3a0d 0a20 2020 2020 2020 2020  ATED:..         
-00008880: 2020 206e 203d 206d 6178 286e 2c20 7365     n = max(n, se
-00008890: 6c66 2e4d 494e 5f52 4541 445f 5349 5a45  lf.MIN_READ_SIZE
-000088a0: 290d 0a20 2020 2020 2020 2020 2020 2064  )..            d
-000088b0: 6174 6120 3d20 7365 6c66 2e5f 6465 636f  ata = self._deco
-000088c0: 6d70 7265 7373 6f72 2e64 6563 6f6d 7072  mpressor.decompr
-000088d0: 6573 7328 6461 7461 2c20 6e29 0d0a 2020  ess(data, n)..  
-000088e0: 2020 2020 2020 2020 2020 7365 6c66 2e5f            self._
-000088f0: 656f 6620 3d20 280d 0a20 2020 2020 2020  eof = (..       
-00008900: 2020 2020 2020 2020 2073 656c 662e 5f64           self._d
-00008910: 6563 6f6d 7072 6573 736f 722e 656f 660d  ecompressor.eof.
-00008920: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00008930: 206f 7220 7365 6c66 2e5f 636f 6d70 7265   or self._compre
-00008940: 7373 5f6c 6566 7420 3c3d 2030 0d0a 2020  ss_left <= 0..  
-00008950: 2020 2020 2020 2020 2020 2020 2020 616e                an
-00008960: 6420 6e6f 7420 7365 6c66 2e5f 6465 636f  d not self._deco
-00008970: 6d70 7265 7373 6f72 2e75 6e63 6f6e 7375  mpressor.unconsu
-00008980: 6d65 645f 7461 696c 0d0a 2020 2020 2020  med_tail..      
-00008990: 2020 2020 2020 290d 0a20 2020 2020 2020        )..       
-000089a0: 2020 2020 2069 6620 7365 6c66 2e5f 656f       if self._eo
-000089b0: 663a 0d0a 2020 2020 2020 2020 2020 2020  f:..            
-000089c0: 2020 2020 6461 7461 202b 3d20 7365 6c66      data += self
-000089d0: 2e5f 6465 636f 6d70 7265 7373 6f72 2e66  ._decompressor.f
-000089e0: 6c75 7368 2829 0d0a 2020 2020 2020 2020  lush()..        
-000089f0: 656c 7365 3a0d 0a20 2020 2020 2020 2020  else:..         
-00008a00: 2020 2064 6174 6120 3d20 7365 6c66 2e5f     data = self._
-00008a10: 6465 636f 6d70 7265 7373 6f72 2e64 6563  decompressor.dec
-00008a20: 6f6d 7072 6573 7328 6461 7461 290d 0a20  ompress(data).. 
-00008a30: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-00008a40: 5f65 6f66 203d 2073 656c 662e 5f64 6563  _eof = self._dec
-00008a50: 6f6d 7072 6573 736f 722e 656f 6620 6f72  ompressor.eof or
-00008a60: 2073 656c 662e 5f63 6f6d 7072 6573 735f   self._compress_
-00008a70: 6c65 6674 203c 3d20 300d 0a0d 0a20 2020  left <= 0....   
-00008a80: 2020 2020 2064 6174 6120 3d20 6461 7461       data = data
-00008a90: 5b3a 2073 656c 662e 5f6c 6566 745d 0d0a  [: self._left]..
-00008aa0: 2020 2020 2020 2020 7365 6c66 2e5f 6c65          self._le
-00008ab0: 6674 202d 3d20 6c65 6e28 6461 7461 290d  ft -= len(data).
-00008ac0: 0a20 2020 2020 2020 2069 6620 7365 6c66  .        if self
-00008ad0: 2e5f 6c65 6674 203c 3d20 303a 0d0a 2020  ._left <= 0:..  
-00008ae0: 2020 2020 2020 2020 2020 7365 6c66 2e5f            self._
-00008af0: 656f 6620 3d20 5472 7565 0d0a 2020 2020  eof = True..    
-00008b00: 2020 2020 7365 6c66 2e5f 7570 6461 7465      self._update
-00008b10: 5f63 7263 2864 6174 6129 0d0a 2020 2020  _crc(data)..    
-00008b20: 2020 2020 7265 7475 726e 2064 6174 610d      return data.
-00008b30: 0a0d 0a20 2020 2064 6566 205f 7265 6164  ...    def _read
-00008b40: 3228 7365 6c66 2c20 6e29 3a0d 0a20 2020  2(self, n):..   
-00008b50: 2020 2020 2069 6620 7365 6c66 2e5f 636f       if self._co
-00008b60: 6d70 7265 7373 5f6c 6566 7420 3c3d 2030  mpress_left <= 0
-00008b70: 3a0d 0a20 2020 2020 2020 2020 2020 2072  :..            r
-00008b80: 6574 7572 6e20 6222 220d 0a0d 0a20 2020  eturn b""....   
-00008b90: 2020 2020 206e 203d 206d 6178 286e 2c20       n = max(n, 
-00008ba0: 7365 6c66 2e4d 494e 5f52 4541 445f 5349  self.MIN_READ_SI
-00008bb0: 5a45 290d 0a20 2020 2020 2020 206e 203d  ZE)..        n =
-00008bc0: 206d 696e 286e 2c20 7365 6c66 2e5f 636f   min(n, self._co
-00008bd0: 6d70 7265 7373 5f6c 6566 7429 0d0a 0d0a  mpress_left)....
-00008be0: 2020 2020 2020 2020 6461 7461 203d 2073          data = s
-00008bf0: 656c 662e 5f66 696c 656f 626a 2e72 6561  elf._fileobj.rea
-00008c00: 6428 6e29 0d0a 2020 2020 2020 2020 7365  d(n)..        se
-00008c10: 6c66 2e5f 636f 6d70 7265 7373 5f6c 6566  lf._compress_lef
-00008c20: 7420 2d3d 206c 656e 2864 6174 6129 0d0a  t -= len(data)..
-00008c30: 2020 2020 2020 2020 6966 206e 6f74 2064          if not d
-00008c40: 6174 613a 0d0a 2020 2020 2020 2020 2020  ata:..          
-00008c50: 2020 7261 6973 6520 454f 4645 7272 6f72    raise EOFError
-00008c60: 0d0a 0d0a 2020 2020 2020 2020 6966 2073  ....        if s
-00008c70: 656c 662e 5f64 6563 7279 7074 6572 2069  elf._decrypter i
-00008c80: 7320 6e6f 7420 4e6f 6e65 3a0d 0a20 2020  s not None:..   
-00008c90: 2020 2020 2020 2020 2064 6174 6120 3d20           data = 
-00008ca0: 7365 6c66 2e5f 6465 6372 7970 7465 7228  self._decrypter(
-00008cb0: 6461 7461 290d 0a20 2020 2020 2020 2072  data)..        r
-00008cc0: 6574 7572 6e20 6461 7461 0d0a 0d0a 2020  eturn data....  
-00008cd0: 2020 6465 6620 636c 6f73 6528 7365 6c66    def close(self
-00008ce0: 293a 0d0a 2020 2020 2020 2020 7472 793a  ):..        try:
-00008cf0: 0d0a 2020 2020 2020 2020 2020 2020 6966  ..            if
-00008d00: 2073 656c 662e 5f63 6c6f 7365 5f66 696c   self._close_fil
-00008d10: 656f 626a 3a0d 0a20 2020 2020 2020 2020  eobj:..         
-00008d20: 2020 2020 2020 2073 656c 662e 5f66 696c         self._fil
-00008d30: 656f 626a 2e63 6c6f 7365 2829 0d0a 2020  eobj.close()..  
-00008d40: 2020 2020 2020 6669 6e61 6c6c 793a 0d0a        finally:..
-00008d50: 2020 2020 2020 2020 2020 2020 7375 7065              supe
-00008d60: 7228 292e 636c 6f73 6528 290d 0a0d 0a20  r().close().... 
-00008d70: 2020 2064 6566 2073 6565 6b61 626c 6528     def seekable(
-00008d80: 7365 6c66 293a 0d0a 2020 2020 2020 2020  self):..        
-00008d90: 6966 2073 656c 662e 636c 6f73 6564 3a0d  if self.closed:.
-00008da0: 0a20 2020 2020 2020 2020 2020 2072 6169  .            rai
-00008db0: 7365 2056 616c 7565 4572 726f 7228 2249  se ValueError("I
-00008dc0: 2f4f 206f 7065 7261 7469 6f6e 206f 6e20  /O operation on 
-00008dd0: 636c 6f73 6564 2066 696c 652e 2229 0d0a  closed file.")..
-00008de0: 2020 2020 2020 2020 7265 7475 726e 2073          return s
-00008df0: 656c 662e 5f73 6565 6b61 626c 650d 0a0d  elf._seekable...
-00008e00: 0a20 2020 2064 6566 2073 6565 6b28 7365  .    def seek(se
-00008e10: 6c66 2c20 6f66 6673 6574 2c20 7768 656e  lf, offset, when
-00008e20: 6365 3d30 293a 0d0a 2020 2020 2020 2020  ce=0):..        
-00008e30: 6966 2073 656c 662e 636c 6f73 6564 3a0d  if self.closed:.
-00008e40: 0a20 2020 2020 2020 2020 2020 2072 6169  .            rai
-00008e50: 7365 2056 616c 7565 4572 726f 7228 2273  se ValueError("s
-00008e60: 6565 6b20 6f6e 2063 6c6f 7365 6420 6669  eek on closed fi
-00008e70: 6c65 2e22 290d 0a20 2020 2020 2020 2069  le.")..        i
-00008e80: 6620 6e6f 7420 7365 6c66 2e5f 7365 656b  f not self._seek
-00008e90: 6162 6c65 3a0d 0a20 2020 2020 2020 2020  able:..         
-00008ea0: 2020 2072 6169 7365 2069 6f2e 556e 7375     raise io.Unsu
-00008eb0: 7070 6f72 7465 644f 7065 7261 7469 6f6e  pportedOperation
-00008ec0: 2822 756e 6465 726c 7969 6e67 2073 7472  ("underlying str
-00008ed0: 6561 6d20 6973 206e 6f74 2073 6565 6b61  eam is not seeka
-00008ee0: 626c 6522 290d 0a20 2020 2020 2020 2063  ble")..        c
-00008ef0: 7572 725f 706f 7320 3d20 7365 6c66 2e74  urr_pos = self.t
-00008f00: 656c 6c28 290d 0a20 2020 2020 2020 2069  ell()..        i
-00008f10: 6620 7768 656e 6365 203d 3d20 303a 2020  f whence == 0:  
-00008f20: 2320 5365 656b 2066 726f 6d20 7374 6172  # Seek from star
-00008f30: 7420 6f66 2066 696c 650d 0a20 2020 2020  t of file..     
-00008f40: 2020 2020 2020 206e 6577 5f70 6f73 203d         new_pos =
-00008f50: 206f 6666 7365 740d 0a20 2020 2020 2020   offset..       
-00008f60: 2065 6c69 6620 7768 656e 6365 203d 3d20   elif whence == 
-00008f70: 313a 2020 2320 5365 656b 2066 726f 6d20  1:  # Seek from 
-00008f80: 6375 7272 656e 7420 706f 7369 7469 6f6e  current position
-00008f90: 0d0a 2020 2020 2020 2020 2020 2020 6e65  ..            ne
-00008fa0: 775f 706f 7320 3d20 6375 7272 5f70 6f73  w_pos = curr_pos
-00008fb0: 202b 206f 6666 7365 740d 0a20 2020 2020   + offset..     
-00008fc0: 2020 2065 6c69 6620 7768 656e 6365 203d     elif whence =
-00008fd0: 3d20 323a 2020 2320 5365 656b 2066 726f  = 2:  # Seek fro
-00008fe0: 6d20 454f 460d 0a20 2020 2020 2020 2020  m EOF..         
-00008ff0: 2020 206e 6577 5f70 6f73 203d 2073 656c     new_pos = sel
-00009000: 662e 5f6f 7269 675f 6669 6c65 5f73 697a  f._orig_file_siz
-00009010: 6520 2b20 6f66 6673 6574 0d0a 2020 2020  e + offset..    
-00009020: 2020 2020 656c 7365 3a0d 0a20 2020 2020      else:..     
-00009030: 2020 2020 2020 2072 6169 7365 2056 616c         raise Val
-00009040: 7565 4572 726f 7228 0d0a 2020 2020 2020  ueError(..      
-00009050: 2020 2020 2020 2020 2020 2277 6865 6e63            "whenc
-00009060: 6520 6d75 7374 2062 6520 6f73 2e53 4545  e must be os.SEE
-00009070: 4b5f 5345 5420 2830 292c 2022 0d0a 2020  K_SET (0), "..  
-00009080: 2020 2020 2020 2020 2020 2020 2020 226f                "o
-00009090: 732e 5345 454b 5f43 5552 2028 3129 2c20  s.SEEK_CUR (1), 
-000090a0: 6f72 206f 732e 5345 454b 5f45 4e44 2028  or os.SEEK_END (
-000090b0: 3229 222c 0d0a 2020 2020 2020 2020 2020  2)",..          
-000090c0: 2020 290d 0a0d 0a20 2020 2020 2020 2069    )....        i
-000090d0: 6620 6e65 775f 706f 7320 3e20 7365 6c66  f new_pos > self
-000090e0: 2e5f 6f72 6967 5f66 696c 655f 7369 7a65  ._orig_file_size
-000090f0: 3a0d 0a20 2020 2020 2020 2020 2020 206e  :..            n
-00009100: 6577 5f70 6f73 203d 2073 656c 662e 5f6f  ew_pos = self._o
-00009110: 7269 675f 6669 6c65 5f73 697a 650d 0a0d  rig_file_size...
-00009120: 0a20 2020 2020 2020 2069 6620 6e65 775f  .        if new_
-00009130: 706f 7320 3c20 303a 0d0a 2020 2020 2020  pos < 0:..      
-00009140: 2020 2020 2020 6e65 775f 706f 7320 3d20        new_pos = 
-00009150: 300d 0a0d 0a20 2020 2020 2020 2072 6561  0....        rea
-00009160: 645f 6f66 6673 6574 203d 206e 6577 5f70  d_offset = new_p
-00009170: 6f73 202d 2063 7572 725f 706f 730d 0a20  os - curr_pos.. 
-00009180: 2020 2020 2020 2062 7566 665f 6f66 6673         buff_offs
-00009190: 6574 203d 2072 6561 645f 6f66 6673 6574  et = read_offset
-000091a0: 202b 2073 656c 662e 5f6f 6666 7365 740d   + self._offset.
-000091b0: 0a0d 0a20 2020 2020 2020 2069 6620 6275  ...        if bu
-000091c0: 6666 5f6f 6666 7365 7420 3e3d 2030 2061  ff_offset >= 0 a
-000091d0: 6e64 2062 7566 665f 6f66 6673 6574 203c  nd buff_offset <
-000091e0: 206c 656e 2873 656c 662e 5f72 6561 6462   len(self._readb
-000091f0: 7566 6665 7229 3a0d 0a20 2020 2020 2020  uffer):..       
-00009200: 2020 2020 2023 204a 7573 7420 6d6f 7665       # Just move
-00009210: 2074 6865 205f 6f66 6673 6574 2069 6e64   the _offset ind
-00009220: 6578 2069 6620 7468 6520 6e65 7720 706f  ex if the new po
-00009230: 7369 7469 6f6e 2069 7320 696e 2074 6865  sition is in the
-00009240: 205f 7265 6164 6275 6666 6572 0d0a 2020   _readbuffer..  
-00009250: 2020 2020 2020 2020 2020 7365 6c66 2e5f            self._
-00009260: 6f66 6673 6574 203d 2062 7566 665f 6f66  offset = buff_of
-00009270: 6673 6574 0d0a 2020 2020 2020 2020 2020  fset..          
-00009280: 2020 7265 6164 5f6f 6666 7365 7420 3d20    read_offset = 
-00009290: 300d 0a20 2020 2020 2020 2065 6c69 6620  0..        elif 
-000092a0: 7265 6164 5f6f 6666 7365 7420 3c20 303a  read_offset < 0:
-000092b0: 0d0a 2020 2020 2020 2020 2020 2020 2320  ..            # 
-000092c0: 506f 7369 7469 6f6e 2069 7320 6265 666f  Position is befo
-000092d0: 7265 2074 6865 2063 7572 7265 6e74 2070  re the current p
-000092e0: 6f73 6974 696f 6e2e 2052 6573 6574 2074  osition. Reset t
-000092f0: 6865 205a 6970 4578 7446 696c 650d 0a20  he ZipExtFile.. 
-00009300: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-00009310: 5f66 696c 656f 626a 2e73 6565 6b28 7365  _fileobj.seek(se
-00009320: 6c66 2e5f 6f72 6967 5f63 6f6d 7072 6573  lf._orig_compres
-00009330: 735f 7374 6172 7429 0d0a 2020 2020 2020  s_start)..      
-00009340: 2020 2020 2020 7365 6c66 2e5f 7275 6e6e        self._runn
-00009350: 696e 675f 6372 6320 3d20 7365 6c66 2e5f  ing_crc = self._
-00009360: 6f72 6967 5f73 7461 7274 5f63 7263 0d0a  orig_start_crc..
-00009370: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00009380: 2e5f 636f 6d70 7265 7373 5f6c 6566 7420  ._compress_left 
-00009390: 3d20 7365 6c66 2e5f 6f72 6967 5f63 6f6d  = self._orig_com
-000093a0: 7072 6573 735f 7369 7a65 0d0a 2020 2020  press_size..    
-000093b0: 2020 2020 2020 2020 7365 6c66 2e5f 6c65          self._le
-000093c0: 6674 203d 2073 656c 662e 5f6f 7269 675f  ft = self._orig_
-000093d0: 6669 6c65 5f73 697a 650d 0a20 2020 2020  file_size..     
-000093e0: 2020 2020 2020 2073 656c 662e 5f72 6561         self._rea
-000093f0: 6462 7566 6665 7220 3d20 6222 220d 0a20  dbuffer = b"".. 
-00009400: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-00009410: 5f6f 6666 7365 7420 3d20 300d 0a20 2020  _offset = 0..   
-00009420: 2020 2020 2020 2020 2073 656c 662e 5f64           self._d
-00009430: 6563 6f6d 7072 6573 736f 7220 3d20 5f67  ecompressor = _g
-00009440: 6574 5f64 6563 6f6d 7072 6573 736f 7228  et_decompressor(
-00009450: 7365 6c66 2e5f 636f 6d70 7265 7373 5f74  self._compress_t
-00009460: 7970 6529 0d0a 2020 2020 2020 2020 2020  ype)..          
-00009470: 2020 7365 6c66 2e5f 656f 6620 3d20 4661    self._eof = Fa
-00009480: 6c73 650d 0a20 2020 2020 2020 2020 2020  lse..           
-00009490: 2072 6561 645f 6f66 6673 6574 203d 206e   read_offset = n
-000094a0: 6577 5f70 6f73 0d0a 2020 2020 2020 2020  ew_pos..        
-000094b0: 2020 2020 6966 2073 656c 662e 5f64 6563      if self._dec
-000094c0: 7279 7074 6572 2069 7320 6e6f 7420 4e6f  rypter is not No
-000094d0: 6e65 3a0d 0a20 2020 2020 2020 2020 2020  ne:..           
-000094e0: 2020 2020 2073 656c 662e 5f69 6e69 745f       self._init_
-000094f0: 6465 6372 7970 7465 7228 290d 0a0d 0a20  decrypter().... 
-00009500: 2020 2020 2020 2077 6869 6c65 2072 6561         while rea
-00009510: 645f 6f66 6673 6574 203e 2030 3a0d 0a20  d_offset > 0:.. 
-00009520: 2020 2020 2020 2020 2020 2072 6561 645f             read_
-00009530: 6c65 6e20 3d20 6d69 6e28 7365 6c66 2e4d  len = min(self.M
-00009540: 4158 5f53 4545 4b5f 5245 4144 2c20 7265  AX_SEEK_READ, re
-00009550: 6164 5f6f 6666 7365 7429 0d0a 2020 2020  ad_offset)..    
-00009560: 2020 2020 2020 2020 7365 6c66 2e72 6561          self.rea
-00009570: 6428 7265 6164 5f6c 656e 290d 0a20 2020  d(read_len)..   
-00009580: 2020 2020 2020 2020 2072 6561 645f 6f66           read_of
-00009590: 6673 6574 202d 3d20 7265 6164 5f6c 656e  fset -= read_len
-000095a0: 0d0a 0d0a 2020 2020 2020 2020 7265 7475  ....        retu
-000095b0: 726e 2073 656c 662e 7465 6c6c 2829 0d0a  rn self.tell()..
-000095c0: 0d0a 2020 2020 6465 6620 7465 6c6c 2873  ..    def tell(s
-000095d0: 656c 6629 3a0d 0a20 2020 2020 2020 2069  elf):..        i
-000095e0: 6620 7365 6c66 2e63 6c6f 7365 643a 0d0a  f self.closed:..
-000095f0: 2020 2020 2020 2020 2020 2020 7261 6973              rais
-00009600: 6520 5661 6c75 6545 7272 6f72 2822 7465  e ValueError("te
-00009610: 6c6c 206f 6e20 636c 6f73 6564 2066 696c  ll on closed fil
-00009620: 652e 2229 0d0a 2020 2020 2020 2020 6966  e.")..        if
-00009630: 206e 6f74 2073 656c 662e 5f73 6565 6b61   not self._seeka
-00009640: 626c 653a 0d0a 2020 2020 2020 2020 2020  ble:..          
-00009650: 2020 7261 6973 6520 696f 2e55 6e73 7570    raise io.Unsup
-00009660: 706f 7274 6564 4f70 6572 6174 696f 6e28  portedOperation(
-00009670: 2275 6e64 6572 6c79 696e 6720 7374 7265  "underlying stre
-00009680: 616d 2069 7320 6e6f 7420 7365 656b 6162  am is not seekab
-00009690: 6c65 2229 0d0a 2020 2020 2020 2020 6669  le")..        fi
-000096a0: 6c65 706f 7320 3d20 280d 0a20 2020 2020  lepos = (..     
-000096b0: 2020 2020 2020 2073 656c 662e 5f6f 7269         self._ori
-000096c0: 675f 6669 6c65 5f73 697a 650d 0a20 2020  g_file_size..   
-000096d0: 2020 2020 2020 2020 202d 2073 656c 662e           - self.
-000096e0: 5f6c 6566 740d 0a20 2020 2020 2020 2020  _left..         
-000096f0: 2020 202d 206c 656e 2873 656c 662e 5f72     - len(self._r
-00009700: 6561 6462 7566 6665 7229 0d0a 2020 2020  eadbuffer)..    
-00009710: 2020 2020 2020 2020 2b20 7365 6c66 2e5f          + self._
-00009720: 6f66 6673 6574 0d0a 2020 2020 2020 2020  offset..        
-00009730: 290d 0a20 2020 2020 2020 2072 6574 7572  )..        retur
-00009740: 6e20 6669 6c65 706f 730d 0a0d 0a0d 0a63  n filepos......c
-00009750: 6c61 7373 205f 5a69 7057 7269 7465 4669  lass _ZipWriteFi
-00009760: 6c65 2869 6f2e 4275 6666 6572 6564 494f  le(io.BufferedIO
-00009770: 4261 7365 293a 0d0a 2020 2020 6465 6620  Base):..    def 
-00009780: 5f5f 696e 6974 5f5f 2873 656c 662c 207a  __init__(self, z
-00009790: 662c 207a 696e 666f 2c20 7a69 7036 3429  f, zinfo, zip64)
-000097a0: 202d 3e20 4e6f 6e65 3a0d 0a20 2020 2020   -> None:..     
-000097b0: 2020 2073 656c 662e 5f7a 696e 666f 203d     self._zinfo =
-000097c0: 207a 696e 666f 0d0a 2020 2020 2020 2020   zinfo..        
-000097d0: 7365 6c66 2e5f 7a69 7036 3420 3d20 7a69  self._zip64 = zi
-000097e0: 7036 340d 0a20 2020 2020 2020 2073 656c  p64..        sel
-000097f0: 662e 5f7a 6970 6669 6c65 203d 207a 660d  f._zipfile = zf.
-00009800: 0a20 2020 2020 2020 2073 656c 662e 5f63  .        self._c
-00009810: 6f6d 7072 6573 736f 7220 3d20 5f67 6574  ompressor = _get
-00009820: 5f63 6f6d 7072 6573 736f 7228 0d0a 2020  _compressor(..  
-00009830: 2020 2020 2020 2020 2020 7a69 6e66 6f2e            zinfo.
-00009840: 636f 6d70 7265 7373 5f74 7970 652c 0d0a  compress_type,..
-00009850: 2020 2020 2020 2020 2020 2020 7a69 6e66              zinf
-00009860: 6f2e 5f63 6f6d 7072 6573 736c 6576 656c  o._compresslevel
-00009870: 2c0d 0a20 2020 2020 2020 2029 0d0a 2020  ,..        )..  
-00009880: 2020 2020 2020 7365 6c66 2e5f 6669 6c65        self._file
-00009890: 5f73 697a 6520 3d20 300d 0a20 2020 2020  _size = 0..     
-000098a0: 2020 2073 656c 662e 5f63 6f6d 7072 6573     self._compres
-000098b0: 735f 7369 7a65 203d 2030 0d0a 2020 2020  s_size = 0..    
-000098c0: 2020 2020 7365 6c66 2e5f 6372 6320 3d20      self._crc = 
-000098d0: 300d 0a0d 0a20 2020 2040 7072 6f70 6572  0....    @proper
-000098e0: 7479 0d0a 2020 2020 6465 6620 5f66 696c  ty..    def _fil
-000098f0: 656f 626a 2873 656c 6629 3a0d 0a20 2020  eobj(self):..   
-00009900: 2020 2020 2072 6574 7572 6e20 7365 6c66       return self
-00009910: 2e5f 7a69 7066 696c 652e 6670 0d0a 0d0a  ._zipfile.fp....
-00009920: 2020 2020 6465 6620 7772 6974 6162 6c65      def writable
-00009930: 2873 656c 6629 3a0d 0a20 2020 2020 2020  (self):..       
-00009940: 2072 6574 7572 6e20 5472 7565 0d0a 0d0a   return True....
-00009950: 2020 2020 6465 6620 7772 6974 6528 7365      def write(se
-00009960: 6c66 2c20 6461 7461 293a 0d0a 2020 2020  lf, data):..    
-00009970: 2020 2020 6966 2073 656c 662e 636c 6f73      if self.clos
-00009980: 6564 3a0d 0a20 2020 2020 2020 2020 2020  ed:..           
-00009990: 2072 6169 7365 2056 616c 7565 4572 726f   raise ValueErro
-000099a0: 7228 2249 2f4f 206f 7065 7261 7469 6f6e  r("I/O operation
-000099b0: 206f 6e20 636c 6f73 6564 2066 696c 652e   on closed file.
-000099c0: 2229 0d0a 2020 2020 2020 2020 6e62 7974  ")..        nbyt
-000099d0: 6573 203d 206c 656e 2864 6174 6129 0d0a  es = len(data)..
-000099e0: 2020 2020 2020 2020 7365 6c66 2e5f 6669          self._fi
-000099f0: 6c65 5f73 697a 6520 2b3d 206e 6279 7465  le_size += nbyte
-00009a00: 730d 0a20 2020 2020 2020 2073 656c 662e  s..        self.
-00009a10: 5f63 7263 203d 2063 7263 3332 2864 6174  _crc = crc32(dat
-00009a20: 612c 2073 656c 662e 5f63 7263 290d 0a20  a, self._crc).. 
-00009a30: 2020 2020 2020 2069 6620 7365 6c66 2e5f         if self._
-00009a40: 636f 6d70 7265 7373 6f72 3a0d 0a20 2020  compressor:..   
-00009a50: 2020 2020 2020 2020 2064 6174 6120 3d20           data = 
-00009a60: 7365 6c66 2e5f 636f 6d70 7265 7373 6f72  self._compressor
-00009a70: 2e63 6f6d 7072 6573 7328 6461 7461 290d  .compress(data).
-00009a80: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-00009a90: 662e 5f63 6f6d 7072 6573 735f 7369 7a65  f._compress_size
-00009aa0: 202b 3d20 6c65 6e28 6461 7461 290d 0a20   += len(data).. 
-00009ab0: 2020 2020 2020 2073 656c 662e 5f66 696c         self._fil
-00009ac0: 656f 626a 2e77 7269 7465 2864 6174 6129  eobj.write(data)
-00009ad0: 0d0a 2020 2020 2020 2020 7265 7475 726e  ..        return
-00009ae0: 206e 6279 7465 730d 0a0d 0a20 2020 2064   nbytes....    d
-00009af0: 6566 2063 6c6f 7365 2873 656c 6629 3a0d  ef close(self):.
-00009b00: 0a20 2020 2020 2020 2069 6620 7365 6c66  .        if self
-00009b10: 2e63 6c6f 7365 643a 0d0a 2020 2020 2020  .closed:..      
-00009b20: 2020 2020 2020 7265 7475 726e 0d0a 2020        return..  
-00009b30: 2020 2020 2020 7472 793a 0d0a 2020 2020        try:..    
-00009b40: 2020 2020 2020 2020 7375 7065 7228 292e          super().
-00009b50: 636c 6f73 6528 290d 0a20 2020 2020 2020  close()..       
-00009b60: 2020 2020 2023 2046 6c75 7368 2061 6e79       # Flush any
-00009b70: 2064 6174 6120 6672 6f6d 2074 6865 2063   data from the c
-00009b80: 6f6d 7072 6573 736f 722c 2061 6e64 2075  ompressor, and u
-00009b90: 7064 6174 6520 6865 6164 6572 2069 6e66  pdate header inf
-00009ba0: 6f0d 0a20 2020 2020 2020 2020 2020 2069  o..            i
-00009bb0: 6620 7365 6c66 2e5f 636f 6d70 7265 7373  f self._compress
-00009bc0: 6f72 3a0d 0a20 2020 2020 2020 2020 2020  or:..           
-00009bd0: 2020 2020 2062 7566 203d 2073 656c 662e       buf = self.
-00009be0: 5f63 6f6d 7072 6573 736f 722e 666c 7573  _compressor.flus
-00009bf0: 6828 290d 0a20 2020 2020 2020 2020 2020  h()..           
-00009c00: 2020 2020 2073 656c 662e 5f63 6f6d 7072       self._compr
-00009c10: 6573 735f 7369 7a65 202b 3d20 6c65 6e28  ess_size += len(
-00009c20: 6275 6629 0d0a 2020 2020 2020 2020 2020  buf)..          
-00009c30: 2020 2020 2020 7365 6c66 2e5f 6669 6c65        self._file
-00009c40: 6f62 6a2e 7772 6974 6528 6275 6629 0d0a  obj.write(buf)..
-00009c50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009c60: 7365 6c66 2e5f 7a69 6e66 6f2e 636f 6d70  self._zinfo.comp
-00009c70: 7265 7373 5f73 697a 6520 3d20 7365 6c66  ress_size = self
-00009c80: 2e5f 636f 6d70 7265 7373 5f73 697a 650d  ._compress_size.
-00009c90: 0a20 2020 2020 2020 2020 2020 2065 6c73  .            els
-00009ca0: 653a 0d0a 2020 2020 2020 2020 2020 2020  e:..            
-00009cb0: 2020 2020 7365 6c66 2e5f 7a69 6e66 6f2e      self._zinfo.
-00009cc0: 636f 6d70 7265 7373 5f73 697a 6520 3d20  compress_size = 
-00009cd0: 7365 6c66 2e5f 6669 6c65 5f73 697a 650d  self._file_size.
-00009ce0: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-00009cf0: 662e 5f7a 696e 666f 2e43 5243 203d 2073  f._zinfo.CRC = s
-00009d00: 656c 662e 5f63 7263 0d0a 2020 2020 2020  elf._crc..      
-00009d10: 2020 2020 2020 7365 6c66 2e5f 7a69 6e66        self._zinf
-00009d20: 6f2e 6669 6c65 5f73 697a 6520 3d20 7365  o.file_size = se
-00009d30: 6c66 2e5f 6669 6c65 5f73 697a 650d 0a0d  lf._file_size...
-00009d40: 0a20 2020 2020 2020 2020 2020 2023 2057  .            # W
-00009d50: 7269 7465 2075 7064 6174 6564 2068 6561  rite updated hea
-00009d60: 6465 7220 696e 666f 0d0a 2020 2020 2020  der info..      
-00009d70: 2020 2020 2020 6966 2073 656c 662e 5f7a        if self._z
-00009d80: 696e 666f 2e66 6c61 675f 6269 7473 2026  info.flag_bits &
-00009d90: 2030 7830 383a 0d0a 2020 2020 2020 2020   0x08:..        
-00009da0: 2020 2020 2020 2020 2320 5772 6974 6520          # Write 
-00009db0: 4352 4320 616e 6420 6669 6c65 2073 697a  CRC and file siz
-00009dc0: 6573 2061 6674 6572 2074 6865 2066 696c  es after the fil
-00009dd0: 6520 6461 7461 0d0a 2020 2020 2020 2020  e data..        
-00009de0: 2020 2020 2020 2020 666d 7420 3d20 223c          fmt = "<
-00009df0: 4c4c 5151 2220 6966 2073 656c 662e 5f7a  LLQQ" if self._z
-00009e00: 6970 3634 2065 6c73 6520 223c 4c4c 4c4c  ip64 else "<LLLL
-00009e10: 220d 0a20 2020 2020 2020 2020 2020 2020  "..             
-00009e20: 2020 2073 656c 662e 5f66 696c 656f 626a     self._fileobj
-00009e30: 2e77 7269 7465 280d 0a20 2020 2020 2020  .write(..       
-00009e40: 2020 2020 2020 2020 2020 2020 2073 7472               str
-00009e50: 7563 742e 7061 636b 280d 0a20 2020 2020  uct.pack(..     
-00009e60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009e70: 2020 2066 6d74 2c0d 0a20 2020 2020 2020     fmt,..       
-00009e80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009e90: 205f 4444 5f53 4947 4e41 5455 5245 2c0d   _DD_SIGNATURE,.
-00009ea0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00009eb0: 2020 2020 2020 2020 2073 656c 662e 5f7a           self._z
-00009ec0: 696e 666f 2e43 5243 2c0d 0a20 2020 2020  info.CRC,..     
-00009ed0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009ee0: 2020 2073 656c 662e 5f7a 696e 666f 2e63     self._zinfo.c
-00009ef0: 6f6d 7072 6573 735f 7369 7a65 2c0d 0a20  ompress_size,.. 
-00009f00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009f10: 2020 2020 2020 2073 656c 662e 5f7a 696e         self._zin
-00009f20: 666f 2e66 696c 655f 7369 7a65 2c0d 0a20  fo.file_size,.. 
-00009f30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009f40: 2020 2029 2c0d 0a20 2020 2020 2020 2020     ),..         
-00009f50: 2020 2020 2020 2029 0d0a 2020 2020 2020         )..      
-00009f60: 2020 2020 2020 2020 2020 7365 6c66 2e5f            self._
-00009f70: 7a69 7066 696c 652e 7374 6172 745f 6469  zipfile.start_di
-00009f80: 7220 3d20 7365 6c66 2e5f 6669 6c65 6f62  r = self._fileob
-00009f90: 6a2e 7465 6c6c 2829 0d0a 2020 2020 2020  j.tell()..      
-00009fa0: 2020 2020 2020 656c 7365 3a0d 0a20 2020        else:..   
-00009fb0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-00009fc0: 6e6f 7420 7365 6c66 2e5f 7a69 7036 343a  not self._zip64:
-00009fd0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00009fe0: 2020 2020 2020 6966 2073 656c 662e 5f66        if self._f
-00009ff0: 696c 655f 7369 7a65 203e 205a 4950 3634  ile_size > ZIP64
-0000a000: 5f4c 494d 4954 3a0d 0a20 2020 2020 2020  _LIMIT:..       
-0000a010: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a020: 2072 6169 7365 2052 756e 7469 6d65 4572   raise RuntimeEr
-0000a030: 726f 7228 0d0a 2020 2020 2020 2020 2020  ror(..          
-0000a040: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a050: 2020 2246 696c 6520 7369 7a65 2075 6e65    "File size une
-0000a060: 7870 6563 7465 646c 7920 6578 6365 6564  xpectedly exceed
-0000a070: 6564 205a 4950 3634 206c 696d 6974 222c  ed ZIP64 limit",
-0000a080: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0000a090: 2020 2020 2020 2020 2020 290d 0a20 2020            )..   
-0000a0a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a0b0: 2069 6620 7365 6c66 2e5f 636f 6d70 7265   if self._compre
-0000a0c0: 7373 5f73 697a 6520 3e20 5a49 5036 345f  ss_size > ZIP64_
-0000a0d0: 4c49 4d49 543a 0d0a 2020 2020 2020 2020  LIMIT:..        
-0000a0e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a0f0: 7261 6973 6520 5275 6e74 696d 6545 7272  raise RuntimeErr
-0000a100: 6f72 280d 0a20 2020 2020 2020 2020 2020  or(..           
-0000a110: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a120: 2022 436f 6d70 7265 7373 6564 2073 697a   "Compressed siz
-0000a130: 6520 756e 6578 7065 6374 6564 6c79 2065  e unexpectedly e
-0000a140: 7863 6565 6465 6420 5a49 5036 3420 6c69  xceeded ZIP64 li
-0000a150: 6d69 7422 2c0d 0a20 2020 2020 2020 2020  mit",..         
-0000a160: 2020 2020 2020 2020 2020 2020 2020 2029                 )
-0000a170: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0000a180: 2020 2320 5365 656b 2062 6163 6b77 6172    # Seek backwar
-0000a190: 6473 2061 6e64 2077 7269 7465 2066 696c  ds and write fil
-0000a1a0: 6520 6865 6164 6572 2028 7768 6963 6820  e header (which 
-0000a1b0: 7769 6c6c 206e 6f77 2069 6e63 6c75 6465  will now include
-0000a1c0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0000a1d0: 2020 2320 636f 7272 6563 7420 4352 4320    # correct CRC 
-0000a1e0: 616e 6420 6669 6c65 2073 697a 6573 290d  and file sizes).
-0000a1f0: 0a0d 0a20 2020 2020 2020 2020 2020 2020  ...             
-0000a200: 2020 2023 2050 7265 7365 7276 6520 6375     # Preserve cu
-0000a210: 7272 656e 7420 706f 7369 7469 6f6e 2069  rrent position i
-0000a220: 6e20 6669 6c65 0d0a 2020 2020 2020 2020  n file..        
-0000a230: 2020 2020 2020 2020 7365 6c66 2e5f 7a69          self._zi
-0000a240: 7066 696c 652e 7374 6172 745f 6469 7220  pfile.start_dir 
-0000a250: 3d20 7365 6c66 2e5f 6669 6c65 6f62 6a2e  = self._fileobj.
-0000a260: 7465 6c6c 2829 0d0a 2020 2020 2020 2020  tell()..        
-0000a270: 2020 2020 2020 2020 7365 6c66 2e5f 6669          self._fi
-0000a280: 6c65 6f62 6a2e 7365 656b 2873 656c 662e  leobj.seek(self.
-0000a290: 5f7a 696e 666f 2e68 6561 6465 725f 6f66  _zinfo.header_of
-0000a2a0: 6673 6574 290d 0a20 2020 2020 2020 2020  fset)..         
-0000a2b0: 2020 2020 2020 2073 656c 662e 5f66 696c         self._fil
-0000a2c0: 656f 626a 2e77 7269 7465 2873 656c 662e  eobj.write(self.
-0000a2d0: 5f7a 696e 666f 2e46 696c 6548 6561 6465  _zinfo.FileHeade
-0000a2e0: 7228 7365 6c66 2e5f 7a69 7036 3429 290d  r(self._zip64)).
-0000a2f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000a300: 2073 656c 662e 5f66 696c 656f 626a 2e73   self._fileobj.s
-0000a310: 6565 6b28 7365 6c66 2e5f 7a69 7066 696c  eek(self._zipfil
-0000a320: 652e 7374 6172 745f 6469 7229 0d0a 0d0a  e.start_dir)....
-0000a330: 2020 2020 2020 2020 2020 2020 2320 5375              # Su
-0000a340: 6363 6573 7366 756c 6c79 2077 7269 7474  ccessfully writt
-0000a350: 656e 3a20 4164 6420 6669 6c65 2074 6f20  en: Add file to 
-0000a360: 6f75 7220 6361 6368 6573 0d0a 2020 2020  our caches..    
-0000a370: 2020 2020 2020 2020 7365 6c66 2e5f 7a69          self._zi
-0000a380: 7066 696c 652e 6669 6c65 6c69 7374 2e61  pfile.filelist.a
-0000a390: 7070 656e 6428 7365 6c66 2e5f 7a69 6e66  ppend(self._zinf
-0000a3a0: 6f29 0d0a 2020 2020 2020 2020 2020 2020  o)..            
-0000a3b0: 7365 6c66 2e5f 7a69 7066 696c 652e 4e61  self._zipfile.Na
-0000a3c0: 6d65 546f 496e 666f 5b73 656c 662e 5f7a  meToInfo[self._z
-0000a3d0: 696e 666f 2e66 696c 656e 616d 655d 203d  info.filename] =
-0000a3e0: 2073 656c 662e 5f7a 696e 666f 0d0a 2020   self._zinfo..  
-0000a3f0: 2020 2020 2020 6669 6e61 6c6c 793a 0d0a        finally:..
-0000a400: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-0000a410: 2e5f 7a69 7066 696c 652e 5f77 7269 7469  ._zipfile._writi
-0000a420: 6e67 203d 2046 616c 7365 0d0a 0d0a 0d0a  ng = False......
-0000a430: 636c 6173 7320 5a69 7046 696c 653a 0d0a  class ZipFile:..
-0000a440: 2020 2020 2222 2243 6c61 7373 2077 6974      """Class wit
-0000a450: 6820 6d65 7468 6f64 7320 746f 206f 7065  h methods to ope
-0000a460: 6e2c 2072 6561 642c 2077 7269 7465 2c20  n, read, write, 
-0000a470: 636c 6f73 652c 206c 6973 7420 7a69 7020  close, list zip 
-0000a480: 6669 6c65 732e 0d0a 0d0a 2020 2020 7a20  files.....    z 
-0000a490: 3d20 5a69 7046 696c 6528 6669 6c65 2c20  = ZipFile(file, 
-0000a4a0: 6d6f 6465 3d22 7222 2c20 636f 6d70 7265  mode="r", compre
-0000a4b0: 7373 696f 6e3d 5a49 505f 5354 4f52 4544  ssion=ZIP_STORED
-0000a4c0: 2c20 616c 6c6f 775a 6970 3634 3d54 7275  , allowZip64=Tru
-0000a4d0: 652c 0d0a 2020 2020 2020 2020 2020 2020  e,..            
-0000a4e0: 2020 2020 636f 6d70 7265 7373 6c65 7665      compressleve
-0000a4f0: 6c3d 4e6f 6e65 290d 0a0d 0a20 2020 2066  l=None)....    f
-0000a500: 696c 653a 2045 6974 6865 7220 7468 6520  ile: Either the 
-0000a510: 7061 7468 2074 6f20 7468 6520 6669 6c65  path to the file
-0000a520: 2c20 6f72 2061 2066 696c 652d 6c69 6b65  , or a file-like
-0000a530: 206f 626a 6563 742e 0d0a 2020 2020 2020   object...      
-0000a540: 2020 2020 4966 2069 7420 6973 2061 2070      If it is a p
-0000a550: 6174 682c 2074 6865 2066 696c 6520 7769  ath, the file wi
-0000a560: 6c6c 2062 6520 6f70 656e 6564 2061 6e64  ll be opened and
-0000a570: 2063 6c6f 7365 6420 6279 205a 6970 4669   closed by ZipFi
-0000a580: 6c65 2e0d 0a20 2020 206d 6f64 653a 2054  le...    mode: T
-0000a590: 6865 206d 6f64 6520 6361 6e20 6265 2065  he mode can be e
-0000a5a0: 6974 6865 7220 7265 6164 2027 7227 2c20  ither read 'r', 
-0000a5b0: 7772 6974 6520 2777 272c 2065 7863 6c75  write 'w', exclu
-0000a5c0: 7369 7665 2063 7265 6174 6520 2778 272c  sive create 'x',
-0000a5d0: 0d0a 2020 2020 2020 2020 2020 6f72 2061  ..          or a
-0000a5e0: 7070 656e 6420 2761 272e 0d0a 2020 2020  ppend 'a'...    
-0000a5f0: 636f 6d70 7265 7373 696f 6e3a 205a 4950  compression: ZIP
-0000a600: 5f53 544f 5245 4420 286e 6f20 636f 6d70  _STORED (no comp
-0000a610: 7265 7373 696f 6e29 2c20 5a49 505f 4445  ression), ZIP_DE
-0000a620: 464c 4154 4544 2028 7265 7175 6972 6573  FLATED (requires
-0000a630: 207a 6c69 6229 2c0d 0a20 2020 2020 2020   zlib),..       
-0000a640: 2020 2020 2020 2020 2020 5a49 505f 425a            ZIP_BZ
-0000a650: 4950 3220 2872 6571 7569 7265 7320 627a  IP2 (requires bz
-0000a660: 3229 206f 7220 5a49 505f 4c5a 4d41 2028  2) or ZIP_LZMA (
-0000a670: 7265 7175 6972 6573 206c 7a6d 6129 2e0d  requires lzma)..
-0000a680: 0a20 2020 2061 6c6c 6f77 5a69 7036 343a  .    allowZip64:
-0000a690: 2069 6620 5472 7565 205a 6970 4669 6c65   if True ZipFile
-0000a6a0: 2077 696c 6c20 6372 6561 7465 2066 696c   will create fil
-0000a6b0: 6573 2077 6974 6820 5a49 5036 3420 6578  es with ZIP64 ex
-0000a6c0: 7465 6e73 696f 6e73 2077 6865 6e0d 0a20  tensions when.. 
-0000a6d0: 2020 2020 2020 2020 2020 2020 2020 206e                 n
-0000a6e0: 6565 6465 642c 206f 7468 6572 7769 7365  eeded, otherwise
-0000a6f0: 2069 7420 7769 6c6c 2072 6169 7365 2061   it will raise a
-0000a700: 6e20 6578 6365 7074 696f 6e20 7768 656e  n exception when
-0000a710: 2074 6869 7320 776f 756c 640d 0a20 2020   this would..   
-0000a720: 2020 2020 2020 2020 2020 2020 2062 6520               be 
-0000a730: 6e65 6365 7373 6172 792e 0d0a 2020 2020  necessary...    
-0000a740: 636f 6d70 7265 7373 6c65 7665 6c3a 204e  compresslevel: N
-0000a750: 6f6e 6520 2864 6566 6175 6c74 2066 6f72  one (default for
-0000a760: 2074 6865 2067 6976 656e 2063 6f6d 7072   the given compr
-0000a770: 6573 7369 6f6e 2074 7970 6529 206f 7220  ession type) or 
-0000a780: 616e 2069 6e74 6567 6572 0d0a 2020 2020  an integer..    
-0000a790: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-0000a7a0: 7065 6369 6679 696e 6720 7468 6520 6c65  pecifying the le
-0000a7b0: 7665 6c20 746f 2070 6173 7320 746f 2074  vel to pass to t
-0000a7c0: 6865 2063 6f6d 7072 6573 736f 722e 0d0a  he compressor...
-0000a7d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a7e0: 2020 2057 6865 6e20 7573 696e 6720 5a49     When using ZI
-0000a7f0: 505f 5354 4f52 4544 206f 7220 5a49 505f  P_STORED or ZIP_
-0000a800: 4c5a 4d41 2074 6869 7320 6b65 7977 6f72  LZMA this keywor
-0000a810: 6420 6861 7320 6e6f 2065 6666 6563 742e  d has no effect.
-0000a820: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0000a830: 2020 2020 2057 6865 6e20 7573 696e 6720       When using 
-0000a840: 5a49 505f 4445 464c 4154 4544 2069 6e74  ZIP_DEFLATED int
-0000a850: 6567 6572 7320 3020 7468 726f 7567 6820  egers 0 through 
-0000a860: 3920 6172 6520 6163 6365 7074 6564 2e0d  9 are accepted..
-0000a870: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000a880: 2020 2020 5768 656e 2075 7369 6e67 205a      When using Z
-0000a890: 4950 5f42 5a49 5032 2069 6e74 6567 6572  IP_BZIP2 integer
-0000a8a0: 7320 3120 7468 726f 7567 6820 3920 6172  s 1 through 9 ar
-0000a8b0: 6520 6163 6365 7074 6564 2e0d 0a0d 0a20  e accepted..... 
-0000a8c0: 2020 2022 2222 0d0a 0d0a 2020 2020 6670     """....    fp
-0000a8d0: 203d 204e 6f6e 6520 2023 2053 6574 2068   = None  # Set h
-0000a8e0: 6572 6520 7369 6e63 6520 5f5f 6465 6c5f  ere since __del_
-0000a8f0: 5f20 6368 6563 6b73 2069 740d 0a20 2020  _ checks it..   
-0000a900: 205f 7769 6e64 6f77 735f 696c 6c65 6761   _windows_illega
-0000a910: 6c5f 6e61 6d65 5f74 7261 6e73 5f74 6162  l_name_trans_tab
-0000a920: 6c65 203d 204e 6f6e 650d 0a0d 0a20 2020  le = None....   
-0000a930: 2064 6566 205f 5f69 6e69 745f 5f28 0d0a   def __init__(..
-0000a940: 2020 2020 2020 2020 7365 6c66 2c0d 0a20          self,.. 
-0000a950: 2020 2020 2020 2066 696c 652c 0d0a 2020         file,..  
-0000a960: 2020 2020 2020 6d6f 6465 3d22 7222 2c0d        mode="r",.
-0000a970: 0a20 2020 2020 2020 2063 6f6d 7072 6573  .        compres
-0000a980: 7369 6f6e 3d5a 4950 5f53 544f 5245 442c  sion=ZIP_STORED,
-0000a990: 0d0a 2020 2020 2020 2020 616c 6c6f 775a  ..        allowZ
-0000a9a0: 6970 3634 3d54 7275 652c 0d0a 2020 2020  ip64=True,..    
-0000a9b0: 2020 2020 636f 6d70 7265 7373 6c65 7665      compressleve
-0000a9c0: 6c3d 4e6f 6e65 2c0d 0a20 2020 2020 2020  l=None,..       
-0000a9d0: 202a 2c0d 0a20 2020 2020 2020 2073 7472   *,..        str
-0000a9e0: 6963 745f 7469 6d65 7374 616d 7073 3d54  ict_timestamps=T
-0000a9f0: 7275 652c 0d0a 2020 2020 2920 2d3e 204e  rue,..    ) -> N
-0000aa00: 6f6e 653a 0d0a 2020 2020 2020 2020 2222  one:..        ""
-0000aa10: 224f 7065 6e20 7468 6520 5a49 5020 6669  "Open the ZIP fi
-0000aa20: 6c65 2077 6974 6820 6d6f 6465 2072 6561  le with mode rea
-0000aa30: 6420 2772 272c 2077 7269 7465 2027 7727  d 'r', write 'w'
-0000aa40: 2c20 6578 636c 7573 6976 6520 6372 6561  , exclusive crea
-0000aa50: 7465 2027 7827 2c0d 0a20 2020 2020 2020  te 'x',..       
-0000aa60: 206f 7220 6170 7065 6e64 2027 6127 2e0d   or append 'a'..
-0000aa70: 0a20 2020 2020 2020 2022 2222 0d0a 2020  .        """..  
-0000aa80: 2020 2020 2020 6966 206d 6f64 6520 6e6f        if mode no
-0000aa90: 7420 696e 2028 2272 222c 2022 7722 2c20  t in ("r", "w", 
-0000aaa0: 2278 222c 2022 6122 293a 0d0a 2020 2020  "x", "a"):..    
-0000aab0: 2020 2020 2020 2020 7261 6973 6520 5661          raise Va
-0000aac0: 6c75 6545 7272 6f72 2822 5a69 7046 696c  lueError("ZipFil
-0000aad0: 6520 7265 7175 6972 6573 206d 6f64 6520  e requires mode 
-0000aae0: 2772 272c 2027 7727 2c20 2778 272c 206f  'r', 'w', 'x', o
-0000aaf0: 7220 2761 2722 290d 0a0d 0a20 2020 2020  r 'a'")....     
-0000ab00: 2020 205f 6368 6563 6b5f 636f 6d70 7265     _check_compre
-0000ab10: 7373 696f 6e28 636f 6d70 7265 7373 696f  ssion(compressio
-0000ab20: 6e29 0d0a 0d0a 2020 2020 2020 2020 7365  n)....        se
-0000ab30: 6c66 2e5f 616c 6c6f 775a 6970 3634 203d  lf._allowZip64 =
-0000ab40: 2061 6c6c 6f77 5a69 7036 340d 0a20 2020   allowZip64..   
-0000ab50: 2020 2020 2073 656c 662e 5f64 6964 4d6f       self._didMo
-0000ab60: 6469 6679 203d 2046 616c 7365 0d0a 2020  dify = False..  
-0000ab70: 2020 2020 2020 7365 6c66 2e64 6562 7567        self.debug
-0000ab80: 203d 2030 2020 2320 4c65 7665 6c20 6f66   = 0  # Level of
-0000ab90: 2070 7269 6e74 696e 673a 2030 2074 6872   printing: 0 thr
-0000aba0: 6f75 6768 2033 0d0a 2020 2020 2020 2020  ough 3..        
-0000abb0: 7365 6c66 2e4e 616d 6554 6f49 6e66 6f20  self.NameToInfo 
-0000abc0: 3d20 7b7d 2020 2320 4669 6e64 2066 696c  = {}  # Find fil
-0000abd0: 6520 696e 666f 2067 6976 656e 206e 616d  e info given nam
-0000abe0: 650d 0a20 2020 2020 2020 2073 656c 662e  e..        self.
-0000abf0: 6669 6c65 6c69 7374 203d 205b 5d20 2023  filelist = []  #
-0000ac00: 204c 6973 7420 6f66 205a 6970 496e 666f   List of ZipInfo
-0000ac10: 2069 6e73 7461 6e63 6573 2066 6f72 2061   instances for a
-0000ac20: 7263 6869 7665 0d0a 2020 2020 2020 2020  rchive..        
-0000ac30: 7365 6c66 2e63 6f6d 7072 6573 7369 6f6e  self.compression
-0000ac40: 203d 2063 6f6d 7072 6573 7369 6f6e 2020   = compression  
-0000ac50: 2320 4d65 7468 6f64 206f 6620 636f 6d70  # Method of comp
-0000ac60: 7265 7373 696f 6e0d 0a20 2020 2020 2020  ression..       
-0000ac70: 2073 656c 662e 636f 6d70 7265 7373 6c65   self.compressle
-0000ac80: 7665 6c20 3d20 636f 6d70 7265 7373 6c65  vel = compressle
-0000ac90: 7665 6c0d 0a20 2020 2020 2020 2073 656c  vel..        sel
-0000aca0: 662e 6d6f 6465 203d 206d 6f64 650d 0a20  f.mode = mode.. 
-0000acb0: 2020 2020 2020 2073 656c 662e 7077 6420         self.pwd 
-0000acc0: 3d20 4e6f 6e65 0d0a 2020 2020 2020 2020  = None..        
-0000acd0: 7365 6c66 2e5f 636f 6d6d 656e 7420 3d20  self._comment = 
-0000ace0: 6222 220d 0a20 2020 2020 2020 2073 656c  b""..        sel
-0000acf0: 662e 5f73 7472 6963 745f 7469 6d65 7374  f._strict_timest
-0000ad00: 616d 7073 203d 2073 7472 6963 745f 7469  amps = strict_ti
-0000ad10: 6d65 7374 616d 7073 0d0a 0d0a 2020 2020  mestamps....    
-0000ad20: 2020 2020 2320 4368 6563 6b20 6966 2077      # Check if w
-0000ad30: 6520 7765 7265 2070 6173 7365 6420 6120  e were passed a 
-0000ad40: 6669 6c65 2d6c 696b 6520 6f62 6a65 6374  file-like object
-0000ad50: 0d0a 2020 2020 2020 2020 6966 2069 7369  ..        if isi
-0000ad60: 6e73 7461 6e63 6528 6669 6c65 2c20 6f73  nstance(file, os
-0000ad70: 2e50 6174 684c 696b 6529 3a0d 0a20 2020  .PathLike):..   
-0000ad80: 2020 2020 2020 2020 2066 696c 6520 3d20           file = 
-0000ad90: 6f73 2e66 7370 6174 6828 6669 6c65 290d  os.fspath(file).
-0000ada0: 0a20 2020 2020 2020 2069 6620 6973 696e  .        if isin
-0000adb0: 7374 616e 6365 2866 696c 652c 2073 7472  stance(file, str
-0000adc0: 293a 0d0a 2020 2020 2020 2020 2020 2020  ):..            
-0000add0: 2320 4e6f 2c20 6974 2773 2061 2066 696c  # No, it's a fil
-0000ade0: 656e 616d 650d 0a20 2020 2020 2020 2020  ename..         
-0000adf0: 2020 2073 656c 662e 5f66 696c 6550 6173     self._filePas
-0000ae00: 7365 6420 3d20 300d 0a20 2020 2020 2020  sed = 0..       
-0000ae10: 2020 2020 2073 656c 662e 6669 6c65 6e61       self.filena
-0000ae20: 6d65 203d 2066 696c 650d 0a20 2020 2020  me = file..     
-0000ae30: 2020 2020 2020 206d 6f64 6544 6963 7420         modeDict 
-0000ae40: 3d20 7b0d 0a20 2020 2020 2020 2020 2020  = {..           
-0000ae50: 2020 2020 2022 7222 3a20 2272 6222 2c0d       "r": "rb",.
-0000ae60: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000ae70: 2022 7722 3a20 2277 2b62 222c 0d0a 2020   "w": "w+b",..  
-0000ae80: 2020 2020 2020 2020 2020 2020 2020 2278                "x
-0000ae90: 223a 2022 782b 6222 2c0d 0a20 2020 2020  ": "x+b",..     
-0000aea0: 2020 2020 2020 2020 2020 2022 6122 3a20             "a": 
-0000aeb0: 2272 2b62 222c 0d0a 2020 2020 2020 2020  "r+b",..        
-0000aec0: 2020 2020 2020 2020 2272 2b62 223a 2022          "r+b": "
-0000aed0: 772b 6222 2c0d 0a20 2020 2020 2020 2020  w+b",..         
-0000aee0: 2020 2020 2020 2022 772b 6222 3a20 2277         "w+b": "w
-0000aef0: 6222 2c0d 0a20 2020 2020 2020 2020 2020  b",..           
-0000af00: 2020 2020 2022 782b 6222 3a20 2278 6222       "x+b": "xb"
-0000af10: 2c0d 0a20 2020 2020 2020 2020 2020 207d  ,..            }
-0000af20: 0d0a 2020 2020 2020 2020 2020 2020 6669  ..            fi
-0000af30: 6c65 6d6f 6465 203d 206d 6f64 6544 6963  lemode = modeDic
-0000af40: 745b 6d6f 6465 5d0d 0a20 2020 2020 2020  t[mode]..       
-0000af50: 2020 2020 2077 6869 6c65 2054 7275 653a       while True:
-0000af60: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0000af70: 2020 7472 793a 0d0a 2020 2020 2020 2020    try:..        
-0000af80: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-0000af90: 2e66 7020 3d20 696f 2e6f 7065 6e28 6669  .fp = io.open(fi
-0000afa0: 6c65 2c20 6669 6c65 6d6f 6465 290d 0a20  le, filemode).. 
-0000afb0: 2020 2020 2020 2020 2020 2020 2020 2065                 e
-0000afc0: 7863 6570 7420 4f53 4572 726f 723a 0d0a  xcept OSError:..
-0000afd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000afe0: 2020 2020 6966 2066 696c 656d 6f64 6520      if filemode 
-0000aff0: 696e 206d 6f64 6544 6963 743a 0d0a 2020  in modeDict:..  
-0000b000: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b010: 2020 2020 2020 6669 6c65 6d6f 6465 203d        filemode =
-0000b020: 206d 6f64 6544 6963 745b 6669 6c65 6d6f   modeDict[filemo
-0000b030: 6465 5d0d 0a20 2020 2020 2020 2020 2020  de]..           
-0000b040: 2020 2020 2020 2020 2020 2020 2063 6f6e               con
-0000b050: 7469 6e75 650d 0a20 2020 2020 2020 2020  tinue..         
-0000b060: 2020 2020 2020 2020 2020 2072 6169 7365             raise
-0000b070: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0000b080: 2020 6272 6561 6b0d 0a20 2020 2020 2020    break..       
-0000b090: 2065 6c73 653a 0d0a 2020 2020 2020 2020   else:..        
-0000b0a0: 2020 2020 7365 6c66 2e5f 6669 6c65 5061      self._filePa
-0000b0b0: 7373 6564 203d 2031 0d0a 2020 2020 2020  ssed = 1..      
-0000b0c0: 2020 2020 2020 7365 6c66 2e66 7020 3d20        self.fp = 
-0000b0d0: 6669 6c65 0d0a 2020 2020 2020 2020 2020  file..          
-0000b0e0: 2020 7365 6c66 2e66 696c 656e 616d 6520    self.filename 
-0000b0f0: 3d20 6765 7461 7474 7228 6669 6c65 2c20  = getattr(file, 
-0000b100: 226e 616d 6522 2c20 4e6f 6e65 290d 0a20  "name", None).. 
-0000b110: 2020 2020 2020 2073 656c 662e 5f66 696c         self._fil
-0000b120: 6552 6566 436e 7420 3d20 310d 0a20 2020  eRefCnt = 1..   
-0000b130: 2020 2020 2073 656c 662e 5f6c 6f63 6b20       self._lock 
-0000b140: 3d20 7468 7265 6164 696e 672e 524c 6f63  = threading.RLoc
-0000b150: 6b28 290d 0a20 2020 2020 2020 2073 656c  k()..        sel
-0000b160: 662e 5f73 6565 6b61 626c 6520 3d20 5472  f._seekable = Tr
-0000b170: 7565 0d0a 2020 2020 2020 2020 7365 6c66  ue..        self
-0000b180: 2e5f 7772 6974 696e 6720 3d20 4661 6c73  ._writing = Fals
-0000b190: 650d 0a0d 0a20 2020 2020 2020 2074 7279  e....        try
-0000b1a0: 3a0d 0a20 2020 2020 2020 2020 2020 2069  :..            i
-0000b1b0: 6620 6d6f 6465 203d 3d20 2272 223a 0d0a  f mode == "r":..
-0000b1c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b1d0: 7365 6c66 2e5f 5265 616c 4765 7443 6f6e  self._RealGetCon
-0000b1e0: 7465 6e74 7328 290d 0a20 2020 2020 2020  tents()..       
-0000b1f0: 2020 2020 2065 6c69 6620 6d6f 6465 2069       elif mode i
-0000b200: 6e20 2822 7722 2c20 2278 2229 3a0d 0a20  n ("w", "x"):.. 
-0000b210: 2020 2020 2020 2020 2020 2020 2020 2023                 #
-0000b220: 2073 6574 2074 6865 206d 6f64 6966 6965   set the modifie
-0000b230: 6420 666c 6167 2073 6f20 6365 6e74 7261  d flag so centra
-0000b240: 6c20 6469 7265 6374 6f72 7920 6765 7473  l directory gets
-0000b250: 2077 7269 7474 656e 0d0a 2020 2020 2020   written..      
-0000b260: 2020 2020 2020 2020 2020 2320 6576 656e            # even
-0000b270: 2069 6620 6e6f 2066 696c 6573 2061 7265   if no files are
-0000b280: 2061 6464 6564 2074 6f20 7468 6520 6172   added to the ar
-0000b290: 6368 6976 650d 0a20 2020 2020 2020 2020  chive..         
-0000b2a0: 2020 2020 2020 2073 656c 662e 5f64 6964         self._did
-0000b2b0: 4d6f 6469 6679 203d 2054 7275 650d 0a20  Modify = True.. 
-0000b2c0: 2020 2020 2020 2020 2020 2020 2020 2074                 t
-0000b2d0: 7279 3a0d 0a20 2020 2020 2020 2020 2020  ry:..           
-0000b2e0: 2020 2020 2020 2020 2073 656c 662e 7374           self.st
-0000b2f0: 6172 745f 6469 7220 3d20 7365 6c66 2e66  art_dir = self.f
-0000b300: 702e 7465 6c6c 2829 0d0a 2020 2020 2020  p.tell()..      
-0000b310: 2020 2020 2020 2020 2020 6578 6365 7074            except
-0000b320: 2028 4174 7472 6962 7574 6545 7272 6f72   (AttributeError
-0000b330: 2c20 4f53 4572 726f 7229 3a0d 0a20 2020  , OSError):..   
-0000b340: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b350: 2073 656c 662e 6670 203d 205f 5465 6c6c   self.fp = _Tell
-0000b360: 6162 6c65 2873 656c 662e 6670 290d 0a20  able(self.fp).. 
-0000b370: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b380: 2020 2073 656c 662e 7374 6172 745f 6469     self.start_di
-0000b390: 7220 3d20 300d 0a20 2020 2020 2020 2020  r = 0..         
-0000b3a0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-0000b3b0: 5f73 6565 6b61 626c 6520 3d20 4661 6c73  _seekable = Fals
-0000b3c0: 650d 0a20 2020 2020 2020 2020 2020 2020  e..             
-0000b3d0: 2020 2065 6c73 653a 0d0a 2020 2020 2020     else:..      
-0000b3e0: 2020 2020 2020 2020 2020 2020 2020 2320                # 
-0000b3f0: 536f 6d65 2066 696c 652d 6c69 6b65 206f  Some file-like o
-0000b400: 626a 6563 7473 2063 616e 2070 726f 7669  bjects can provi
-0000b410: 6465 2074 656c 6c28 2920 6275 7420 6e6f  de tell() but no
-0000b420: 7420 7365 656b 2829 0d0a 2020 2020 2020  t seek()..      
-0000b430: 2020 2020 2020 2020 2020 2020 2020 7472                tr
-0000b440: 793a 0d0a 2020 2020 2020 2020 2020 2020  y:..            
-0000b450: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-0000b460: 2e66 702e 7365 656b 2873 656c 662e 7374  .fp.seek(self.st
-0000b470: 6172 745f 6469 7229 0d0a 2020 2020 2020  art_dir)..      
-0000b480: 2020 2020 2020 2020 2020 2020 2020 6578                ex
-0000b490: 6365 7074 2028 4174 7472 6962 7574 6545  cept (AttributeE
-0000b4a0: 7272 6f72 2c20 4f53 4572 726f 7229 3a0d  rror, OSError):.
-0000b4b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000b4c0: 2020 2020 2020 2020 2073 656c 662e 5f73           self._s
-0000b4d0: 6565 6b61 626c 6520 3d20 4661 6c73 650d  eekable = False.
-0000b4e0: 0a20 2020 2020 2020 2020 2020 2065 6c69  .            eli
-0000b4f0: 6620 6d6f 6465 203d 3d20 2261 223a 0d0a  f mode == "a":..
-0000b500: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b510: 7472 793a 0d0a 2020 2020 2020 2020 2020  try:..          
-0000b520: 2020 2020 2020 2020 2020 2320 5365 6520            # See 
-0000b530: 6966 2066 696c 6520 6973 2061 207a 6970  if file is a zip
-0000b540: 2066 696c 650d 0a20 2020 2020 2020 2020   file..         
-0000b550: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-0000b560: 5f52 6561 6c47 6574 436f 6e74 656e 7473  _RealGetContents
-0000b570: 2829 0d0a 2020 2020 2020 2020 2020 2020  ()..            
-0000b580: 2020 2020 2020 2020 2320 7365 656b 2074          # seek t
-0000b590: 6f20 7374 6172 7420 6f66 2064 6972 6563  o start of direc
-0000b5a0: 746f 7279 2061 6e64 206f 7665 7277 7269  tory and overwri
-0000b5b0: 7465 0d0a 2020 2020 2020 2020 2020 2020  te..            
-0000b5c0: 2020 2020 2020 2020 7365 6c66 2e66 702e          self.fp.
-0000b5d0: 7365 656b 2873 656c 662e 7374 6172 745f  seek(self.start_
-0000b5e0: 6469 7229 0d0a 2020 2020 2020 2020 2020  dir)..          
-0000b5f0: 2020 2020 2020 6578 6365 7074 2042 6164        except Bad
-0000b600: 5a69 7046 696c 653a 0d0a 2020 2020 2020  ZipFile:..      
-0000b610: 2020 2020 2020 2020 2020 2020 2020 2320                # 
-0000b620: 6669 6c65 2069 7320 6e6f 7420 6120 7a69  file is not a zi
-0000b630: 7020 6669 6c65 2c20 6a75 7374 2061 7070  p file, just app
-0000b640: 656e 640d 0a20 2020 2020 2020 2020 2020  end..           
-0000b650: 2020 2020 2020 2020 2073 656c 662e 6670           self.fp
-0000b660: 2e73 6565 6b28 302c 2032 290d 0a0d 0a20  .seek(0, 2).... 
-0000b670: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b680: 2020 2023 2073 6574 2074 6865 206d 6f64     # set the mod
-0000b690: 6966 6965 6420 666c 6167 2073 6f20 6365  ified flag so ce
-0000b6a0: 6e74 7261 6c20 6469 7265 6374 6f72 7920  ntral directory 
-0000b6b0: 6765 7473 2077 7269 7474 656e 0d0a 2020  gets written..  
-0000b6c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b6d0: 2020 2320 6576 656e 2069 6620 6e6f 2066    # even if no f
-0000b6e0: 696c 6573 2061 7265 2061 6464 6564 2074  iles are added t
-0000b6f0: 6f20 7468 6520 6172 6368 6976 650d 0a20  o the archive.. 
-0000b700: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b710: 2020 2073 656c 662e 5f64 6964 4d6f 6469     self._didModi
-0000b720: 6679 203d 2054 7275 650d 0a20 2020 2020  fy = True..     
-0000b730: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-0000b740: 656c 662e 7374 6172 745f 6469 7220 3d20  elf.start_dir = 
-0000b750: 7365 6c66 2e66 702e 7465 6c6c 2829 0d0a  self.fp.tell()..
-0000b760: 2020 2020 2020 2020 2020 2020 656c 7365              else
-0000b770: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
-0000b780: 2020 2072 6169 7365 2056 616c 7565 4572     raise ValueEr
-0000b790: 726f 7228 224d 6f64 6520 6d75 7374 2062  ror("Mode must b
-0000b7a0: 6520 2772 272c 2027 7727 2c20 2778 272c  e 'r', 'w', 'x',
-0000b7b0: 206f 7220 2761 2722 290d 0a20 2020 2020   or 'a'")..     
-0000b7c0: 2020 2065 7863 6570 743a 0d0a 2020 2020     except:..    
-0000b7d0: 2020 2020 2020 2020 6670 203d 2073 656c          fp = sel
-0000b7e0: 662e 6670 0d0a 2020 2020 2020 2020 2020  f.fp..          
-0000b7f0: 2020 7365 6c66 2e66 7020 3d20 4e6f 6e65    self.fp = None
-0000b800: 0d0a 2020 2020 2020 2020 2020 2020 7365  ..            se
-0000b810: 6c66 2e5f 6670 636c 6f73 6528 6670 290d  lf._fpclose(fp).
-0000b820: 0a20 2020 2020 2020 2020 2020 2072 6169  .            rai
-0000b830: 7365 0d0a 0d0a 2020 2020 6465 6620 5f5f  se....    def __
-0000b840: 656e 7465 725f 5f28 7365 6c66 293a 0d0a  enter__(self):..
-0000b850: 2020 2020 2020 2020 7265 7475 726e 2073          return s
-0000b860: 656c 660d 0a0d 0a20 2020 2064 6566 205f  elf....    def _
-0000b870: 5f65 7869 745f 5f28 7365 6c66 2c20 7479  _exit__(self, ty
-0000b880: 7065 2c20 7661 6c75 652c 2074 7261 6365  pe, value, trace
-0000b890: 6261 636b 293a 0d0a 2020 2020 2020 2020  back):..        
-0000b8a0: 7365 6c66 2e63 6c6f 7365 2829 0d0a 0d0a  self.close()....
-0000b8b0: 2020 2020 6465 6620 5f5f 7265 7072 5f5f      def __repr__
-0000b8c0: 2873 656c 6629 202d 3e20 7374 723a 0d0a  (self) -> str:..
-0000b8d0: 2020 2020 2020 2020 7265 7375 6c74 203d          result =
-0000b8e0: 205b 0d0a 2020 2020 2020 2020 2020 2020   [..            
-0000b8f0: 6622 3c7b 7365 6c66 2e5f 5f63 6c61 7373  f"<{self.__class
-0000b900: 5f5f 2e5f 5f6d 6f64 756c 655f 5f7d 2e7b  __.__module__}.{
-0000b910: 7365 6c66 2e5f 5f63 6c61 7373 5f5f 2e5f  self.__class__._
-0000b920: 5f71 7561 6c6e 616d 655f 5f7d 222c 0d0a  _qualname__}",..
-0000b930: 2020 2020 2020 2020 5d0d 0a20 2020 2020          ]..     
-0000b940: 2020 2069 6620 7365 6c66 2e66 7020 6973     if self.fp is
-0000b950: 206e 6f74 204e 6f6e 653a 0d0a 2020 2020   not None:..    
-0000b960: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
-0000b970: 5f66 696c 6550 6173 7365 643a 0d0a 2020  _filePassed:..  
-0000b980: 2020 2020 2020 2020 2020 2020 2020 7265                re
-0000b990: 7375 6c74 2e61 7070 656e 6428 2220 6669  sult.append(" fi
-0000b9a0: 6c65 3d25 7222 2025 2073 656c 662e 6670  le=%r" % self.fp
-0000b9b0: 290d 0a20 2020 2020 2020 2020 2020 2065  )..            e
-0000b9c0: 6c69 6620 7365 6c66 2e66 696c 656e 616d  lif self.filenam
-0000b9d0: 6520 6973 206e 6f74 204e 6f6e 653a 0d0a  e is not None:..
-0000b9e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b9f0: 7265 7375 6c74 2e61 7070 656e 6428 2220  result.append(" 
-0000ba00: 6669 6c65 6e61 6d65 3d25 7222 2025 2073  filename=%r" % s
-0000ba10: 656c 662e 6669 6c65 6e61 6d65 290d 0a20  elf.filename).. 
-0000ba20: 2020 2020 2020 2020 2020 2072 6573 756c             resul
-0000ba30: 742e 6170 7065 6e64 2822 206d 6f64 653d  t.append(" mode=
-0000ba40: 2572 2220 2520 7365 6c66 2e6d 6f64 6529  %r" % self.mode)
-0000ba50: 0d0a 2020 2020 2020 2020 656c 7365 3a0d  ..        else:.
-0000ba60: 0a20 2020 2020 2020 2020 2020 2072 6573  .            res
-0000ba70: 756c 742e 6170 7065 6e64 2822 205b 636c  ult.append(" [cl
-0000ba80: 6f73 6564 5d22 290d 0a20 2020 2020 2020  osed]")..       
-0000ba90: 2072 6573 756c 742e 6170 7065 6e64 2822   result.append("
-0000baa0: 3e22 290d 0a20 2020 2020 2020 2072 6574  >")..        ret
-0000bab0: 7572 6e20 2222 2e6a 6f69 6e28 7265 7375  urn "".join(resu
-0000bac0: 6c74 290d 0a0d 0a20 2020 2064 6566 205f  lt)....    def _
-0000bad0: 5265 616c 4765 7443 6f6e 7465 6e74 7328  RealGetContents(
-0000bae0: 7365 6c66 293a 0d0a 2020 2020 2020 2020  self):..        
-0000baf0: 2222 2252 6561 6420 696e 2074 6865 2074  """Read in the t
-0000bb00: 6162 6c65 206f 6620 636f 6e74 656e 7473  able of contents
-0000bb10: 2066 6f72 2074 6865 205a 4950 2066 696c   for the ZIP fil
-0000bb20: 652e 2222 220d 0a20 2020 2020 2020 2066  e."""..        f
-0000bb30: 7020 3d20 7365 6c66 2e66 700d 0a20 2020  p = self.fp..   
-0000bb40: 2020 2020 2074 7279 3a0d 0a20 2020 2020       try:..     
-0000bb50: 2020 2020 2020 2065 6e64 7265 6320 3d20         endrec = 
-0000bb60: 5f45 6e64 5265 6344 6174 6128 6670 290d  _EndRecData(fp).
-0000bb70: 0a20 2020 2020 2020 2065 7863 6570 7420  .        except 
-0000bb80: 4f53 4572 726f 723a 0d0a 2020 2020 2020  OSError:..      
-0000bb90: 2020 2020 2020 7261 6973 6520 4261 645a        raise BadZ
-0000bba0: 6970 4669 6c65 2822 4669 6c65 2069 7320  ipFile("File is 
-0000bbb0: 6e6f 7420 6120 7a69 7020 6669 6c65 2229  not a zip file")
-0000bbc0: 0d0a 2020 2020 2020 2020 6966 206e 6f74  ..        if not
-0000bbd0: 2065 6e64 7265 633a 0d0a 2020 2020 2020   endrec:..      
-0000bbe0: 2020 2020 2020 7261 6973 6520 4261 645a        raise BadZ
-0000bbf0: 6970 4669 6c65 2822 4669 6c65 2069 7320  ipFile("File is 
-0000bc00: 6e6f 7420 6120 7a69 7020 6669 6c65 2229  not a zip file")
-0000bc10: 0d0a 2020 2020 2020 2020 6966 2073 656c  ..        if sel
-0000bc20: 662e 6465 6275 6720 3e20 313a 0d0a 2020  f.debug > 1:..  
-0000bc30: 2020 2020 2020 2020 2020 7072 696e 7428            print(
-0000bc40: 656e 6472 6563 290d 0a20 2020 2020 2020  endrec)..       
-0000bc50: 2073 697a 655f 6364 203d 2065 6e64 7265   size_cd = endre
-0000bc60: 635b 5f45 4344 5f53 495a 455d 2020 2320  c[_ECD_SIZE]  # 
-0000bc70: 6279 7465 7320 696e 2063 656e 7472 616c  bytes in central
-0000bc80: 2064 6972 6563 746f 7279 0d0a 2020 2020   directory..    
-0000bc90: 2020 2020 6f66 6673 6574 5f63 6420 3d20      offset_cd = 
-0000bca0: 656e 6472 6563 5b5f 4543 445f 4f46 4653  endrec[_ECD_OFFS
-0000bcb0: 4554 5d20 2023 206f 6666 7365 7420 6f66  ET]  # offset of
-0000bcc0: 2063 656e 7472 616c 2064 6972 6563 746f   central directo
-0000bcd0: 7279 0d0a 2020 2020 2020 2020 7365 6c66  ry..        self
-0000bce0: 2e5f 636f 6d6d 656e 7420 3d20 656e 6472  ._comment = endr
-0000bcf0: 6563 5b5f 4543 445f 434f 4d4d 454e 545d  ec[_ECD_COMMENT]
-0000bd00: 2020 2320 6172 6368 6976 6520 636f 6d6d    # archive comm
-0000bd10: 656e 740d 0a0d 0a20 2020 2020 2020 2023  ent....        #
-0000bd20: 2022 636f 6e63 6174 2220 6973 207a 6572   "concat" is zer
-0000bd30: 6f2c 2075 6e6c 6573 7320 7a69 7020 7761  o, unless zip wa
-0000bd40: 7320 636f 6e63 6174 656e 6174 6564 2074  s concatenated t
-0000bd50: 6f20 616e 6f74 6865 7220 6669 6c65 0d0a  o another file..
-0000bd60: 2020 2020 2020 2020 636f 6e63 6174 203d          concat =
-0000bd70: 2065 6e64 7265 635b 5f45 4344 5f4c 4f43   endrec[_ECD_LOC
-0000bd80: 4154 494f 4e5d 202d 2073 697a 655f 6364  ATION] - size_cd
-0000bd90: 202d 206f 6666 7365 745f 6364 0d0a 2020   - offset_cd..  
-0000bda0: 2020 2020 2020 6966 2065 6e64 7265 635b        if endrec[
-0000bdb0: 5f45 4344 5f53 4947 4e41 5455 5245 5d20  _ECD_SIGNATURE] 
-0000bdc0: 3d3d 2073 7472 696e 6745 6e64 4172 6368  == stringEndArch
-0000bdd0: 6976 6536 343a 0d0a 2020 2020 2020 2020  ive64:..        
-0000bde0: 2020 2020 2320 4966 205a 6970 3634 2065      # If Zip64 e
-0000bdf0: 7874 656e 7369 6f6e 2073 7472 7563 7475  xtension structu
-0000be00: 7265 7320 6172 6520 7072 6573 656e 742c  res are present,
-0000be10: 2061 6363 6f75 6e74 2066 6f72 2074 6865   account for the
-0000be20: 6d0d 0a20 2020 2020 2020 2020 2020 2063  m..            c
-0000be30: 6f6e 6361 7420 2d3d 2073 697a 6545 6e64  oncat -= sizeEnd
-0000be40: 4365 6e74 4469 7236 3420 2b20 7369 7a65  CentDir64 + size
-0000be50: 456e 6443 656e 7444 6972 3634 4c6f 6361  EndCentDir64Loca
-0000be60: 746f 720d 0a0d 0a20 2020 2020 2020 2069  tor....        i
-0000be70: 6620 7365 6c66 2e64 6562 7567 203e 2032  f self.debug > 2
-0000be80: 3a0d 0a20 2020 2020 2020 2020 2020 2069  :..            i
-0000be90: 6e66 6572 7265 6420 3d20 636f 6e63 6174  nferred = concat
-0000bea0: 202b 206f 6666 7365 745f 6364 0d0a 2020   + offset_cd..  
-0000beb0: 2020 2020 2020 2020 2020 7072 696e 7428            print(
-0000bec0: 2267 6976 656e 2c20 696e 6665 7272 6564  "given, inferred
-0000bed0: 2c20 6f66 6673 6574 222c 206f 6666 7365  , offset", offse
-0000bee0: 745f 6364 2c20 696e 6665 7272 6564 2c20  t_cd, inferred, 
-0000bef0: 636f 6e63 6174 290d 0a20 2020 2020 2020  concat)..       
-0000bf00: 2023 2073 656c 662e 7374 6172 745f 6469   # self.start_di
-0000bf10: 723a 2020 506f 7369 7469 6f6e 206f 6620  r:  Position of 
-0000bf20: 7374 6172 7420 6f66 2063 656e 7472 616c  start of central
-0000bf30: 2064 6972 6563 746f 7279 0d0a 2020 2020   directory..    
-0000bf40: 2020 2020 7365 6c66 2e73 7461 7274 5f64      self.start_d
-0000bf50: 6972 203d 206f 6666 7365 745f 6364 202b  ir = offset_cd +
-0000bf60: 2063 6f6e 6361 740d 0a20 2020 2020 2020   concat..       
-0000bf70: 2066 702e 7365 656b 2873 656c 662e 7374   fp.seek(self.st
-0000bf80: 6172 745f 6469 722c 2030 290d 0a20 2020  art_dir, 0)..   
-0000bf90: 2020 2020 2064 6174 6120 3d20 6670 2e72       data = fp.r
-0000bfa0: 6561 6428 7369 7a65 5f63 6429 0d0a 2020  ead(size_cd)..  
-0000bfb0: 2020 2020 2020 6670 203d 2069 6f2e 4279        fp = io.By
-0000bfc0: 7465 7349 4f28 6461 7461 290d 0a20 2020  tesIO(data)..   
-0000bfd0: 2020 2020 2074 6f74 616c 203d 2030 0d0a       total = 0..
-0000bfe0: 2020 2020 2020 2020 7768 696c 6520 746f          while to
-0000bff0: 7461 6c20 3c20 7369 7a65 5f63 643a 0d0a  tal < size_cd:..
-0000c000: 2020 2020 2020 2020 2020 2020 6365 6e74              cent
-0000c010: 6469 7220 3d20 6670 2e72 6561 6428 7369  dir = fp.read(si
-0000c020: 7a65 4365 6e74 7261 6c44 6972 290d 0a20  zeCentralDir).. 
-0000c030: 2020 2020 2020 2020 2020 2069 6620 6c65             if le
-0000c040: 6e28 6365 6e74 6469 7229 2021 3d20 7369  n(centdir) != si
-0000c050: 7a65 4365 6e74 7261 6c44 6972 3a0d 0a20  zeCentralDir:.. 
-0000c060: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-0000c070: 6169 7365 2042 6164 5a69 7046 696c 6528  aise BadZipFile(
-0000c080: 2254 7275 6e63 6174 6564 2063 656e 7472  "Truncated centr
-0000c090: 616c 2064 6972 6563 746f 7279 2229 0d0a  al directory")..
-0000c0a0: 2020 2020 2020 2020 2020 2020 6365 6e74              cent
-0000c0b0: 6469 7220 3d20 7374 7275 6374 2e75 6e70  dir = struct.unp
-0000c0c0: 6163 6b28 7374 7275 6374 4365 6e74 7261  ack(structCentra
-0000c0d0: 6c44 6972 2c20 6365 6e74 6469 7229 0d0a  lDir, centdir)..
-0000c0e0: 2020 2020 2020 2020 2020 2020 6966 2063              if c
-0000c0f0: 656e 7464 6972 5b5f 4344 5f53 4947 4e41  entdir[_CD_SIGNA
-0000c100: 5455 5245 5d20 213d 2073 7472 696e 6743  TURE] != stringC
-0000c110: 656e 7472 616c 4469 723a 0d0a 2020 2020  entralDir:..    
-0000c120: 2020 2020 2020 2020 2020 2020 7261 6973              rais
-0000c130: 6520 4261 645a 6970 4669 6c65 2822 4261  e BadZipFile("Ba
-0000c140: 6420 6d61 6769 6320 6e75 6d62 6572 2066  d magic number f
-0000c150: 6f72 2063 656e 7472 616c 2064 6972 6563  or central direc
-0000c160: 746f 7279 2229 0d0a 2020 2020 2020 2020  tory")..        
-0000c170: 2020 2020 6966 2073 656c 662e 6465 6275      if self.debu
-0000c180: 6720 3e20 323a 0d0a 2020 2020 2020 2020  g > 2:..        
-0000c190: 2020 2020 2020 2020 7072 696e 7428 6365          print(ce
-0000c1a0: 6e74 6469 7229 0d0a 2020 2020 2020 2020  ntdir)..        
-0000c1b0: 2020 2020 6669 6c65 6e61 6d65 203d 2066      filename = f
-0000c1c0: 702e 7265 6164 2863 656e 7464 6972 5b5f  p.read(centdir[_
-0000c1d0: 4344 5f46 494c 454e 414d 455f 4c45 4e47  CD_FILENAME_LENG
-0000c1e0: 5448 5d29 0d0a 2020 2020 2020 2020 2020  TH])..          
-0000c1f0: 2020 666c 6167 7320 3d20 6365 6e74 6469    flags = centdi
-0000c200: 725b 355d 0d0a 2020 2020 2020 2020 2020  r[5]..          
-0000c210: 2020 6966 2066 6c61 6773 2026 2030 7838    if flags & 0x8
-0000c220: 3030 3a0d 0a20 2020 2020 2020 2020 2020  00:..           
-0000c230: 2020 2020 2023 2055 5446 2d38 2066 696c       # UTF-8 fil
-0000c240: 6520 6e61 6d65 7320 6578 7465 6e73 696f  e names extensio
-0000c250: 6e0d 0a20 2020 2020 2020 2020 2020 2020  n..             
-0000c260: 2020 2066 696c 656e 616d 6520 3d20 6669     filename = fi
-0000c270: 6c65 6e61 6d65 2e64 6563 6f64 6528 2275  lename.decode("u
-0000c280: 7466 2d38 2229 0d0a 2020 2020 2020 2020  tf-8")..        
-0000c290: 2020 2020 656c 7365 3a0d 0a20 2020 2020      else:..     
-0000c2a0: 2020 2020 2020 2020 2020 2023 2048 6973             # His
-0000c2b0: 746f 7269 6361 6c20 5a49 5020 6669 6c65  torical ZIP file
-0000c2c0: 6e61 6d65 2065 6e63 6f64 696e 670d 0a20  name encoding.. 
-0000c2d0: 2020 2020 2020 2020 2020 2020 2020 2066                 f
-0000c2e0: 696c 656e 616d 6520 3d20 6669 6c65 6e61  ilename = filena
-0000c2f0: 6d65 2e64 6563 6f64 6528 2263 7034 3337  me.decode("cp437
-0000c300: 2229 0d0a 2020 2020 2020 2020 2020 2020  ")..            
-0000c310: 2320 4372 6561 7465 205a 6970 496e 666f  # Create ZipInfo
-0000c320: 2069 6e73 7461 6e63 6520 746f 2073 746f   instance to sto
-0000c330: 7265 2066 696c 6520 696e 666f 726d 6174  re file informat
-0000c340: 696f 6e0d 0a20 2020 2020 2020 2020 2020  ion..           
-0000c350: 2078 203d 205a 6970 496e 666f 2866 696c   x = ZipInfo(fil
-0000c360: 656e 616d 6529 0d0a 2020 2020 2020 2020  ename)..        
-0000c370: 2020 2020 782e 6578 7472 6120 3d20 6670      x.extra = fp
-0000c380: 2e72 6561 6428 6365 6e74 6469 725b 5f43  .read(centdir[_C
-0000c390: 445f 4558 5452 415f 4649 454c 445f 4c45  D_EXTRA_FIELD_LE
-0000c3a0: 4e47 5448 5d29 0d0a 2020 2020 2020 2020  NGTH])..        
-0000c3b0: 2020 2020 782e 636f 6d6d 656e 7420 3d20      x.comment = 
-0000c3c0: 6670 2e72 6561 6428 6365 6e74 6469 725b  fp.read(centdir[
-0000c3d0: 5f43 445f 434f 4d4d 454e 545f 4c45 4e47  _CD_COMMENT_LENG
-0000c3e0: 5448 5d29 0d0a 2020 2020 2020 2020 2020  TH])..          
-0000c3f0: 2020 782e 6865 6164 6572 5f6f 6666 7365    x.header_offse
-0000c400: 7420 3d20 6365 6e74 6469 725b 5f43 445f  t = centdir[_CD_
-0000c410: 4c4f 4341 4c5f 4845 4144 4552 5f4f 4646  LOCAL_HEADER_OFF
-0000c420: 5345 545d 0d0a 2020 2020 2020 2020 2020  SET]..          
-0000c430: 2020 280d 0a20 2020 2020 2020 2020 2020    (..           
-0000c440: 2020 2020 2078 2e63 7265 6174 655f 7665       x.create_ve
-0000c450: 7273 696f 6e2c 0d0a 2020 2020 2020 2020  rsion,..        
-0000c460: 2020 2020 2020 2020 782e 6372 6561 7465          x.create
-0000c470: 5f73 7973 7465 6d2c 0d0a 2020 2020 2020  _system,..      
-0000c480: 2020 2020 2020 2020 2020 782e 6578 7472            x.extr
-0000c490: 6163 745f 7665 7273 696f 6e2c 0d0a 2020  act_version,..  
-0000c4a0: 2020 2020 2020 2020 2020 2020 2020 782e                x.
-0000c4b0: 7265 7365 7276 6564 2c0d 0a20 2020 2020  reserved,..     
-0000c4c0: 2020 2020 2020 2020 2020 2078 2e66 6c61             x.fla
-0000c4d0: 675f 6269 7473 2c0d 0a20 2020 2020 2020  g_bits,..       
-0000c4e0: 2020 2020 2020 2020 2078 2e63 6f6d 7072           x.compr
-0000c4f0: 6573 735f 7479 7065 2c0d 0a20 2020 2020  ess_type,..     
-0000c500: 2020 2020 2020 2020 2020 2074 2c0d 0a20             t,.. 
-0000c510: 2020 2020 2020 2020 2020 2020 2020 2064                 d
-0000c520: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
-0000c530: 2020 2078 2e43 5243 2c0d 0a20 2020 2020     x.CRC,..     
-0000c540: 2020 2020 2020 2020 2020 2078 2e63 6f6d             x.com
-0000c550: 7072 6573 735f 7369 7a65 2c0d 0a20 2020  press_size,..   
-0000c560: 2020 2020 2020 2020 2020 2020 2078 2e66               x.f
-0000c570: 696c 655f 7369 7a65 2c0d 0a20 2020 2020  ile_size,..     
-0000c580: 2020 2020 2020 2029 203d 2063 656e 7464         ) = centd
-0000c590: 6972 5b31 3a31 325d 0d0a 2020 2020 2020  ir[1:12]..      
-0000c5a0: 2020 2020 2020 6966 2078 2e65 7874 7261        if x.extra
-0000c5b0: 6374 5f76 6572 7369 6f6e 203e 204d 4158  ct_version > MAX
-0000c5c0: 5f45 5854 5241 4354 5f56 4552 5349 4f4e  _EXTRACT_VERSION
-0000c5d0: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
-0000c5e0: 2020 2072 6169 7365 204e 6f74 496d 706c     raise NotImpl
-0000c5f0: 656d 656e 7465 6445 7272 6f72 280d 0a20  ementedError(.. 
-0000c600: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c610: 2020 2022 7a69 7020 6669 6c65 2076 6572     "zip file ver
-0000c620: 7369 6f6e 2025 2e31 6622 2025 2028 782e  sion %.1f" % (x.
-0000c630: 6578 7472 6163 745f 7665 7273 696f 6e20  extract_version 
-0000c640: 2f20 3130 292c 0d0a 2020 2020 2020 2020  / 10),..        
-0000c650: 2020 2020 2020 2020 290d 0a20 2020 2020          )..     
-0000c660: 2020 2020 2020 2078 2e76 6f6c 756d 652c         x.volume,
-0000c670: 2078 2e69 6e74 6572 6e61 6c5f 6174 7472   x.internal_attr
-0000c680: 2c20 782e 6578 7465 726e 616c 5f61 7474  , x.external_att
-0000c690: 7220 3d20 6365 6e74 6469 725b 3135 3a31  r = centdir[15:1
-0000c6a0: 385d 0d0a 2020 2020 2020 2020 2020 2020  8]..            
-0000c6b0: 2320 436f 6e76 6572 7420 6461 7465 2f74  # Convert date/t
-0000c6c0: 696d 6520 636f 6465 2074 6f20 2879 6561  ime code to (yea
-0000c6d0: 722c 206d 6f6e 7468 2c20 6461 792c 2068  r, month, day, h
-0000c6e0: 6f75 722c 206d 696e 2c20 7365 6329 0d0a  our, min, sec)..
-0000c6f0: 2020 2020 2020 2020 2020 2020 782e 5f72              x._r
-0000c700: 6177 5f74 696d 6520 3d20 740d 0a20 2020  aw_time = t..   
-0000c710: 2020 2020 2020 2020 2078 2e64 6174 655f           x.date_
-0000c720: 7469 6d65 203d 2028 0d0a 2020 2020 2020  time = (..      
-0000c730: 2020 2020 2020 2020 2020 2864 203e 3e20            (d >> 
-0000c740: 3929 202b 2031 3938 302c 0d0a 2020 2020  9) + 1980,..    
-0000c750: 2020 2020 2020 2020 2020 2020 2864 203e              (d >
-0000c760: 3e20 3529 2026 2030 7846 2c0d 0a20 2020  > 5) & 0xF,..   
-0000c770: 2020 2020 2020 2020 2020 2020 2064 2026               d &
-0000c780: 2030 7831 462c 0d0a 2020 2020 2020 2020   0x1F,..        
-0000c790: 2020 2020 2020 2020 7420 3e3e 2031 312c          t >> 11,
-0000c7a0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0000c7b0: 2020 2874 203e 3e20 3529 2026 2030 7833    (t >> 5) & 0x3
-0000c7c0: 462c 0d0a 2020 2020 2020 2020 2020 2020  F,..            
-0000c7d0: 2020 2020 2874 2026 2030 7831 4629 202a      (t & 0x1F) *
-0000c7e0: 2032 2c0d 0a20 2020 2020 2020 2020 2020   2,..           
-0000c7f0: 2029 0d0a 0d0a 2020 2020 2020 2020 2020   )....          
-0000c800: 2020 782e 5f64 6563 6f64 6545 7874 7261    x._decodeExtra
-0000c810: 2829 0d0a 2020 2020 2020 2020 2020 2020  ()..            
-0000c820: 782e 6865 6164 6572 5f6f 6666 7365 7420  x.header_offset 
-0000c830: 3d20 782e 6865 6164 6572 5f6f 6666 7365  = x.header_offse
-0000c840: 7420 2b20 636f 6e63 6174 0d0a 2020 2020  t + concat..    
-0000c850: 2020 2020 2020 2020 7365 6c66 2e66 696c          self.fil
-0000c860: 656c 6973 742e 6170 7065 6e64 2878 290d  elist.append(x).
-0000c870: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-0000c880: 662e 4e61 6d65 546f 496e 666f 5b78 2e66  f.NameToInfo[x.f
-0000c890: 696c 656e 616d 655d 203d 2078 0d0a 0d0a  ilename] = x....
-0000c8a0: 2020 2020 2020 2020 2020 2020 2320 7570              # up
-0000c8b0: 6461 7465 2074 6f74 616c 2062 7974 6573  date total bytes
-0000c8c0: 2072 6561 6420 6672 6f6d 2063 656e 7472   read from centr
-0000c8d0: 616c 2064 6972 6563 746f 7279 0d0a 2020  al directory..  
-0000c8e0: 2020 2020 2020 2020 2020 746f 7461 6c20            total 
-0000c8f0: 3d20 280d 0a20 2020 2020 2020 2020 2020  = (..           
-0000c900: 2020 2020 2074 6f74 616c 0d0a 2020 2020       total..    
-0000c910: 2020 2020 2020 2020 2020 2020 2b20 7369              + si
-0000c920: 7a65 4365 6e74 7261 6c44 6972 0d0a 2020  zeCentralDir..  
-0000c930: 2020 2020 2020 2020 2020 2020 2020 2b20                + 
-0000c940: 6365 6e74 6469 725b 5f43 445f 4649 4c45  centdir[_CD_FILE
-0000c950: 4e41 4d45 5f4c 454e 4754 485d 0d0a 2020  NAME_LENGTH]..  
-0000c960: 2020 2020 2020 2020 2020 2020 2020 2b20                + 
-0000c970: 6365 6e74 6469 725b 5f43 445f 4558 5452  centdir[_CD_EXTR
-0000c980: 415f 4649 454c 445f 4c45 4e47 5448 5d0d  A_FIELD_LENGTH].
-0000c990: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000c9a0: 202b 2063 656e 7464 6972 5b5f 4344 5f43   + centdir[_CD_C
-0000c9b0: 4f4d 4d45 4e54 5f4c 454e 4754 485d 0d0a  OMMENT_LENGTH]..
-0000c9c0: 2020 2020 2020 2020 2020 2020 290d 0a0d              )...
-0000c9d0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-0000c9e0: 7365 6c66 2e64 6562 7567 203e 2032 3a0d  self.debug > 2:.
-0000c9f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000ca00: 2070 7269 6e74 2822 746f 7461 6c22 2c20   print("total", 
-0000ca10: 746f 7461 6c29 0d0a 0d0a 2020 2020 6465  total)....    de
-0000ca20: 6620 6e61 6d65 6c69 7374 2873 656c 6629  f namelist(self)
-0000ca30: 3a0d 0a20 2020 2020 2020 2022 2222 5265  :..        """Re
-0000ca40: 7475 726e 2061 206c 6973 7420 6f66 2066  turn a list of f
-0000ca50: 696c 6520 6e61 6d65 7320 696e 2074 6865  ile names in the
-0000ca60: 2061 7263 6869 7665 2e22 2222 0d0a 2020   archive."""..  
-0000ca70: 2020 2020 2020 7265 7475 726e 205b 6461        return [da
-0000ca80: 7461 2e66 696c 656e 616d 6520 666f 7220  ta.filename for 
-0000ca90: 6461 7461 2069 6e20 7365 6c66 2e66 696c  data in self.fil
-0000caa0: 656c 6973 745d 0d0a 0d0a 2020 2020 6465  elist]....    de
-0000cab0: 6620 696e 666f 6c69 7374 2873 656c 6629  f infolist(self)
-0000cac0: 3a0d 0a20 2020 2020 2020 2022 2222 5265  :..        """Re
-0000cad0: 7475 726e 2061 206c 6973 7420 6f66 2063  turn a list of c
-0000cae0: 6c61 7373 205a 6970 496e 666f 2069 6e73  lass ZipInfo ins
-0000caf0: 7461 6e63 6573 2066 6f72 2066 696c 6573  tances for files
-0000cb00: 2069 6e20 7468 650d 0a20 2020 2020 2020   in the..       
-0000cb10: 2061 7263 6869 7665 2e0d 0a20 2020 2020   archive...     
-0000cb20: 2020 2022 2222 0d0a 2020 2020 2020 2020     """..        
-0000cb30: 7265 7475 726e 2073 656c 662e 6669 6c65  return self.file
-0000cb40: 6c69 7374 0d0a 0d0a 2020 2020 6465 6620  list....    def 
-0000cb50: 7072 696e 7464 6972 2873 656c 662c 2066  printdir(self, f
-0000cb60: 696c 653d 4e6f 6e65 293a 0d0a 2020 2020  ile=None):..    
-0000cb70: 2020 2020 2222 2250 7269 6e74 2061 2074      """Print a t
-0000cb80: 6162 6c65 206f 6620 636f 6e74 656e 7473  able of contents
-0000cb90: 2066 6f72 2074 6865 207a 6970 2066 696c   for the zip fil
-0000cba0: 652e 2222 220d 0a20 2020 2020 2020 2070  e."""..        p
-0000cbb0: 7269 6e74 280d 0a20 2020 2020 2020 2020  rint(..         
-0000cbc0: 2020 2022 252d 3436 7320 2531 3973 2025     "%-46s %19s %
-0000cbd0: 3132 7322 2025 2028 2246 696c 6520 4e61  12s" % ("File Na
-0000cbe0: 6d65 222c 2022 4d6f 6469 6669 6564 2020  me", "Modified  
-0000cbf0: 2020 222c 2022 5369 7a65 2229 2c0d 0a20    ", "Size"),.. 
-0000cc00: 2020 2020 2020 2020 2020 2066 696c 653d             file=
-0000cc10: 6669 6c65 2c0d 0a20 2020 2020 2020 2029  file,..        )
-0000cc20: 0d0a 2020 2020 2020 2020 666f 7220 7a69  ..        for zi
-0000cc30: 6e66 6f20 696e 2073 656c 662e 6669 6c65  nfo in self.file
-0000cc40: 6c69 7374 3a0d 0a20 2020 2020 2020 2020  list:..         
-0000cc50: 2020 2064 6174 6520 3d20 2225 642d 2530     date = "%d-%0
-0000cc60: 3264 2d25 3032 6420 2530 3264 3a25 3032  2d-%02d %02d:%02
-0000cc70: 643a 2530 3264 2220 2520 7a69 6e66 6f2e  d:%02d" % zinfo.
-0000cc80: 6461 7465 5f74 696d 655b 3a36 5d0d 0a20  date_time[:6].. 
-0000cc90: 2020 2020 2020 2020 2020 2070 7269 6e74             print
-0000cca0: 280d 0a20 2020 2020 2020 2020 2020 2020  (..             
-0000ccb0: 2020 2022 252d 3436 7320 2573 2025 3132     "%-46s %s %12
-0000ccc0: 6422 2025 2028 7a69 6e66 6f2e 6669 6c65  d" % (zinfo.file
-0000ccd0: 6e61 6d65 2c20 6461 7465 2c20 7a69 6e66  name, date, zinf
-0000cce0: 6f2e 6669 6c65 5f73 697a 6529 2c0d 0a20  o.file_size),.. 
-0000ccf0: 2020 2020 2020 2020 2020 2020 2020 2066                 f
-0000cd00: 696c 653d 6669 6c65 2c0d 0a20 2020 2020  ile=file,..     
-0000cd10: 2020 2020 2020 2029 0d0a 0d0a 2020 2020         )....    
-0000cd20: 6465 6620 7465 7374 7a69 7028 7365 6c66  def testzip(self
-0000cd30: 293a 0d0a 2020 2020 2020 2020 2222 2252  ):..        """R
-0000cd40: 6561 6420 616c 6c20 7468 6520 6669 6c65  ead all the file
-0000cd50: 7320 616e 6420 6368 6563 6b20 7468 6520  s and check the 
-0000cd60: 4352 432e 2222 220d 0a20 2020 2020 2020  CRC."""..       
-0000cd70: 2063 6875 6e6b 5f73 697a 6520 3d20 322a   chunk_size = 2*
-0000cd80: 2a32 300d 0a20 2020 2020 2020 2066 6f72  *20..        for
-0000cd90: 207a 696e 666f 2069 6e20 7365 6c66 2e66   zinfo in self.f
-0000cda0: 696c 656c 6973 743a 0d0a 2020 2020 2020  ilelist:..      
-0000cdb0: 2020 2020 2020 7472 793a 0d0a 2020 2020        try:..    
-0000cdc0: 2020 2020 2020 2020 2020 2020 2320 5265              # Re
-0000cdd0: 6164 2062 7920 6368 756e 6b73 2c20 746f  ad by chunks, to
-0000cde0: 2061 766f 6964 2061 6e20 4f76 6572 666c   avoid an Overfl
-0000cdf0: 6f77 4572 726f 7220 6f72 2061 0d0a 2020  owError or a..  
-0000ce00: 2020 2020 2020 2020 2020 2020 2020 2320                # 
-0000ce10: 4d65 6d6f 7279 4572 726f 7220 7769 7468  MemoryError with
-0000ce20: 2076 6572 7920 6c61 7267 6520 656d 6265   very large embe
-0000ce30: 6464 6564 2066 696c 6573 2e0d 0a20 2020  dded files...   
-0000ce40: 2020 2020 2020 2020 2020 2020 2077 6974               wit
-0000ce50: 6820 7365 6c66 2e6f 7065 6e28 7a69 6e66  h self.open(zinf
-0000ce60: 6f2e 6669 6c65 6e61 6d65 2c20 2272 2229  o.filename, "r")
-0000ce70: 2061 7320 663a 0d0a 2020 2020 2020 2020   as f:..        
-0000ce80: 2020 2020 2020 2020 2020 2020 7768 696c              whil
-0000ce90: 6520 662e 7265 6164 2863 6875 6e6b 5f73  e f.read(chunk_s
-0000cea0: 697a 6529 3a20 2023 2043 6865 636b 2043  ize):  # Check C
-0000ceb0: 5243 2d33 320d 0a20 2020 2020 2020 2020  RC-32..         
-0000cec0: 2020 2020 2020 2020 2020 2020 2020 2070                 p
-0000ced0: 6173 730d 0a20 2020 2020 2020 2020 2020  ass..           
-0000cee0: 2065 7863 6570 7420 4261 645a 6970 4669   except BadZipFi
-0000cef0: 6c65 3a0d 0a20 2020 2020 2020 2020 2020  le:..           
-0000cf00: 2020 2020 2072 6574 7572 6e20 7a69 6e66       return zinf
-0000cf10: 6f2e 6669 6c65 6e61 6d65 0d0a 2020 2020  o.filename..    
-0000cf20: 2020 2020 7265 7475 726e 204e 6f6e 650d      return None.
-0000cf30: 0a0d 0a20 2020 2064 6566 2067 6574 696e  ...    def getin
-0000cf40: 666f 2873 656c 662c 206e 616d 6529 3a0d  fo(self, name):.
-0000cf50: 0a20 2020 2020 2020 2022 2222 5265 7475  .        """Retu
-0000cf60: 726e 2074 6865 2069 6e73 7461 6e63 6520  rn the instance 
-0000cf70: 6f66 205a 6970 496e 666f 2067 6976 656e  of ZipInfo given
-0000cf80: 2027 6e61 6d65 272e 2222 220d 0a20 2020   'name'."""..   
-0000cf90: 2020 2020 2069 6e66 6f20 3d20 7365 6c66       info = self
-0000cfa0: 2e4e 616d 6554 6f49 6e66 6f2e 6765 7428  .NameToInfo.get(
-0000cfb0: 6e61 6d65 290d 0a20 2020 2020 2020 2069  name)..        i
-0000cfc0: 6620 696e 666f 2069 7320 4e6f 6e65 3a0d  f info is None:.
-0000cfd0: 0a20 2020 2020 2020 2020 2020 2072 6169  .            rai
-0000cfe0: 7365 204b 6579 4572 726f 7228 2254 6865  se KeyError("The
-0000cff0: 7265 2069 7320 6e6f 2069 7465 6d20 6e61  re is no item na
-0000d000: 6d65 6420 2572 2069 6e20 7468 6520 6172  med %r in the ar
-0000d010: 6368 6976 6522 2025 206e 616d 6529 0d0a  chive" % name)..
-0000d020: 0d0a 2020 2020 2020 2020 7265 7475 726e  ..        return
-0000d030: 2069 6e66 6f0d 0a0d 0a20 2020 2064 6566   info....    def
-0000d040: 2073 6574 7061 7373 776f 7264 2873 656c   setpassword(sel
-0000d050: 662c 2070 7764 293a 0d0a 2020 2020 2020  f, pwd):..      
-0000d060: 2020 2222 2253 6574 2064 6566 6175 6c74    """Set default
-0000d070: 2070 6173 7377 6f72 6420 666f 7220 656e   password for en
-0000d080: 6372 7970 7465 6420 6669 6c65 732e 2222  crypted files.""
-0000d090: 220d 0a20 2020 2020 2020 2069 6620 7077  "..        if pw
-0000d0a0: 6420 616e 6420 6e6f 7420 6973 696e 7374  d and not isinst
-0000d0b0: 616e 6365 2870 7764 2c20 6279 7465 7329  ance(pwd, bytes)
-0000d0c0: 3a0d 0a20 2020 2020 2020 2020 2020 2072  :..            r
-0000d0d0: 6169 7365 2054 7970 6545 7272 6f72 2822  aise TypeError("
-0000d0e0: 7077 643a 2065 7870 6563 7465 6420 6279  pwd: expected by
-0000d0f0: 7465 732c 2067 6f74 2025 7322 2025 2074  tes, got %s" % t
-0000d100: 7970 6528 7077 6429 2e5f 5f6e 616d 655f  ype(pwd).__name_
-0000d110: 5f29 0d0a 2020 2020 2020 2020 6966 2070  _)..        if p
-0000d120: 7764 3a0d 0a20 2020 2020 2020 2020 2020  wd:..           
-0000d130: 2073 656c 662e 7077 6420 3d20 7077 640d   self.pwd = pwd.
-0000d140: 0a20 2020 2020 2020 2065 6c73 653a 0d0a  .        else:..
-0000d150: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-0000d160: 2e70 7764 203d 204e 6f6e 650d 0a0d 0a20  .pwd = None.... 
-0000d170: 2020 2040 7072 6f70 6572 7479 0d0a 2020     @property..  
-0000d180: 2020 6465 6620 636f 6d6d 656e 7428 7365    def comment(se
-0000d190: 6c66 293a 0d0a 2020 2020 2020 2020 2222  lf):..        ""
-0000d1a0: 2254 6865 2063 6f6d 6d65 6e74 2074 6578  "The comment tex
-0000d1b0: 7420 6173 736f 6369 6174 6564 2077 6974  t associated wit
-0000d1c0: 6820 7468 6520 5a49 5020 6669 6c65 2e22  h the ZIP file."
-0000d1d0: 2222 0d0a 2020 2020 2020 2020 7265 7475  ""..        retu
-0000d1e0: 726e 2073 656c 662e 5f63 6f6d 6d65 6e74  rn self._comment
-0000d1f0: 0d0a 0d0a 2020 2020 4063 6f6d 6d65 6e74  ....    @comment
-0000d200: 2e73 6574 7465 720d 0a20 2020 2064 6566  .setter..    def
-0000d210: 2063 6f6d 6d65 6e74 2873 656c 662c 2063   comment(self, c
-0000d220: 6f6d 6d65 6e74 293a 0d0a 2020 2020 2020  omment):..      
-0000d230: 2020 6966 206e 6f74 2069 7369 6e73 7461    if not isinsta
-0000d240: 6e63 6528 636f 6d6d 656e 742c 2062 7974  nce(comment, byt
-0000d250: 6573 293a 0d0a 2020 2020 2020 2020 2020  es):..          
-0000d260: 2020 7261 6973 6520 5479 7065 4572 726f    raise TypeErro
-0000d270: 7228 0d0a 2020 2020 2020 2020 2020 2020  r(..            
-0000d280: 2020 2020 2263 6f6d 6d65 6e74 3a20 6578      "comment: ex
-0000d290: 7065 6374 6564 2062 7974 6573 2c20 676f  pected bytes, go
-0000d2a0: 7420 2573 2220 2520 7479 7065 2863 6f6d  t %s" % type(com
-0000d2b0: 6d65 6e74 292e 5f5f 6e61 6d65 5f5f 2c0d  ment).__name__,.
-0000d2c0: 0a20 2020 2020 2020 2020 2020 2029 0d0a  .            )..
-0000d2d0: 2020 2020 2020 2020 2320 6368 6563 6b20          # check 
-0000d2e0: 666f 7220 7661 6c69 6420 636f 6d6d 656e  for valid commen
-0000d2f0: 7420 6c65 6e67 7468 0d0a 2020 2020 2020  t length..      
-0000d300: 2020 6966 206c 656e 2863 6f6d 6d65 6e74    if len(comment
-0000d310: 2920 3e20 5a49 505f 4d41 585f 434f 4d4d  ) > ZIP_MAX_COMM
-0000d320: 454e 543a 0d0a 2020 2020 2020 2020 2020  ENT:..          
-0000d330: 2020 696d 706f 7274 2077 6172 6e69 6e67    import warning
-0000d340: 730d 0a0d 0a20 2020 2020 2020 2020 2020  s....           
-0000d350: 2077 6172 6e69 6e67 732e 7761 726e 280d   warnings.warn(.
-0000d360: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000d370: 2022 4172 6368 6976 6520 636f 6d6d 656e   "Archive commen
-0000d380: 7420 6973 2074 6f6f 206c 6f6e 673b 2074  t is too long; t
-0000d390: 7275 6e63 6174 696e 6720 746f 2025 6420  runcating to %d 
-0000d3a0: 6279 7465 7322 0d0a 2020 2020 2020 2020  bytes"..        
-0000d3b0: 2020 2020 2020 2020 2520 5a49 505f 4d41          % ZIP_MA
-0000d3c0: 585f 434f 4d4d 454e 542c 0d0a 2020 2020  X_COMMENT,..    
-0000d3d0: 2020 2020 2020 2020 2020 2020 7374 6163              stac
-0000d3e0: 6b6c 6576 656c 3d32 2c0d 0a20 2020 2020  klevel=2,..     
-0000d3f0: 2020 2020 2020 2029 0d0a 2020 2020 2020         )..      
-0000d400: 2020 2020 2020 636f 6d6d 656e 7420 3d20        comment = 
-0000d410: 636f 6d6d 656e 745b 3a5a 4950 5f4d 4158  comment[:ZIP_MAX
-0000d420: 5f43 4f4d 4d45 4e54 5d0d 0a20 2020 2020  _COMMENT]..     
-0000d430: 2020 2073 656c 662e 5f63 6f6d 6d65 6e74     self._comment
-0000d440: 203d 2063 6f6d 6d65 6e74 0d0a 2020 2020   = comment..    
-0000d450: 2020 2020 7365 6c66 2e5f 6469 644d 6f64      self._didMod
-0000d460: 6966 7920 3d20 5472 7565 0d0a 0d0a 2020  ify = True....  
-0000d470: 2020 6465 6620 7265 6164 2873 656c 662c    def read(self,
-0000d480: 206e 616d 652c 2070 7764 3d4e 6f6e 6529   name, pwd=None)
-0000d490: 3a0d 0a20 2020 2020 2020 2022 2222 5265  :..        """Re
-0000d4a0: 7475 726e 2066 696c 6520 6279 7465 7320  turn file bytes 
-0000d4b0: 666f 7220 6e61 6d65 2e22 2222 0d0a 2020  for name."""..  
-0000d4c0: 2020 2020 2020 7769 7468 2073 656c 662e        with self.
-0000d4d0: 6f70 656e 286e 616d 652c 2022 7222 2c20  open(name, "r", 
-0000d4e0: 7077 6429 2061 7320 6670 3a0d 0a20 2020  pwd) as fp:..   
-0000d4f0: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
-0000d500: 6670 2e72 6561 6428 290d 0a0d 0a20 2020  fp.read()....   
-0000d510: 2064 6566 206f 7065 6e28 7365 6c66 2c20   def open(self, 
-0000d520: 6e61 6d65 2c20 6d6f 6465 3d22 7222 2c20  name, mode="r", 
-0000d530: 7077 643d 4e6f 6e65 2c20 2a2c 2066 6f72  pwd=None, *, for
-0000d540: 6365 5f7a 6970 3634 3d46 616c 7365 293a  ce_zip64=False):
-0000d550: 0d0a 2020 2020 2020 2020 2222 2252 6574  ..        """Ret
-0000d560: 7572 6e20 6669 6c65 2d6c 696b 6520 6f62  urn file-like ob
-0000d570: 6a65 6374 2066 6f72 2027 6e61 6d65 272e  ject for 'name'.
-0000d580: 0d0a 0d0a 2020 2020 2020 2020 6e61 6d65  ....        name
-0000d590: 2069 7320 6120 7374 7269 6e67 2066 6f72   is a string for
-0000d5a0: 2074 6865 2066 696c 6520 6e61 6d65 2077   the file name w
-0000d5b0: 6974 6869 6e20 7468 6520 5a49 5020 6669  ithin the ZIP fi
-0000d5c0: 6c65 2c20 6f72 2061 205a 6970 496e 666f  le, or a ZipInfo
-0000d5d0: 0d0a 2020 2020 2020 2020 6f62 6a65 6374  ..        object
-0000d5e0: 2e0d 0a0d 0a20 2020 2020 2020 206d 6f64  .....        mod
-0000d5f0: 6520 7368 6f75 6c64 2062 6520 2772 2720  e should be 'r' 
-0000d600: 746f 2072 6561 6420 6120 6669 6c65 2061  to read a file a
-0000d610: 6c72 6561 6479 2069 6e20 7468 6520 5a49  lready in the ZI
-0000d620: 5020 6669 6c65 2c20 6f72 2027 7727 2074  P file, or 'w' t
-0000d630: 6f0d 0a20 2020 2020 2020 2077 7269 7465  o..        write
-0000d640: 2074 6f20 6120 6669 6c65 206e 6577 6c79   to a file newly
-0000d650: 2061 6464 6564 2074 6f20 7468 6520 6172   added to the ar
-0000d660: 6368 6976 652e 0d0a 0d0a 2020 2020 2020  chive.....      
-0000d670: 2020 7077 6420 6973 2074 6865 2070 6173    pwd is the pas
-0000d680: 7377 6f72 6420 746f 2064 6563 7279 7074  sword to decrypt
-0000d690: 2066 696c 6573 2028 6f6e 6c79 2075 7365   files (only use
-0000d6a0: 6420 666f 7220 7265 6164 696e 6729 2e0d  d for reading)..
-0000d6b0: 0a0d 0a20 2020 2020 2020 2057 6865 6e20  ...        When 
-0000d6c0: 7772 6974 696e 672c 2069 6620 7468 6520  writing, if the 
-0000d6d0: 6669 6c65 2073 697a 6520 6973 206e 6f74  file size is not
-0000d6e0: 206b 6e6f 776e 2069 6e20 6164 7661 6e63   known in advanc
-0000d6f0: 6520 6275 7420 6d61 7920 6578 6365 6564  e but may exceed
-0000d700: 0d0a 2020 2020 2020 2020 3220 4769 422c  ..        2 GiB,
-0000d710: 2070 6173 7320 666f 7263 655f 7a69 7036   pass force_zip6
-0000d720: 3420 746f 2075 7365 2074 6865 205a 4950  4 to use the ZIP
-0000d730: 3634 2066 6f72 6d61 742c 2077 6869 6368  64 format, which
-0000d740: 2063 616e 2068 616e 646c 6520 6c61 7267   can handle larg
-0000d750: 650d 0a20 2020 2020 2020 2066 696c 6573  e..        files
-0000d760: 2e20 2049 6620 7468 6520 7369 7a65 2069  .  If the size i
-0000d770: 7320 6b6e 6f77 6e20 696e 2061 6476 616e  s known in advan
-0000d780: 6365 2c20 6974 2069 7320 6265 7374 2074  ce, it is best t
-0000d790: 6f20 7061 7373 2061 205a 6970 496e 666f  o pass a ZipInfo
-0000d7a0: 0d0a 2020 2020 2020 2020 696e 7374 616e  ..        instan
-0000d7b0: 6365 2066 6f72 206e 616d 652c 2077 6974  ce for name, wit
-0000d7c0: 6820 7a69 6e66 6f2e 6669 6c65 5f73 697a  h zinfo.file_siz
-0000d7d0: 6520 7365 742e 0d0a 2020 2020 2020 2020  e set...        
-0000d7e0: 2222 220d 0a20 2020 2020 2020 2069 6620  """..        if 
-0000d7f0: 6d6f 6465 206e 6f74 2069 6e20 7b22 7222  mode not in {"r"
-0000d800: 2c20 2277 227d 3a0d 0a20 2020 2020 2020  , "w"}:..       
-0000d810: 2020 2020 2072 6169 7365 2056 616c 7565       raise Value
-0000d820: 4572 726f 7228 276f 7065 6e28 2920 7265  Error('open() re
-0000d830: 7175 6972 6573 206d 6f64 6520 2272 2220  quires mode "r" 
-0000d840: 6f72 2022 7722 2729 0d0a 2020 2020 2020  or "w"')..      
-0000d850: 2020 6966 2070 7764 2061 6e64 206e 6f74    if pwd and not
-0000d860: 2069 7369 6e73 7461 6e63 6528 7077 642c   isinstance(pwd,
-0000d870: 2062 7974 6573 293a 0d0a 2020 2020 2020   bytes):..      
-0000d880: 2020 2020 2020 7261 6973 6520 5479 7065        raise Type
-0000d890: 4572 726f 7228 2270 7764 3a20 6578 7065  Error("pwd: expe
-0000d8a0: 6374 6564 2062 7974 6573 2c20 676f 7420  cted bytes, got 
-0000d8b0: 2573 2220 2520 7479 7065 2870 7764 292e  %s" % type(pwd).
-0000d8c0: 5f5f 6e61 6d65 5f5f 290d 0a20 2020 2020  __name__)..     
-0000d8d0: 2020 2069 6620 7077 6420 616e 6420 286d     if pwd and (m
-0000d8e0: 6f64 6520 3d3d 2022 7722 293a 0d0a 2020  ode == "w"):..  
-0000d8f0: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
-0000d900: 5661 6c75 6545 7272 6f72 2822 7077 6420  ValueError("pwd 
-0000d910: 6973 206f 6e6c 7920 7375 7070 6f72 7465  is only supporte
-0000d920: 6420 666f 7220 7265 6164 696e 6720 6669  d for reading fi
-0000d930: 6c65 7322 290d 0a20 2020 2020 2020 2069  les")..        i
-0000d940: 6620 6e6f 7420 7365 6c66 2e66 703a 0d0a  f not self.fp:..
-0000d950: 2020 2020 2020 2020 2020 2020 7261 6973              rais
-0000d960: 6520 5661 6c75 6545 7272 6f72 280d 0a20  e ValueError(.. 
-0000d970: 2020 2020 2020 2020 2020 2020 2020 2022                 "
-0000d980: 4174 7465 6d70 7420 746f 2075 7365 205a  Attempt to use Z
-0000d990: 4950 2061 7263 6869 7665 2074 6861 7420  IP archive that 
-0000d9a0: 7761 7320 616c 7265 6164 7920 636c 6f73  was already clos
-0000d9b0: 6564 222c 0d0a 2020 2020 2020 2020 2020  ed",..          
-0000d9c0: 2020 290d 0a0d 0a20 2020 2020 2020 2023    )....        #
-0000d9d0: 204d 616b 6520 7375 7265 2077 6520 6861   Make sure we ha
-0000d9e0: 7665 2061 6e20 696e 666f 206f 626a 6563  ve an info objec
-0000d9f0: 740d 0a20 2020 2020 2020 2069 6620 6973  t..        if is
-0000da00: 696e 7374 616e 6365 286e 616d 652c 205a  instance(name, Z
-0000da10: 6970 496e 666f 293a 0d0a 2020 2020 2020  ipInfo):..      
-0000da20: 2020 2020 2020 2320 276e 616d 6527 2069        # 'name' i
-0000da30: 7320 616c 7265 6164 7920 616e 2069 6e66  s already an inf
-0000da40: 6f20 6f62 6a65 6374 0d0a 2020 2020 2020  o object..      
-0000da50: 2020 2020 2020 7a69 6e66 6f20 3d20 6e61        zinfo = na
-0000da60: 6d65 0d0a 2020 2020 2020 2020 656c 6966  me..        elif
-0000da70: 206d 6f64 6520 3d3d 2022 7722 3a0d 0a20   mode == "w":.. 
-0000da80: 2020 2020 2020 2020 2020 207a 696e 666f             zinfo
-0000da90: 203d 205a 6970 496e 666f 286e 616d 6529   = ZipInfo(name)
-0000daa0: 0d0a 2020 2020 2020 2020 2020 2020 7a69  ..            zi
-0000dab0: 6e66 6f2e 636f 6d70 7265 7373 5f74 7970  nfo.compress_typ
-0000dac0: 6520 3d20 7365 6c66 2e63 6f6d 7072 6573  e = self.compres
-0000dad0: 7369 6f6e 0d0a 2020 2020 2020 2020 2020  sion..          
-0000dae0: 2020 7a69 6e66 6f2e 5f63 6f6d 7072 6573    zinfo._compres
-0000daf0: 736c 6576 656c 203d 2073 656c 662e 636f  slevel = self.co
-0000db00: 6d70 7265 7373 6c65 7665 6c0d 0a20 2020  mpresslevel..   
-0000db10: 2020 2020 2065 6c73 653a 0d0a 2020 2020       else:..    
-0000db20: 2020 2020 2020 2020 2320 4765 7420 696e          # Get in
-0000db30: 666f 206f 626a 6563 7420 666f 7220 6e61  fo object for na
-0000db40: 6d65 0d0a 2020 2020 2020 2020 2020 2020  me..            
-0000db50: 7a69 6e66 6f20 3d20 7365 6c66 2e67 6574  zinfo = self.get
-0000db60: 696e 666f 286e 616d 6529 0d0a 0d0a 2020  info(name)....  
-0000db70: 2020 2020 2020 6966 206d 6f64 6520 3d3d        if mode ==
-0000db80: 2022 7722 3a0d 0a20 2020 2020 2020 2020   "w":..         
-0000db90: 2020 2072 6574 7572 6e20 7365 6c66 2e5f     return self._
-0000dba0: 6f70 656e 5f74 6f5f 7772 6974 6528 7a69  open_to_write(zi
-0000dbb0: 6e66 6f2c 2066 6f72 6365 5f7a 6970 3634  nfo, force_zip64
-0000dbc0: 3d66 6f72 6365 5f7a 6970 3634 290d 0a0d  =force_zip64)...
-0000dbd0: 0a20 2020 2020 2020 2069 6620 7365 6c66  .        if self
-0000dbe0: 2e5f 7772 6974 696e 673a 0d0a 2020 2020  ._writing:..    
-0000dbf0: 2020 2020 2020 2020 7261 6973 6520 5661          raise Va
-0000dc00: 6c75 6545 7272 6f72 280d 0a20 2020 2020  lueError(..     
-0000dc10: 2020 2020 2020 2020 2020 2022 4361 6e27             "Can'
-0000dc20: 7420 7265 6164 2066 726f 6d20 7468 6520  t read from the 
-0000dc30: 5a49 5020 6669 6c65 2077 6869 6c65 2074  ZIP file while t
-0000dc40: 6865 7265 2022 0d0a 2020 2020 2020 2020  here "..        
-0000dc50: 2020 2020 2020 2020 2269 7320 616e 206f          "is an o
-0000dc60: 7065 6e20 7772 6974 696e 6720 6861 6e64  pen writing hand
-0000dc70: 6c65 206f 6e20 6974 2e20 220d 0a20 2020  le on it. "..   
-0000dc80: 2020 2020 2020 2020 2020 2020 2022 436c               "Cl
-0000dc90: 6f73 6520 7468 6520 7772 6974 696e 6720  ose the writing 
-0000dca0: 6861 6e64 6c65 2062 6566 6f72 6520 7472  handle before tr
-0000dcb0: 7969 6e67 2074 6f20 7265 6164 2e22 2c0d  ying to read.",.
-0000dcc0: 0a20 2020 2020 2020 2020 2020 2029 0d0a  .            )..
-0000dcd0: 0d0a 2020 2020 2020 2020 2320 4f70 656e  ..        # Open
-0000dce0: 2066 6f72 2072 6561 6469 6e67 3a0d 0a20   for reading:.. 
-0000dcf0: 2020 2020 2020 2073 656c 662e 5f66 696c         self._fil
-0000dd00: 6552 6566 436e 7420 2b3d 2031 0d0a 2020  eRefCnt += 1..  
-0000dd10: 2020 2020 2020 7a65 665f 6669 6c65 203d        zef_file =
-0000dd20: 205f 5368 6172 6564 4669 6c65 280d 0a20   _SharedFile(.. 
-0000dd30: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-0000dd40: 6670 2c0d 0a20 2020 2020 2020 2020 2020  fp,..           
-0000dd50: 207a 696e 666f 2e68 6561 6465 725f 6f66   zinfo.header_of
-0000dd60: 6673 6574 2c0d 0a20 2020 2020 2020 2020  fset,..         
-0000dd70: 2020 2073 656c 662e 5f66 7063 6c6f 7365     self._fpclose
-0000dd80: 2c0d 0a20 2020 2020 2020 2020 2020 2073  ,..            s
-0000dd90: 656c 662e 5f6c 6f63 6b2c 0d0a 2020 2020  elf._lock,..    
-0000dda0: 2020 2020 2020 2020 6c61 6d62 6461 3a20          lambda: 
-0000ddb0: 7365 6c66 2e5f 7772 6974 696e 672c 0d0a  self._writing,..
-0000ddc0: 2020 2020 2020 2020 290d 0a20 2020 2020          )..     
-0000ddd0: 2020 2074 7279 3a0d 0a20 2020 2020 2020     try:..       
-0000dde0: 2020 2020 2023 2053 6b69 7020 7468 6520       # Skip the 
-0000ddf0: 6669 6c65 2068 6561 6465 723a 0d0a 2020  file header:..  
-0000de00: 2020 2020 2020 2020 2020 6668 6561 6465            fheade
-0000de10: 7220 3d20 7a65 665f 6669 6c65 2e72 6561  r = zef_file.rea
-0000de20: 6428 7369 7a65 4669 6c65 4865 6164 6572  d(sizeFileHeader
-0000de30: 290d 0a20 2020 2020 2020 2020 2020 2069  )..            i
-0000de40: 6620 6c65 6e28 6668 6561 6465 7229 2021  f len(fheader) !
-0000de50: 3d20 7369 7a65 4669 6c65 4865 6164 6572  = sizeFileHeader
-0000de60: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
-0000de70: 2020 2072 6169 7365 2042 6164 5a69 7046     raise BadZipF
-0000de80: 696c 6528 2254 7275 6e63 6174 6564 2066  ile("Truncated f
-0000de90: 696c 6520 6865 6164 6572 2229 0d0a 2020  ile header")..  
-0000dea0: 2020 2020 2020 2020 2020 6668 6561 6465            fheade
-0000deb0: 7220 3d20 7374 7275 6374 2e75 6e70 6163  r = struct.unpac
-0000dec0: 6b28 7374 7275 6374 4669 6c65 4865 6164  k(structFileHead
-0000ded0: 6572 2c20 6668 6561 6465 7229 0d0a 2020  er, fheader)..  
-0000dee0: 2020 2020 2020 2020 2020 6966 2066 6865            if fhe
-0000def0: 6164 6572 5b5f 4648 5f53 4947 4e41 5455  ader[_FH_SIGNATU
-0000df00: 5245 5d20 213d 2073 7472 696e 6746 696c  RE] != stringFil
-0000df10: 6548 6561 6465 723a 0d0a 2020 2020 2020  eHeader:..      
-0000df20: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
-0000df30: 4261 645a 6970 4669 6c65 2822 4261 6420  BadZipFile("Bad 
-0000df40: 6d61 6769 6320 6e75 6d62 6572 2066 6f72  magic number for
-0000df50: 2066 696c 6520 6865 6164 6572 2229 0d0a   file header")..
-0000df60: 0d0a 2020 2020 2020 2020 2020 2020 666e  ..            fn
-0000df70: 616d 6520 3d20 7a65 665f 6669 6c65 2e72  ame = zef_file.r
-0000df80: 6561 6428 6668 6561 6465 725b 5f46 485f  ead(fheader[_FH_
-0000df90: 4649 4c45 4e41 4d45 5f4c 454e 4754 485d  FILENAME_LENGTH]
-0000dfa0: 290d 0a20 2020 2020 2020 2020 2020 2069  )..            i
-0000dfb0: 6620 6668 6561 6465 725b 5f46 485f 4558  f fheader[_FH_EX
-0000dfc0: 5452 415f 4649 454c 445f 4c45 4e47 5448  TRA_FIELD_LENGTH
-0000dfd0: 5d3a 0d0a 2020 2020 2020 2020 2020 2020  ]:..            
-0000dfe0: 2020 2020 7a65 665f 6669 6c65 2e72 6561      zef_file.rea
-0000dff0: 6428 6668 6561 6465 725b 5f46 485f 4558  d(fheader[_FH_EX
-0000e000: 5452 415f 4649 454c 445f 4c45 4e47 5448  TRA_FIELD_LENGTH
-0000e010: 5d29 0d0a 0d0a 2020 2020 2020 2020 2020  ])....          
-0000e020: 2020 6966 207a 696e 666f 2e66 6c61 675f    if zinfo.flag_
-0000e030: 6269 7473 2026 2030 7832 303a 0d0a 2020  bits & 0x20:..  
-0000e040: 2020 2020 2020 2020 2020 2020 2020 2320                # 
-0000e050: 5a69 7020 322e 373a 2063 6f6d 7072 6573  Zip 2.7: compres
-0000e060: 7365 6420 7061 7463 6865 6420 6461 7461  sed patched data
-0000e070: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0000e080: 2020 7261 6973 6520 4e6f 7449 6d70 6c65    raise NotImple
-0000e090: 6d65 6e74 6564 4572 726f 7228 0d0a 2020  mentedError(..  
-0000e0a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e0b0: 2020 2263 6f6d 7072 6573 7365 6420 7061    "compressed pa
-0000e0c0: 7463 6865 6420 6461 7461 2028 666c 6167  tched data (flag
-0000e0d0: 2062 6974 2035 2922 2c0d 0a20 2020 2020   bit 5)",..     
-0000e0e0: 2020 2020 2020 2020 2020 2029 0d0a 0d0a             )....
-0000e0f0: 2020 2020 2020 2020 2020 2020 6966 207a              if z
-0000e100: 696e 666f 2e66 6c61 675f 6269 7473 2026  info.flag_bits &
-0000e110: 2030 7834 303a 0d0a 2020 2020 2020 2020   0x40:..        
-0000e120: 2020 2020 2020 2020 2320 7374 726f 6e67          # strong
-0000e130: 2065 6e63 7279 7074 696f 6e0d 0a20 2020   encryption..   
-0000e140: 2020 2020 2020 2020 2020 2020 2072 6169               rai
-0000e150: 7365 204e 6f74 496d 706c 656d 656e 7465  se NotImplemente
-0000e160: 6445 7272 6f72 2822 7374 726f 6e67 2065  dError("strong e
-0000e170: 6e63 7279 7074 696f 6e20 2866 6c61 6720  ncryption (flag 
-0000e180: 6269 7420 3629 2229 0d0a 0d0a 2020 2020  bit 6)")....    
-0000e190: 2020 2020 2020 2020 6966 207a 696e 666f          if zinfo
-0000e1a0: 2e66 6c61 675f 6269 7473 2026 2030 7838  .flag_bits & 0x8
-0000e1b0: 3030 3a0d 0a20 2020 2020 2020 2020 2020  00:..           
-0000e1c0: 2020 2020 2023 2055 5446 2d38 2066 696c       # UTF-8 fil
-0000e1d0: 656e 616d 650d 0a20 2020 2020 2020 2020  ename..         
-0000e1e0: 2020 2020 2020 2066 6e61 6d65 5f73 7472         fname_str
-0000e1f0: 203d 2066 6e61 6d65 2e64 6563 6f64 6528   = fname.decode(
-0000e200: 2275 7466 2d38 2229 0d0a 2020 2020 2020  "utf-8")..      
-0000e210: 2020 2020 2020 656c 7365 3a0d 0a20 2020        else:..   
-0000e220: 2020 2020 2020 2020 2020 2020 2066 6e61               fna
-0000e230: 6d65 5f73 7472 203d 2066 6e61 6d65 2e64  me_str = fname.d
-0000e240: 6563 6f64 6528 2263 7034 3337 2229 0d0a  ecode("cp437")..
-0000e250: 0d0a 2020 2020 2020 2020 2020 2020 6966  ..            if
-0000e260: 2066 6e61 6d65 5f73 7472 2021 3d20 7a69   fname_str != zi
-0000e270: 6e66 6f2e 6f72 6967 5f66 696c 656e 616d  nfo.orig_filenam
-0000e280: 653a 0d0a 2020 2020 2020 2020 2020 2020  e:..            
-0000e290: 2020 2020 7261 6973 6520 4261 645a 6970      raise BadZip
-0000e2a0: 4669 6c65 280d 0a20 2020 2020 2020 2020  File(..         
-0000e2b0: 2020 2020 2020 2020 2020 2066 2246 696c             f"Fil
-0000e2c0: 6520 6e61 6d65 2069 6e20 6469 7265 6374  e name in direct
-0000e2d0: 6f72 7920 7b7a 696e 666f 2e6f 7269 675f  ory {zinfo.orig_
-0000e2e0: 6669 6c65 6e61 6d65 2172 7d20 616e 6420  filename!r} and 
-0000e2f0: 6865 6164 6572 207b 666e 616d 6521 727d  header {fname!r}
-0000e300: 2064 6966 6665 722e 222c 0d0a 2020 2020   differ.",..    
-0000e310: 2020 2020 2020 2020 2020 2020 290d 0a0d              )...
-0000e320: 0a20 2020 2020 2020 2020 2020 2023 2063  .            # c
-0000e330: 6865 636b 2066 6f72 2065 6e63 7279 7074  heck for encrypt
-0000e340: 6564 2066 6c61 6720 2620 6861 6e64 6c65  ed flag & handle
-0000e350: 2070 6173 7377 6f72 640d 0a20 2020 2020   password..     
-0000e360: 2020 2020 2020 2069 735f 656e 6372 7970         is_encryp
-0000e370: 7465 6420 3d20 7a69 6e66 6f2e 666c 6167  ted = zinfo.flag
-0000e380: 5f62 6974 7320 2620 3078 310d 0a20 2020  _bits & 0x1..   
-0000e390: 2020 2020 2020 2020 2069 6620 6973 5f65           if is_e
-0000e3a0: 6e63 7279 7074 6564 3a0d 0a20 2020 2020  ncrypted:..     
-0000e3b0: 2020 2020 2020 2020 2020 2069 6620 6e6f             if no
-0000e3c0: 7420 7077 643a 0d0a 2020 2020 2020 2020  t pwd:..        
-0000e3d0: 2020 2020 2020 2020 2020 2020 7077 6420              pwd 
-0000e3e0: 3d20 7365 6c66 2e70 7764 0d0a 2020 2020  = self.pwd..    
-0000e3f0: 2020 2020 2020 2020 2020 2020 6966 206e              if n
-0000e400: 6f74 2070 7764 3a0d 0a20 2020 2020 2020  ot pwd:..       
-0000e410: 2020 2020 2020 2020 2020 2020 2072 6169               rai
-0000e420: 7365 2052 756e 7469 6d65 4572 726f 7228  se RuntimeError(
-0000e430: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0000e440: 2020 2020 2020 2020 2020 2246 696c 6520            "File 
-0000e450: 2572 2069 7320 656e 6372 7970 7465 642c  %r is encrypted,
-0000e460: 2070 6173 7377 6f72 6420 220d 0a20 2020   password "..   
-0000e470: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e480: 2020 2020 2022 7265 7175 6972 6564 2066       "required f
-0000e490: 6f72 2065 7874 7261 6374 696f 6e22 2025  or extraction" %
-0000e4a0: 206e 616d 652c 0d0a 2020 2020 2020 2020   name,..        
-0000e4b0: 2020 2020 2020 2020 2020 2020 290d 0a20              ).. 
-0000e4c0: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
-0000e4d0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0000e4e0: 2020 7077 6420 3d20 4e6f 6e65 0d0a 0d0a    pwd = None....
-0000e4f0: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-0000e500: 726e 205a 6970 4578 7446 696c 6528 7a65  rn ZipExtFile(ze
-0000e510: 665f 6669 6c65 2c20 6d6f 6465 2c20 7a69  f_file, mode, zi
-0000e520: 6e66 6f2c 2070 7764 2c20 5472 7565 290d  nfo, pwd, True).
-0000e530: 0a20 2020 2020 2020 2065 7863 6570 743a  .        except:
-0000e540: 0d0a 2020 2020 2020 2020 2020 2020 7a65  ..            ze
-0000e550: 665f 6669 6c65 2e63 6c6f 7365 2829 0d0a  f_file.close()..
-0000e560: 2020 2020 2020 2020 2020 2020 7261 6973              rais
-0000e570: 650d 0a0d 0a20 2020 2064 6566 205f 6f70  e....    def _op
-0000e580: 656e 5f74 6f5f 7772 6974 6528 7365 6c66  en_to_write(self
-0000e590: 2c20 7a69 6e66 6f2c 2066 6f72 6365 5f7a  , zinfo, force_z
-0000e5a0: 6970 3634 3d46 616c 7365 293a 0d0a 2020  ip64=False):..  
-0000e5b0: 2020 2020 2020 6966 2066 6f72 6365 5f7a        if force_z
-0000e5c0: 6970 3634 2061 6e64 206e 6f74 2073 656c  ip64 and not sel
-0000e5d0: 662e 5f61 6c6c 6f77 5a69 7036 343a 0d0a  f._allowZip64:..
-0000e5e0: 2020 2020 2020 2020 2020 2020 7261 6973              rais
-0000e5f0: 6520 5661 6c75 6545 7272 6f72 280d 0a20  e ValueError(.. 
-0000e600: 2020 2020 2020 2020 2020 2020 2020 2022                 "
-0000e610: 666f 7263 655f 7a69 7036 3420 6973 2054  force_zip64 is T
-0000e620: 7275 652c 2062 7574 2061 6c6c 6f77 5a69  rue, but allowZi
-0000e630: 7036 3420 7761 7320 4661 6c73 6520 7768  p64 was False wh
-0000e640: 656e 206f 7065 6e69 6e67 2022 0d0a 2020  en opening "..  
-0000e650: 2020 2020 2020 2020 2020 2020 2020 2274                "t
-0000e660: 6865 205a 4950 2066 696c 652e 222c 0d0a  he ZIP file.",..
-0000e670: 2020 2020 2020 2020 2020 2020 290d 0a20              ).. 
-0000e680: 2020 2020 2020 2069 6620 7365 6c66 2e5f         if self._
-0000e690: 7772 6974 696e 673a 0d0a 2020 2020 2020  writing:..      
-0000e6a0: 2020 2020 2020 7261 6973 6520 5661 6c75        raise Valu
-0000e6b0: 6545 7272 6f72 280d 0a20 2020 2020 2020  eError(..       
-0000e6c0: 2020 2020 2020 2020 2022 4361 6e27 7420           "Can't 
-0000e6d0: 7772 6974 6520 746f 2074 6865 205a 4950  write to the ZIP
-0000e6e0: 2066 696c 6520 7768 696c 6520 7468 6572   file while ther
-0000e6f0: 6520 6973 2022 0d0a 2020 2020 2020 2020  e is "..        
-0000e700: 2020 2020 2020 2020 2261 6e6f 7468 6572          "another
-0000e710: 2077 7269 7465 2068 616e 646c 6520 6f70   write handle op
-0000e720: 656e 206f 6e20 6974 2e20 220d 0a20 2020  en on it. "..   
-0000e730: 2020 2020 2020 2020 2020 2020 2022 436c               "Cl
-0000e740: 6f73 6520 7468 6520 6669 7273 7420 6861  ose the first ha
-0000e750: 6e64 6c65 2062 6566 6f72 6520 6f70 656e  ndle before open
-0000e760: 696e 6720 616e 6f74 6865 722e 222c 0d0a  ing another.",..
-0000e770: 2020 2020 2020 2020 2020 2020 290d 0a0d              )...
-0000e780: 0a20 2020 2020 2020 2023 2053 697a 6520  .        # Size 
-0000e790: 616e 6420 4352 4320 6172 6520 6f76 6572  and CRC are over
-0000e7a0: 7772 6974 7465 6e20 7769 7468 2063 6f72  written with cor
-0000e7b0: 7265 6374 2064 6174 6120 6166 7465 7220  rect data after 
-0000e7c0: 7072 6f63 6573 7369 6e67 2074 6865 2066  processing the f
-0000e7d0: 696c 650d 0a20 2020 2020 2020 207a 696e  ile..        zin
-0000e7e0: 666f 2e63 6f6d 7072 6573 735f 7369 7a65  fo.compress_size
-0000e7f0: 203d 2030 0d0a 2020 2020 2020 2020 7a69   = 0..        zi
-0000e800: 6e66 6f2e 4352 4320 3d20 300d 0a0d 0a20  nfo.CRC = 0.... 
-0000e810: 2020 2020 2020 207a 696e 666f 2e66 6c61         zinfo.fla
-0000e820: 675f 6269 7473 203d 2030 7830 300d 0a20  g_bits = 0x00.. 
-0000e830: 2020 2020 2020 2069 6620 7a69 6e66 6f2e         if zinfo.
-0000e840: 636f 6d70 7265 7373 5f74 7970 6520 3d3d  compress_type ==
-0000e850: 205a 4950 5f4c 5a4d 413a 0d0a 2020 2020   ZIP_LZMA:..    
-0000e860: 2020 2020 2020 2020 2320 436f 6d70 7265          # Compre
-0000e870: 7373 6564 2064 6174 6120 696e 636c 7564  ssed data includ
-0000e880: 6573 2061 6e20 656e 642d 6f66 2d73 7472  es an end-of-str
-0000e890: 6561 6d20 2845 4f53 2920 6d61 726b 6572  eam (EOS) marker
-0000e8a0: 0d0a 2020 2020 2020 2020 2020 2020 7a69  ..            zi
-0000e8b0: 6e66 6f2e 666c 6167 5f62 6974 7320 7c3d  nfo.flag_bits |=
-0000e8c0: 2030 7830 320d 0a20 2020 2020 2020 2069   0x02..        i
-0000e8d0: 6620 6e6f 7420 7365 6c66 2e5f 7365 656b  f not self._seek
-0000e8e0: 6162 6c65 3a0d 0a20 2020 2020 2020 2020  able:..         
-0000e8f0: 2020 207a 696e 666f 2e66 6c61 675f 6269     zinfo.flag_bi
-0000e900: 7473 207c 3d20 3078 3038 0d0a 0d0a 2020  ts |= 0x08....  
-0000e910: 2020 2020 2020 6966 206e 6f74 207a 696e        if not zin
-0000e920: 666f 2e65 7874 6572 6e61 6c5f 6174 7472  fo.external_attr
-0000e930: 3a0d 0a20 2020 2020 2020 2020 2020 207a  :..            z
-0000e940: 696e 666f 2e65 7874 6572 6e61 6c5f 6174  info.external_at
-0000e950: 7472 203d 2030 6f36 3030 203c 3c20 3136  tr = 0o600 << 16
-0000e960: 2020 2320 7065 726d 6973 7369 6f6e 733a    # permissions:
-0000e970: 203f 7277 2d2d 2d2d 2d2d 2d0d 0a0d 0a20   ?rw-------.... 
-0000e980: 2020 2020 2020 2023 2043 6f6d 7072 6573         # Compres
-0000e990: 7365 6420 7369 7a65 2063 616e 2062 6520  sed size can be 
-0000e9a0: 6c61 7267 6572 2074 6861 6e20 756e 636f  larger than unco
-0000e9b0: 6d70 7265 7373 6564 2073 697a 650d 0a20  mpressed size.. 
-0000e9c0: 2020 2020 2020 207a 6970 3634 203d 2073         zip64 = s
-0000e9d0: 656c 662e 5f61 6c6c 6f77 5a69 7036 3420  elf._allowZip64 
-0000e9e0: 616e 6420 280d 0a20 2020 2020 2020 2020  and (..         
-0000e9f0: 2020 2066 6f72 6365 5f7a 6970 3634 206f     force_zip64 o
-0000ea00: 7220 7a69 6e66 6f2e 6669 6c65 5f73 697a  r zinfo.file_siz
-0000ea10: 6520 2a20 312e 3035 203e 205a 4950 3634  e * 1.05 > ZIP64
-0000ea20: 5f4c 494d 4954 0d0a 2020 2020 2020 2020  _LIMIT..        
-0000ea30: 290d 0a0d 0a20 2020 2020 2020 2069 6620  )....        if 
-0000ea40: 7365 6c66 2e5f 7365 656b 6162 6c65 3a0d  self._seekable:.
-0000ea50: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-0000ea60: 662e 6670 2e73 6565 6b28 7365 6c66 2e73  f.fp.seek(self.s
-0000ea70: 7461 7274 5f64 6972 290d 0a20 2020 2020  tart_dir)..     
-0000ea80: 2020 207a 696e 666f 2e68 6561 6465 725f     zinfo.header_
-0000ea90: 6f66 6673 6574 203d 2073 656c 662e 6670  offset = self.fp
-0000eaa0: 2e74 656c 6c28 290d 0a0d 0a20 2020 2020  .tell()....     
-0000eab0: 2020 2073 656c 662e 5f77 7269 7465 6368     self._writech
-0000eac0: 6563 6b28 7a69 6e66 6f29 0d0a 2020 2020  eck(zinfo)..    
-0000ead0: 2020 2020 7365 6c66 2e5f 6469 644d 6f64      self._didMod
-0000eae0: 6966 7920 3d20 5472 7565 0d0a 0d0a 2020  ify = True....  
-0000eaf0: 2020 2020 2020 7365 6c66 2e66 702e 7772        self.fp.wr
-0000eb00: 6974 6528 7a69 6e66 6f2e 4669 6c65 4865  ite(zinfo.FileHe
-0000eb10: 6164 6572 287a 6970 3634 2929 0d0a 0d0a  ader(zip64))....
-0000eb20: 2020 2020 2020 2020 7365 6c66 2e5f 7772          self._wr
-0000eb30: 6974 696e 6720 3d20 5472 7565 0d0a 2020  iting = True..  
-0000eb40: 2020 2020 2020 7265 7475 726e 205f 5a69        return _Zi
-0000eb50: 7057 7269 7465 4669 6c65 2873 656c 662c  pWriteFile(self,
-0000eb60: 207a 696e 666f 2c20 7a69 7036 3429 0d0a   zinfo, zip64)..
-0000eb70: 0d0a 2020 2020 6465 6620 6578 7472 6163  ..    def extrac
-0000eb80: 7428 7365 6c66 2c20 6d65 6d62 6572 2c20  t(self, member, 
-0000eb90: 7061 7468 3d4e 6f6e 652c 2070 7764 3d4e  path=None, pwd=N
-0000eba0: 6f6e 6529 3a0d 0a20 2020 2020 2020 2022  one):..        "
-0000ebb0: 2222 4578 7472 6163 7420 6120 6d65 6d62  ""Extract a memb
-0000ebc0: 6572 2066 726f 6d20 7468 6520 6172 6368  er from the arch
-0000ebd0: 6976 6520 746f 2074 6865 2063 7572 7265  ive to the curre
-0000ebe0: 6e74 2077 6f72 6b69 6e67 2064 6972 6563  nt working direc
-0000ebf0: 746f 7279 2c0d 0a20 2020 2020 2020 2075  tory,..        u
-0000ec00: 7369 6e67 2069 7473 2066 756c 6c20 6e61  sing its full na
-0000ec10: 6d65 2e20 4974 7320 6669 6c65 2069 6e66  me. Its file inf
-0000ec20: 6f72 6d61 7469 6f6e 2069 7320 6578 7472  ormation is extr
-0000ec30: 6163 7465 6420 6173 2061 6363 7572 6174  acted as accurat
-0000ec40: 656c 790d 0a20 2020 2020 2020 2061 7320  ely..        as 
-0000ec50: 706f 7373 6962 6c65 2e20 606d 656d 6265  possible. `membe
-0000ec60: 7227 206d 6179 2062 6520 6120 6669 6c65  r' may be a file
-0000ec70: 6e61 6d65 206f 7220 6120 5a69 7049 6e66  name or a ZipInf
-0000ec80: 6f20 6f62 6a65 6374 2e20 596f 7520 6361  o object. You ca
-0000ec90: 6e0d 0a20 2020 2020 2020 2073 7065 6369  n..        speci
-0000eca0: 6679 2061 2064 6966 6665 7265 6e74 2064  fy a different d
-0000ecb0: 6972 6563 746f 7279 2075 7369 6e67 2060  irectory using `
-0000ecc0: 7061 7468 272e 0d0a 2020 2020 2020 2020  path'...        
-0000ecd0: 2222 220d 0a20 2020 2020 2020 2070 6174  """..        pat
-0000ece0: 6820 3d20 6f73 2e67 6574 6377 6428 2920  h = os.getcwd() 
-0000ecf0: 6966 2070 6174 6820 6973 204e 6f6e 6520  if path is None 
-0000ed00: 656c 7365 206f 732e 6673 7061 7468 2870  else os.fspath(p
-0000ed10: 6174 6829 0d0a 0d0a 2020 2020 2020 2020  ath)....        
-0000ed20: 7265 7475 726e 2073 656c 662e 5f65 7874  return self._ext
-0000ed30: 7261 6374 5f6d 656d 6265 7228 6d65 6d62  ract_member(memb
-0000ed40: 6572 2c20 7061 7468 2c20 7077 6429 0d0a  er, path, pwd)..
-0000ed50: 0d0a 2020 2020 6465 6620 6578 7472 6163  ..    def extrac
-0000ed60: 7461 6c6c 2873 656c 662c 2070 6174 683d  tall(self, path=
-0000ed70: 4e6f 6e65 2c20 6d65 6d62 6572 733d 4e6f  None, members=No
-0000ed80: 6e65 2c20 7077 643d 4e6f 6e65 293a 0d0a  ne, pwd=None):..
-0000ed90: 2020 2020 2020 2020 2222 2245 7874 7261          """Extra
-0000eda0: 6374 2061 6c6c 206d 656d 6265 7273 2066  ct all members f
-0000edb0: 726f 6d20 7468 6520 6172 6368 6976 6520  rom the archive 
-0000edc0: 746f 2074 6865 2063 7572 7265 6e74 2077  to the current w
-0000edd0: 6f72 6b69 6e67 0d0a 2020 2020 2020 2020  orking..        
-0000ede0: 6469 7265 6374 6f72 792e 2060 7061 7468  directory. `path
-0000edf0: 2720 7370 6563 6966 6965 7320 6120 6469  ' specifies a di
-0000ee00: 6666 6572 656e 7420 6469 7265 6374 6f72  fferent director
-0000ee10: 7920 746f 2065 7874 7261 6374 2074 6f2e  y to extract to.
-0000ee20: 0d0a 2020 2020 2020 2020 606d 656d 6265  ..        `membe
-0000ee30: 7273 2720 6973 206f 7074 696f 6e61 6c20  rs' is optional 
-0000ee40: 616e 6420 6d75 7374 2062 6520 6120 7375  and must be a su
-0000ee50: 6273 6574 206f 6620 7468 6520 6c69 7374  bset of the list
-0000ee60: 2072 6574 7572 6e65 640d 0a20 2020 2020   returned..     
-0000ee70: 2020 2062 7920 6e61 6d65 6c69 7374 2829     by namelist()
-0000ee80: 2e0d 0a20 2020 2020 2020 2022 2222 0d0a  ...        """..
-0000ee90: 2020 2020 2020 2020 6966 206d 656d 6265          if membe
-0000eea0: 7273 2069 7320 4e6f 6e65 3a0d 0a20 2020  rs is None:..   
-0000eeb0: 2020 2020 2020 2020 206d 656d 6265 7273           members
-0000eec0: 203d 2073 656c 662e 6e61 6d65 6c69 7374   = self.namelist
-0000eed0: 2829 0d0a 0d0a 2020 2020 2020 2020 7061  ()....        pa
-0000eee0: 7468 203d 206f 732e 6765 7463 7764 2829  th = os.getcwd()
-0000eef0: 2069 6620 7061 7468 2069 7320 4e6f 6e65   if path is None
-0000ef00: 2065 6c73 6520 6f73 2e66 7370 6174 6828   else os.fspath(
-0000ef10: 7061 7468 290d 0a0d 0a20 2020 2020 2020  path)....       
-0000ef20: 2066 6f72 207a 6970 696e 666f 2069 6e20   for zipinfo in 
-0000ef30: 6d65 6d62 6572 733a 0d0a 2020 2020 2020  members:..      
-0000ef40: 2020 2020 2020 7365 6c66 2e5f 6578 7472        self._extr
-0000ef50: 6163 745f 6d65 6d62 6572 287a 6970 696e  act_member(zipin
-0000ef60: 666f 2c20 7061 7468 2c20 7077 6429 0d0a  fo, path, pwd)..
-0000ef70: 0d0a 2020 2020 6465 6620 7265 6d6f 7665  ..    def remove
-0000ef80: 2873 656c 662c 206d 656d 6265 7229 3a0d  (self, member):.
-0000ef90: 0a20 2020 2020 2020 2022 2222 5265 6d6f  .        """Remo
-0000efa0: 7665 2061 2066 696c 6520 6672 6f6d 2074  ve a file from t
-0000efb0: 6865 2061 7263 6869 7665 2e20 5468 6520  he archive. The 
-0000efc0: 6172 6368 6976 6520 6d75 7374 2062 6520  archive must be 
-0000efd0: 6f70 656e 2077 6974 6820 6d6f 6465 2027  open with mode '
-0000efe0: 6127 2e22 2222 0d0a 2020 2020 2020 2020  a'."""..        
-0000eff0: 6966 2073 656c 662e 6d6f 6465 2021 3d20  if self.mode != 
-0000f000: 2261 223a 0d0a 2020 2020 2020 2020 2020  "a":..          
-0000f010: 2020 7261 6973 6520 5275 6e74 696d 6545    raise RuntimeE
-0000f020: 7272 6f72 2822 7265 6d6f 7665 2829 2072  rror("remove() r
-0000f030: 6571 7569 7265 7320 6d6f 6465 2027 6127  equires mode 'a'
-0000f040: 2229 0d0a 2020 2020 2020 2020 6966 206e  ")..        if n
-0000f050: 6f74 2073 656c 662e 6670 3a0d 0a20 2020  ot self.fp:..   
-0000f060: 2020 2020 2020 2020 2072 6169 7365 2056           raise V
-0000f070: 616c 7565 4572 726f 7228 0d0a 2020 2020  alueError(..    
-0000f080: 2020 2020 2020 2020 2020 2020 2241 7474              "Att
-0000f090: 656d 7074 2074 6f20 7772 6974 6520 746f  empt to write to
-0000f0a0: 205a 4950 2061 7263 6869 7665 2074 6861   ZIP archive tha
-0000f0b0: 7420 7761 7320 616c 7265 6164 7920 636c  t was already cl
-0000f0c0: 6f73 6564 222c 0d0a 2020 2020 2020 2020  osed",..        
-0000f0d0: 2020 2020 290d 0a20 2020 2020 2020 2069      )..        i
-0000f0e0: 6620 7365 6c66 2e5f 7772 6974 696e 673a  f self._writing:
-0000f0f0: 0d0a 2020 2020 2020 2020 2020 2020 7261  ..            ra
-0000f100: 6973 6520 5661 6c75 6545 7272 6f72 280d  ise ValueError(.
-0000f110: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000f120: 2022 4361 6e27 7420 7772 6974 6520 746f   "Can't write to
-0000f130: 205a 4950 2061 7263 6869 7665 2077 6869   ZIP archive whi
-0000f140: 6c65 2061 6e20 6f70 656e 2077 7269 7469  le an open writi
-0000f150: 6e67 2068 616e 646c 6520 6578 6973 7473  ng handle exists
-0000f160: 2e22 2c0d 0a20 2020 2020 2020 2020 2020  .",..           
-0000f170: 2029 0d0a 0d0a 2020 2020 2020 2020 2320   )....        # 
-0000f180: 4d61 6b65 2073 7572 6520 7765 2068 6176  Make sure we hav
-0000f190: 6520 616e 2069 6e66 6f20 6f62 6a65 6374  e an info object
-0000f1a0: 0d0a 2020 2020 2020 2020 6966 2069 7369  ..        if isi
-0000f1b0: 6e73 7461 6e63 6528 6d65 6d62 6572 2c20  nstance(member, 
-0000f1c0: 5a69 7049 6e66 6f29 3a0d 0a20 2020 2020  ZipInfo):..     
-0000f1d0: 2020 2020 2020 2023 2027 6d65 6d62 6572         # 'member
-0000f1e0: 2720 6973 2061 6c72 6561 6479 2061 6e20  ' is already an 
-0000f1f0: 696e 666f 206f 626a 6563 740d 0a20 2020  info object..   
-0000f200: 2020 2020 2020 2020 207a 696e 666f 203d           zinfo =
-0000f210: 206d 656d 6265 720d 0a20 2020 2020 2020   member..       
-0000f220: 2065 6c73 653a 0d0a 2020 2020 2020 2020   else:..        
-0000f230: 2020 2020 2320 6765 7420 7468 6520 696e      # get the in
-0000f240: 666f 206f 626a 6563 740d 0a20 2020 2020  fo object..     
-0000f250: 2020 2020 2020 207a 696e 666f 203d 2073         zinfo = s
-0000f260: 656c 662e 6765 7469 6e66 6f28 6d65 6d62  elf.getinfo(memb
-0000f270: 6572 290d 0a0d 0a20 2020 2020 2020 2072  er)....        r
-0000f280: 6574 7572 6e20 7365 6c66 2e5f 7265 6d6f  eturn self._remo
-0000f290: 7665 5f6d 656d 6265 7228 7a69 6e66 6f29  ve_member(zinfo)
-0000f2a0: 0d0a 0d0a 2020 2020 4063 6c61 7373 6d65  ....    @classme
-0000f2b0: 7468 6f64 0d0a 2020 2020 6465 6620 5f73  thod..    def _s
-0000f2c0: 616e 6974 697a 655f 7769 6e64 6f77 735f  anitize_windows_
-0000f2d0: 6e61 6d65 2863 6c73 2c20 6172 636e 616d  name(cls, arcnam
-0000f2e0: 652c 2070 6174 6873 6570 293a 0d0a 2020  e, pathsep):..  
-0000f2f0: 2020 2020 2020 2222 2252 6570 6c61 6365        """Replace
-0000f300: 2062 6164 2063 6861 7261 6374 6572 7320   bad characters 
-0000f310: 616e 6420 7265 6d6f 7665 2074 7261 696c  and remove trail
-0000f320: 696e 6720 646f 7473 2066 726f 6d20 7061  ing dots from pa
-0000f330: 7274 732e 2222 220d 0a20 2020 2020 2020  rts."""..       
-0000f340: 2074 6162 6c65 203d 2063 6c73 2e5f 7769   table = cls._wi
-0000f350: 6e64 6f77 735f 696c 6c65 6761 6c5f 6e61  ndows_illegal_na
-0000f360: 6d65 5f74 7261 6e73 5f74 6162 6c65 0d0a  me_trans_table..
-0000f370: 2020 2020 2020 2020 6966 206e 6f74 2074          if not t
-0000f380: 6162 6c65 3a0d 0a20 2020 2020 2020 2020  able:..         
-0000f390: 2020 2069 6c6c 6567 616c 203d 2027 3a3c     illegal = ':<
-0000f3a0: 3e7c 223f 2a27 0d0a 2020 2020 2020 2020  >|"?*'..        
-0000f3b0: 2020 2020 7461 626c 6520 3d20 7374 722e      table = str.
-0000f3c0: 6d61 6b65 7472 616e 7328 696c 6c65 6761  maketrans(illega
-0000f3d0: 6c2c 2022 5f22 202a 206c 656e 2869 6c6c  l, "_" * len(ill
-0000f3e0: 6567 616c 2929 0d0a 2020 2020 2020 2020  egal))..        
-0000f3f0: 2020 2020 636c 732e 5f77 696e 646f 7773      cls._windows
-0000f400: 5f69 6c6c 6567 616c 5f6e 616d 655f 7472  _illegal_name_tr
-0000f410: 616e 735f 7461 626c 6520 3d20 7461 626c  ans_table = tabl
-0000f420: 650d 0a20 2020 2020 2020 2061 7263 6e61  e..        arcna
-0000f430: 6d65 203d 2061 7263 6e61 6d65 2e74 7261  me = arcname.tra
-0000f440: 6e73 6c61 7465 2874 6162 6c65 290d 0a20  nslate(table).. 
-0000f450: 2020 2020 2020 2023 2072 656d 6f76 6520         # remove 
-0000f460: 7472 6169 6c69 6e67 2064 6f74 730d 0a20  trailing dots.. 
-0000f470: 2020 2020 2020 2061 7263 6e61 6d65 203d         arcname =
-0000f480: 2028 782e 7273 7472 6970 2822 2e22 2920   (x.rstrip(".") 
-0000f490: 666f 7220 7820 696e 2061 7263 6e61 6d65  for x in arcname
-0000f4a0: 2e73 706c 6974 2870 6174 6873 6570 2929  .split(pathsep))
-0000f4b0: 0d0a 2020 2020 2020 2020 2320 7265 6a6f  ..        # rejo
-0000f4c0: 696e 2c20 7265 6d6f 7669 6e67 2065 6d70  in, removing emp
-0000f4d0: 7479 2070 6172 7473 2e0d 0a20 2020 2020  ty parts...     
-0000f4e0: 2020 2061 7263 6e61 6d65 203d 2070 6174     arcname = pat
-0000f4f0: 6873 6570 2e6a 6f69 6e28 7820 666f 7220  hsep.join(x for 
-0000f500: 7820 696e 2061 7263 6e61 6d65 2069 6620  x in arcname if 
-0000f510: 7829 0d0a 2020 2020 2020 2020 7265 7475  x)..        retu
-0000f520: 726e 2061 7263 6e61 6d65 0d0a 0d0a 2020  rn arcname....  
-0000f530: 2020 6465 6620 5f65 7874 7261 6374 5f6d    def _extract_m
-0000f540: 656d 6265 7228 7365 6c66 2c20 6d65 6d62  ember(self, memb
-0000f550: 6572 2c20 7461 7267 6574 7061 7468 2c20  er, targetpath, 
-0000f560: 7077 6429 3a0d 0a20 2020 2020 2020 2022  pwd):..        "
-0000f570: 2222 4578 7472 6163 7420 7468 6520 5a69  ""Extract the Zi
-0000f580: 7049 6e66 6f20 6f62 6a65 6374 2027 6d65  pInfo object 'me
-0000f590: 6d62 6572 2720 746f 2061 2070 6879 7369  mber' to a physi
-0000f5a0: 6361 6c0d 0a20 2020 2020 2020 2066 696c  cal..        fil
-0000f5b0: 6520 6f6e 2074 6865 2070 6174 6820 7461  e on the path ta
-0000f5c0: 7267 6574 7061 7468 2e0d 0a20 2020 2020  rgetpath...     
-0000f5d0: 2020 2022 2222 0d0a 2020 2020 2020 2020     """..        
-0000f5e0: 6966 206e 6f74 2069 7369 6e73 7461 6e63  if not isinstanc
-0000f5f0: 6528 6d65 6d62 6572 2c20 5a69 7049 6e66  e(member, ZipInf
-0000f600: 6f29 3a0d 0a20 2020 2020 2020 2020 2020  o):..           
-0000f610: 206d 656d 6265 7220 3d20 7365 6c66 2e67   member = self.g
-0000f620: 6574 696e 666f 286d 656d 6265 7229 0d0a  etinfo(member)..
-0000f630: 0d0a 2020 2020 2020 2020 2320 6275 696c  ..        # buil
-0000f640: 6420 7468 6520 6465 7374 696e 6174 696f  d the destinatio
-0000f650: 6e20 7061 7468 6e61 6d65 2c20 7265 706c  n pathname, repl
-0000f660: 6163 696e 670d 0a20 2020 2020 2020 2023  acing..        #
-0000f670: 2066 6f72 7761 7264 2073 6c61 7368 6573   forward slashes
-0000f680: 2074 6f20 706c 6174 666f 726d 2073 7065   to platform spe
-0000f690: 6369 6669 6320 7365 7061 7261 746f 7273  cific separators
-0000f6a0: 2e0d 0a20 2020 2020 2020 2061 7263 6e61  ...        arcna
-0000f6b0: 6d65 203d 206d 656d 6265 722e 6669 6c65  me = member.file
-0000f6c0: 6e61 6d65 2e72 6570 6c61 6365 2822 2f22  name.replace("/"
-0000f6d0: 2c20 6f73 2e70 6174 682e 7365 7029 0d0a  , os.path.sep)..
-0000f6e0: 0d0a 2020 2020 2020 2020 6966 206f 732e  ..        if os.
-0000f6f0: 7061 7468 2e61 6c74 7365 703a 0d0a 2020  path.altsep:..  
-0000f700: 2020 2020 2020 2020 2020 6172 636e 616d            arcnam
-0000f710: 6520 3d20 6172 636e 616d 652e 7265 706c  e = arcname.repl
-0000f720: 6163 6528 6f73 2e70 6174 682e 616c 7473  ace(os.path.alts
-0000f730: 6570 2c20 6f73 2e70 6174 682e 7365 7029  ep, os.path.sep)
-0000f740: 0d0a 2020 2020 2020 2020 2320 696e 7465  ..        # inte
-0000f750: 7270 7265 7420 6162 736f 6c75 7465 2070  rpret absolute p
-0000f760: 6174 686e 616d 6520 6173 2072 656c 6174  athname as relat
-0000f770: 6976 652c 2072 656d 6f76 6520 6472 6976  ive, remove driv
-0000f780: 6520 6c65 7474 6572 206f 720d 0a20 2020  e letter or..   
-0000f790: 2020 2020 2023 2055 4e43 2070 6174 682c       # UNC path,
-0000f7a0: 2072 6564 756e 6461 6e74 2073 6570 6172   redundant separ
-0000f7b0: 6174 6f72 732c 2022 2e22 2061 6e64 2022  ators, "." and "
-0000f7c0: 2e2e 2220 636f 6d70 6f6e 656e 7473 2e0d  .." components..
-0000f7d0: 0a20 2020 2020 2020 2061 7263 6e61 6d65  .        arcname
-0000f7e0: 203d 206f 732e 7061 7468 2e73 706c 6974   = os.path.split
-0000f7f0: 6472 6976 6528 6172 636e 616d 6529 5b31  drive(arcname)[1
-0000f800: 5d0d 0a20 2020 2020 2020 2069 6e76 616c  ]..        inval
-0000f810: 6964 5f70 6174 685f 7061 7274 7320 3d20  id_path_parts = 
-0000f820: 2822 222c 206f 732e 7061 7468 2e63 7572  ("", os.path.cur
-0000f830: 6469 722c 206f 732e 7061 7468 2e70 6172  dir, os.path.par
-0000f840: 6469 7229 0d0a 2020 2020 2020 2020 6172  dir)..        ar
-0000f850: 636e 616d 6520 3d20 6f73 2e70 6174 682e  cname = os.path.
-0000f860: 7365 702e 6a6f 696e 280d 0a20 2020 2020  sep.join(..     
-0000f870: 2020 2020 2020 2078 0d0a 2020 2020 2020         x..      
-0000f880: 2020 2020 2020 666f 7220 7820 696e 2061        for x in a
-0000f890: 7263 6e61 6d65 2e73 706c 6974 286f 732e  rcname.split(os.
-0000f8a0: 7061 7468 2e73 6570 290d 0a20 2020 2020  path.sep)..     
-0000f8b0: 2020 2020 2020 2069 6620 7820 6e6f 7420         if x not 
-0000f8c0: 696e 2069 6e76 616c 6964 5f70 6174 685f  in invalid_path_
-0000f8d0: 7061 7274 730d 0a20 2020 2020 2020 2029  parts..        )
-0000f8e0: 0d0a 2020 2020 2020 2020 6966 206f 732e  ..        if os.
-0000f8f0: 7061 7468 2e73 6570 203d 3d20 225c 5c22  path.sep == "\\"
-0000f900: 3a0d 0a20 2020 2020 2020 2020 2020 2023  :..            #
-0000f910: 2066 696c 7465 7220 696c 6c65 6761 6c20   filter illegal 
-0000f920: 6368 6172 6163 7465 7273 206f 6e20 5769  characters on Wi
-0000f930: 6e64 6f77 730d 0a20 2020 2020 2020 2020  ndows..         
-0000f940: 2020 2061 7263 6e61 6d65 203d 2073 656c     arcname = sel
-0000f950: 662e 5f73 616e 6974 697a 655f 7769 6e64  f._sanitize_wind
-0000f960: 6f77 735f 6e61 6d65 2861 7263 6e61 6d65  ows_name(arcname
-0000f970: 2c20 6f73 2e70 6174 682e 7365 7029 0d0a  , os.path.sep)..
-0000f980: 0d0a 2020 2020 2020 2020 7461 7267 6574  ..        target
-0000f990: 7061 7468 203d 206f 732e 7061 7468 2e6a  path = os.path.j
-0000f9a0: 6f69 6e28 7461 7267 6574 7061 7468 2c20  oin(targetpath, 
-0000f9b0: 6172 636e 616d 6529 0d0a 2020 2020 2020  arcname)..      
-0000f9c0: 2020 7461 7267 6574 7061 7468 203d 206f    targetpath = o
-0000f9d0: 732e 7061 7468 2e6e 6f72 6d70 6174 6828  s.path.normpath(
-0000f9e0: 7461 7267 6574 7061 7468 290d 0a0d 0a20  targetpath).... 
-0000f9f0: 2020 2020 2020 2023 2043 7265 6174 6520         # Create 
-0000fa00: 616c 6c20 7570 7065 7220 6469 7265 6374  all upper direct
-0000fa10: 6f72 6965 7320 6966 206e 6563 6573 7361  ories if necessa
-0000fa20: 7279 2e0d 0a20 2020 2020 2020 2075 7070  ry...        upp
-0000fa30: 6572 6469 7273 203d 206f 732e 7061 7468  erdirs = os.path
-0000fa40: 2e64 6972 6e61 6d65 2874 6172 6765 7470  .dirname(targetp
-0000fa50: 6174 6829 0d0a 2020 2020 2020 2020 6966  ath)..        if
-0000fa60: 2075 7070 6572 6469 7273 2061 6e64 206e   upperdirs and n
-0000fa70: 6f74 206f 732e 7061 7468 2e65 7869 7374  ot os.path.exist
-0000fa80: 7328 7570 7065 7264 6972 7329 3a0d 0a20  s(upperdirs):.. 
-0000fa90: 2020 2020 2020 2020 2020 206f 732e 6d61             os.ma
-0000faa0: 6b65 6469 7273 2875 7070 6572 6469 7273  kedirs(upperdirs
-0000fab0: 290d 0a0d 0a20 2020 2020 2020 2069 6620  )....        if 
-0000fac0: 6d65 6d62 6572 2e69 735f 6469 7228 293a  member.is_dir():
-0000fad0: 0d0a 2020 2020 2020 2020 2020 2020 6966  ..            if
-0000fae0: 206e 6f74 206f 732e 7061 7468 2e69 7364   not os.path.isd
-0000faf0: 6972 2874 6172 6765 7470 6174 6829 3a0d  ir(targetpath):.
-0000fb00: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000fb10: 206f 732e 6d6b 6469 7228 7461 7267 6574   os.mkdir(target
-0000fb20: 7061 7468 290d 0a20 2020 2020 2020 2020  path)..         
-0000fb30: 2020 2072 6574 7572 6e20 7461 7267 6574     return target
-0000fb40: 7061 7468 0d0a 0d0a 2020 2020 2020 2020  path....        
-0000fb50: 7769 7468 2073 656c 662e 6f70 656e 286d  with self.open(m
-0000fb60: 656d 6265 722c 2070 7764 3d70 7764 2920  ember, pwd=pwd) 
-0000fb70: 6173 2073 6f75 7263 652c 206f 7065 6e28  as source, open(
-0000fb80: 0d0a 2020 2020 2020 2020 2020 2020 7461  ..            ta
-0000fb90: 7267 6574 7061 7468 2c0d 0a20 2020 2020  rgetpath,..     
-0000fba0: 2020 2020 2020 2022 7762 222c 0d0a 2020         "wb",..  
-0000fbb0: 2020 2020 2020 2920 6173 2074 6172 6765        ) as targe
-0000fbc0: 743a 0d0a 2020 2020 2020 2020 2020 2020  t:..            
-0000fbd0: 7368 7574 696c 2e63 6f70 7966 696c 656f  shutil.copyfileo
-0000fbe0: 626a 2873 6f75 7263 652c 2074 6172 6765  bj(source, targe
-0000fbf0: 7429 0d0a 0d0a 2020 2020 2020 2020 7265  t)....        re
-0000fc00: 7475 726e 2074 6172 6765 7470 6174 680d  turn targetpath.
-0000fc10: 0a0d 0a20 2020 2064 6566 205f 7265 6d6f  ...    def _remo
-0000fc20: 7665 5f6d 656d 6265 7228 7365 6c66 2c20  ve_member(self, 
-0000fc30: 6d65 6d62 6572 293a 0d0a 2020 2020 2020  member):..      
-0000fc40: 2020 2320 6765 7420 6120 736f 7274 6564    # get a sorted
-0000fc50: 2066 696c 656c 6973 7420 6279 2068 6561   filelist by hea
-0000fc60: 6465 7220 6f66 6673 6574 2c20 696e 2063  der offset, in c
-0000fc70: 6173 6520 7468 6520 6469 7220 6f72 6465  ase the dir orde
-0000fc80: 720d 0a20 2020 2020 2020 2023 2064 6f65  r..        # doe
-0000fc90: 736e 2774 206d 6174 6368 2074 6865 2061  sn't match the a
-0000fca0: 6374 7561 6c20 656e 7472 7920 6f72 6465  ctual entry orde
-0000fcb0: 720d 0a20 2020 2020 2020 2066 7020 3d20  r..        fp = 
-0000fcc0: 7365 6c66 2e66 700d 0a20 2020 2020 2020  self.fp..       
-0000fcd0: 2065 6e74 7279 5f6f 6666 7365 7420 3d20   entry_offset = 
-0000fce0: 300d 0a20 2020 2020 2020 2066 696c 656c  0..        filel
-0000fcf0: 6973 7420 3d20 736f 7274 6564 2873 656c  ist = sorted(sel
-0000fd00: 662e 6669 6c65 6c69 7374 2c20 6b65 793d  f.filelist, key=
-0000fd10: 6174 7472 6765 7474 6572 2822 6865 6164  attrgetter("head
-0000fd20: 6572 5f6f 6666 7365 7422 2929 0d0a 2020  er_offset"))..  
-0000fd30: 2020 2020 2020 666f 7220 6920 696e 2072        for i in r
-0000fd40: 616e 6765 286c 656e 2866 696c 656c 6973  ange(len(filelis
-0000fd50: 7429 293a 0d0a 2020 2020 2020 2020 2020  t)):..          
-0000fd60: 2020 696e 666f 203d 2066 696c 656c 6973    info = filelis
-0000fd70: 745b 695d 0d0a 2020 2020 2020 2020 2020  t[i]..          
-0000fd80: 2020 2320 6669 6e64 2074 6865 2074 6172    # find the tar
-0000fd90: 6765 7420 6d65 6d62 6572 0d0a 2020 2020  get member..    
-0000fda0: 2020 2020 2020 2020 6966 2069 6e66 6f2e          if info.
-0000fdb0: 6865 6164 6572 5f6f 6666 7365 7420 3c20  header_offset < 
-0000fdc0: 6d65 6d62 6572 2e68 6561 6465 725f 6f66  member.header_of
-0000fdd0: 6673 6574 3a0d 0a20 2020 2020 2020 2020  fset:..         
-0000fde0: 2020 2020 2020 2063 6f6e 7469 6e75 650d         continue.
-0000fdf0: 0a0d 0a20 2020 2020 2020 2020 2020 2023  ...            #
-0000fe00: 2067 6574 2074 6865 2074 6f74 616c 2073   get the total s
-0000fe10: 697a 6520 6f66 2074 6865 2065 6e74 7279  ize of the entry
-0000fe20: 0d0a 2020 2020 2020 2020 2020 2020 656e  ..            en
-0000fe30: 7472 795f 7369 7a65 203d 204e 6f6e 650d  try_size = None.
-0000fe40: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-0000fe50: 6920 3d3d 206c 656e 2866 696c 656c 6973  i == len(filelis
-0000fe60: 7429 202d 2031 3a0d 0a20 2020 2020 2020  t) - 1:..       
-0000fe70: 2020 2020 2020 2020 2065 6e74 7279 5f73           entry_s
-0000fe80: 697a 6520 3d20 7365 6c66 2e73 7461 7274  ize = self.start
-0000fe90: 5f64 6972 202d 2069 6e66 6f2e 6865 6164  _dir - info.head
-0000fea0: 6572 5f6f 6666 7365 740d 0a20 2020 2020  er_offset..     
-0000feb0: 2020 2020 2020 2065 6c73 653a 0d0a 2020         else:..  
-0000fec0: 2020 2020 2020 2020 2020 2020 2020 656e                en
-0000fed0: 7472 795f 7369 7a65 203d 2066 696c 656c  try_size = filel
-0000fee0: 6973 745b 6920 2b20 315d 2e68 6561 6465  ist[i + 1].heade
-0000fef0: 725f 6f66 6673 6574 202d 2069 6e66 6f2e  r_offset - info.
-0000ff00: 6865 6164 6572 5f6f 6666 7365 740d 0a0d  header_offset...
-0000ff10: 0a20 2020 2020 2020 2020 2020 2023 2066  .            # f
-0000ff20: 6f75 6e64 2074 6865 206d 656d 6265 722c  ound the member,
-0000ff30: 2073 6574 2074 6865 2065 6e74 7279 206f   set the entry o
-0000ff40: 6666 7365 740d 0a20 2020 2020 2020 2020  ffset..         
-0000ff50: 2020 2069 6620 6d65 6d62 6572 203d 3d20     if member == 
-0000ff60: 696e 666f 3a0d 0a20 2020 2020 2020 2020  info:..         
-0000ff70: 2020 2020 2020 2065 6e74 7279 5f6f 6666         entry_off
-0000ff80: 7365 7420 3d20 656e 7472 795f 7369 7a65  set = entry_size
-0000ff90: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0000ffa0: 2020 636f 6e74 696e 7565 0d0a 0d0a 2020    continue....  
-0000ffb0: 2020 2020 2020 2020 2020 2320 4d6f 7665            # Move
-0000ffc0: 2065 6e74 7279 0d0a 2020 2020 2020 2020   entry..        
-0000ffd0: 2020 2020 2320 7265 6164 2074 6865 2061      # read the a
-0000ffe0: 6374 7561 6c20 656e 7472 7920 6461 7461  ctual entry data
-0000fff0: 0d0a 2020 2020 2020 2020 2020 2020 6670  ..            fp
-00010000: 2e73 6565 6b28 696e 666f 2e68 6561 6465  .seek(info.heade
-00010010: 725f 6f66 6673 6574 290d 0a20 2020 2020  r_offset)..     
-00010020: 2020 2020 2020 2065 6e74 7279 5f64 6174         entry_dat
-00010030: 6120 3d20 6670 2e72 6561 6428 656e 7472  a = fp.read(entr
-00010040: 795f 7369 7a65 290d 0a0d 0a20 2020 2020  y_size)....     
-00010050: 2020 2020 2020 2023 2075 7064 6174 6520         # update 
-00010060: 7468 6520 6865 6164 6572 0d0a 2020 2020  the header..    
-00010070: 2020 2020 2020 2020 696e 666f 2e68 6561          info.hea
-00010080: 6465 725f 6f66 6673 6574 202d 3d20 656e  der_offset -= en
-00010090: 7472 795f 6f66 6673 6574 0d0a 0d0a 2020  try_offset....  
-000100a0: 2020 2020 2020 2020 2020 2320 7772 6974            # writ
-000100b0: 6520 7468 6520 656e 7472 7920 746f 2074  e the entry to t
-000100c0: 6865 206e 6577 2070 6f73 6974 696f 6e0d  he new position.
-000100d0: 0a20 2020 2020 2020 2020 2020 2066 702e  .            fp.
-000100e0: 7365 656b 2869 6e66 6f2e 6865 6164 6572  seek(info.header
-000100f0: 5f6f 6666 7365 7429 0d0a 2020 2020 2020  _offset)..      
-00010100: 2020 2020 2020 6670 2e77 7269 7465 2865        fp.write(e
-00010110: 6e74 7279 5f64 6174 6129 0d0a 2020 2020  ntry_data)..    
-00010120: 2020 2020 2020 2020 6670 2e66 6c75 7368          fp.flush
-00010130: 2829 0d0a 0d0a 2020 2020 2020 2020 2320  ()....        # 
-00010140: 7570 6461 7465 2073 7461 7465 0d0a 2020  update state..  
-00010150: 2020 2020 2020 7365 6c66 2e73 7461 7274        self.start
-00010160: 5f64 6972 202d 3d20 656e 7472 795f 6f66  _dir -= entry_of
-00010170: 6673 6574 0d0a 2020 2020 2020 2020 7365  fset..        se
-00010180: 6c66 2e66 696c 656c 6973 742e 7265 6d6f  lf.filelist.remo
-00010190: 7665 286d 656d 6265 7229 0d0a 2020 2020  ve(member)..    
-000101a0: 2020 2020 6465 6c20 7365 6c66 2e4e 616d      del self.Nam
-000101b0: 6554 6f49 6e66 6f5b 6d65 6d62 6572 2e66  eToInfo[member.f
-000101c0: 696c 656e 616d 655d 0d0a 2020 2020 2020  ilename]..      
-000101d0: 2020 7365 6c66 2e5f 6469 644d 6f64 6966    self._didModif
-000101e0: 7920 3d20 5472 7565 0d0a 0d0a 2020 2020  y = True....    
-000101f0: 2020 2020 2320 7365 656b 2074 6f20 7468      # seek to th
-00010200: 6520 7374 6172 7420 6f66 2074 6865 2063  e start of the c
-00010210: 656e 7472 616c 2064 6972 0d0a 2020 2020  entral dir..    
-00010220: 2020 2020 6670 2e73 6565 6b28 7365 6c66      fp.seek(self
-00010230: 2e73 7461 7274 5f64 6972 290d 0a0d 0a20  .start_dir).... 
-00010240: 2020 2064 6566 205f 7772 6974 6563 6865     def _writeche
-00010250: 636b 2873 656c 662c 207a 696e 666f 293a  ck(self, zinfo):
-00010260: 0d0a 2020 2020 2020 2020 2222 2243 6865  ..        """Che
-00010270: 636b 2066 6f72 2065 7272 6f72 7320 6265  ck for errors be
-00010280: 666f 7265 2077 7269 7469 6e67 2061 2066  fore writing a f
-00010290: 696c 6520 746f 2074 6865 2061 7263 6869  ile to the archi
-000102a0: 7665 2e22 2222 0d0a 2020 2020 2020 2020  ve."""..        
-000102b0: 6966 207a 696e 666f 2e66 696c 656e 616d  if zinfo.filenam
-000102c0: 6520 696e 2073 656c 662e 4e61 6d65 546f  e in self.NameTo
-000102d0: 496e 666f 3a0d 0a20 2020 2020 2020 2020  Info:..         
-000102e0: 2020 2069 6d70 6f72 7420 7761 726e 696e     import warnin
-000102f0: 6773 0d0a 0d0a 2020 2020 2020 2020 2020  gs....          
-00010300: 2020 7761 726e 696e 6773 2e77 6172 6e28    warnings.warn(
-00010310: 2244 7570 6c69 6361 7465 206e 616d 653a  "Duplicate name:
-00010320: 2025 7222 2025 207a 696e 666f 2e66 696c   %r" % zinfo.fil
-00010330: 656e 616d 652c 2073 7461 636b 6c65 7665  ename, stackleve
-00010340: 6c3d 3329 0d0a 2020 2020 2020 2020 6966  l=3)..        if
-00010350: 2073 656c 662e 6d6f 6465 206e 6f74 2069   self.mode not i
-00010360: 6e20 2822 7722 2c20 2278 222c 2022 6122  n ("w", "x", "a"
-00010370: 293a 0d0a 2020 2020 2020 2020 2020 2020  ):..            
-00010380: 7261 6973 6520 5661 6c75 6545 7272 6f72  raise ValueError
-00010390: 2822 7772 6974 6528 2920 7265 7175 6972  ("write() requir
-000103a0: 6573 206d 6f64 6520 2777 272c 2027 7827  es mode 'w', 'x'
-000103b0: 2c20 6f72 2027 6127 2229 0d0a 2020 2020  , or 'a'")..    
-000103c0: 2020 2020 6966 206e 6f74 2073 656c 662e      if not self.
-000103d0: 6670 3a0d 0a20 2020 2020 2020 2020 2020  fp:..           
-000103e0: 2072 6169 7365 2056 616c 7565 4572 726f   raise ValueErro
-000103f0: 7228 0d0a 2020 2020 2020 2020 2020 2020  r(..            
-00010400: 2020 2020 2241 7474 656d 7074 2074 6f20      "Attempt to 
-00010410: 7772 6974 6520 5a49 5020 6172 6368 6976  write ZIP archiv
-00010420: 6520 7468 6174 2077 6173 2061 6c72 6561  e that was alrea
-00010430: 6479 2063 6c6f 7365 6422 2c0d 0a20 2020  dy closed",..   
-00010440: 2020 2020 2020 2020 2029 0d0a 2020 2020           )..    
-00010450: 2020 2020 5f63 6865 636b 5f63 6f6d 7072      _check_compr
-00010460: 6573 7369 6f6e 287a 696e 666f 2e63 6f6d  ession(zinfo.com
-00010470: 7072 6573 735f 7479 7065 290d 0a20 2020  press_type)..   
-00010480: 2020 2020 2069 6620 6e6f 7420 7365 6c66       if not self
-00010490: 2e5f 616c 6c6f 775a 6970 3634 3a0d 0a20  ._allowZip64:.. 
-000104a0: 2020 2020 2020 2020 2020 2072 6571 7569             requi
-000104b0: 7265 735f 7a69 7036 3420 3d20 4e6f 6e65  res_zip64 = None
-000104c0: 0d0a 2020 2020 2020 2020 2020 2020 6966  ..            if
-000104d0: 206c 656e 2873 656c 662e 6669 6c65 6c69   len(self.fileli
-000104e0: 7374 2920 3e3d 205a 4950 5f46 494c 4543  st) >= ZIP_FILEC
-000104f0: 4f55 4e54 5f4c 494d 4954 3a0d 0a20 2020  OUNT_LIMIT:..   
-00010500: 2020 2020 2020 2020 2020 2020 2072 6571               req
-00010510: 7569 7265 735f 7a69 7036 3420 3d20 2246  uires_zip64 = "F
-00010520: 696c 6573 2063 6f75 6e74 220d 0a20 2020  iles count"..   
-00010530: 2020 2020 2020 2020 2065 6c69 6620 7a69           elif zi
-00010540: 6e66 6f2e 6669 6c65 5f73 697a 6520 3e20  nfo.file_size > 
-00010550: 5a49 5036 345f 4c49 4d49 543a 0d0a 2020  ZIP64_LIMIT:..  
-00010560: 2020 2020 2020 2020 2020 2020 2020 7265                re
-00010570: 7175 6972 6573 5f7a 6970 3634 203d 2022  quires_zip64 = "
-00010580: 4669 6c65 7369 7a65 220d 0a20 2020 2020  Filesize"..     
-00010590: 2020 2020 2020 2065 6c69 6620 7a69 6e66         elif zinf
-000105a0: 6f2e 6865 6164 6572 5f6f 6666 7365 7420  o.header_offset 
-000105b0: 3e20 5a49 5036 345f 4c49 4d49 543a 0d0a  > ZIP64_LIMIT:..
-000105c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000105d0: 7265 7175 6972 6573 5f7a 6970 3634 203d  requires_zip64 =
-000105e0: 2022 5a69 7066 696c 6520 7369 7a65 220d   "Zipfile size".
-000105f0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-00010600: 7265 7175 6972 6573 5f7a 6970 3634 3a0d  requires_zip64:.
-00010610: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00010620: 2072 6169 7365 204c 6172 6765 5a69 7046   raise LargeZipF
-00010630: 696c 6528 0d0a 2020 2020 2020 2020 2020  ile(..          
-00010640: 2020 2020 2020 2020 2020 7265 7175 6972            requir
-00010650: 6573 5f7a 6970 3634 202b 2022 2077 6f75  es_zip64 + " wou
-00010660: 6c64 2072 6571 7569 7265 205a 4950 3634  ld require ZIP64
-00010670: 2065 7874 656e 7369 6f6e 7322 2c0d 0a20   extensions",.. 
-00010680: 2020 2020 2020 2020 2020 2020 2020 2029                 )
-00010690: 0d0a 0d0a 2020 2020 6465 6620 7772 6974  ....    def writ
-000106a0: 6528 0d0a 2020 2020 2020 2020 7365 6c66  e(..        self
-000106b0: 2c0d 0a20 2020 2020 2020 2066 696c 656e  ,..        filen
-000106c0: 616d 652c 0d0a 2020 2020 2020 2020 6172  ame,..        ar
-000106d0: 636e 616d 653d 4e6f 6e65 2c0d 0a20 2020  cname=None,..   
-000106e0: 2020 2020 2063 6f6d 7072 6573 735f 7479       compress_ty
-000106f0: 7065 3d4e 6f6e 652c 0d0a 2020 2020 2020  pe=None,..      
-00010700: 2020 636f 6d70 7265 7373 6c65 7665 6c3d    compresslevel=
-00010710: 4e6f 6e65 2c0d 0a20 2020 2029 3a0d 0a20  None,..    ):.. 
-00010720: 2020 2020 2020 2022 2222 5075 7420 7468         """Put th
-00010730: 6520 6279 7465 7320 6672 6f6d 2066 696c  e bytes from fil
-00010740: 656e 616d 6520 696e 746f 2074 6865 2061  ename into the a
-00010750: 7263 6869 7665 2075 6e64 6572 2074 6865  rchive under the
-00010760: 206e 616d 650d 0a20 2020 2020 2020 2061   name..        a
-00010770: 7263 6e61 6d65 2e0d 0a20 2020 2020 2020  rcname...       
-00010780: 2022 2222 0d0a 2020 2020 2020 2020 6966   """..        if
-00010790: 206e 6f74 2073 656c 662e 6670 3a0d 0a20   not self.fp:.. 
-000107a0: 2020 2020 2020 2020 2020 2072 6169 7365             raise
-000107b0: 2056 616c 7565 4572 726f 7228 0d0a 2020   ValueError(..  
-000107c0: 2020 2020 2020 2020 2020 2020 2020 2241                "A
-000107d0: 7474 656d 7074 2074 6f20 7772 6974 6520  ttempt to write 
-000107e0: 746f 205a 4950 2061 7263 6869 7665 2074  to ZIP archive t
-000107f0: 6861 7420 7761 7320 616c 7265 6164 7920  hat was already 
-00010800: 636c 6f73 6564 222c 0d0a 2020 2020 2020  closed",..      
-00010810: 2020 2020 2020 290d 0a20 2020 2020 2020        )..       
-00010820: 2069 6620 7365 6c66 2e5f 7772 6974 696e   if self._writin
-00010830: 673a 0d0a 2020 2020 2020 2020 2020 2020  g:..            
-00010840: 7261 6973 6520 5661 6c75 6545 7272 6f72  raise ValueError
-00010850: 280d 0a20 2020 2020 2020 2020 2020 2020  (..             
-00010860: 2020 2022 4361 6e27 7420 7772 6974 6520     "Can't write 
-00010870: 746f 205a 4950 2061 7263 6869 7665 2077  to ZIP archive w
-00010880: 6869 6c65 2061 6e20 6f70 656e 2077 7269  hile an open wri
-00010890: 7469 6e67 2068 616e 646c 6520 6578 6973  ting handle exis
-000108a0: 7473 222c 0d0a 2020 2020 2020 2020 2020  ts",..          
-000108b0: 2020 290d 0a0d 0a20 2020 2020 2020 207a    )....        z
-000108c0: 696e 666f 203d 205a 6970 496e 666f 2e66  info = ZipInfo.f
-000108d0: 726f 6d5f 6669 6c65 280d 0a20 2020 2020  rom_file(..     
-000108e0: 2020 2020 2020 2066 696c 656e 616d 652c         filename,
-000108f0: 0d0a 2020 2020 2020 2020 2020 2020 6172  ..            ar
-00010900: 636e 616d 652c 0d0a 2020 2020 2020 2020  cname,..        
-00010910: 2020 2020 7374 7269 6374 5f74 696d 6573      strict_times
-00010920: 7461 6d70 733d 7365 6c66 2e5f 7374 7269  tamps=self._stri
-00010930: 6374 5f74 696d 6573 7461 6d70 732c 0d0a  ct_timestamps,..
-00010940: 2020 2020 2020 2020 290d 0a0d 0a20 2020          )....   
-00010950: 2020 2020 2069 6620 7a69 6e66 6f2e 6973       if zinfo.is
-00010960: 5f64 6972 2829 3a0d 0a20 2020 2020 2020  _dir():..       
-00010970: 2020 2020 207a 696e 666f 2e63 6f6d 7072       zinfo.compr
-00010980: 6573 735f 7369 7a65 203d 2030 0d0a 2020  ess_size = 0..  
-00010990: 2020 2020 2020 2020 2020 7a69 6e66 6f2e            zinfo.
-000109a0: 4352 4320 3d20 300d 0a20 2020 2020 2020  CRC = 0..       
-000109b0: 2065 6c73 653a 0d0a 2020 2020 2020 2020   else:..        
-000109c0: 2020 2020 6966 2063 6f6d 7072 6573 735f      if compress_
-000109d0: 7479 7065 2069 7320 6e6f 7420 4e6f 6e65  type is not None
-000109e0: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
-000109f0: 2020 207a 696e 666f 2e63 6f6d 7072 6573     zinfo.compres
-00010a00: 735f 7479 7065 203d 2063 6f6d 7072 6573  s_type = compres
-00010a10: 735f 7479 7065 0d0a 2020 2020 2020 2020  s_type..        
-00010a20: 2020 2020 656c 7365 3a0d 0a20 2020 2020      else:..     
-00010a30: 2020 2020 2020 2020 2020 207a 696e 666f             zinfo
-00010a40: 2e63 6f6d 7072 6573 735f 7479 7065 203d  .compress_type =
-00010a50: 2073 656c 662e 636f 6d70 7265 7373 696f   self.compressio
-00010a60: 6e0d 0a0d 0a20 2020 2020 2020 2020 2020  n....           
-00010a70: 2069 6620 636f 6d70 7265 7373 6c65 7665   if compressleve
-00010a80: 6c20 6973 206e 6f74 204e 6f6e 653a 0d0a  l is not None:..
-00010a90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010aa0: 7a69 6e66 6f2e 5f63 6f6d 7072 6573 736c  zinfo._compressl
-00010ab0: 6576 656c 203d 2063 6f6d 7072 6573 736c  evel = compressl
-00010ac0: 6576 656c 0d0a 2020 2020 2020 2020 2020  evel..          
-00010ad0: 2020 656c 7365 3a0d 0a20 2020 2020 2020    else:..       
-00010ae0: 2020 2020 2020 2020 207a 696e 666f 2e5f           zinfo._
-00010af0: 636f 6d70 7265 7373 6c65 7665 6c20 3d20  compresslevel = 
-00010b00: 7365 6c66 2e63 6f6d 7072 6573 736c 6576  self.compresslev
-00010b10: 656c 0d0a 0d0a 2020 2020 2020 2020 6966  el....        if
-00010b20: 207a 696e 666f 2e69 735f 6469 7228 293a   zinfo.is_dir():
-00010b30: 0d0a 2020 2020 2020 2020 2020 2020 7769  ..            wi
-00010b40: 7468 2073 656c 662e 5f6c 6f63 6b3a 0d0a  th self._lock:..
-00010b50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010b60: 6966 2073 656c 662e 5f73 6565 6b61 626c  if self._seekabl
-00010b70: 653a 0d0a 2020 2020 2020 2020 2020 2020  e:..            
-00010b80: 2020 2020 2020 2020 7365 6c66 2e66 702e          self.fp.
-00010b90: 7365 656b 2873 656c 662e 7374 6172 745f  seek(self.start_
-00010ba0: 6469 7229 0d0a 2020 2020 2020 2020 2020  dir)..          
-00010bb0: 2020 2020 2020 7a69 6e66 6f2e 6865 6164        zinfo.head
-00010bc0: 6572 5f6f 6666 7365 7420 3d20 7365 6c66  er_offset = self
-00010bd0: 2e66 702e 7465 6c6c 2829 2020 2320 5374  .fp.tell()  # St
-00010be0: 6172 7420 6f66 2068 6561 6465 7220 6279  art of header by
-00010bf0: 7465 730d 0a20 2020 2020 2020 2020 2020  tes..           
-00010c00: 2020 2020 2069 6620 7a69 6e66 6f2e 636f       if zinfo.co
-00010c10: 6d70 7265 7373 5f74 7970 6520 3d3d 205a  mpress_type == Z
-00010c20: 4950 5f4c 5a4d 413a 0d0a 2020 2020 2020  IP_LZMA:..      
-00010c30: 2020 2020 2020 2020 2020 2020 2020 2320                # 
-00010c40: 436f 6d70 7265 7373 6564 2064 6174 6120  Compressed data 
-00010c50: 696e 636c 7564 6573 2061 6e20 656e 642d  includes an end-
-00010c60: 6f66 2d73 7472 6561 6d20 2845 4f53 2920  of-stream (EOS) 
-00010c70: 6d61 726b 6572 0d0a 2020 2020 2020 2020  marker..        
-00010c80: 2020 2020 2020 2020 2020 2020 7a69 6e66              zinf
-00010c90: 6f2e 666c 6167 5f62 6974 7320 7c3d 2030  o.flag_bits |= 0
-00010ca0: 7830 320d 0a0d 0a20 2020 2020 2020 2020  x02....         
-00010cb0: 2020 2020 2020 2073 656c 662e 5f77 7269         self._wri
-00010cc0: 7465 6368 6563 6b28 7a69 6e66 6f29 0d0a  techeck(zinfo)..
-00010cd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010ce0: 7365 6c66 2e5f 6469 644d 6f64 6966 7920  self._didModify 
-00010cf0: 3d20 5472 7565 0d0a 0d0a 2020 2020 2020  = True....      
-00010d00: 2020 2020 2020 2020 2020 7365 6c66 2e66            self.f
-00010d10: 696c 656c 6973 742e 6170 7065 6e64 287a  ilelist.append(z
-00010d20: 696e 666f 290d 0a20 2020 2020 2020 2020  info)..         
-00010d30: 2020 2020 2020 2073 656c 662e 4e61 6d65         self.Name
-00010d40: 546f 496e 666f 5b7a 696e 666f 2e66 696c  ToInfo[zinfo.fil
-00010d50: 656e 616d 655d 203d 207a 696e 666f 0d0a  ename] = zinfo..
-00010d60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010d70: 7365 6c66 2e66 702e 7772 6974 6528 7a69  self.fp.write(zi
-00010d80: 6e66 6f2e 4669 6c65 4865 6164 6572 2846  nfo.FileHeader(F
-00010d90: 616c 7365 2929 0d0a 2020 2020 2020 2020  alse))..        
-00010da0: 2020 2020 2020 2020 7365 6c66 2e73 7461          self.sta
-00010db0: 7274 5f64 6972 203d 2073 656c 662e 6670  rt_dir = self.fp
-00010dc0: 2e74 656c 6c28 290d 0a20 2020 2020 2020  .tell()..       
-00010dd0: 2065 6c73 653a 0d0a 2020 2020 2020 2020   else:..        
-00010de0: 2020 2020 7769 7468 206f 7065 6e28 6669      with open(fi
-00010df0: 6c65 6e61 6d65 2c20 2272 6222 2920 6173  lename, "rb") as
-00010e00: 2073 7263 2c20 7365 6c66 2e6f 7065 6e28   src, self.open(
-00010e10: 7a69 6e66 6f2c 2022 7722 2920 6173 2064  zinfo, "w") as d
-00010e20: 6573 743a 0d0a 2020 2020 2020 2020 2020  est:..          
-00010e30: 2020 2020 2020 7368 7574 696c 2e63 6f70        shutil.cop
-00010e40: 7966 696c 656f 626a 2873 7263 2c20 6465  yfileobj(src, de
-00010e50: 7374 2c20 3130 3234 202a 2038 290d 0a0d  st, 1024 * 8)...
-00010e60: 0a20 2020 2064 6566 2077 7269 7465 7374  .    def writest
-00010e70: 7228 0d0a 2020 2020 2020 2020 7365 6c66  r(..        self
-00010e80: 2c0d 0a20 2020 2020 2020 207a 696e 666f  ,..        zinfo
-00010e90: 5f6f 725f 6172 636e 616d 652c 0d0a 2020  _or_arcname,..  
-00010ea0: 2020 2020 2020 6461 7461 2c0d 0a20 2020        data,..   
-00010eb0: 2020 2020 2063 6f6d 7072 6573 735f 7479       compress_ty
-00010ec0: 7065 3d4e 6f6e 652c 0d0a 2020 2020 2020  pe=None,..      
-00010ed0: 2020 636f 6d70 7265 7373 6c65 7665 6c3d    compresslevel=
-00010ee0: 4e6f 6e65 2c0d 0a20 2020 2029 3a0d 0a20  None,..    ):.. 
-00010ef0: 2020 2020 2020 2022 2222 5772 6974 6520         """Write 
-00010f00: 6120 6669 6c65 2069 6e74 6f20 7468 6520  a file into the 
-00010f10: 6172 6368 6976 652e 2020 5468 6520 636f  archive.  The co
-00010f20: 6e74 656e 7473 2069 7320 2764 6174 6127  ntents is 'data'
-00010f30: 2c20 7768 6963 680d 0a20 2020 2020 2020  , which..       
-00010f40: 206d 6179 2062 6520 6569 7468 6572 2061   may be either a
-00010f50: 2027 7374 7227 206f 7220 6120 2762 7974   'str' or a 'byt
-00010f60: 6573 2720 696e 7374 616e 6365 3b20 6966  es' instance; if
-00010f70: 2069 7420 6973 2061 2027 7374 7227 2c0d   it is a 'str',.
-00010f80: 0a20 2020 2020 2020 2069 7420 6973 2065  .        it is e
-00010f90: 6e63 6f64 6564 2061 7320 5554 462d 3820  ncoded as UTF-8 
-00010fa0: 6669 7273 742e 0d0a 2020 2020 2020 2020  first...        
-00010fb0: 277a 696e 666f 5f6f 725f 6172 636e 616d  'zinfo_or_arcnam
-00010fc0: 6527 2069 7320 6569 7468 6572 2061 205a  e' is either a Z
-00010fd0: 6970 496e 666f 2069 6e73 7461 6e63 6520  ipInfo instance 
-00010fe0: 6f72 0d0a 2020 2020 2020 2020 7468 6520  or..        the 
-00010ff0: 6e61 6d65 206f 6620 7468 6520 6669 6c65  name of the file
-00011000: 2069 6e20 7468 6520 6172 6368 6976 652e   in the archive.
-00011010: 0d0a 2020 2020 2020 2020 2222 220d 0a20  ..        """.. 
-00011020: 2020 2020 2020 2069 6620 6973 696e 7374         if isinst
-00011030: 616e 6365 2864 6174 612c 2073 7472 293a  ance(data, str):
-00011040: 0d0a 2020 2020 2020 2020 2020 2020 6461  ..            da
-00011050: 7461 203d 2064 6174 612e 656e 636f 6465  ta = data.encode
-00011060: 2822 7574 662d 3822 290d 0a20 2020 2020  ("utf-8")..     
-00011070: 2020 2069 6620 6e6f 7420 6973 696e 7374     if not isinst
-00011080: 616e 6365 287a 696e 666f 5f6f 725f 6172  ance(zinfo_or_ar
-00011090: 636e 616d 652c 205a 6970 496e 666f 293a  cname, ZipInfo):
-000110a0: 0d0a 2020 2020 2020 2020 2020 2020 7a69  ..            zi
-000110b0: 6e66 6f20 3d20 5a69 7049 6e66 6f28 0d0a  nfo = ZipInfo(..
-000110c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000110d0: 6669 6c65 6e61 6d65 3d7a 696e 666f 5f6f  filename=zinfo_o
-000110e0: 725f 6172 636e 616d 652c 0d0a 2020 2020  r_arcname,..    
-000110f0: 2020 2020 2020 2020 2020 2020 6461 7465              date
-00011100: 5f74 696d 653d 7469 6d65 2e6c 6f63 616c  _time=time.local
-00011110: 7469 6d65 2874 696d 652e 7469 6d65 2829  time(time.time()
-00011120: 295b 3a36 5d2c 0d0a 2020 2020 2020 2020  )[:6],..        
-00011130: 2020 2020 290d 0a20 2020 2020 2020 2020      )..         
-00011140: 2020 207a 696e 666f 2e63 6f6d 7072 6573     zinfo.compres
-00011150: 735f 7479 7065 203d 2073 656c 662e 636f  s_type = self.co
-00011160: 6d70 7265 7373 696f 6e0d 0a20 2020 2020  mpression..     
-00011170: 2020 2020 2020 207a 696e 666f 2e5f 636f         zinfo._co
-00011180: 6d70 7265 7373 6c65 7665 6c20 3d20 7365  mpresslevel = se
-00011190: 6c66 2e63 6f6d 7072 6573 736c 6576 656c  lf.compresslevel
-000111a0: 0d0a 2020 2020 2020 2020 2020 2020 6966  ..            if
-000111b0: 207a 696e 666f 2e66 696c 656e 616d 655b   zinfo.filename[
-000111c0: 2d31 5d20 3d3d 2022 2f22 3a0d 0a20 2020  -1] == "/":..   
-000111d0: 2020 2020 2020 2020 2020 2020 207a 696e               zin
-000111e0: 666f 2e65 7874 6572 6e61 6c5f 6174 7472  fo.external_attr
-000111f0: 203d 2030 6f34 3037 3735 203c 3c20 3136   = 0o40775 << 16
-00011200: 2020 2320 6472 7778 7277 7872 2d78 0d0a    # drwxrwxr-x..
-00011210: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011220: 7a69 6e66 6f2e 6578 7465 726e 616c 5f61  zinfo.external_a
-00011230: 7474 7220 7c3d 2030 7831 3020 2023 204d  ttr |= 0x10  # M
-00011240: 532d 444f 5320 6469 7265 6374 6f72 7920  S-DOS directory 
-00011250: 666c 6167 0d0a 2020 2020 2020 2020 2020  flag..          
-00011260: 2020 656c 7365 3a0d 0a20 2020 2020 2020    else:..       
-00011270: 2020 2020 2020 2020 207a 696e 666f 2e65           zinfo.e
-00011280: 7874 6572 6e61 6c5f 6174 7472 203d 2030  xternal_attr = 0
-00011290: 6f36 3030 203c 3c20 3136 2020 2320 3f72  o600 << 16  # ?r
-000112a0: 772d 2d2d 2d2d 2d2d 0d0a 2020 2020 2020  w-------..      
-000112b0: 2020 656c 7365 3a0d 0a20 2020 2020 2020    else:..       
-000112c0: 2020 2020 207a 696e 666f 203d 207a 696e       zinfo = zin
-000112d0: 666f 5f6f 725f 6172 636e 616d 650d 0a0d  fo_or_arcname...
-000112e0: 0a20 2020 2020 2020 2069 6620 6e6f 7420  .        if not 
-000112f0: 7365 6c66 2e66 703a 0d0a 2020 2020 2020  self.fp:..      
-00011300: 2020 2020 2020 7261 6973 6520 5661 6c75        raise Valu
-00011310: 6545 7272 6f72 280d 0a20 2020 2020 2020  eError(..       
-00011320: 2020 2020 2020 2020 2022 4174 7465 6d70           "Attemp
-00011330: 7420 746f 2077 7269 7465 2074 6f20 5a49  t to write to ZI
-00011340: 5020 6172 6368 6976 6520 7468 6174 2077  P archive that w
-00011350: 6173 2061 6c72 6561 6479 2063 6c6f 7365  as already close
-00011360: 6422 2c0d 0a20 2020 2020 2020 2020 2020  d",..           
-00011370: 2029 0d0a 2020 2020 2020 2020 6966 2073   )..        if s
-00011380: 656c 662e 5f77 7269 7469 6e67 3a0d 0a20  elf._writing:.. 
-00011390: 2020 2020 2020 2020 2020 2072 6169 7365             raise
-000113a0: 2056 616c 7565 4572 726f 7228 0d0a 2020   ValueError(..  
-000113b0: 2020 2020 2020 2020 2020 2020 2020 2243                "C
-000113c0: 616e 2774 2077 7269 7465 2074 6f20 5a49  an't write to ZI
-000113d0: 5020 6172 6368 6976 6520 7768 696c 6520  P archive while 
-000113e0: 616e 206f 7065 6e20 7772 6974 696e 6720  an open writing 
-000113f0: 6861 6e64 6c65 2065 7869 7374 732e 222c  handle exists.",
-00011400: 0d0a 2020 2020 2020 2020 2020 2020 290d  ..            ).
-00011410: 0a0d 0a20 2020 2020 2020 2069 6620 636f  ...        if co
-00011420: 6d70 7265 7373 5f74 7970 6520 6973 206e  mpress_type is n
-00011430: 6f74 204e 6f6e 653a 0d0a 2020 2020 2020  ot None:..      
-00011440: 2020 2020 2020 7a69 6e66 6f2e 636f 6d70        zinfo.comp
-00011450: 7265 7373 5f74 7970 6520 3d20 636f 6d70  ress_type = comp
-00011460: 7265 7373 5f74 7970 650d 0a0d 0a20 2020  ress_type....   
-00011470: 2020 2020 2069 6620 636f 6d70 7265 7373       if compress
-00011480: 6c65 7665 6c20 6973 206e 6f74 204e 6f6e  level is not Non
+00006ef0: 2020 7261 6973 6520 5661 6c75 6545 7272    raise ValueErr
+00006f00: 6f72 280d 0a20 2020 2020 2020 2020 2020  or(..           
+00006f10: 2020 2020 2020 2020 2022 4361 6e27 7420           "Can't 
+00006f20: 7265 6164 2066 726f 6d20 7468 6520 5a49  read from the ZI
+00006f30: 5020 6669 6c65 2077 6869 6c65 2074 6865  P file while the
+00006f40: 7265 2022 0d0a 2020 2020 2020 2020 2020  re "..          
+00006f50: 2020 2020 2020 2020 2020 2269 7320 616e            "is an
+00006f60: 206f 7065 6e20 7772 6974 696e 6720 6861   open writing ha
+00006f70: 6e64 6c65 206f 6e20 6974 2e20 220d 0a20  ndle on it. ".. 
+00006f80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006f90: 2020 2022 436c 6f73 6520 7468 6520 7772     "Close the wr
+00006fa0: 6974 696e 6720 6861 6e64 6c65 2062 6566  iting handle bef
+00006fb0: 6f72 6520 7472 7969 6e67 2074 6f20 7265  ore trying to re
+00006fc0: 6164 2e22 2c0d 0a20 2020 2020 2020 2020  ad.",..         
+00006fd0: 2020 2020 2020 2029 0d0a 2020 2020 2020         )..      
+00006fe0: 2020 2020 2020 7365 6c66 2e5f 6669 6c65        self._file
+00006ff0: 2e73 6565 6b28 7365 6c66 2e5f 706f 7329  .seek(self._pos)
+00007000: 0d0a 2020 2020 2020 2020 2020 2020 6461  ..            da
+00007010: 7461 203d 2073 656c 662e 5f66 696c 652e  ta = self._file.
+00007020: 7265 6164 286e 290d 0a20 2020 2020 2020  read(n)..       
+00007030: 2020 2020 2073 656c 662e 5f70 6f73 203d       self._pos =
+00007040: 2073 656c 662e 5f66 696c 652e 7465 6c6c   self._file.tell
+00007050: 2829 0d0a 2020 2020 2020 2020 2020 2020  ()..            
+00007060: 7265 7475 726e 2064 6174 610d 0a0d 0a20  return data.... 
+00007070: 2020 2064 6566 2063 6c6f 7365 2873 656c     def close(sel
+00007080: 6629 3a0d 0a20 2020 2020 2020 2069 6620  f):..        if 
+00007090: 7365 6c66 2e5f 6669 6c65 2069 7320 6e6f  self._file is no
+000070a0: 7420 4e6f 6e65 3a0d 0a20 2020 2020 2020  t None:..       
+000070b0: 2020 2020 2066 696c 656f 626a 203d 2073       fileobj = s
+000070c0: 656c 662e 5f66 696c 650d 0a20 2020 2020  elf._file..     
+000070d0: 2020 2020 2020 2073 656c 662e 5f66 696c         self._fil
+000070e0: 6520 3d20 4e6f 6e65 0d0a 2020 2020 2020  e = None..      
+000070f0: 2020 2020 2020 7365 6c66 2e5f 636c 6f73        self._clos
+00007100: 6528 6669 6c65 6f62 6a29 0d0a 0d0a 0d0a  e(fileobj)......
+00007110: 2320 5072 6f76 6964 6520 7468 6520 7465  # Provide the te
+00007120: 6c6c 206d 6574 686f 6420 666f 7220 756e  ll method for un
+00007130: 7365 656b 6162 6c65 2073 7472 6561 6d0d  seekable stream.
+00007140: 0a63 6c61 7373 205f 5465 6c6c 6162 6c65  .class _Tellable
+00007150: 3a0d 0a20 2020 2064 6566 205f 5f69 6e69  :..    def __ini
+00007160: 745f 5f28 7365 6c66 2c20 6670 2920 2d3e  t__(self, fp) ->
+00007170: 204e 6f6e 653a 0d0a 2020 2020 2020 2020   None:..        
+00007180: 7365 6c66 2e66 7020 3d20 6670 0d0a 2020  self.fp = fp..  
+00007190: 2020 2020 2020 7365 6c66 2e6f 6666 7365        self.offse
+000071a0: 7420 3d20 300d 0a0d 0a20 2020 2064 6566  t = 0....    def
+000071b0: 2077 7269 7465 2873 656c 662c 2064 6174   write(self, dat
+000071c0: 6129 3a0d 0a20 2020 2020 2020 206e 203d  a):..        n =
+000071d0: 2073 656c 662e 6670 2e77 7269 7465 2864   self.fp.write(d
+000071e0: 6174 6129 0d0a 2020 2020 2020 2020 7365  ata)..        se
+000071f0: 6c66 2e6f 6666 7365 7420 2b3d 206e 0d0a  lf.offset += n..
+00007200: 2020 2020 2020 2020 7265 7475 726e 206e          return n
+00007210: 0d0a 0d0a 2020 2020 6465 6620 7465 6c6c  ....    def tell
+00007220: 2873 656c 6629 3a0d 0a20 2020 2020 2020  (self):..       
+00007230: 2072 6574 7572 6e20 7365 6c66 2e6f 6666   return self.off
+00007240: 7365 740d 0a0d 0a20 2020 2064 6566 2066  set....    def f
+00007250: 6c75 7368 2873 656c 6629 3a0d 0a20 2020  lush(self):..   
+00007260: 2020 2020 2073 656c 662e 6670 2e66 6c75       self.fp.flu
+00007270: 7368 2829 0d0a 0d0a 2020 2020 6465 6620  sh()....    def 
+00007280: 636c 6f73 6528 7365 6c66 293a 0d0a 2020  close(self):..  
+00007290: 2020 2020 2020 7365 6c66 2e66 702e 636c        self.fp.cl
+000072a0: 6f73 6528 290d 0a0d 0a0d 0a63 6c61 7373  ose()......class
+000072b0: 205a 6970 4578 7446 696c 6528 696f 2e42   ZipExtFile(io.B
+000072c0: 7566 6665 7265 6449 4f42 6173 6529 3a0d  ufferedIOBase):.
+000072d0: 0a20 2020 2022 2222 4669 6c65 2d6c 696b  .    """File-lik
+000072e0: 6520 6f62 6a65 6374 2066 6f72 2072 6561  e object for rea
+000072f0: 6469 6e67 2061 6e20 6172 6368 6976 6520  ding an archive 
+00007300: 6d65 6d62 6572 2e0d 0a20 2020 2049 7320  member...    Is 
+00007310: 7265 7475 726e 6564 2062 7920 5a69 7046  returned by ZipF
+00007320: 696c 652e 6f70 656e 2829 2e0d 0a20 2020  ile.open()...   
+00007330: 2022 2222 0d0a 0d0a 2020 2020 2320 4d61   """....    # Ma
+00007340: 7820 7369 7a65 2073 7570 706f 7274 6564  x size supported
+00007350: 2062 7920 6465 636f 6d70 7265 7373 6f72   by decompressor
+00007360: 2e0d 0a20 2020 204d 4158 5f4e 203d 2031  ...    MAX_N = 1
+00007370: 203c 3c20 3331 202d 2031 0d0a 0d0a 2020   << 31 - 1....  
+00007380: 2020 2320 5265 6164 2066 726f 6d20 636f    # Read from co
+00007390: 6d70 7265 7373 6564 2066 696c 6573 2069  mpressed files i
+000073a0: 6e20 346b 2062 6c6f 636b 732e 0d0a 2020  n 4k blocks...  
+000073b0: 2020 4d49 4e5f 5245 4144 5f53 495a 4520    MIN_READ_SIZE 
+000073c0: 3d20 3430 3936 0d0a 0d0a 2020 2020 2320  = 4096....    # 
+000073d0: 4368 756e 6b20 7369 7a65 2074 6f20 7265  Chunk size to re
+000073e0: 6164 2064 7572 696e 6720 7365 656b 0d0a  ad during seek..
+000073f0: 2020 2020 4d41 585f 5345 454b 5f52 4541      MAX_SEEK_REA
+00007400: 4420 3d20 3120 3c3c 2032 340d 0a0d 0a20  D = 1 << 24.... 
+00007410: 2020 2064 6566 205f 5f69 6e69 745f 5f28     def __init__(
+00007420: 0d0a 2020 2020 2020 2020 7365 6c66 2c0d  ..        self,.
+00007430: 0a20 2020 2020 2020 2066 696c 656f 626a  .        fileobj
+00007440: 2c0d 0a20 2020 2020 2020 206d 6f64 652c  ,..        mode,
+00007450: 0d0a 2020 2020 2020 2020 7a69 7069 6e66  ..        zipinf
+00007460: 6f2c 0d0a 2020 2020 2020 2020 7077 643d  o,..        pwd=
+00007470: 4e6f 6e65 2c0d 0a20 2020 2020 2020 2063  None,..        c
+00007480: 6c6f 7365 5f66 696c 656f 626a 3d46 616c  lose_fileobj=Fal
+00007490: 7365 2c0d 0a20 2020 2029 202d 3e20 4e6f  se,..    ) -> No
+000074a0: 6e65 3a0d 0a20 2020 2020 2020 2073 656c  ne:..        sel
+000074b0: 662e 5f66 696c 656f 626a 203d 2066 696c  f._fileobj = fil
+000074c0: 656f 626a 0d0a 2020 2020 2020 2020 7365  eobj..        se
+000074d0: 6c66 2e5f 7077 6420 3d20 7077 640d 0a20  lf._pwd = pwd.. 
+000074e0: 2020 2020 2020 2073 656c 662e 5f63 6c6f         self._clo
+000074f0: 7365 5f66 696c 656f 626a 203d 2063 6c6f  se_fileobj = clo
+00007500: 7365 5f66 696c 656f 626a 0d0a 0d0a 2020  se_fileobj....  
+00007510: 2020 2020 2020 7365 6c66 2e5f 636f 6d70        self._comp
+00007520: 7265 7373 5f74 7970 6520 3d20 7a69 7069  ress_type = zipi
+00007530: 6e66 6f2e 636f 6d70 7265 7373 5f74 7970  nfo.compress_typ
+00007540: 650d 0a20 2020 2020 2020 2073 656c 662e  e..        self.
+00007550: 5f63 6f6d 7072 6573 735f 6c65 6674 203d  _compress_left =
+00007560: 207a 6970 696e 666f 2e63 6f6d 7072 6573   zipinfo.compres
+00007570: 735f 7369 7a65 0d0a 2020 2020 2020 2020  s_size..        
+00007580: 7365 6c66 2e5f 6c65 6674 203d 207a 6970  self._left = zip
+00007590: 696e 666f 2e66 696c 655f 7369 7a65 0d0a  info.file_size..
+000075a0: 0d0a 2020 2020 2020 2020 7365 6c66 2e5f  ..        self._
+000075b0: 6465 636f 6d70 7265 7373 6f72 203d 205f  decompressor = _
+000075c0: 6765 745f 6465 636f 6d70 7265 7373 6f72  get_decompressor
+000075d0: 2873 656c 662e 5f63 6f6d 7072 6573 735f  (self._compress_
+000075e0: 7479 7065 290d 0a0d 0a20 2020 2020 2020  type)....       
+000075f0: 2073 656c 662e 5f65 6f66 203d 2046 616c   self._eof = Fal
+00007600: 7365 0d0a 2020 2020 2020 2020 7365 6c66  se..        self
+00007610: 2e5f 7265 6164 6275 6666 6572 203d 2062  ._readbuffer = b
+00007620: 2222 0d0a 2020 2020 2020 2020 7365 6c66  ""..        self
+00007630: 2e5f 6f66 6673 6574 203d 2030 0d0a 0d0a  ._offset = 0....
+00007640: 2020 2020 2020 2020 7365 6c66 2e6e 6577          self.new
+00007650: 6c69 6e65 7320 3d20 4e6f 6e65 0d0a 0d0a  lines = None....
+00007660: 2020 2020 2020 2020 7365 6c66 2e6d 6f64          self.mod
+00007670: 6520 3d20 6d6f 6465 0d0a 2020 2020 2020  e = mode..      
+00007680: 2020 7365 6c66 2e6e 616d 6520 3d20 7a69    self.name = zi
+00007690: 7069 6e66 6f2e 6669 6c65 6e61 6d65 0d0a  pinfo.filename..
+000076a0: 0d0a 2020 2020 2020 2020 6966 2068 6173  ..        if has
+000076b0: 6174 7472 287a 6970 696e 666f 2c20 2243  attr(zipinfo, "C
+000076c0: 5243 2229 3a0d 0a20 2020 2020 2020 2020  RC"):..         
+000076d0: 2020 2073 656c 662e 5f65 7870 6563 7465     self._expecte
+000076e0: 645f 6372 6320 3d20 7a69 7069 6e66 6f2e  d_crc = zipinfo.
+000076f0: 4352 430d 0a20 2020 2020 2020 2020 2020  CRC..           
+00007700: 2073 656c 662e 5f72 756e 6e69 6e67 5f63   self._running_c
+00007710: 7263 203d 2063 7263 3332 2862 2222 290d  rc = crc32(b"").
+00007720: 0a20 2020 2020 2020 2065 6c73 653a 0d0a  .        else:..
+00007730: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00007740: 2e5f 6578 7065 6374 6564 5f63 7263 203d  ._expected_crc =
+00007750: 204e 6f6e 650d 0a0d 0a20 2020 2020 2020   None....       
+00007760: 2073 656c 662e 5f73 6565 6b61 626c 6520   self._seekable 
+00007770: 3d20 4661 6c73 650d 0a20 2020 2020 2020  = False..       
+00007780: 2074 7279 3a0d 0a20 2020 2020 2020 2020   try:..         
+00007790: 2020 2069 6620 6669 6c65 6f62 6a2e 7365     if fileobj.se
+000077a0: 656b 6162 6c65 2829 3a0d 0a20 2020 2020  ekable():..     
+000077b0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+000077c0: 5f6f 7269 675f 636f 6d70 7265 7373 5f73  _orig_compress_s
+000077d0: 7461 7274 203d 2066 696c 656f 626a 2e74  tart = fileobj.t
+000077e0: 656c 6c28 290d 0a20 2020 2020 2020 2020  ell()..         
+000077f0: 2020 2020 2020 2073 656c 662e 5f6f 7269         self._ori
+00007800: 675f 636f 6d70 7265 7373 5f73 697a 6520  g_compress_size 
+00007810: 3d20 7a69 7069 6e66 6f2e 636f 6d70 7265  = zipinfo.compre
+00007820: 7373 5f73 697a 650d 0a20 2020 2020 2020  ss_size..       
+00007830: 2020 2020 2020 2020 2073 656c 662e 5f6f           self._o
+00007840: 7269 675f 6669 6c65 5f73 697a 6520 3d20  rig_file_size = 
+00007850: 7a69 7069 6e66 6f2e 6669 6c65 5f73 697a  zipinfo.file_siz
+00007860: 650d 0a20 2020 2020 2020 2020 2020 2020  e..             
+00007870: 2020 2073 656c 662e 5f6f 7269 675f 7374     self._orig_st
+00007880: 6172 745f 6372 6320 3d20 7365 6c66 2e5f  art_crc = self._
+00007890: 7275 6e6e 696e 675f 6372 630d 0a20 2020  running_crc..   
+000078a0: 2020 2020 2020 2020 2020 2020 2073 656c               sel
+000078b0: 662e 5f73 6565 6b61 626c 6520 3d20 5472  f._seekable = Tr
+000078c0: 7565 0d0a 2020 2020 2020 2020 6578 6365  ue..        exce
+000078d0: 7074 2041 7474 7269 6275 7465 4572 726f  pt AttributeErro
+000078e0: 723a 0d0a 2020 2020 2020 2020 2020 2020  r:..            
+000078f0: 7061 7373 0d0a 0d0a 2020 2020 2020 2020  pass....        
+00007900: 7365 6c66 2e5f 6465 6372 7970 7465 7220  self._decrypter 
+00007910: 3d20 4e6f 6e65 0d0a 2020 2020 2020 2020  = None..        
+00007920: 6966 2070 7764 3a0d 0a20 2020 2020 2020  if pwd:..       
+00007930: 2020 2020 2069 6620 7a69 7069 6e66 6f2e       if zipinfo.
+00007940: 666c 6167 5f62 6974 7320 2620 3078 383a  flag_bits & 0x8:
+00007950: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00007960: 2020 2320 636f 6d70 6172 6520 6167 6169    # compare agai
+00007970: 6e73 7420 7468 6520 6669 6c65 2074 7970  nst the file typ
+00007980: 6520 6672 6f6d 2065 7874 656e 6465 6420  e from extended 
+00007990: 6c6f 6361 6c20 6865 6164 6572 730d 0a20  local headers.. 
+000079a0: 2020 2020 2020 2020 2020 2020 2020 2063                 c
+000079b0: 6865 636b 5f62 7974 6520 3d20 287a 6970  heck_byte = (zip
+000079c0: 696e 666f 2e5f 7261 775f 7469 6d65 203e  info._raw_time >
+000079d0: 3e20 3829 2026 2030 7846 460d 0a20 2020  > 8) & 0xFF..   
+000079e0: 2020 2020 2020 2020 2065 6c73 653a 0d0a           else:..
+000079f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00007a00: 2320 636f 6d70 6172 6520 6167 6169 6e73  # compare agains
+00007a10: 7420 7468 6520 4352 4320 6f74 6865 7277  t the CRC otherw
+00007a20: 6973 650d 0a20 2020 2020 2020 2020 2020  ise..           
+00007a30: 2020 2020 2063 6865 636b 5f62 7974 6520       check_byte 
+00007a40: 3d20 287a 6970 696e 666f 2e43 5243 203e  = (zipinfo.CRC >
+00007a50: 3e20 3234 2920 2620 3078 4646 0d0a 2020  > 24) & 0xFF..  
+00007a60: 2020 2020 2020 2020 2020 6820 3d20 7365            h = se
+00007a70: 6c66 2e5f 696e 6974 5f64 6563 7279 7074  lf._init_decrypt
+00007a80: 6572 2829 0d0a 2020 2020 2020 2020 2020  er()..          
+00007a90: 2020 6966 2068 2021 3d20 6368 6563 6b5f    if h != check_
+00007aa0: 6279 7465 3a0d 0a20 2020 2020 2020 2020  byte:..         
+00007ab0: 2020 2020 2020 2072 6169 7365 2052 756e         raise Run
+00007ac0: 7469 6d65 4572 726f 7228 0d0a 2020 2020  timeError(..    
+00007ad0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00007ae0: 2242 6164 2070 6173 7377 6f72 6420 666f  "Bad password fo
+00007af0: 7220 6669 6c65 2025 7222 2025 207a 6970  r file %r" % zip
+00007b00: 696e 666f 2e6f 7269 675f 6669 6c65 6e61  info.orig_filena
+00007b10: 6d65 2c0d 0a20 2020 2020 2020 2020 2020  me,..           
+00007b20: 2020 2020 2029 0d0a 0d0a 2020 2020 6465       )....    de
+00007b30: 6620 5f69 6e69 745f 6465 6372 7970 7465  f _init_decrypte
+00007b40: 7228 7365 6c66 293a 0d0a 2020 2020 2020  r(self):..      
+00007b50: 2020 7365 6c66 2e5f 6465 6372 7970 7465    self._decrypte
+00007b60: 7220 3d20 5f5a 6970 4465 6372 7970 7465  r = _ZipDecrypte
+00007b70: 7228 7365 6c66 2e5f 7077 6429 0d0a 2020  r(self._pwd)..  
+00007b80: 2020 2020 2020 2320 5468 6520 6669 7273        # The firs
+00007b90: 7420 3132 2062 7974 6573 2069 6e20 7468  t 12 bytes in th
+00007ba0: 6520 6379 7068 6572 2073 7472 6561 6d20  e cypher stream 
+00007bb0: 6973 2061 6e20 656e 6372 7970 7469 6f6e  is an encryption
+00007bc0: 2068 6561 6465 720d 0a20 2020 2020 2020   header..       
+00007bd0: 2023 2020 7573 6564 2074 6f20 7374 7265   #  used to stre
+00007be0: 6e67 7468 656e 2074 6865 2061 6c67 6f72  ngthen the algor
+00007bf0: 6974 686d 2e20 5468 6520 6669 7273 7420  ithm. The first 
+00007c00: 3131 2062 7974 6573 2061 7265 0d0a 2020  11 bytes are..  
+00007c10: 2020 2020 2020 2320 2063 6f6d 706c 6574        #  complet
+00007c20: 656c 7920 7261 6e64 6f6d 2c20 7768 696c  ely random, whil
+00007c30: 6520 7468 6520 3132 7468 2063 6f6e 7461  e the 12th conta
+00007c40: 696e 7320 7468 6520 4d53 4220 6f66 2074  ins the MSB of t
+00007c50: 6865 2043 5243 2c0d 0a20 2020 2020 2020  he CRC,..       
+00007c60: 2023 2020 6f72 2074 6865 204d 5342 206f   #  or the MSB o
+00007c70: 6620 7468 6520 6669 6c65 2074 696d 6520  f the file time 
+00007c80: 6465 7065 6e64 696e 6720 6f6e 2074 6865  depending on the
+00007c90: 2068 6561 6465 7220 7479 7065 0d0a 2020   header type..  
+00007ca0: 2020 2020 2020 2320 2061 6e64 2069 7320        #  and is 
+00007cb0: 7573 6564 2074 6f20 6368 6563 6b20 7468  used to check th
+00007cc0: 6520 636f 7272 6563 746e 6573 7320 6f66  e correctness of
+00007cd0: 2074 6865 2070 6173 7377 6f72 642e 0d0a   the password...
+00007ce0: 2020 2020 2020 2020 6865 6164 6572 203d          header =
+00007cf0: 2073 656c 662e 5f66 696c 656f 626a 2e72   self._fileobj.r
+00007d00: 6561 6428 3132 290d 0a20 2020 2020 2020  ead(12)..       
+00007d10: 2073 656c 662e 5f63 6f6d 7072 6573 735f   self._compress_
+00007d20: 6c65 6674 202d 3d20 3132 0d0a 2020 2020  left -= 12..    
+00007d30: 2020 2020 7265 7475 726e 2073 656c 662e      return self.
+00007d40: 5f64 6563 7279 7074 6572 2868 6561 6465  _decrypter(heade
+00007d50: 7229 5b31 315d 0d0a 0d0a 2020 2020 6465  r)[11]....    de
+00007d60: 6620 5f5f 7265 7072 5f5f 2873 656c 6629  f __repr__(self)
+00007d70: 202d 3e20 7374 723a 0d0a 2020 2020 2020   -> str:..      
+00007d80: 2020 7265 7375 6c74 203d 205b 0d0a 2020    result = [..  
+00007d90: 2020 2020 2020 2020 2020 6622 3c7b 7365            f"<{se
+00007da0: 6c66 2e5f 5f63 6c61 7373 5f5f 2e5f 5f6d  lf.__class__.__m
+00007db0: 6f64 756c 655f 5f7d 2e7b 7365 6c66 2e5f  odule__}.{self._
+00007dc0: 5f63 6c61 7373 5f5f 2e5f 5f71 7561 6c6e  _class__.__qualn
+00007dd0: 616d 655f 5f7d 222c 0d0a 2020 2020 2020  ame__}",..      
+00007de0: 2020 5d0d 0a20 2020 2020 2020 2069 6620    ]..        if 
+00007df0: 6e6f 7420 7365 6c66 2e63 6c6f 7365 643a  not self.closed:
+00007e00: 0d0a 2020 2020 2020 2020 2020 2020 7265  ..            re
+00007e10: 7375 6c74 2e61 7070 656e 6428 6622 206e  sult.append(f" n
+00007e20: 616d 653d 7b73 656c 662e 6e61 6d65 2172  ame={self.name!r
+00007e30: 7d20 6d6f 6465 3d7b 7365 6c66 2e6d 6f64  } mode={self.mod
+00007e40: 6521 727d 2229 0d0a 2020 2020 2020 2020  e!r}")..        
+00007e50: 2020 2020 6966 2073 656c 662e 5f63 6f6d      if self._com
+00007e60: 7072 6573 735f 7479 7065 2021 3d20 5a49  press_type != ZI
+00007e70: 505f 5354 4f52 4544 3a0d 0a20 2020 2020  P_STORED:..     
+00007e80: 2020 2020 2020 2020 2020 2072 6573 756c             resul
+00007e90: 742e 6170 7065 6e64 280d 0a20 2020 2020  t.append(..     
+00007ea0: 2020 2020 2020 2020 2020 2020 2020 2022                 "
+00007eb0: 2063 6f6d 7072 6573 735f 7479 7065 3d25   compress_type=%
+00007ec0: 7322 0d0a 2020 2020 2020 2020 2020 2020  s"..            
+00007ed0: 2020 2020 2020 2020 2520 636f 6d70 7265          % compre
+00007ee0: 7373 6f72 5f6e 616d 6573 2e67 6574 280d  ssor_names.get(.
+00007ef0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00007f00: 2020 2020 2020 2020 2073 656c 662e 5f63           self._c
+00007f10: 6f6d 7072 6573 735f 7479 7065 2c0d 0a20  ompress_type,.. 
+00007f20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00007f30: 2020 2020 2020 2073 656c 662e 5f63 6f6d         self._com
+00007f40: 7072 6573 735f 7479 7065 2c0d 0a20 2020  press_type,..   
+00007f50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00007f60: 2029 2c0d 0a20 2020 2020 2020 2020 2020   ),..           
+00007f70: 2020 2020 2029 0d0a 2020 2020 2020 2020       )..        
+00007f80: 656c 7365 3a0d 0a20 2020 2020 2020 2020  else:..         
+00007f90: 2020 2072 6573 756c 742e 6170 7065 6e64     result.append
+00007fa0: 2822 205b 636c 6f73 6564 5d22 290d 0a20  (" [closed]").. 
+00007fb0: 2020 2020 2020 2072 6573 756c 742e 6170         result.ap
+00007fc0: 7065 6e64 2822 3e22 290d 0a20 2020 2020  pend(">")..     
+00007fd0: 2020 2072 6574 7572 6e20 2222 2e6a 6f69     return "".joi
+00007fe0: 6e28 7265 7375 6c74 290d 0a0d 0a20 2020  n(result)....   
+00007ff0: 2064 6566 2072 6561 646c 696e 6528 7365   def readline(se
+00008000: 6c66 2c20 6c69 6d69 743d 2d31 293a 0d0a  lf, limit=-1):..
+00008010: 2020 2020 2020 2020 2222 2252 6561 6420          """Read 
+00008020: 616e 6420 7265 7475 726e 2061 206c 696e  and return a lin
+00008030: 6520 6672 6f6d 2074 6865 2073 7472 6561  e from the strea
+00008040: 6d2e 0d0a 0d0a 2020 2020 2020 2020 4966  m.....        If
+00008050: 206c 696d 6974 2069 7320 7370 6563 6966   limit is specif
+00008060: 6965 642c 2061 7420 6d6f 7374 206c 696d  ied, at most lim
+00008070: 6974 2062 7974 6573 2077 696c 6c20 6265  it bytes will be
+00008080: 2072 6561 642e 0d0a 2020 2020 2020 2020   read...        
+00008090: 2222 220d 0a20 2020 2020 2020 2069 6620  """..        if 
+000080a0: 6c69 6d69 7420 3c20 303a 0d0a 2020 2020  limit < 0:..    
+000080b0: 2020 2020 2020 2020 2320 5368 6f72 7463          # Shortc
+000080c0: 7574 2063 6f6d 6d6f 6e20 6361 7365 202d  ut common case -
+000080d0: 206e 6577 6c69 6e65 2066 6f75 6e64 2069   newline found i
+000080e0: 6e20 6275 6666 6572 2e0d 0a20 2020 2020  n buffer...     
+000080f0: 2020 2020 2020 2069 203d 2073 656c 662e         i = self.
+00008100: 5f72 6561 6462 7566 6665 722e 6669 6e64  _readbuffer.find
+00008110: 2862 225c 6e22 2c20 7365 6c66 2e5f 6f66  (b"\n", self._of
+00008120: 6673 6574 2920 2b20 310d 0a20 2020 2020  fset) + 1..     
+00008130: 2020 2020 2020 2069 6620 6920 3e20 303a         if i > 0:
+00008140: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00008150: 2020 6c69 6e65 203d 2073 656c 662e 5f72    line = self._r
+00008160: 6561 6462 7566 6665 725b 7365 6c66 2e5f  eadbuffer[self._
+00008170: 6f66 6673 6574 203a 2069 5d0d 0a20 2020  offset : i]..   
+00008180: 2020 2020 2020 2020 2020 2020 2073 656c               sel
+00008190: 662e 5f6f 6666 7365 7420 3d20 690d 0a20  f._offset = i.. 
+000081a0: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+000081b0: 6574 7572 6e20 6c69 6e65 0d0a 0d0a 2020  eturn line....  
+000081c0: 2020 2020 2020 7265 7475 726e 2069 6f2e        return io.
+000081d0: 4275 6666 6572 6564 494f 4261 7365 2e72  BufferedIOBase.r
+000081e0: 6561 646c 696e 6528 7365 6c66 2c20 6c69  eadline(self, li
+000081f0: 6d69 7429 0d0a 0d0a 2020 2020 6465 6620  mit)....    def 
+00008200: 7065 656b 2873 656c 662c 206e 3d31 293a  peek(self, n=1):
+00008210: 0d0a 2020 2020 2020 2020 2222 2252 6574  ..        """Ret
+00008220: 7572 6e73 2062 7566 6665 7265 6420 6279  urns buffered by
+00008230: 7465 7320 7769 7468 6f75 7420 6164 7661  tes without adva
+00008240: 6e63 696e 6720 7468 6520 706f 7369 7469  ncing the positi
+00008250: 6f6e 2e22 2222 0d0a 2020 2020 2020 2020  on."""..        
+00008260: 6966 206e 203e 206c 656e 2873 656c 662e  if n > len(self.
+00008270: 5f72 6561 6462 7566 6665 7229 202d 2073  _readbuffer) - s
+00008280: 656c 662e 5f6f 6666 7365 743a 0d0a 2020  elf._offset:..  
+00008290: 2020 2020 2020 2020 2020 6368 756e 6b20            chunk 
+000082a0: 3d20 7365 6c66 2e72 6561 6428 6e29 0d0a  = self.read(n)..
+000082b0: 2020 2020 2020 2020 2020 2020 6966 206c              if l
+000082c0: 656e 2863 6875 6e6b 2920 3e20 7365 6c66  en(chunk) > self
+000082d0: 2e5f 6f66 6673 6574 3a0d 0a20 2020 2020  ._offset:..     
+000082e0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+000082f0: 5f72 6561 6462 7566 6665 7220 3d20 6368  _readbuffer = ch
+00008300: 756e 6b20 2b20 7365 6c66 2e5f 7265 6164  unk + self._read
+00008310: 6275 6666 6572 5b73 656c 662e 5f6f 6666  buffer[self._off
+00008320: 7365 7420 3a5d 0d0a 2020 2020 2020 2020  set :]..        
+00008330: 2020 2020 2020 2020 7365 6c66 2e5f 6f66          self._of
+00008340: 6673 6574 203d 2030 0d0a 2020 2020 2020  fset = 0..      
+00008350: 2020 2020 2020 656c 7365 3a0d 0a20 2020        else:..   
+00008360: 2020 2020 2020 2020 2020 2020 2073 656c               sel
+00008370: 662e 5f6f 6666 7365 7420 2d3d 206c 656e  f._offset -= len
+00008380: 2863 6875 6e6b 290d 0a0d 0a20 2020 2020  (chunk)....     
+00008390: 2020 2023 2052 6574 7572 6e20 7570 2074     # Return up t
+000083a0: 6f20 3531 3220 6279 7465 7320 746f 2072  o 512 bytes to r
+000083b0: 6564 7563 6520 616c 6c6f 6361 7469 6f6e  educe allocation
+000083c0: 206f 7665 7268 6561 6420 666f 7220 7469   overhead for ti
+000083d0: 6768 7420 6c6f 6f70 732e 0d0a 2020 2020  ght loops...    
+000083e0: 2020 2020 7265 7475 726e 2073 656c 662e      return self.
+000083f0: 5f72 6561 6462 7566 6665 725b 7365 6c66  _readbuffer[self
+00008400: 2e5f 6f66 6673 6574 203a 2073 656c 662e  ._offset : self.
+00008410: 5f6f 6666 7365 7420 2b20 3531 325d 0d0a  _offset + 512]..
+00008420: 0d0a 2020 2020 6465 6620 7265 6164 6162  ..    def readab
+00008430: 6c65 2873 656c 6629 3a0d 0a20 2020 2020  le(self):..     
+00008440: 2020 2069 6620 7365 6c66 2e63 6c6f 7365     if self.close
+00008450: 643a 0d0a 2020 2020 2020 2020 2020 2020  d:..            
+00008460: 7261 6973 6520 5661 6c75 6545 7272 6f72  raise ValueError
+00008470: 2822 492f 4f20 6f70 6572 6174 696f 6e20  ("I/O operation 
+00008480: 6f6e 2063 6c6f 7365 6420 6669 6c65 2e22  on closed file."
+00008490: 290d 0a20 2020 2020 2020 2072 6574 7572  )..        retur
+000084a0: 6e20 5472 7565 0d0a 0d0a 2020 2020 6465  n True....    de
+000084b0: 6620 7265 6164 2873 656c 662c 206e 3d2d  f read(self, n=-
+000084c0: 3129 3a0d 0a20 2020 2020 2020 2022 2222  1):..        """
+000084d0: 5265 6164 2061 6e64 2072 6574 7572 6e20  Read and return 
+000084e0: 7570 2074 6f20 6e20 6279 7465 732e 0d0a  up to n bytes...
+000084f0: 2020 2020 2020 2020 4966 2074 6865 2061          If the a
+00008500: 7267 756d 656e 7420 6973 206f 6d69 7474  rgument is omitt
+00008510: 6564 2c20 4e6f 6e65 2c20 6f72 206e 6567  ed, None, or neg
+00008520: 6174 6976 652c 2064 6174 6120 6973 2072  ative, data is r
+00008530: 6561 6420 616e 6420 7265 7475 726e 6564  ead and returned
+00008540: 2075 6e74 696c 2045 4f46 2069 7320 7265   until EOF is re
+00008550: 6163 6865 642e 0d0a 2020 2020 2020 2020  ached...        
+00008560: 2222 220d 0a20 2020 2020 2020 2069 6620  """..        if 
+00008570: 7365 6c66 2e63 6c6f 7365 643a 0d0a 2020  self.closed:..  
+00008580: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
+00008590: 5661 6c75 6545 7272 6f72 2822 7265 6164  ValueError("read
+000085a0: 2066 726f 6d20 636c 6f73 6564 2066 696c   from closed fil
+000085b0: 652e 2229 0d0a 2020 2020 2020 2020 6966  e.")..        if
+000085c0: 206e 2069 7320 4e6f 6e65 206f 7220 6e20   n is None or n 
+000085d0: 3c20 303a 0d0a 2020 2020 2020 2020 2020  < 0:..          
+000085e0: 2020 6275 6620 3d20 7365 6c66 2e5f 7265    buf = self._re
+000085f0: 6164 6275 6666 6572 5b73 656c 662e 5f6f  adbuffer[self._o
+00008600: 6666 7365 7420 3a5d 0d0a 2020 2020 2020  ffset :]..      
+00008610: 2020 2020 2020 7365 6c66 2e5f 7265 6164        self._read
+00008620: 6275 6666 6572 203d 2062 2222 0d0a 2020  buffer = b""..  
+00008630: 2020 2020 2020 2020 2020 7365 6c66 2e5f            self._
+00008640: 6f66 6673 6574 203d 2030 0d0a 2020 2020  offset = 0..    
+00008650: 2020 2020 2020 2020 7768 696c 6520 6e6f          while no
+00008660: 7420 7365 6c66 2e5f 656f 663a 0d0a 2020  t self._eof:..  
+00008670: 2020 2020 2020 2020 2020 2020 2020 6275                bu
+00008680: 6620 2b3d 2073 656c 662e 5f72 6561 6431  f += self._read1
+00008690: 2873 656c 662e 4d41 585f 4e29 0d0a 2020  (self.MAX_N)..  
+000086a0: 2020 2020 2020 2020 2020 7265 7475 726e            return
+000086b0: 2062 7566 0d0a 0d0a 2020 2020 2020 2020   buf....        
+000086c0: 656e 6420 3d20 6e20 2b20 7365 6c66 2e5f  end = n + self._
+000086d0: 6f66 6673 6574 0d0a 2020 2020 2020 2020  offset..        
+000086e0: 6966 2065 6e64 203c 206c 656e 2873 656c  if end < len(sel
+000086f0: 662e 5f72 6561 6462 7566 6665 7229 3a0d  f._readbuffer):.
+00008700: 0a20 2020 2020 2020 2020 2020 2062 7566  .            buf
+00008710: 203d 2073 656c 662e 5f72 6561 6462 7566   = self._readbuf
+00008720: 6665 725b 7365 6c66 2e5f 6f66 6673 6574  fer[self._offset
+00008730: 203a 2065 6e64 5d0d 0a20 2020 2020 2020   : end]..       
+00008740: 2020 2020 2073 656c 662e 5f6f 6666 7365       self._offse
+00008750: 7420 3d20 656e 640d 0a20 2020 2020 2020  t = end..       
+00008760: 2020 2020 2072 6574 7572 6e20 6275 660d       return buf.
+00008770: 0a0d 0a20 2020 2020 2020 206e 203d 2065  ...        n = e
+00008780: 6e64 202d 206c 656e 2873 656c 662e 5f72  nd - len(self._r
+00008790: 6561 6462 7566 6665 7229 0d0a 2020 2020  eadbuffer)..    
+000087a0: 2020 2020 6275 6620 3d20 7365 6c66 2e5f      buf = self._
+000087b0: 7265 6164 6275 6666 6572 5b73 656c 662e  readbuffer[self.
+000087c0: 5f6f 6666 7365 7420 3a5d 0d0a 2020 2020  _offset :]..    
+000087d0: 2020 2020 7365 6c66 2e5f 7265 6164 6275      self._readbu
+000087e0: 6666 6572 203d 2062 2222 0d0a 2020 2020  ffer = b""..    
+000087f0: 2020 2020 7365 6c66 2e5f 6f66 6673 6574      self._offset
+00008800: 203d 2030 0d0a 2020 2020 2020 2020 7768   = 0..        wh
+00008810: 696c 6520 6e20 3e20 3020 616e 6420 6e6f  ile n > 0 and no
+00008820: 7420 7365 6c66 2e5f 656f 663a 0d0a 2020  t self._eof:..  
+00008830: 2020 2020 2020 2020 2020 6461 7461 203d            data =
+00008840: 2073 656c 662e 5f72 6561 6431 286e 290d   self._read1(n).
+00008850: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+00008860: 6e20 3c20 6c65 6e28 6461 7461 293a 0d0a  n < len(data):..
+00008870: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00008880: 7365 6c66 2e5f 7265 6164 6275 6666 6572  self._readbuffer
+00008890: 203d 2064 6174 610d 0a20 2020 2020 2020   = data..       
+000088a0: 2020 2020 2020 2020 2073 656c 662e 5f6f           self._o
+000088b0: 6666 7365 7420 3d20 6e0d 0a20 2020 2020  ffset = n..     
+000088c0: 2020 2020 2020 2020 2020 2062 7566 202b             buf +
+000088d0: 3d20 6461 7461 5b3a 6e5d 0d0a 2020 2020  = data[:n]..    
+000088e0: 2020 2020 2020 2020 2020 2020 6272 6561              brea
+000088f0: 6b0d 0a20 2020 2020 2020 2020 2020 2062  k..            b
+00008900: 7566 202b 3d20 6461 7461 0d0a 2020 2020  uf += data..    
+00008910: 2020 2020 2020 2020 6e20 2d3d 206c 656e          n -= len
+00008920: 2864 6174 6129 0d0a 2020 2020 2020 2020  (data)..        
+00008930: 7265 7475 726e 2062 7566 0d0a 0d0a 2020  return buf....  
+00008940: 2020 6465 6620 5f75 7064 6174 655f 6372    def _update_cr
+00008950: 6328 7365 6c66 2c20 6e65 7764 6174 6129  c(self, newdata)
+00008960: 3a0d 0a20 2020 2020 2020 2023 2055 7064  :..        # Upd
+00008970: 6174 6520 7468 6520 4352 4320 7573 696e  ate the CRC usin
+00008980: 6720 7468 6520 6769 7665 6e20 6461 7461  g the given data
+00008990: 2e0d 0a20 2020 2020 2020 2069 6620 7365  ...        if se
+000089a0: 6c66 2e5f 6578 7065 6374 6564 5f63 7263  lf._expected_crc
+000089b0: 2069 7320 4e6f 6e65 3a0d 0a20 2020 2020   is None:..     
+000089c0: 2020 2020 2020 2023 204e 6f20 6e65 6564         # No need
+000089d0: 2074 6f20 636f 6d70 7574 6520 7468 6520   to compute the 
+000089e0: 4352 4320 6966 2077 6520 646f 6e27 7420  CRC if we don't 
+000089f0: 6861 7665 2061 2072 6566 6572 656e 6365  have a reference
+00008a00: 2076 616c 7565 0d0a 2020 2020 2020 2020   value..        
+00008a10: 2020 2020 7265 7475 726e 0d0a 2020 2020      return..    
+00008a20: 2020 2020 7365 6c66 2e5f 7275 6e6e 696e      self._runnin
+00008a30: 675f 6372 6320 3d20 6372 6333 3228 6e65  g_crc = crc32(ne
+00008a40: 7764 6174 612c 2073 656c 662e 5f72 756e  wdata, self._run
+00008a50: 6e69 6e67 5f63 7263 290d 0a20 2020 2020  ning_crc)..     
+00008a60: 2020 2023 2043 6865 636b 2074 6865 2043     # Check the C
+00008a70: 5243 2069 6620 7765 2772 6520 6174 2074  RC if we're at t
+00008a80: 6865 2065 6e64 206f 6620 7468 6520 6669  he end of the fi
+00008a90: 6c65 0d0a 2020 2020 2020 2020 6966 2073  le..        if s
+00008aa0: 656c 662e 5f65 6f66 2061 6e64 2073 656c  elf._eof and sel
+00008ab0: 662e 5f72 756e 6e69 6e67 5f63 7263 2021  f._running_crc !
+00008ac0: 3d20 7365 6c66 2e5f 6578 7065 6374 6564  = self._expected
+00008ad0: 5f63 7263 3a0d 0a20 2020 2020 2020 2020  _crc:..         
+00008ae0: 2020 2072 6169 7365 2042 6164 5a69 7046     raise BadZipF
+00008af0: 696c 6528 2242 6164 2043 5243 2d33 3220  ile("Bad CRC-32 
+00008b00: 666f 7220 6669 6c65 2025 7222 2025 2073  for file %r" % s
+00008b10: 656c 662e 6e61 6d65 290d 0a0d 0a20 2020  elf.name)....   
+00008b20: 2064 6566 2072 6561 6431 2873 656c 662c   def read1(self,
+00008b30: 206e 293a 0d0a 2020 2020 2020 2020 2222   n):..        ""
+00008b40: 2252 6561 6420 7570 2074 6f20 6e20 6279  "Read up to n by
+00008b50: 7465 7320 7769 7468 2061 7420 6d6f 7374  tes with at most
+00008b60: 206f 6e65 2072 6561 6428 2920 7379 7374   one read() syst
+00008b70: 656d 2063 616c 6c2e 2222 220d 0a20 2020  em call."""..   
+00008b80: 2020 2020 2069 6620 6e20 6973 204e 6f6e       if n is Non
+00008b90: 6520 6f72 206e 203c 2030 3a0d 0a20 2020  e or n < 0:..   
+00008ba0: 2020 2020 2020 2020 2062 7566 203d 2073           buf = s
+00008bb0: 656c 662e 5f72 6561 6462 7566 6665 725b  elf._readbuffer[
+00008bc0: 7365 6c66 2e5f 6f66 6673 6574 203a 5d0d  self._offset :].
+00008bd0: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+00008be0: 662e 5f72 6561 6462 7566 6665 7220 3d20  f._readbuffer = 
+00008bf0: 6222 220d 0a20 2020 2020 2020 2020 2020  b""..           
+00008c00: 2073 656c 662e 5f6f 6666 7365 7420 3d20   self._offset = 
+00008c10: 300d 0a20 2020 2020 2020 2020 2020 2077  0..            w
+00008c20: 6869 6c65 206e 6f74 2073 656c 662e 5f65  hile not self._e
+00008c30: 6f66 3a0d 0a20 2020 2020 2020 2020 2020  of:..           
+00008c40: 2020 2020 2064 6174 6120 3d20 7365 6c66       data = self
+00008c50: 2e5f 7265 6164 3128 7365 6c66 2e4d 4158  ._read1(self.MAX
+00008c60: 5f4e 290d 0a20 2020 2020 2020 2020 2020  _N)..           
+00008c70: 2020 2020 2069 6620 6461 7461 3a0d 0a20       if data:.. 
+00008c80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00008c90: 2020 2062 7566 202b 3d20 6461 7461 0d0a     buf += data..
+00008ca0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00008cb0: 2020 2020 6272 6561 6b0d 0a20 2020 2020      break..     
+00008cc0: 2020 2020 2020 2072 6574 7572 6e20 6275         return bu
+00008cd0: 660d 0a0d 0a20 2020 2020 2020 2065 6e64  f....        end
+00008ce0: 203d 206e 202b 2073 656c 662e 5f6f 6666   = n + self._off
+00008cf0: 7365 740d 0a20 2020 2020 2020 2069 6620  set..        if 
+00008d00: 656e 6420 3c20 6c65 6e28 7365 6c66 2e5f  end < len(self._
+00008d10: 7265 6164 6275 6666 6572 293a 0d0a 2020  readbuffer):..  
+00008d20: 2020 2020 2020 2020 2020 6275 6620 3d20            buf = 
+00008d30: 7365 6c66 2e5f 7265 6164 6275 6666 6572  self._readbuffer
+00008d40: 5b73 656c 662e 5f6f 6666 7365 7420 3a20  [self._offset : 
+00008d50: 656e 645d 0d0a 2020 2020 2020 2020 2020  end]..          
+00008d60: 2020 7365 6c66 2e5f 6f66 6673 6574 203d    self._offset =
+00008d70: 2065 6e64 0d0a 2020 2020 2020 2020 2020   end..          
+00008d80: 2020 7265 7475 726e 2062 7566 0d0a 0d0a    return buf....
+00008d90: 2020 2020 2020 2020 6e20 3d20 656e 6420          n = end 
+00008da0: 2d20 6c65 6e28 7365 6c66 2e5f 7265 6164  - len(self._read
+00008db0: 6275 6666 6572 290d 0a20 2020 2020 2020  buffer)..       
+00008dc0: 2062 7566 203d 2073 656c 662e 5f72 6561   buf = self._rea
+00008dd0: 6462 7566 6665 725b 7365 6c66 2e5f 6f66  dbuffer[self._of
+00008de0: 6673 6574 203a 5d0d 0a20 2020 2020 2020  fset :]..       
+00008df0: 2073 656c 662e 5f72 6561 6462 7566 6665   self._readbuffe
+00008e00: 7220 3d20 6222 220d 0a20 2020 2020 2020  r = b""..       
+00008e10: 2073 656c 662e 5f6f 6666 7365 7420 3d20   self._offset = 
+00008e20: 300d 0a20 2020 2020 2020 2069 6620 6e20  0..        if n 
+00008e30: 3e20 303a 0d0a 2020 2020 2020 2020 2020  > 0:..          
+00008e40: 2020 7768 696c 6520 6e6f 7420 7365 6c66    while not self
+00008e50: 2e5f 656f 663a 0d0a 2020 2020 2020 2020  ._eof:..        
+00008e60: 2020 2020 2020 2020 6461 7461 203d 2073          data = s
+00008e70: 656c 662e 5f72 6561 6431 286e 290d 0a20  elf._read1(n).. 
+00008e80: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+00008e90: 6620 6e20 3c20 6c65 6e28 6461 7461 293a  f n < len(data):
+00008ea0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00008eb0: 2020 2020 2020 7365 6c66 2e5f 7265 6164        self._read
+00008ec0: 6275 6666 6572 203d 2064 6174 610d 0a20  buffer = data.. 
+00008ed0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00008ee0: 2020 2073 656c 662e 5f6f 6666 7365 7420     self._offset 
+00008ef0: 3d20 6e0d 0a20 2020 2020 2020 2020 2020  = n..           
+00008f00: 2020 2020 2020 2020 2062 7566 202b 3d20           buf += 
+00008f10: 6461 7461 5b3a 6e5d 0d0a 2020 2020 2020  data[:n]..      
+00008f20: 2020 2020 2020 2020 2020 2020 2020 6272                br
+00008f30: 6561 6b0d 0a20 2020 2020 2020 2020 2020  eak..           
+00008f40: 2020 2020 2069 6620 6461 7461 3a0d 0a20       if data:.. 
+00008f50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00008f60: 2020 2062 7566 202b 3d20 6461 7461 0d0a     buf += data..
+00008f70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00008f80: 2020 2020 6272 6561 6b0d 0a20 2020 2020      break..     
+00008f90: 2020 2072 6574 7572 6e20 6275 660d 0a0d     return buf...
+00008fa0: 0a20 2020 2064 6566 205f 7265 6164 3128  .    def _read1(
+00008fb0: 7365 6c66 2c20 6e29 3a0d 0a20 2020 2020  self, n):..     
+00008fc0: 2020 2023 2052 6561 6420 7570 2074 6f20     # Read up to 
+00008fd0: 6e20 636f 6d70 7265 7373 6564 2062 7974  n compressed byt
+00008fe0: 6573 2077 6974 6820 6174 206d 6f73 7420  es with at most 
+00008ff0: 6f6e 6520 7265 6164 2829 2073 7973 7465  one read() syste
+00009000: 6d20 6361 6c6c 2c0d 0a20 2020 2020 2020  m call,..       
+00009010: 2023 2064 6563 7279 7074 2061 6e64 2064   # decrypt and d
+00009020: 6563 6f6d 7072 6573 7320 7468 656d 2e0d  ecompress them..
+00009030: 0a20 2020 2020 2020 2069 6620 7365 6c66  .        if self
+00009040: 2e5f 656f 6620 6f72 206e 203c 3d20 303a  ._eof or n <= 0:
+00009050: 0d0a 2020 2020 2020 2020 2020 2020 7265  ..            re
+00009060: 7475 726e 2062 2222 0d0a 0d0a 2020 2020  turn b""....    
+00009070: 2020 2020 2320 5265 6164 2066 726f 6d20      # Read from 
+00009080: 6669 6c65 2e0d 0a20 2020 2020 2020 2069  file...        i
+00009090: 6620 7365 6c66 2e5f 636f 6d70 7265 7373  f self._compress
+000090a0: 5f74 7970 6520 3d3d 205a 4950 5f44 4546  _type == ZIP_DEF
+000090b0: 4c41 5445 443a 0d0a 2020 2020 2020 2020  LATED:..        
+000090c0: 2020 2020 2323 2048 616e 646c 6520 756e      ## Handle un
+000090d0: 636f 6e73 756d 6564 2064 6174 612e 0d0a  consumed data...
+000090e0: 2020 2020 2020 2020 2020 2020 6461 7461              data
+000090f0: 203d 2073 656c 662e 5f64 6563 6f6d 7072   = self._decompr
+00009100: 6573 736f 722e 756e 636f 6e73 756d 6564  essor.unconsumed
+00009110: 5f74 6169 6c0d 0a20 2020 2020 2020 2020  _tail..         
+00009120: 2020 2069 6620 6e20 3e20 6c65 6e28 6461     if n > len(da
+00009130: 7461 293a 0d0a 2020 2020 2020 2020 2020  ta):..          
+00009140: 2020 2020 2020 6461 7461 202b 3d20 7365        data += se
+00009150: 6c66 2e5f 7265 6164 3228 6e20 2d20 6c65  lf._read2(n - le
+00009160: 6e28 6461 7461 2929 0d0a 2020 2020 2020  n(data))..      
+00009170: 2020 656c 7365 3a0d 0a20 2020 2020 2020    else:..       
+00009180: 2020 2020 2064 6174 6120 3d20 7365 6c66       data = self
+00009190: 2e5f 7265 6164 3228 6e29 0d0a 0d0a 2020  ._read2(n)....  
+000091a0: 2020 2020 2020 6966 2073 656c 662e 5f63        if self._c
+000091b0: 6f6d 7072 6573 735f 7479 7065 203d 3d20  ompress_type == 
+000091c0: 5a49 505f 5354 4f52 4544 3a0d 0a20 2020  ZIP_STORED:..   
+000091d0: 2020 2020 2020 2020 2073 656c 662e 5f65           self._e
+000091e0: 6f66 203d 2073 656c 662e 5f63 6f6d 7072  of = self._compr
+000091f0: 6573 735f 6c65 6674 203c 3d20 300d 0a20  ess_left <= 0.. 
+00009200: 2020 2020 2020 2065 6c69 6620 7365 6c66         elif self
+00009210: 2e5f 636f 6d70 7265 7373 5f74 7970 6520  ._compress_type 
+00009220: 3d3d 205a 4950 5f44 4546 4c41 5445 443a  == ZIP_DEFLATED:
+00009230: 0d0a 2020 2020 2020 2020 2020 2020 6e20  ..            n 
+00009240: 3d20 6d61 7828 6e2c 2073 656c 662e 4d49  = max(n, self.MI
+00009250: 4e5f 5245 4144 5f53 495a 4529 0d0a 2020  N_READ_SIZE)..  
+00009260: 2020 2020 2020 2020 2020 6461 7461 203d            data =
+00009270: 2073 656c 662e 5f64 6563 6f6d 7072 6573   self._decompres
+00009280: 736f 722e 6465 636f 6d70 7265 7373 2864  sor.decompress(d
+00009290: 6174 612c 206e 290d 0a20 2020 2020 2020  ata, n)..       
+000092a0: 2020 2020 2073 656c 662e 5f65 6f66 203d       self._eof =
+000092b0: 2028 0d0a 2020 2020 2020 2020 2020 2020   (..            
+000092c0: 2020 2020 7365 6c66 2e5f 6465 636f 6d70      self._decomp
+000092d0: 7265 7373 6f72 2e65 6f66 0d0a 2020 2020  ressor.eof..    
+000092e0: 2020 2020 2020 2020 2020 2020 6f72 2073              or s
+000092f0: 656c 662e 5f63 6f6d 7072 6573 735f 6c65  elf._compress_le
+00009300: 6674 203c 3d20 300d 0a20 2020 2020 2020  ft <= 0..       
+00009310: 2020 2020 2020 2020 2061 6e64 206e 6f74           and not
+00009320: 2073 656c 662e 5f64 6563 6f6d 7072 6573   self._decompres
+00009330: 736f 722e 756e 636f 6e73 756d 6564 5f74  sor.unconsumed_t
+00009340: 6169 6c0d 0a20 2020 2020 2020 2020 2020  ail..           
+00009350: 2029 0d0a 2020 2020 2020 2020 2020 2020   )..            
+00009360: 6966 2073 656c 662e 5f65 6f66 3a0d 0a20  if self._eof:.. 
+00009370: 2020 2020 2020 2020 2020 2020 2020 2064                 d
+00009380: 6174 6120 2b3d 2073 656c 662e 5f64 6563  ata += self._dec
+00009390: 6f6d 7072 6573 736f 722e 666c 7573 6828  ompressor.flush(
+000093a0: 290d 0a20 2020 2020 2020 2065 6c73 653a  )..        else:
+000093b0: 0d0a 2020 2020 2020 2020 2020 2020 6461  ..            da
+000093c0: 7461 203d 2073 656c 662e 5f64 6563 6f6d  ta = self._decom
+000093d0: 7072 6573 736f 722e 6465 636f 6d70 7265  pressor.decompre
+000093e0: 7373 2864 6174 6129 0d0a 2020 2020 2020  ss(data)..      
+000093f0: 2020 2020 2020 7365 6c66 2e5f 656f 6620        self._eof 
+00009400: 3d20 7365 6c66 2e5f 6465 636f 6d70 7265  = self._decompre
+00009410: 7373 6f72 2e65 6f66 206f 7220 7365 6c66  ssor.eof or self
+00009420: 2e5f 636f 6d70 7265 7373 5f6c 6566 7420  ._compress_left 
+00009430: 3c3d 2030 0d0a 0d0a 2020 2020 2020 2020  <= 0....        
+00009440: 6461 7461 203d 2064 6174 615b 3a20 7365  data = data[: se
+00009450: 6c66 2e5f 6c65 6674 5d0d 0a20 2020 2020  lf._left]..     
+00009460: 2020 2073 656c 662e 5f6c 6566 7420 2d3d     self._left -=
+00009470: 206c 656e 2864 6174 6129 0d0a 2020 2020   len(data)..    
+00009480: 2020 2020 6966 2073 656c 662e 5f6c 6566      if self._lef
+00009490: 7420 3c3d 2030 3a0d 0a20 2020 2020 2020  t <= 0:..       
+000094a0: 2020 2020 2073 656c 662e 5f65 6f66 203d       self._eof =
+000094b0: 2054 7275 650d 0a20 2020 2020 2020 2073   True..        s
+000094c0: 656c 662e 5f75 7064 6174 655f 6372 6328  elf._update_crc(
+000094d0: 6461 7461 290d 0a20 2020 2020 2020 2072  data)..        r
+000094e0: 6574 7572 6e20 6461 7461 0d0a 0d0a 2020  eturn data....  
+000094f0: 2020 6465 6620 5f72 6561 6432 2873 656c    def _read2(sel
+00009500: 662c 206e 293a 0d0a 2020 2020 2020 2020  f, n):..        
+00009510: 6966 2073 656c 662e 5f63 6f6d 7072 6573  if self._compres
+00009520: 735f 6c65 6674 203c 3d20 303a 0d0a 2020  s_left <= 0:..  
+00009530: 2020 2020 2020 2020 2020 7265 7475 726e            return
+00009540: 2062 2222 0d0a 0d0a 2020 2020 2020 2020   b""....        
+00009550: 6e20 3d20 6d61 7828 6e2c 2073 656c 662e  n = max(n, self.
+00009560: 4d49 4e5f 5245 4144 5f53 495a 4529 0d0a  MIN_READ_SIZE)..
+00009570: 2020 2020 2020 2020 6e20 3d20 6d69 6e28          n = min(
+00009580: 6e2c 2073 656c 662e 5f63 6f6d 7072 6573  n, self._compres
+00009590: 735f 6c65 6674 290d 0a0d 0a20 2020 2020  s_left)....     
+000095a0: 2020 2064 6174 6120 3d20 7365 6c66 2e5f     data = self._
+000095b0: 6669 6c65 6f62 6a2e 7265 6164 286e 290d  fileobj.read(n).
+000095c0: 0a20 2020 2020 2020 2073 656c 662e 5f63  .        self._c
+000095d0: 6f6d 7072 6573 735f 6c65 6674 202d 3d20  ompress_left -= 
+000095e0: 6c65 6e28 6461 7461 290d 0a20 2020 2020  len(data)..     
+000095f0: 2020 2069 6620 6e6f 7420 6461 7461 3a0d     if not data:.
+00009600: 0a20 2020 2020 2020 2020 2020 2072 6169  .            rai
+00009610: 7365 2045 4f46 4572 726f 720d 0a0d 0a20  se EOFError.... 
+00009620: 2020 2020 2020 2069 6620 7365 6c66 2e5f         if self._
+00009630: 6465 6372 7970 7465 7220 6973 206e 6f74  decrypter is not
+00009640: 204e 6f6e 653a 0d0a 2020 2020 2020 2020   None:..        
+00009650: 2020 2020 6461 7461 203d 2073 656c 662e      data = self.
+00009660: 5f64 6563 7279 7074 6572 2864 6174 6129  _decrypter(data)
+00009670: 0d0a 2020 2020 2020 2020 7265 7475 726e  ..        return
+00009680: 2064 6174 610d 0a0d 0a20 2020 2064 6566   data....    def
+00009690: 2063 6c6f 7365 2873 656c 6629 3a0d 0a20   close(self):.. 
+000096a0: 2020 2020 2020 2074 7279 3a0d 0a20 2020         try:..   
+000096b0: 2020 2020 2020 2020 2069 6620 7365 6c66           if self
+000096c0: 2e5f 636c 6f73 655f 6669 6c65 6f62 6a3a  ._close_fileobj:
+000096d0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+000096e0: 2020 7365 6c66 2e5f 6669 6c65 6f62 6a2e    self._fileobj.
+000096f0: 636c 6f73 6528 290d 0a20 2020 2020 2020  close()..       
+00009700: 2066 696e 616c 6c79 3a0d 0a20 2020 2020   finally:..     
+00009710: 2020 2020 2020 2073 7570 6572 2829 2e63         super().c
+00009720: 6c6f 7365 2829 0d0a 0d0a 2020 2020 6465  lose()....    de
+00009730: 6620 7365 656b 6162 6c65 2873 656c 6629  f seekable(self)
+00009740: 3a0d 0a20 2020 2020 2020 2069 6620 7365  :..        if se
+00009750: 6c66 2e63 6c6f 7365 643a 0d0a 2020 2020  lf.closed:..    
+00009760: 2020 2020 2020 2020 7261 6973 6520 5661          raise Va
+00009770: 6c75 6545 7272 6f72 2822 492f 4f20 6f70  lueError("I/O op
+00009780: 6572 6174 696f 6e20 6f6e 2063 6c6f 7365  eration on close
+00009790: 6420 6669 6c65 2e22 290d 0a20 2020 2020  d file.")..     
+000097a0: 2020 2072 6574 7572 6e20 7365 6c66 2e5f     return self._
+000097b0: 7365 656b 6162 6c65 0d0a 0d0a 2020 2020  seekable....    
+000097c0: 6465 6620 7365 656b 2873 656c 662c 206f  def seek(self, o
+000097d0: 6666 7365 742c 2077 6865 6e63 653d 3029  ffset, whence=0)
+000097e0: 3a0d 0a20 2020 2020 2020 2069 6620 7365  :..        if se
+000097f0: 6c66 2e63 6c6f 7365 643a 0d0a 2020 2020  lf.closed:..    
+00009800: 2020 2020 2020 2020 7261 6973 6520 5661          raise Va
+00009810: 6c75 6545 7272 6f72 2822 7365 656b 206f  lueError("seek o
+00009820: 6e20 636c 6f73 6564 2066 696c 652e 2229  n closed file.")
+00009830: 0d0a 2020 2020 2020 2020 6966 206e 6f74  ..        if not
+00009840: 2073 656c 662e 5f73 6565 6b61 626c 653a   self._seekable:
+00009850: 0d0a 2020 2020 2020 2020 2020 2020 7261  ..            ra
+00009860: 6973 6520 696f 2e55 6e73 7570 706f 7274  ise io.Unsupport
+00009870: 6564 4f70 6572 6174 696f 6e28 2275 6e64  edOperation("und
+00009880: 6572 6c79 696e 6720 7374 7265 616d 2069  erlying stream i
+00009890: 7320 6e6f 7420 7365 656b 6162 6c65 2229  s not seekable")
+000098a0: 0d0a 2020 2020 2020 2020 6375 7272 5f70  ..        curr_p
+000098b0: 6f73 203d 2073 656c 662e 7465 6c6c 2829  os = self.tell()
+000098c0: 0d0a 2020 2020 2020 2020 6966 2077 6865  ..        if whe
+000098d0: 6e63 6520 3d3d 2030 3a20 2023 2053 6565  nce == 0:  # See
+000098e0: 6b20 6672 6f6d 2073 7461 7274 206f 6620  k from start of 
+000098f0: 6669 6c65 0d0a 2020 2020 2020 2020 2020  file..          
+00009900: 2020 6e65 775f 706f 7320 3d20 6f66 6673    new_pos = offs
+00009910: 6574 0d0a 2020 2020 2020 2020 656c 6966  et..        elif
+00009920: 2077 6865 6e63 6520 3d3d 2031 3a20 2023   whence == 1:  #
+00009930: 2053 6565 6b20 6672 6f6d 2063 7572 7265   Seek from curre
+00009940: 6e74 2070 6f73 6974 696f 6e0d 0a20 2020  nt position..   
+00009950: 2020 2020 2020 2020 206e 6577 5f70 6f73           new_pos
+00009960: 203d 2063 7572 725f 706f 7320 2b20 6f66   = curr_pos + of
+00009970: 6673 6574 0d0a 2020 2020 2020 2020 656c  fset..        el
+00009980: 6966 2077 6865 6e63 6520 3d3d 2032 3a20  if whence == 2: 
+00009990: 2023 2053 6565 6b20 6672 6f6d 2045 4f46   # Seek from EOF
+000099a0: 0d0a 2020 2020 2020 2020 2020 2020 6e65  ..            ne
+000099b0: 775f 706f 7320 3d20 7365 6c66 2e5f 6f72  w_pos = self._or
+000099c0: 6967 5f66 696c 655f 7369 7a65 202b 206f  ig_file_size + o
+000099d0: 6666 7365 740d 0a20 2020 2020 2020 2065  ffset..        e
+000099e0: 6c73 653a 0d0a 2020 2020 2020 2020 2020  lse:..          
+000099f0: 2020 7261 6973 6520 5661 6c75 6545 7272    raise ValueErr
+00009a00: 6f72 280d 0a20 2020 2020 2020 2020 2020  or(..           
+00009a10: 2020 2020 2022 7768 656e 6365 206d 7573       "whence mus
+00009a20: 7420 6265 206f 732e 5345 454b 5f53 4554  t be os.SEEK_SET
+00009a30: 2028 3029 2c20 220d 0a20 2020 2020 2020   (0), "..       
+00009a40: 2020 2020 2020 2020 2022 6f73 2e53 4545           "os.SEE
+00009a50: 4b5f 4355 5220 2831 292c 206f 7220 6f73  K_CUR (1), or os
+00009a60: 2e53 4545 4b5f 454e 4420 2832 2922 2c0d  .SEEK_END (2)",.
+00009a70: 0a20 2020 2020 2020 2020 2020 2029 0d0a  .            )..
+00009a80: 0d0a 2020 2020 2020 2020 6966 206e 6577  ..        if new
+00009a90: 5f70 6f73 203e 2073 656c 662e 5f6f 7269  _pos > self._ori
+00009aa0: 675f 6669 6c65 5f73 697a 653a 0d0a 2020  g_file_size:..  
+00009ab0: 2020 2020 2020 2020 2020 6e65 775f 706f            new_po
+00009ac0: 7320 3d20 7365 6c66 2e5f 6f72 6967 5f66  s = self._orig_f
+00009ad0: 696c 655f 7369 7a65 0d0a 0d0a 2020 2020  ile_size....    
+00009ae0: 2020 2020 6966 206e 6577 5f70 6f73 203c      if new_pos <
+00009af0: 2030 3a0d 0a20 2020 2020 2020 2020 2020   0:..           
+00009b00: 206e 6577 5f70 6f73 203d 2030 0d0a 0d0a   new_pos = 0....
+00009b10: 2020 2020 2020 2020 7265 6164 5f6f 6666          read_off
+00009b20: 7365 7420 3d20 6e65 775f 706f 7320 2d20  set = new_pos - 
+00009b30: 6375 7272 5f70 6f73 0d0a 2020 2020 2020  curr_pos..      
+00009b40: 2020 6275 6666 5f6f 6666 7365 7420 3d20    buff_offset = 
+00009b50: 7265 6164 5f6f 6666 7365 7420 2b20 7365  read_offset + se
+00009b60: 6c66 2e5f 6f66 6673 6574 0d0a 0d0a 2020  lf._offset....  
+00009b70: 2020 2020 2020 6966 2062 7566 665f 6f66        if buff_of
+00009b80: 6673 6574 203e 3d20 3020 616e 6420 6275  fset >= 0 and bu
+00009b90: 6666 5f6f 6666 7365 7420 3c20 6c65 6e28  ff_offset < len(
+00009ba0: 7365 6c66 2e5f 7265 6164 6275 6666 6572  self._readbuffer
+00009bb0: 293a 0d0a 2020 2020 2020 2020 2020 2020  ):..            
+00009bc0: 2320 4a75 7374 206d 6f76 6520 7468 6520  # Just move the 
+00009bd0: 5f6f 6666 7365 7420 696e 6465 7820 6966  _offset index if
+00009be0: 2074 6865 206e 6577 2070 6f73 6974 696f   the new positio
+00009bf0: 6e20 6973 2069 6e20 7468 6520 5f72 6561  n is in the _rea
+00009c00: 6462 7566 6665 720d 0a20 2020 2020 2020  dbuffer..       
+00009c10: 2020 2020 2073 656c 662e 5f6f 6666 7365       self._offse
+00009c20: 7420 3d20 6275 6666 5f6f 6666 7365 740d  t = buff_offset.
+00009c30: 0a20 2020 2020 2020 2020 2020 2072 6561  .            rea
+00009c40: 645f 6f66 6673 6574 203d 2030 0d0a 2020  d_offset = 0..  
+00009c50: 2020 2020 2020 656c 6966 2072 6561 645f        elif read_
+00009c60: 6f66 6673 6574 203c 2030 3a0d 0a20 2020  offset < 0:..   
+00009c70: 2020 2020 2020 2020 2023 2050 6f73 6974           # Posit
+00009c80: 696f 6e20 6973 2062 6566 6f72 6520 7468  ion is before th
+00009c90: 6520 6375 7272 656e 7420 706f 7369 7469  e current positi
+00009ca0: 6f6e 2e20 5265 7365 7420 7468 6520 5a69  on. Reset the Zi
+00009cb0: 7045 7874 4669 6c65 0d0a 2020 2020 2020  pExtFile..      
+00009cc0: 2020 2020 2020 7365 6c66 2e5f 6669 6c65        self._file
+00009cd0: 6f62 6a2e 7365 656b 2873 656c 662e 5f6f  obj.seek(self._o
+00009ce0: 7269 675f 636f 6d70 7265 7373 5f73 7461  rig_compress_sta
+00009cf0: 7274 290d 0a20 2020 2020 2020 2020 2020  rt)..           
+00009d00: 2073 656c 662e 5f72 756e 6e69 6e67 5f63   self._running_c
+00009d10: 7263 203d 2073 656c 662e 5f6f 7269 675f  rc = self._orig_
+00009d20: 7374 6172 745f 6372 630d 0a20 2020 2020  start_crc..     
+00009d30: 2020 2020 2020 2073 656c 662e 5f63 6f6d         self._com
+00009d40: 7072 6573 735f 6c65 6674 203d 2073 656c  press_left = sel
+00009d50: 662e 5f6f 7269 675f 636f 6d70 7265 7373  f._orig_compress
+00009d60: 5f73 697a 650d 0a20 2020 2020 2020 2020  _size..         
+00009d70: 2020 2073 656c 662e 5f6c 6566 7420 3d20     self._left = 
+00009d80: 7365 6c66 2e5f 6f72 6967 5f66 696c 655f  self._orig_file_
+00009d90: 7369 7a65 0d0a 2020 2020 2020 2020 2020  size..          
+00009da0: 2020 7365 6c66 2e5f 7265 6164 6275 6666    self._readbuff
+00009db0: 6572 203d 2062 2222 0d0a 2020 2020 2020  er = b""..      
+00009dc0: 2020 2020 2020 7365 6c66 2e5f 6f66 6673        self._offs
+00009dd0: 6574 203d 2030 0d0a 2020 2020 2020 2020  et = 0..        
+00009de0: 2020 2020 7365 6c66 2e5f 6465 636f 6d70      self._decomp
+00009df0: 7265 7373 6f72 203d 205f 6765 745f 6465  ressor = _get_de
+00009e00: 636f 6d70 7265 7373 6f72 2873 656c 662e  compressor(self.
+00009e10: 5f63 6f6d 7072 6573 735f 7479 7065 290d  _compress_type).
+00009e20: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+00009e30: 662e 5f65 6f66 203d 2046 616c 7365 0d0a  f._eof = False..
+00009e40: 2020 2020 2020 2020 2020 2020 7265 6164              read
+00009e50: 5f6f 6666 7365 7420 3d20 6e65 775f 706f  _offset = new_po
+00009e60: 730d 0a20 2020 2020 2020 2020 2020 2069  s..            i
+00009e70: 6620 7365 6c66 2e5f 6465 6372 7970 7465  f self._decrypte
+00009e80: 7220 6973 206e 6f74 204e 6f6e 653a 0d0a  r is not None:..
+00009e90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009ea0: 7365 6c66 2e5f 696e 6974 5f64 6563 7279  self._init_decry
+00009eb0: 7074 6572 2829 0d0a 0d0a 2020 2020 2020  pter()....      
+00009ec0: 2020 7768 696c 6520 7265 6164 5f6f 6666    while read_off
+00009ed0: 7365 7420 3e20 303a 0d0a 2020 2020 2020  set > 0:..      
+00009ee0: 2020 2020 2020 7265 6164 5f6c 656e 203d        read_len =
+00009ef0: 206d 696e 2873 656c 662e 4d41 585f 5345   min(self.MAX_SE
+00009f00: 454b 5f52 4541 442c 2072 6561 645f 6f66  EK_READ, read_of
+00009f10: 6673 6574 290d 0a20 2020 2020 2020 2020  fset)..         
+00009f20: 2020 2073 656c 662e 7265 6164 2872 6561     self.read(rea
+00009f30: 645f 6c65 6e29 0d0a 2020 2020 2020 2020  d_len)..        
+00009f40: 2020 2020 7265 6164 5f6f 6666 7365 7420      read_offset 
+00009f50: 2d3d 2072 6561 645f 6c65 6e0d 0a0d 0a20  -= read_len.... 
+00009f60: 2020 2020 2020 2072 6574 7572 6e20 7365         return se
+00009f70: 6c66 2e74 656c 6c28 290d 0a0d 0a20 2020  lf.tell()....   
+00009f80: 2064 6566 2074 656c 6c28 7365 6c66 293a   def tell(self):
+00009f90: 0d0a 2020 2020 2020 2020 6966 2073 656c  ..        if sel
+00009fa0: 662e 636c 6f73 6564 3a0d 0a20 2020 2020  f.closed:..     
+00009fb0: 2020 2020 2020 2072 6169 7365 2056 616c         raise Val
+00009fc0: 7565 4572 726f 7228 2274 656c 6c20 6f6e  ueError("tell on
+00009fd0: 2063 6c6f 7365 6420 6669 6c65 2e22 290d   closed file.").
+00009fe0: 0a20 2020 2020 2020 2069 6620 6e6f 7420  .        if not 
+00009ff0: 7365 6c66 2e5f 7365 656b 6162 6c65 3a0d  self._seekable:.
+0000a000: 0a20 2020 2020 2020 2020 2020 2072 6169  .            rai
+0000a010: 7365 2069 6f2e 556e 7375 7070 6f72 7465  se io.Unsupporte
+0000a020: 644f 7065 7261 7469 6f6e 2822 756e 6465  dOperation("unde
+0000a030: 726c 7969 6e67 2073 7472 6561 6d20 6973  rlying stream is
+0000a040: 206e 6f74 2073 6565 6b61 626c 6522 290d   not seekable").
+0000a050: 0a20 2020 2020 2020 2066 696c 6570 6f73  .        filepos
+0000a060: 203d 2028 0d0a 2020 2020 2020 2020 2020   = (..          
+0000a070: 2020 7365 6c66 2e5f 6f72 6967 5f66 696c    self._orig_fil
+0000a080: 655f 7369 7a65 0d0a 2020 2020 2020 2020  e_size..        
+0000a090: 2020 2020 2d20 7365 6c66 2e5f 6c65 6674      - self._left
+0000a0a0: 0d0a 2020 2020 2020 2020 2020 2020 2d20  ..            - 
+0000a0b0: 6c65 6e28 7365 6c66 2e5f 7265 6164 6275  len(self._readbu
+0000a0c0: 6666 6572 290d 0a20 2020 2020 2020 2020  ffer)..         
+0000a0d0: 2020 202b 2073 656c 662e 5f6f 6666 7365     + self._offse
+0000a0e0: 740d 0a20 2020 2020 2020 2029 0d0a 2020  t..        )..  
+0000a0f0: 2020 2020 2020 7265 7475 726e 2066 696c        return fil
+0000a100: 6570 6f73 0d0a 0d0a 0d0a 636c 6173 7320  epos......class 
+0000a110: 5f5a 6970 5772 6974 6546 696c 6528 696f  _ZipWriteFile(io
+0000a120: 2e42 7566 6665 7265 6449 4f42 6173 6529  .BufferedIOBase)
+0000a130: 3a0d 0a20 2020 2064 6566 205f 5f69 6e69  :..    def __ini
+0000a140: 745f 5f28 7365 6c66 2c20 7a66 2c20 7a69  t__(self, zf, zi
+0000a150: 6e66 6f2c 207a 6970 3634 2920 2d3e 204e  nfo, zip64) -> N
+0000a160: 6f6e 653a 0d0a 2020 2020 2020 2020 7365  one:..        se
+0000a170: 6c66 2e5f 7a69 6e66 6f20 3d20 7a69 6e66  lf._zinfo = zinf
+0000a180: 6f0d 0a20 2020 2020 2020 2073 656c 662e  o..        self.
+0000a190: 5f7a 6970 3634 203d 207a 6970 3634 0d0a  _zip64 = zip64..
+0000a1a0: 2020 2020 2020 2020 7365 6c66 2e5f 7a69          self._zi
+0000a1b0: 7066 696c 6520 3d20 7a66 0d0a 2020 2020  pfile = zf..    
+0000a1c0: 2020 2020 7365 6c66 2e5f 636f 6d70 7265      self._compre
+0000a1d0: 7373 6f72 203d 205f 6765 745f 636f 6d70  ssor = _get_comp
+0000a1e0: 7265 7373 6f72 280d 0a20 2020 2020 2020  ressor(..       
+0000a1f0: 2020 2020 207a 696e 666f 2e63 6f6d 7072       zinfo.compr
+0000a200: 6573 735f 7479 7065 2c0d 0a20 2020 2020  ess_type,..     
+0000a210: 2020 2020 2020 207a 696e 666f 2e5f 636f         zinfo._co
+0000a220: 6d70 7265 7373 6c65 7665 6c2c 0d0a 2020  mpresslevel,..  
+0000a230: 2020 2020 2020 290d 0a20 2020 2020 2020        )..       
+0000a240: 2073 656c 662e 5f66 696c 655f 7369 7a65   self._file_size
+0000a250: 203d 2030 0d0a 2020 2020 2020 2020 7365   = 0..        se
+0000a260: 6c66 2e5f 636f 6d70 7265 7373 5f73 697a  lf._compress_siz
+0000a270: 6520 3d20 300d 0a20 2020 2020 2020 2073  e = 0..        s
+0000a280: 656c 662e 5f63 7263 203d 2030 0d0a 0d0a  elf._crc = 0....
+0000a290: 2020 2020 4070 726f 7065 7274 790d 0a20      @property.. 
+0000a2a0: 2020 2064 6566 205f 6669 6c65 6f62 6a28     def _fileobj(
+0000a2b0: 7365 6c66 293a 0d0a 2020 2020 2020 2020  self):..        
+0000a2c0: 7265 7475 726e 2073 656c 662e 5f7a 6970  return self._zip
+0000a2d0: 6669 6c65 2e66 700d 0a0d 0a20 2020 2064  file.fp....    d
+0000a2e0: 6566 2077 7269 7461 626c 6528 7365 6c66  ef writable(self
+0000a2f0: 293a 0d0a 2020 2020 2020 2020 7265 7475  ):..        retu
+0000a300: 726e 2054 7275 650d 0a0d 0a20 2020 2064  rn True....    d
+0000a310: 6566 2077 7269 7465 2873 656c 662c 2064  ef write(self, d
+0000a320: 6174 6129 3a0d 0a20 2020 2020 2020 2069  ata):..        i
+0000a330: 6620 7365 6c66 2e63 6c6f 7365 643a 0d0a  f self.closed:..
+0000a340: 2020 2020 2020 2020 2020 2020 7261 6973              rais
+0000a350: 6520 5661 6c75 6545 7272 6f72 2822 492f  e ValueError("I/
+0000a360: 4f20 6f70 6572 6174 696f 6e20 6f6e 2063  O operation on c
+0000a370: 6c6f 7365 6420 6669 6c65 2e22 290d 0a20  losed file.").. 
+0000a380: 2020 2020 2020 206e 6279 7465 7320 3d20         nbytes = 
+0000a390: 6c65 6e28 6461 7461 290d 0a20 2020 2020  len(data)..     
+0000a3a0: 2020 2073 656c 662e 5f66 696c 655f 7369     self._file_si
+0000a3b0: 7a65 202b 3d20 6e62 7974 6573 0d0a 2020  ze += nbytes..  
+0000a3c0: 2020 2020 2020 7365 6c66 2e5f 6372 6320        self._crc 
+0000a3d0: 3d20 6372 6333 3228 6461 7461 2c20 7365  = crc32(data, se
+0000a3e0: 6c66 2e5f 6372 6329 0d0a 2020 2020 2020  lf._crc)..      
+0000a3f0: 2020 6966 2073 656c 662e 5f63 6f6d 7072    if self._compr
+0000a400: 6573 736f 723a 0d0a 2020 2020 2020 2020  essor:..        
+0000a410: 2020 2020 6461 7461 203d 2073 656c 662e      data = self.
+0000a420: 5f63 6f6d 7072 6573 736f 722e 636f 6d70  _compressor.comp
+0000a430: 7265 7373 2864 6174 6129 0d0a 2020 2020  ress(data)..    
+0000a440: 2020 2020 2020 2020 7365 6c66 2e5f 636f          self._co
+0000a450: 6d70 7265 7373 5f73 697a 6520 2b3d 206c  mpress_size += l
+0000a460: 656e 2864 6174 6129 0d0a 2020 2020 2020  en(data)..      
+0000a470: 2020 7365 6c66 2e5f 6669 6c65 6f62 6a2e    self._fileobj.
+0000a480: 7772 6974 6528 6461 7461 290d 0a20 2020  write(data)..   
+0000a490: 2020 2020 2072 6574 7572 6e20 6e62 7974       return nbyt
+0000a4a0: 6573 0d0a 0d0a 2020 2020 6465 6620 636c  es....    def cl
+0000a4b0: 6f73 6528 7365 6c66 293a 0d0a 2020 2020  ose(self):..    
+0000a4c0: 2020 2020 6966 2073 656c 662e 636c 6f73      if self.clos
+0000a4d0: 6564 3a0d 0a20 2020 2020 2020 2020 2020  ed:..           
+0000a4e0: 2072 6574 7572 6e0d 0a20 2020 2020 2020   return..       
+0000a4f0: 2074 7279 3a0d 0a20 2020 2020 2020 2020   try:..         
+0000a500: 2020 2073 7570 6572 2829 2e63 6c6f 7365     super().close
+0000a510: 2829 0d0a 2020 2020 2020 2020 2020 2020  ()..            
+0000a520: 2320 466c 7573 6820 616e 7920 6461 7461  # Flush any data
+0000a530: 2066 726f 6d20 7468 6520 636f 6d70 7265   from the compre
+0000a540: 7373 6f72 2c20 616e 6420 7570 6461 7465  ssor, and update
+0000a550: 2068 6561 6465 7220 696e 666f 0d0a 2020   header info..  
+0000a560: 2020 2020 2020 2020 2020 6966 2073 656c            if sel
+0000a570: 662e 5f63 6f6d 7072 6573 736f 723a 0d0a  f._compressor:..
+0000a580: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a590: 6275 6620 3d20 7365 6c66 2e5f 636f 6d70  buf = self._comp
+0000a5a0: 7265 7373 6f72 2e66 6c75 7368 2829 0d0a  ressor.flush()..
+0000a5b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a5c0: 7365 6c66 2e5f 636f 6d70 7265 7373 5f73  self._compress_s
+0000a5d0: 697a 6520 2b3d 206c 656e 2862 7566 290d  ize += len(buf).
+0000a5e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000a5f0: 2073 656c 662e 5f66 696c 656f 626a 2e77   self._fileobj.w
+0000a600: 7269 7465 2862 7566 290d 0a20 2020 2020  rite(buf)..     
+0000a610: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+0000a620: 5f7a 696e 666f 2e63 6f6d 7072 6573 735f  _zinfo.compress_
+0000a630: 7369 7a65 203d 2073 656c 662e 5f63 6f6d  size = self._com
+0000a640: 7072 6573 735f 7369 7a65 0d0a 2020 2020  press_size..    
+0000a650: 2020 2020 2020 2020 656c 7365 3a0d 0a20          else:.. 
+0000a660: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+0000a670: 656c 662e 5f7a 696e 666f 2e63 6f6d 7072  elf._zinfo.compr
+0000a680: 6573 735f 7369 7a65 203d 2073 656c 662e  ess_size = self.
+0000a690: 5f66 696c 655f 7369 7a65 0d0a 2020 2020  _file_size..    
+0000a6a0: 2020 2020 2020 2020 7365 6c66 2e5f 7a69          self._zi
+0000a6b0: 6e66 6f2e 4352 4320 3d20 7365 6c66 2e5f  nfo.CRC = self._
+0000a6c0: 6372 630d 0a20 2020 2020 2020 2020 2020  crc..           
+0000a6d0: 2073 656c 662e 5f7a 696e 666f 2e66 696c   self._zinfo.fil
+0000a6e0: 655f 7369 7a65 203d 2073 656c 662e 5f66  e_size = self._f
+0000a6f0: 696c 655f 7369 7a65 0d0a 0d0a 2020 2020  ile_size....    
+0000a700: 2020 2020 2020 2020 2320 5772 6974 6520          # Write 
+0000a710: 7570 6461 7465 6420 6865 6164 6572 2069  updated header i
+0000a720: 6e66 6f0d 0a20 2020 2020 2020 2020 2020  nfo..           
+0000a730: 2069 6620 7365 6c66 2e5f 7a69 6e66 6f2e   if self._zinfo.
+0000a740: 666c 6167 5f62 6974 7320 2620 3078 3038  flag_bits & 0x08
+0000a750: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+0000a760: 2020 2023 2057 7269 7465 2043 5243 2061     # Write CRC a
+0000a770: 6e64 2066 696c 6520 7369 7a65 7320 6166  nd file sizes af
+0000a780: 7465 7220 7468 6520 6669 6c65 2064 6174  ter the file dat
+0000a790: 610d 0a20 2020 2020 2020 2020 2020 2020  a..             
+0000a7a0: 2020 2066 6d74 203d 2022 3c4c 4c51 5122     fmt = "<LLQQ"
+0000a7b0: 2069 6620 7365 6c66 2e5f 7a69 7036 3420   if self._zip64 
+0000a7c0: 656c 7365 2022 3c4c 4c4c 4c22 0d0a 2020  else "<LLLL"..  
+0000a7d0: 2020 2020 2020 2020 2020 2020 2020 7365                se
+0000a7e0: 6c66 2e5f 6669 6c65 6f62 6a2e 7772 6974  lf._fileobj.writ
+0000a7f0: 6528 0d0a 2020 2020 2020 2020 2020 2020  e(..            
+0000a800: 2020 2020 2020 2020 7374 7275 6374 2e70          struct.p
+0000a810: 6163 6b28 0d0a 2020 2020 2020 2020 2020  ack(..          
+0000a820: 2020 2020 2020 2020 2020 2020 2020 666d                fm
+0000a830: 742c 0d0a 2020 2020 2020 2020 2020 2020  t,..            
+0000a840: 2020 2020 2020 2020 2020 2020 5f44 445f              _DD_
+0000a850: 5349 474e 4154 5552 452c 0d0a 2020 2020  SIGNATURE,..    
+0000a860: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a870: 2020 2020 7365 6c66 2e5f 7a69 6e66 6f2e      self._zinfo.
+0000a880: 4352 432c 0d0a 2020 2020 2020 2020 2020  CRC,..          
+0000a890: 2020 2020 2020 2020 2020 2020 2020 7365                se
+0000a8a0: 6c66 2e5f 7a69 6e66 6f2e 636f 6d70 7265  lf._zinfo.compre
+0000a8b0: 7373 5f73 697a 652c 0d0a 2020 2020 2020  ss_size,..      
+0000a8c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a8d0: 2020 7365 6c66 2e5f 7a69 6e66 6f2e 6669    self._zinfo.fi
+0000a8e0: 6c65 5f73 697a 652c 0d0a 2020 2020 2020  le_size,..      
+0000a8f0: 2020 2020 2020 2020 2020 2020 2020 292c                ),
+0000a900: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0000a910: 2020 290d 0a20 2020 2020 2020 2020 2020    )..           
+0000a920: 2020 2020 2073 656c 662e 5f7a 6970 6669       self._zipfi
+0000a930: 6c65 2e73 7461 7274 5f64 6972 203d 2073  le.start_dir = s
+0000a940: 656c 662e 5f66 696c 656f 626a 2e74 656c  elf._fileobj.tel
+0000a950: 6c28 290d 0a20 2020 2020 2020 2020 2020  l()..           
+0000a960: 2065 6c73 653a 0d0a 2020 2020 2020 2020   else:..        
+0000a970: 2020 2020 2020 2020 6966 206e 6f74 2073          if not s
+0000a980: 656c 662e 5f7a 6970 3634 3a0d 0a20 2020  elf._zip64:..   
+0000a990: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a9a0: 2069 6620 7365 6c66 2e5f 6669 6c65 5f73   if self._file_s
+0000a9b0: 697a 6520 3e20 5a49 5036 345f 4c49 4d49  ize > ZIP64_LIMI
+0000a9c0: 543a 0d0a 2020 2020 2020 2020 2020 2020  T:..            
+0000a9d0: 2020 2020 2020 2020 2020 2020 7261 6973              rais
+0000a9e0: 6520 5275 6e74 696d 6545 7272 6f72 280d  e RuntimeError(.
+0000a9f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000aa00: 2020 2020 2020 2020 2020 2020 2022 4669               "Fi
+0000aa10: 6c65 2073 697a 6520 756e 6578 7065 6374  le size unexpect
+0000aa20: 6564 6c79 2065 7863 6565 6465 6420 5a49  edly exceeded ZI
+0000aa30: 5036 3420 6c69 6d69 7422 2c0d 0a20 2020  P64 limit",..   
+0000aa40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000aa50: 2020 2020 2029 0d0a 2020 2020 2020 2020       )..        
+0000aa60: 2020 2020 2020 2020 2020 2020 6966 2073              if s
+0000aa70: 656c 662e 5f63 6f6d 7072 6573 735f 7369  elf._compress_si
+0000aa80: 7a65 203e 205a 4950 3634 5f4c 494d 4954  ze > ZIP64_LIMIT
+0000aa90: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+0000aaa0: 2020 2020 2020 2020 2020 2072 6169 7365             raise
+0000aab0: 2052 756e 7469 6d65 4572 726f 7228 0d0a   RuntimeError(..
+0000aac0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000aad0: 2020 2020 2020 2020 2020 2020 2243 6f6d              "Com
+0000aae0: 7072 6573 7365 6420 7369 7a65 2075 6e65  pressed size une
+0000aaf0: 7870 6563 7465 646c 7920 6578 6365 6564  xpectedly exceed
+0000ab00: 6564 205a 4950 3634 206c 696d 6974 222c  ed ZIP64 limit",
+0000ab10: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0000ab20: 2020 2020 2020 2020 2020 290d 0a20 2020            )..   
+0000ab30: 2020 2020 2020 2020 2020 2020 2023 2053               # S
+0000ab40: 6565 6b20 6261 636b 7761 7264 7320 616e  eek backwards an
+0000ab50: 6420 7772 6974 6520 6669 6c65 2068 6561  d write file hea
+0000ab60: 6465 7220 2877 6869 6368 2077 696c 6c20  der (which will 
+0000ab70: 6e6f 7720 696e 636c 7564 650d 0a20 2020  now include..   
+0000ab80: 2020 2020 2020 2020 2020 2020 2023 2063               # c
+0000ab90: 6f72 7265 6374 2043 5243 2061 6e64 2066  orrect CRC and f
+0000aba0: 696c 6520 7369 7a65 7329 0d0a 0d0a 2020  ile sizes)....  
+0000abb0: 2020 2020 2020 2020 2020 2020 2020 2320                # 
+0000abc0: 5072 6573 6572 7665 2063 7572 7265 6e74  Preserve current
+0000abd0: 2070 6f73 6974 696f 6e20 696e 2066 696c   position in fil
+0000abe0: 650d 0a20 2020 2020 2020 2020 2020 2020  e..             
+0000abf0: 2020 2073 656c 662e 5f7a 6970 6669 6c65     self._zipfile
+0000ac00: 2e73 7461 7274 5f64 6972 203d 2073 656c  .start_dir = sel
+0000ac10: 662e 5f66 696c 656f 626a 2e74 656c 6c28  f._fileobj.tell(
+0000ac20: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
+0000ac30: 2020 2073 656c 662e 5f66 696c 656f 626a     self._fileobj
+0000ac40: 2e73 6565 6b28 7365 6c66 2e5f 7a69 6e66  .seek(self._zinf
+0000ac50: 6f2e 6865 6164 6572 5f6f 6666 7365 7429  o.header_offset)
+0000ac60: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0000ac70: 2020 7365 6c66 2e5f 6669 6c65 6f62 6a2e    self._fileobj.
+0000ac80: 7772 6974 6528 7365 6c66 2e5f 7a69 6e66  write(self._zinf
+0000ac90: 6f2e 4669 6c65 4865 6164 6572 2873 656c  o.FileHeader(sel
+0000aca0: 662e 5f7a 6970 3634 2929 0d0a 2020 2020  f._zip64))..    
+0000acb0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+0000acc0: 2e5f 6669 6c65 6f62 6a2e 7365 656b 2873  ._fileobj.seek(s
+0000acd0: 656c 662e 5f7a 6970 6669 6c65 2e73 7461  elf._zipfile.sta
+0000ace0: 7274 5f64 6972 290d 0a0d 0a20 2020 2020  rt_dir)....     
+0000acf0: 2020 2020 2020 2023 2053 7563 6365 7373         # Success
+0000ad00: 6675 6c6c 7920 7772 6974 7465 6e3a 2041  fully written: A
+0000ad10: 6464 2066 696c 6520 746f 206f 7572 2063  dd file to our c
+0000ad20: 6163 6865 730d 0a20 2020 2020 2020 2020  aches..         
+0000ad30: 2020 2073 656c 662e 5f7a 6970 6669 6c65     self._zipfile
+0000ad40: 2e66 696c 656c 6973 742e 6170 7065 6e64  .filelist.append
+0000ad50: 2873 656c 662e 5f7a 696e 666f 290d 0a20  (self._zinfo).. 
+0000ad60: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+0000ad70: 5f7a 6970 6669 6c65 2e4e 616d 6554 6f49  _zipfile.NameToI
+0000ad80: 6e66 6f5b 7365 6c66 2e5f 7a69 6e66 6f2e  nfo[self._zinfo.
+0000ad90: 6669 6c65 6e61 6d65 5d20 3d20 7365 6c66  filename] = self
+0000ada0: 2e5f 7a69 6e66 6f0d 0a20 2020 2020 2020  ._zinfo..       
+0000adb0: 2066 696e 616c 6c79 3a0d 0a20 2020 2020   finally:..     
+0000adc0: 2020 2020 2020 2073 656c 662e 5f7a 6970         self._zip
+0000add0: 6669 6c65 2e5f 7772 6974 696e 6720 3d20  file._writing = 
+0000ade0: 4661 6c73 650d 0a0d 0a0d 0a63 6c61 7373  False......class
+0000adf0: 205a 6970 4669 6c65 3a0d 0a20 2020 2022   ZipFile:..    "
+0000ae00: 2222 436c 6173 7320 7769 7468 206d 6574  ""Class with met
+0000ae10: 686f 6473 2074 6f20 6f70 656e 2c20 7265  hods to open, re
+0000ae20: 6164 2c20 7772 6974 652c 2063 6c6f 7365  ad, write, close
+0000ae30: 2c20 6c69 7374 207a 6970 2066 696c 6573  , list zip files
+0000ae40: 2e0d 0a0d 0a20 2020 207a 203d 205a 6970  .....    z = Zip
+0000ae50: 4669 6c65 2866 696c 652c 206d 6f64 653d  File(file, mode=
+0000ae60: 2272 222c 2063 6f6d 7072 6573 7369 6f6e  "r", compression
+0000ae70: 3d5a 4950 5f53 544f 5245 442c 2061 6c6c  =ZIP_STORED, all
+0000ae80: 6f77 5a69 7036 343d 5472 7565 2c0d 0a20  owZip64=True,.. 
+0000ae90: 2020 2020 2020 2020 2020 2020 2020 2063                 c
+0000aea0: 6f6d 7072 6573 736c 6576 656c 3d4e 6f6e  ompresslevel=Non
+0000aeb0: 6529 0d0a 0d0a 2020 2020 6669 6c65 3a20  e)....    file: 
+0000aec0: 4569 7468 6572 2074 6865 2070 6174 6820  Either the path 
+0000aed0: 746f 2074 6865 2066 696c 652c 206f 7220  to the file, or 
+0000aee0: 6120 6669 6c65 2d6c 696b 6520 6f62 6a65  a file-like obje
+0000aef0: 6374 2e0d 0a20 2020 2020 2020 2020 2049  ct...          I
+0000af00: 6620 6974 2069 7320 6120 7061 7468 2c20  f it is a path, 
+0000af10: 7468 6520 6669 6c65 2077 696c 6c20 6265  the file will be
+0000af20: 206f 7065 6e65 6420 616e 6420 636c 6f73   opened and clos
+0000af30: 6564 2062 7920 5a69 7046 696c 652e 0d0a  ed by ZipFile...
+0000af40: 2020 2020 6d6f 6465 3a20 5468 6520 6d6f      mode: The mo
+0000af50: 6465 2063 616e 2062 6520 6569 7468 6572  de can be either
+0000af60: 2072 6561 6420 2772 272c 2077 7269 7465   read 'r', write
+0000af70: 2027 7727 2c20 6578 636c 7573 6976 6520   'w', exclusive 
+0000af80: 6372 6561 7465 2027 7827 2c0d 0a20 2020  create 'x',..   
+0000af90: 2020 2020 2020 206f 7220 6170 7065 6e64         or append
+0000afa0: 2027 6127 2e0d 0a20 2020 2063 6f6d 7072   'a'...    compr
+0000afb0: 6573 7369 6f6e 3a20 5a49 505f 5354 4f52  ession: ZIP_STOR
+0000afc0: 4544 2028 6e6f 2063 6f6d 7072 6573 7369  ED (no compressi
+0000afd0: 6f6e 292c 205a 4950 5f44 4546 4c41 5445  on), ZIP_DEFLATE
+0000afe0: 4420 2872 6571 7569 7265 7320 7a6c 6962  D (requires zlib
+0000aff0: 292c 0d0a 2020 2020 2020 2020 2020 2020  ),..            
+0000b000: 2020 2020 205a 4950 5f42 5a49 5032 2028       ZIP_BZIP2 (
+0000b010: 7265 7175 6972 6573 2062 7a32 2920 6f72  requires bz2) or
+0000b020: 205a 4950 5f4c 5a4d 4120 2872 6571 7569   ZIP_LZMA (requi
+0000b030: 7265 7320 6c7a 6d61 292e 0d0a 2020 2020  res lzma)...    
+0000b040: 616c 6c6f 775a 6970 3634 3a20 6966 2054  allowZip64: if T
+0000b050: 7275 6520 5a69 7046 696c 6520 7769 6c6c  rue ZipFile will
+0000b060: 2063 7265 6174 6520 6669 6c65 7320 7769   create files wi
+0000b070: 7468 205a 4950 3634 2065 7874 656e 7369  th ZIP64 extensi
+0000b080: 6f6e 7320 7768 656e 0d0a 2020 2020 2020  ons when..      
+0000b090: 2020 2020 2020 2020 2020 6e65 6564 6564            needed
+0000b0a0: 2c20 6f74 6865 7277 6973 6520 6974 2077  , otherwise it w
+0000b0b0: 696c 6c20 7261 6973 6520 616e 2065 7863  ill raise an exc
+0000b0c0: 6570 7469 6f6e 2077 6865 6e20 7468 6973  eption when this
+0000b0d0: 2077 6f75 6c64 0d0a 2020 2020 2020 2020   would..        
+0000b0e0: 2020 2020 2020 2020 6265 206e 6563 6573          be neces
+0000b0f0: 7361 7279 2e0d 0a20 2020 2063 6f6d 7072  sary...    compr
+0000b100: 6573 736c 6576 656c 3a20 4e6f 6e65 2028  esslevel: None (
+0000b110: 6465 6661 756c 7420 666f 7220 7468 6520  default for the 
+0000b120: 6769 7665 6e20 636f 6d70 7265 7373 696f  given compressio
+0000b130: 6e20 7479 7065 2920 6f72 2061 6e20 696e  n type) or an in
+0000b140: 7465 6765 720d 0a20 2020 2020 2020 2020  teger..         
+0000b150: 2020 2020 2020 2020 2020 7370 6563 6966            specif
+0000b160: 7969 6e67 2074 6865 206c 6576 656c 2074  ying the level t
+0000b170: 6f20 7061 7373 2074 6f20 7468 6520 636f  o pass to the co
+0000b180: 6d70 7265 7373 6f72 2e0d 0a20 2020 2020  mpressor...     
+0000b190: 2020 2020 2020 2020 2020 2020 2020 5768                Wh
+0000b1a0: 656e 2075 7369 6e67 205a 4950 5f53 544f  en using ZIP_STO
+0000b1b0: 5245 4420 6f72 205a 4950 5f4c 5a4d 4120  RED or ZIP_LZMA 
+0000b1c0: 7468 6973 206b 6579 776f 7264 2068 6173  this keyword has
+0000b1d0: 206e 6f20 6566 6665 6374 2e0d 0a20 2020   no effect...   
+0000b1e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b1f0: 5768 656e 2075 7369 6e67 205a 4950 5f44  When using ZIP_D
+0000b200: 4546 4c41 5445 4420 696e 7465 6765 7273  EFLATED integers
+0000b210: 2030 2074 6872 6f75 6768 2039 2061 7265   0 through 9 are
+0000b220: 2061 6363 6570 7465 642e 0d0a 2020 2020   accepted...    
+0000b230: 2020 2020 2020 2020 2020 2020 2020 2057                 W
+0000b240: 6865 6e20 7573 696e 6720 5a49 505f 425a  hen using ZIP_BZ
+0000b250: 4950 3220 696e 7465 6765 7273 2031 2074  IP2 integers 1 t
+0000b260: 6872 6f75 6768 2039 2061 7265 2061 6363  hrough 9 are acc
+0000b270: 6570 7465 642e 0d0a 0d0a 2020 2020 2222  epted.....    ""
+0000b280: 220d 0a0d 0a20 2020 2066 7020 3d20 4e6f  "....    fp = No
+0000b290: 6e65 2020 2320 5365 7420 6865 7265 2073  ne  # Set here s
+0000b2a0: 696e 6365 205f 5f64 656c 5f5f 2063 6865  ince __del__ che
+0000b2b0: 636b 7320 6974 0d0a 2020 2020 5f77 696e  cks it..    _win
+0000b2c0: 646f 7773 5f69 6c6c 6567 616c 5f6e 616d  dows_illegal_nam
+0000b2d0: 655f 7472 616e 735f 7461 626c 6520 3d20  e_trans_table = 
+0000b2e0: 4e6f 6e65 0d0a 0d0a 2020 2020 6465 6620  None....    def 
+0000b2f0: 5f5f 696e 6974 5f5f 280d 0a20 2020 2020  __init__(..     
+0000b300: 2020 2073 656c 662c 0d0a 2020 2020 2020     self,..      
+0000b310: 2020 6669 6c65 2c0d 0a20 2020 2020 2020    file,..       
+0000b320: 206d 6f64 653d 2272 222c 0d0a 2020 2020   mode="r",..    
+0000b330: 2020 2020 636f 6d70 7265 7373 696f 6e3d      compression=
+0000b340: 5a49 505f 5354 4f52 4544 2c0d 0a20 2020  ZIP_STORED,..   
+0000b350: 2020 2020 2061 6c6c 6f77 5a69 7036 343d       allowZip64=
+0000b360: 5472 7565 2c0d 0a20 2020 2020 2020 2063  True,..        c
+0000b370: 6f6d 7072 6573 736c 6576 656c 3d4e 6f6e  ompresslevel=Non
+0000b380: 652c 0d0a 2020 2020 2020 2020 2a2c 0d0a  e,..        *,..
+0000b390: 2020 2020 2020 2020 7374 7269 6374 5f74          strict_t
+0000b3a0: 696d 6573 7461 6d70 733d 5472 7565 2c0d  imestamps=True,.
+0000b3b0: 0a20 2020 2029 202d 3e20 4e6f 6e65 3a0d  .    ) -> None:.
+0000b3c0: 0a20 2020 2020 2020 2022 2222 4f70 656e  .        """Open
+0000b3d0: 2074 6865 205a 4950 2066 696c 6520 7769   the ZIP file wi
+0000b3e0: 7468 206d 6f64 6520 7265 6164 2027 7227  th mode read 'r'
+0000b3f0: 2c20 7772 6974 6520 2777 272c 2065 7863  , write 'w', exc
+0000b400: 6c75 7369 7665 2063 7265 6174 6520 2778  lusive create 'x
+0000b410: 272c 0d0a 2020 2020 2020 2020 6f72 2061  ',..        or a
+0000b420: 7070 656e 6420 2761 272e 0d0a 2020 2020  ppend 'a'...    
+0000b430: 2020 2020 2222 220d 0a20 2020 2020 2020      """..       
+0000b440: 2069 6620 6d6f 6465 206e 6f74 2069 6e20   if mode not in 
+0000b450: 2822 7222 2c20 2277 222c 2022 7822 2c20  ("r", "w", "x", 
+0000b460: 2261 2229 3a0d 0a20 2020 2020 2020 2020  "a"):..         
+0000b470: 2020 2072 6169 7365 2056 616c 7565 4572     raise ValueEr
+0000b480: 726f 7228 225a 6970 4669 6c65 2072 6571  ror("ZipFile req
+0000b490: 7569 7265 7320 6d6f 6465 2027 7227 2c20  uires mode 'r', 
+0000b4a0: 2777 272c 2027 7827 2c20 6f72 2027 6127  'w', 'x', or 'a'
+0000b4b0: 2229 0d0a 0d0a 2020 2020 2020 2020 5f63  ")....        _c
+0000b4c0: 6865 636b 5f63 6f6d 7072 6573 7369 6f6e  heck_compression
+0000b4d0: 2863 6f6d 7072 6573 7369 6f6e 290d 0a0d  (compression)...
+0000b4e0: 0a20 2020 2020 2020 2073 656c 662e 5f61  .        self._a
+0000b4f0: 6c6c 6f77 5a69 7036 3420 3d20 616c 6c6f  llowZip64 = allo
+0000b500: 775a 6970 3634 0d0a 2020 2020 2020 2020  wZip64..        
+0000b510: 7365 6c66 2e5f 6469 644d 6f64 6966 7920  self._didModify 
+0000b520: 3d20 4661 6c73 650d 0a20 2020 2020 2020  = False..       
+0000b530: 2073 656c 662e 6465 6275 6720 3d20 3020   self.debug = 0 
+0000b540: 2023 204c 6576 656c 206f 6620 7072 696e   # Level of prin
+0000b550: 7469 6e67 3a20 3020 7468 726f 7567 6820  ting: 0 through 
+0000b560: 330d 0a20 2020 2020 2020 2073 656c 662e  3..        self.
+0000b570: 4e61 6d65 546f 496e 666f 203d 207b 7d20  NameToInfo = {} 
+0000b580: 2023 2046 696e 6420 6669 6c65 2069 6e66   # Find file inf
+0000b590: 6f20 6769 7665 6e20 6e61 6d65 0d0a 2020  o given name..  
+0000b5a0: 2020 2020 2020 7365 6c66 2e66 696c 656c        self.filel
+0000b5b0: 6973 7420 3d20 5b5d 2020 2320 4c69 7374  ist = []  # List
+0000b5c0: 206f 6620 5a69 7049 6e66 6f20 696e 7374   of ZipInfo inst
+0000b5d0: 616e 6365 7320 666f 7220 6172 6368 6976  ances for archiv
+0000b5e0: 650d 0a20 2020 2020 2020 2073 656c 662e  e..        self.
+0000b5f0: 636f 6d70 7265 7373 696f 6e20 3d20 636f  compression = co
+0000b600: 6d70 7265 7373 696f 6e20 2023 204d 6574  mpression  # Met
+0000b610: 686f 6420 6f66 2063 6f6d 7072 6573 7369  hod of compressi
+0000b620: 6f6e 0d0a 2020 2020 2020 2020 7365 6c66  on..        self
+0000b630: 2e63 6f6d 7072 6573 736c 6576 656c 203d  .compresslevel =
+0000b640: 2063 6f6d 7072 6573 736c 6576 656c 0d0a   compresslevel..
+0000b650: 2020 2020 2020 2020 7365 6c66 2e6d 6f64          self.mod
+0000b660: 6520 3d20 6d6f 6465 0d0a 2020 2020 2020  e = mode..      
+0000b670: 2020 7365 6c66 2e70 7764 203d 204e 6f6e    self.pwd = Non
+0000b680: 650d 0a20 2020 2020 2020 2073 656c 662e  e..        self.
+0000b690: 5f63 6f6d 6d65 6e74 203d 2062 2222 0d0a  _comment = b""..
+0000b6a0: 2020 2020 2020 2020 7365 6c66 2e5f 7374          self._st
+0000b6b0: 7269 6374 5f74 696d 6573 7461 6d70 7320  rict_timestamps 
+0000b6c0: 3d20 7374 7269 6374 5f74 696d 6573 7461  = strict_timesta
+0000b6d0: 6d70 730d 0a0d 0a20 2020 2020 2020 2023  mps....        #
+0000b6e0: 2043 6865 636b 2069 6620 7765 2077 6572   Check if we wer
+0000b6f0: 6520 7061 7373 6564 2061 2066 696c 652d  e passed a file-
+0000b700: 6c69 6b65 206f 626a 6563 740d 0a20 2020  like object..   
+0000b710: 2020 2020 2069 6620 6973 696e 7374 616e       if isinstan
+0000b720: 6365 2866 696c 652c 206f 732e 5061 7468  ce(file, os.Path
+0000b730: 4c69 6b65 293a 0d0a 2020 2020 2020 2020  Like):..        
+0000b740: 2020 2020 6669 6c65 203d 206f 732e 6673      file = os.fs
+0000b750: 7061 7468 2866 696c 6529 0d0a 2020 2020  path(file)..    
+0000b760: 2020 2020 6966 2069 7369 6e73 7461 6e63      if isinstanc
+0000b770: 6528 6669 6c65 2c20 7374 7229 3a0d 0a20  e(file, str):.. 
+0000b780: 2020 2020 2020 2020 2020 2023 204e 6f2c             # No,
+0000b790: 2069 7427 7320 6120 6669 6c65 6e61 6d65   it's a filename
+0000b7a0: 0d0a 2020 2020 2020 2020 2020 2020 7365  ..            se
+0000b7b0: 6c66 2e5f 6669 6c65 5061 7373 6564 203d  lf._filePassed =
+0000b7c0: 2030 0d0a 2020 2020 2020 2020 2020 2020   0..            
+0000b7d0: 7365 6c66 2e66 696c 656e 616d 6520 3d20  self.filename = 
+0000b7e0: 6669 6c65 0d0a 2020 2020 2020 2020 2020  file..          
+0000b7f0: 2020 6d6f 6465 4469 6374 203d 207b 0d0a    modeDict = {..
+0000b800: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b810: 2272 223a 2022 7262 222c 0d0a 2020 2020  "r": "rb",..    
+0000b820: 2020 2020 2020 2020 2020 2020 2277 223a              "w":
+0000b830: 2022 772b 6222 2c0d 0a20 2020 2020 2020   "w+b",..       
+0000b840: 2020 2020 2020 2020 2022 7822 3a20 2278           "x": "x
+0000b850: 2b62 222c 0d0a 2020 2020 2020 2020 2020  +b",..          
+0000b860: 2020 2020 2020 2261 223a 2022 722b 6222        "a": "r+b"
+0000b870: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
+0000b880: 2020 2022 722b 6222 3a20 2277 2b62 222c     "r+b": "w+b",
+0000b890: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0000b8a0: 2020 2277 2b62 223a 2022 7762 222c 0d0a    "w+b": "wb",..
+0000b8b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b8c0: 2278 2b62 223a 2022 7862 222c 0d0a 2020  "x+b": "xb",..  
+0000b8d0: 2020 2020 2020 2020 2020 7d0d 0a20 2020            }..   
+0000b8e0: 2020 2020 2020 2020 2066 696c 656d 6f64           filemod
+0000b8f0: 6520 3d20 6d6f 6465 4469 6374 5b6d 6f64  e = modeDict[mod
+0000b900: 655d 0d0a 2020 2020 2020 2020 2020 2020  e]..            
+0000b910: 7768 696c 6520 5472 7565 3a0d 0a20 2020  while True:..   
+0000b920: 2020 2020 2020 2020 2020 2020 2074 7279               try
+0000b930: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+0000b940: 2020 2020 2020 2073 656c 662e 6670 203d         self.fp =
+0000b950: 2069 6f2e 6f70 656e 2866 696c 652c 2066   io.open(file, f
+0000b960: 696c 656d 6f64 6529 0d0a 2020 2020 2020  ilemode)..      
+0000b970: 2020 2020 2020 2020 2020 6578 6365 7074            except
+0000b980: 204f 5345 7272 6f72 3a0d 0a20 2020 2020   OSError:..     
+0000b990: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+0000b9a0: 6620 6669 6c65 6d6f 6465 2069 6e20 6d6f  f filemode in mo
+0000b9b0: 6465 4469 6374 3a0d 0a20 2020 2020 2020  deDict:..       
+0000b9c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b9d0: 2066 696c 656d 6f64 6520 3d20 6d6f 6465   filemode = mode
+0000b9e0: 4469 6374 5b66 696c 656d 6f64 655d 0d0a  Dict[filemode]..
+0000b9f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ba00: 2020 2020 2020 2020 636f 6e74 696e 7565          continue
+0000ba10: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0000ba20: 2020 2020 2020 7261 6973 650d 0a20 2020        raise..   
+0000ba30: 2020 2020 2020 2020 2020 2020 2062 7265               bre
+0000ba40: 616b 0d0a 2020 2020 2020 2020 656c 7365  ak..        else
+0000ba50: 3a0d 0a20 2020 2020 2020 2020 2020 2073  :..            s
+0000ba60: 656c 662e 5f66 696c 6550 6173 7365 6420  elf._filePassed 
+0000ba70: 3d20 310d 0a20 2020 2020 2020 2020 2020  = 1..           
+0000ba80: 2073 656c 662e 6670 203d 2066 696c 650d   self.fp = file.
+0000ba90: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+0000baa0: 662e 6669 6c65 6e61 6d65 203d 2067 6574  f.filename = get
+0000bab0: 6174 7472 2866 696c 652c 2022 6e61 6d65  attr(file, "name
+0000bac0: 222c 204e 6f6e 6529 0d0a 2020 2020 2020  ", None)..      
+0000bad0: 2020 7365 6c66 2e5f 6669 6c65 5265 6643    self._fileRefC
+0000bae0: 6e74 203d 2031 0d0a 2020 2020 2020 2020  nt = 1..        
+0000baf0: 7365 6c66 2e5f 6c6f 636b 203d 2074 6872  self._lock = thr
+0000bb00: 6561 6469 6e67 2e52 4c6f 636b 2829 0d0a  eading.RLock()..
+0000bb10: 2020 2020 2020 2020 7365 6c66 2e5f 7365          self._se
+0000bb20: 656b 6162 6c65 203d 2054 7275 650d 0a20  ekable = True.. 
+0000bb30: 2020 2020 2020 2073 656c 662e 5f77 7269         self._wri
+0000bb40: 7469 6e67 203d 2046 616c 7365 0d0a 0d0a  ting = False....
+0000bb50: 2020 2020 2020 2020 7472 793a 0d0a 2020          try:..  
+0000bb60: 2020 2020 2020 2020 2020 6966 206d 6f64            if mod
+0000bb70: 6520 3d3d 2022 7222 3a0d 0a20 2020 2020  e == "r":..     
+0000bb80: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+0000bb90: 5f52 6561 6c47 6574 436f 6e74 656e 7473  _RealGetContents
+0000bba0: 2829 0d0a 2020 2020 2020 2020 2020 2020  ()..            
+0000bbb0: 656c 6966 206d 6f64 6520 696e 2028 2277  elif mode in ("w
+0000bbc0: 222c 2022 7822 293a 0d0a 2020 2020 2020  ", "x"):..      
+0000bbd0: 2020 2020 2020 2020 2020 2320 7365 7420            # set 
+0000bbe0: 7468 6520 6d6f 6469 6669 6564 2066 6c61  the modified fla
+0000bbf0: 6720 736f 2063 656e 7472 616c 2064 6972  g so central dir
+0000bc00: 6563 746f 7279 2067 6574 7320 7772 6974  ectory gets writ
+0000bc10: 7465 6e0d 0a20 2020 2020 2020 2020 2020  ten..           
+0000bc20: 2020 2020 2023 2065 7665 6e20 6966 206e       # even if n
+0000bc30: 6f20 6669 6c65 7320 6172 6520 6164 6465  o files are adde
+0000bc40: 6420 746f 2074 6865 2061 7263 6869 7665  d to the archive
+0000bc50: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0000bc60: 2020 7365 6c66 2e5f 6469 644d 6f64 6966    self._didModif
+0000bc70: 7920 3d20 5472 7565 0d0a 2020 2020 2020  y = True..      
+0000bc80: 2020 2020 2020 2020 2020 7472 793a 0d0a            try:..
+0000bc90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000bca0: 2020 2020 7365 6c66 2e73 7461 7274 5f64      self.start_d
+0000bcb0: 6972 203d 2073 656c 662e 6670 2e74 656c  ir = self.fp.tel
+0000bcc0: 6c28 290d 0a20 2020 2020 2020 2020 2020  l()..           
+0000bcd0: 2020 2020 2065 7863 6570 7420 2841 7474       except (Att
+0000bce0: 7269 6275 7465 4572 726f 722c 204f 5345  ributeError, OSE
+0000bcf0: 7272 6f72 293a 0d0a 2020 2020 2020 2020  rror):..        
+0000bd00: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+0000bd10: 2e66 7020 3d20 5f54 656c 6c61 626c 6528  .fp = _Tellable(
+0000bd20: 7365 6c66 2e66 7029 0d0a 2020 2020 2020  self.fp)..      
+0000bd30: 2020 2020 2020 2020 2020 2020 2020 7365                se
+0000bd40: 6c66 2e73 7461 7274 5f64 6972 203d 2030  lf.start_dir = 0
+0000bd50: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0000bd60: 2020 2020 2020 7365 6c66 2e5f 7365 656b        self._seek
+0000bd70: 6162 6c65 203d 2046 616c 7365 0d0a 2020  able = False..  
+0000bd80: 2020 2020 2020 2020 2020 2020 2020 656c                el
+0000bd90: 7365 3a0d 0a20 2020 2020 2020 2020 2020  se:..           
+0000bda0: 2020 2020 2020 2020 2023 2053 6f6d 6520           # Some 
+0000bdb0: 6669 6c65 2d6c 696b 6520 6f62 6a65 6374  file-like object
+0000bdc0: 7320 6361 6e20 7072 6f76 6964 6520 7465  s can provide te
+0000bdd0: 6c6c 2829 2062 7574 206e 6f74 2073 6565  ll() but not see
+0000bde0: 6b28 290d 0a20 2020 2020 2020 2020 2020  k()..           
+0000bdf0: 2020 2020 2020 2020 2074 7279 3a0d 0a20           try:.. 
+0000be00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000be10: 2020 2020 2020 2073 656c 662e 6670 2e73         self.fp.s
+0000be20: 6565 6b28 7365 6c66 2e73 7461 7274 5f64  eek(self.start_d
+0000be30: 6972 290d 0a20 2020 2020 2020 2020 2020  ir)..           
+0000be40: 2020 2020 2020 2020 2065 7863 6570 7420           except 
+0000be50: 2841 7474 7269 6275 7465 4572 726f 722c  (AttributeError,
+0000be60: 204f 5345 7272 6f72 293a 0d0a 2020 2020   OSError):..    
+0000be70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000be80: 2020 2020 7365 6c66 2e5f 7365 656b 6162      self._seekab
+0000be90: 6c65 203d 2046 616c 7365 0d0a 2020 2020  le = False..    
+0000bea0: 2020 2020 2020 2020 656c 6966 206d 6f64          elif mod
+0000beb0: 6520 3d3d 2022 6122 3a0d 0a20 2020 2020  e == "a":..     
+0000bec0: 2020 2020 2020 2020 2020 2074 7279 3a0d             try:.
+0000bed0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000bee0: 2020 2020 2023 2053 6565 2069 6620 6669       # See if fi
+0000bef0: 6c65 2069 7320 6120 7a69 7020 6669 6c65  le is a zip file
+0000bf00: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0000bf10: 2020 2020 2020 7365 6c66 2e5f 5265 616c        self._Real
+0000bf20: 4765 7443 6f6e 7465 6e74 7328 290d 0a20  GetContents().. 
+0000bf30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000bf40: 2020 2023 2073 6565 6b20 746f 2073 7461     # seek to sta
+0000bf50: 7274 206f 6620 6469 7265 6374 6f72 7920  rt of directory 
+0000bf60: 616e 6420 6f76 6572 7772 6974 650d 0a20  and overwrite.. 
+0000bf70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000bf80: 2020 2073 656c 662e 6670 2e73 6565 6b28     self.fp.seek(
+0000bf90: 7365 6c66 2e73 7461 7274 5f64 6972 290d  self.start_dir).
+0000bfa0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000bfb0: 2065 7863 6570 7420 4261 645a 6970 4669   except BadZipFi
+0000bfc0: 6c65 3a0d 0a20 2020 2020 2020 2020 2020  le:..           
+0000bfd0: 2020 2020 2020 2020 2023 2066 696c 6520           # file 
+0000bfe0: 6973 206e 6f74 2061 207a 6970 2066 696c  is not a zip fil
+0000bff0: 652c 206a 7573 7420 6170 7065 6e64 0d0a  e, just append..
+0000c000: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c010: 2020 2020 7365 6c66 2e66 702e 7365 656b      self.fp.seek
+0000c020: 2830 2c20 3229 0d0a 0d0a 2020 2020 2020  (0, 2)....      
+0000c030: 2020 2020 2020 2020 2020 2020 2020 2320                # 
+0000c040: 7365 7420 7468 6520 6d6f 6469 6669 6564  set the modified
+0000c050: 2066 6c61 6720 736f 2063 656e 7472 616c   flag so central
+0000c060: 2064 6972 6563 746f 7279 2067 6574 7320   directory gets 
+0000c070: 7772 6974 7465 6e0d 0a20 2020 2020 2020  written..       
+0000c080: 2020 2020 2020 2020 2020 2020 2023 2065               # e
+0000c090: 7665 6e20 6966 206e 6f20 6669 6c65 7320  ven if no files 
+0000c0a0: 6172 6520 6164 6465 6420 746f 2074 6865  are added to the
+0000c0b0: 2061 7263 6869 7665 0d0a 2020 2020 2020   archive..      
+0000c0c0: 2020 2020 2020 2020 2020 2020 2020 7365                se
+0000c0d0: 6c66 2e5f 6469 644d 6f64 6966 7920 3d20  lf._didModify = 
+0000c0e0: 5472 7565 0d0a 2020 2020 2020 2020 2020  True..          
+0000c0f0: 2020 2020 2020 2020 2020 7365 6c66 2e73            self.s
+0000c100: 7461 7274 5f64 6972 203d 2073 656c 662e  tart_dir = self.
+0000c110: 6670 2e74 656c 6c28 290d 0a20 2020 2020  fp.tell()..     
+0000c120: 2020 2020 2020 2065 6c73 653a 0d0a 2020         else:..  
+0000c130: 2020 2020 2020 2020 2020 2020 2020 7261                ra
+0000c140: 6973 6520 5661 6c75 6545 7272 6f72 2822  ise ValueError("
+0000c150: 4d6f 6465 206d 7573 7420 6265 2027 7227  Mode must be 'r'
+0000c160: 2c20 2777 272c 2027 7827 2c20 6f72 2027  , 'w', 'x', or '
+0000c170: 6127 2229 0d0a 2020 2020 2020 2020 6578  a'")..        ex
+0000c180: 6365 7074 3a0d 0a20 2020 2020 2020 2020  cept:..         
+0000c190: 2020 2066 7020 3d20 7365 6c66 2e66 700d     fp = self.fp.
+0000c1a0: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+0000c1b0: 662e 6670 203d 204e 6f6e 650d 0a20 2020  f.fp = None..   
+0000c1c0: 2020 2020 2020 2020 2073 656c 662e 5f66           self._f
+0000c1d0: 7063 6c6f 7365 2866 7029 0d0a 2020 2020  pclose(fp)..    
+0000c1e0: 2020 2020 2020 2020 7261 6973 650d 0a0d          raise...
+0000c1f0: 0a20 2020 2064 6566 205f 5f65 6e74 6572  .    def __enter
+0000c200: 5f5f 2873 656c 6629 3a0d 0a20 2020 2020  __(self):..     
+0000c210: 2020 2072 6574 7572 6e20 7365 6c66 0d0a     return self..
+0000c220: 0d0a 2020 2020 6465 6620 5f5f 6578 6974  ..    def __exit
+0000c230: 5f5f 2873 656c 662c 2074 7970 652c 2076  __(self, type, v
+0000c240: 616c 7565 2c20 7472 6163 6562 6163 6b29  alue, traceback)
+0000c250: 3a0d 0a20 2020 2020 2020 2073 656c 662e  :..        self.
+0000c260: 636c 6f73 6528 290d 0a0d 0a20 2020 2064  close()....    d
+0000c270: 6566 205f 5f72 6570 725f 5f28 7365 6c66  ef __repr__(self
+0000c280: 2920 2d3e 2073 7472 3a0d 0a20 2020 2020  ) -> str:..     
+0000c290: 2020 2072 6573 756c 7420 3d20 5b0d 0a20     result = [.. 
+0000c2a0: 2020 2020 2020 2020 2020 2066 223c 7b73             f"<{s
+0000c2b0: 656c 662e 5f5f 636c 6173 735f 5f2e 5f5f  elf.__class__.__
+0000c2c0: 6d6f 6475 6c65 5f5f 7d2e 7b73 656c 662e  module__}.{self.
+0000c2d0: 5f5f 636c 6173 735f 5f2e 5f5f 7175 616c  __class__.__qual
+0000c2e0: 6e61 6d65 5f5f 7d22 2c0d 0a20 2020 2020  name__}",..     
+0000c2f0: 2020 205d 0d0a 2020 2020 2020 2020 6966     ]..        if
+0000c300: 2073 656c 662e 6670 2069 7320 6e6f 7420   self.fp is not 
+0000c310: 4e6f 6e65 3a0d 0a20 2020 2020 2020 2020  None:..         
+0000c320: 2020 2069 6620 7365 6c66 2e5f 6669 6c65     if self._file
+0000c330: 5061 7373 6564 3a0d 0a20 2020 2020 2020  Passed:..       
+0000c340: 2020 2020 2020 2020 2072 6573 756c 742e           result.
+0000c350: 6170 7065 6e64 2822 2066 696c 653d 2572  append(" file=%r
+0000c360: 2220 2520 7365 6c66 2e66 7029 0d0a 2020  " % self.fp)..  
+0000c370: 2020 2020 2020 2020 2020 656c 6966 2073            elif s
+0000c380: 656c 662e 6669 6c65 6e61 6d65 2069 7320  elf.filename is 
+0000c390: 6e6f 7420 4e6f 6e65 3a0d 0a20 2020 2020  not None:..     
+0000c3a0: 2020 2020 2020 2020 2020 2072 6573 756c             resul
+0000c3b0: 742e 6170 7065 6e64 2822 2066 696c 656e  t.append(" filen
+0000c3c0: 616d 653d 2572 2220 2520 7365 6c66 2e66  ame=%r" % self.f
+0000c3d0: 696c 656e 616d 6529 0d0a 2020 2020 2020  ilename)..      
+0000c3e0: 2020 2020 2020 7265 7375 6c74 2e61 7070        result.app
+0000c3f0: 656e 6428 2220 6d6f 6465 3d25 7222 2025  end(" mode=%r" %
+0000c400: 2073 656c 662e 6d6f 6465 290d 0a20 2020   self.mode)..   
+0000c410: 2020 2020 2065 6c73 653a 0d0a 2020 2020       else:..    
+0000c420: 2020 2020 2020 2020 7265 7375 6c74 2e61          result.a
+0000c430: 7070 656e 6428 2220 5b63 6c6f 7365 645d  ppend(" [closed]
+0000c440: 2229 0d0a 2020 2020 2020 2020 7265 7375  ")..        resu
+0000c450: 6c74 2e61 7070 656e 6428 223e 2229 0d0a  lt.append(">")..
+0000c460: 2020 2020 2020 2020 7265 7475 726e 2022          return "
+0000c470: 222e 6a6f 696e 2872 6573 756c 7429 0d0a  ".join(result)..
+0000c480: 0d0a 2020 2020 6465 6620 5f52 6561 6c47  ..    def _RealG
+0000c490: 6574 436f 6e74 656e 7473 2873 656c 6629  etContents(self)
+0000c4a0: 3a0d 0a20 2020 2020 2020 2022 2222 5265  :..        """Re
+0000c4b0: 6164 2069 6e20 7468 6520 7461 626c 6520  ad in the table 
+0000c4c0: 6f66 2063 6f6e 7465 6e74 7320 666f 7220  of contents for 
+0000c4d0: 7468 6520 5a49 5020 6669 6c65 2e22 2222  the ZIP file."""
+0000c4e0: 0d0a 2020 2020 2020 2020 6670 203d 2073  ..        fp = s
+0000c4f0: 656c 662e 6670 0d0a 2020 2020 2020 2020  elf.fp..        
+0000c500: 7472 793a 0d0a 2020 2020 2020 2020 2020  try:..          
+0000c510: 2020 656e 6472 6563 203d 205f 456e 6452    endrec = _EndR
+0000c520: 6563 4461 7461 2866 7029 0d0a 2020 2020  ecData(fp)..    
+0000c530: 2020 2020 6578 6365 7074 204f 5345 7272      except OSErr
+0000c540: 6f72 3a0d 0a20 2020 2020 2020 2020 2020  or:..           
+0000c550: 2072 6169 7365 2042 6164 5a69 7046 696c   raise BadZipFil
+0000c560: 6528 2246 696c 6520 6973 206e 6f74 2061  e("File is not a
+0000c570: 207a 6970 2066 696c 6522 290d 0a20 2020   zip file")..   
+0000c580: 2020 2020 2069 6620 6e6f 7420 656e 6472       if not endr
+0000c590: 6563 3a0d 0a20 2020 2020 2020 2020 2020  ec:..           
+0000c5a0: 2072 6169 7365 2042 6164 5a69 7046 696c   raise BadZipFil
+0000c5b0: 6528 2246 696c 6520 6973 206e 6f74 2061  e("File is not a
+0000c5c0: 207a 6970 2066 696c 6522 290d 0a20 2020   zip file")..   
+0000c5d0: 2020 2020 2069 6620 7365 6c66 2e64 6562       if self.deb
+0000c5e0: 7567 203e 2031 3a0d 0a20 2020 2020 2020  ug > 1:..       
+0000c5f0: 2020 2020 2070 7269 6e74 2865 6e64 7265       print(endre
+0000c600: 6329 0d0a 2020 2020 2020 2020 7369 7a65  c)..        size
+0000c610: 5f63 6420 3d20 656e 6472 6563 5b5f 4543  _cd = endrec[_EC
+0000c620: 445f 5349 5a45 5d20 2023 2062 7974 6573  D_SIZE]  # bytes
+0000c630: 2069 6e20 6365 6e74 7261 6c20 6469 7265   in central dire
+0000c640: 6374 6f72 790d 0a20 2020 2020 2020 206f  ctory..        o
+0000c650: 6666 7365 745f 6364 203d 2065 6e64 7265  ffset_cd = endre
+0000c660: 635b 5f45 4344 5f4f 4646 5345 545d 2020  c[_ECD_OFFSET]  
+0000c670: 2320 6f66 6673 6574 206f 6620 6365 6e74  # offset of cent
+0000c680: 7261 6c20 6469 7265 6374 6f72 790d 0a20  ral directory.. 
+0000c690: 2020 2020 2020 2073 656c 662e 5f63 6f6d         self._com
+0000c6a0: 6d65 6e74 203d 2065 6e64 7265 635b 5f45  ment = endrec[_E
+0000c6b0: 4344 5f43 4f4d 4d45 4e54 5d20 2023 2061  CD_COMMENT]  # a
+0000c6c0: 7263 6869 7665 2063 6f6d 6d65 6e74 0d0a  rchive comment..
+0000c6d0: 0d0a 2020 2020 2020 2020 2320 2263 6f6e  ..        # "con
+0000c6e0: 6361 7422 2069 7320 7a65 726f 2c20 756e  cat" is zero, un
+0000c6f0: 6c65 7373 207a 6970 2077 6173 2063 6f6e  less zip was con
+0000c700: 6361 7465 6e61 7465 6420 746f 2061 6e6f  catenated to ano
+0000c710: 7468 6572 2066 696c 650d 0a20 2020 2020  ther file..     
+0000c720: 2020 2063 6f6e 6361 7420 3d20 656e 6472     concat = endr
+0000c730: 6563 5b5f 4543 445f 4c4f 4341 5449 4f4e  ec[_ECD_LOCATION
+0000c740: 5d20 2d20 7369 7a65 5f63 6420 2d20 6f66  ] - size_cd - of
+0000c750: 6673 6574 5f63 640d 0a20 2020 2020 2020  fset_cd..       
+0000c760: 2069 6620 656e 6472 6563 5b5f 4543 445f   if endrec[_ECD_
+0000c770: 5349 474e 4154 5552 455d 203d 3d20 7374  SIGNATURE] == st
+0000c780: 7269 6e67 456e 6441 7263 6869 7665 3634  ringEndArchive64
+0000c790: 3a0d 0a20 2020 2020 2020 2020 2020 2023  :..            #
+0000c7a0: 2049 6620 5a69 7036 3420 6578 7465 6e73   If Zip64 extens
+0000c7b0: 696f 6e20 7374 7275 6374 7572 6573 2061  ion structures a
+0000c7c0: 7265 2070 7265 7365 6e74 2c20 6163 636f  re present, acco
+0000c7d0: 756e 7420 666f 7220 7468 656d 0d0a 2020  unt for them..  
+0000c7e0: 2020 2020 2020 2020 2020 636f 6e63 6174            concat
+0000c7f0: 202d 3d20 7369 7a65 456e 6443 656e 7444   -= sizeEndCentD
+0000c800: 6972 3634 202b 2073 697a 6545 6e64 4365  ir64 + sizeEndCe
+0000c810: 6e74 4469 7236 344c 6f63 6174 6f72 0d0a  ntDir64Locator..
+0000c820: 0d0a 2020 2020 2020 2020 6966 2073 656c  ..        if sel
+0000c830: 662e 6465 6275 6720 3e20 323a 0d0a 2020  f.debug > 2:..  
+0000c840: 2020 2020 2020 2020 2020 696e 6665 7272            inferr
+0000c850: 6564 203d 2063 6f6e 6361 7420 2b20 6f66  ed = concat + of
+0000c860: 6673 6574 5f63 640d 0a20 2020 2020 2020  fset_cd..       
+0000c870: 2020 2020 2070 7269 6e74 2822 6769 7665       print("give
+0000c880: 6e2c 2069 6e66 6572 7265 642c 206f 6666  n, inferred, off
+0000c890: 7365 7422 2c20 6f66 6673 6574 5f63 642c  set", offset_cd,
+0000c8a0: 2069 6e66 6572 7265 642c 2063 6f6e 6361   inferred, conca
+0000c8b0: 7429 0d0a 2020 2020 2020 2020 2320 7365  t)..        # se
+0000c8c0: 6c66 2e73 7461 7274 5f64 6972 3a20 2050  lf.start_dir:  P
+0000c8d0: 6f73 6974 696f 6e20 6f66 2073 7461 7274  osition of start
+0000c8e0: 206f 6620 6365 6e74 7261 6c20 6469 7265   of central dire
+0000c8f0: 6374 6f72 790d 0a20 2020 2020 2020 2073  ctory..        s
+0000c900: 656c 662e 7374 6172 745f 6469 7220 3d20  elf.start_dir = 
+0000c910: 6f66 6673 6574 5f63 6420 2b20 636f 6e63  offset_cd + conc
+0000c920: 6174 0d0a 2020 2020 2020 2020 6670 2e73  at..        fp.s
+0000c930: 6565 6b28 7365 6c66 2e73 7461 7274 5f64  eek(self.start_d
+0000c940: 6972 2c20 3029 0d0a 2020 2020 2020 2020  ir, 0)..        
+0000c950: 6461 7461 203d 2066 702e 7265 6164 2873  data = fp.read(s
+0000c960: 697a 655f 6364 290d 0a20 2020 2020 2020  ize_cd)..       
+0000c970: 2066 7020 3d20 696f 2e42 7974 6573 494f   fp = io.BytesIO
+0000c980: 2864 6174 6129 0d0a 2020 2020 2020 2020  (data)..        
+0000c990: 746f 7461 6c20 3d20 300d 0a20 2020 2020  total = 0..     
+0000c9a0: 2020 2077 6869 6c65 2074 6f74 616c 203c     while total <
+0000c9b0: 2073 697a 655f 6364 3a0d 0a20 2020 2020   size_cd:..     
+0000c9c0: 2020 2020 2020 2063 656e 7464 6972 203d         centdir =
+0000c9d0: 2066 702e 7265 6164 2873 697a 6543 656e   fp.read(sizeCen
+0000c9e0: 7472 616c 4469 7229 0d0a 2020 2020 2020  tralDir)..      
+0000c9f0: 2020 2020 2020 6966 206c 656e 2863 656e        if len(cen
+0000ca00: 7464 6972 2920 213d 2073 697a 6543 656e  tdir) != sizeCen
+0000ca10: 7472 616c 4469 723a 0d0a 2020 2020 2020  tralDir:..      
+0000ca20: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
+0000ca30: 4261 645a 6970 4669 6c65 2822 5472 756e  BadZipFile("Trun
+0000ca40: 6361 7465 6420 6365 6e74 7261 6c20 6469  cated central di
+0000ca50: 7265 6374 6f72 7922 290d 0a20 2020 2020  rectory")..     
+0000ca60: 2020 2020 2020 2063 656e 7464 6972 203d         centdir =
+0000ca70: 2073 7472 7563 742e 756e 7061 636b 2873   struct.unpack(s
+0000ca80: 7472 7563 7443 656e 7472 616c 4469 722c  tructCentralDir,
+0000ca90: 2063 656e 7464 6972 290d 0a20 2020 2020   centdir)..     
+0000caa0: 2020 2020 2020 2069 6620 6365 6e74 6469         if centdi
+0000cab0: 725b 5f43 445f 5349 474e 4154 5552 455d  r[_CD_SIGNATURE]
+0000cac0: 2021 3d20 7374 7269 6e67 4365 6e74 7261   != stringCentra
+0000cad0: 6c44 6972 3a0d 0a20 2020 2020 2020 2020  lDir:..         
+0000cae0: 2020 2020 2020 2072 6169 7365 2042 6164         raise Bad
+0000caf0: 5a69 7046 696c 6528 2242 6164 206d 6167  ZipFile("Bad mag
+0000cb00: 6963 206e 756d 6265 7220 666f 7220 6365  ic number for ce
+0000cb10: 6e74 7261 6c20 6469 7265 6374 6f72 7922  ntral directory"
+0000cb20: 290d 0a20 2020 2020 2020 2020 2020 2069  )..            i
+0000cb30: 6620 7365 6c66 2e64 6562 7567 203e 2032  f self.debug > 2
+0000cb40: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+0000cb50: 2020 2070 7269 6e74 2863 656e 7464 6972     print(centdir
+0000cb60: 290d 0a20 2020 2020 2020 2020 2020 2066  )..            f
+0000cb70: 696c 656e 616d 6520 3d20 6670 2e72 6561  ilename = fp.rea
+0000cb80: 6428 6365 6e74 6469 725b 5f43 445f 4649  d(centdir[_CD_FI
+0000cb90: 4c45 4e41 4d45 5f4c 454e 4754 485d 290d  LENAME_LENGTH]).
+0000cba0: 0a20 2020 2020 2020 2020 2020 2066 6c61  .            fla
+0000cbb0: 6773 203d 2063 656e 7464 6972 5b35 5d0d  gs = centdir[5].
+0000cbc0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+0000cbd0: 666c 6167 7320 2620 3078 3830 303a 0d0a  flags & 0x800:..
+0000cbe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000cbf0: 2320 5554 462d 3820 6669 6c65 206e 616d  # UTF-8 file nam
+0000cc00: 6573 2065 7874 656e 7369 6f6e 0d0a 2020  es extension..  
+0000cc10: 2020 2020 2020 2020 2020 2020 2020 6669                fi
+0000cc20: 6c65 6e61 6d65 203d 2066 696c 656e 616d  lename = filenam
+0000cc30: 652e 6465 636f 6465 2822 7574 662d 3822  e.decode("utf-8"
+0000cc40: 290d 0a20 2020 2020 2020 2020 2020 2065  )..            e
+0000cc50: 6c73 653a 0d0a 2020 2020 2020 2020 2020  lse:..          
+0000cc60: 2020 2020 2020 2320 4869 7374 6f72 6963        # Historic
+0000cc70: 616c 205a 4950 2066 696c 656e 616d 6520  al ZIP filename 
+0000cc80: 656e 636f 6469 6e67 0d0a 2020 2020 2020  encoding..      
+0000cc90: 2020 2020 2020 2020 2020 6669 6c65 6e61            filena
+0000cca0: 6d65 203d 2066 696c 656e 616d 652e 6465  me = filename.de
+0000ccb0: 636f 6465 2822 6370 3433 3722 290d 0a20  code("cp437").. 
+0000ccc0: 2020 2020 2020 2020 2020 2023 2043 7265             # Cre
+0000ccd0: 6174 6520 5a69 7049 6e66 6f20 696e 7374  ate ZipInfo inst
+0000cce0: 616e 6365 2074 6f20 7374 6f72 6520 6669  ance to store fi
+0000ccf0: 6c65 2069 6e66 6f72 6d61 7469 6f6e 0d0a  le information..
+0000cd00: 2020 2020 2020 2020 2020 2020 7820 3d20              x = 
+0000cd10: 5a69 7049 6e66 6f28 6669 6c65 6e61 6d65  ZipInfo(filename
+0000cd20: 290d 0a20 2020 2020 2020 2020 2020 2078  )..            x
+0000cd30: 2e65 7874 7261 203d 2066 702e 7265 6164  .extra = fp.read
+0000cd40: 2863 656e 7464 6972 5b5f 4344 5f45 5854  (centdir[_CD_EXT
+0000cd50: 5241 5f46 4945 4c44 5f4c 454e 4754 485d  RA_FIELD_LENGTH]
+0000cd60: 290d 0a20 2020 2020 2020 2020 2020 2078  )..            x
+0000cd70: 2e63 6f6d 6d65 6e74 203d 2066 702e 7265  .comment = fp.re
+0000cd80: 6164 2863 656e 7464 6972 5b5f 4344 5f43  ad(centdir[_CD_C
+0000cd90: 4f4d 4d45 4e54 5f4c 454e 4754 485d 290d  OMMENT_LENGTH]).
+0000cda0: 0a20 2020 2020 2020 2020 2020 2078 2e68  .            x.h
+0000cdb0: 6561 6465 725f 6f66 6673 6574 203d 2063  eader_offset = c
+0000cdc0: 656e 7464 6972 5b5f 4344 5f4c 4f43 414c  entdir[_CD_LOCAL
+0000cdd0: 5f48 4541 4445 525f 4f46 4653 4554 5d0d  _HEADER_OFFSET].
+0000cde0: 0a20 2020 2020 2020 2020 2020 2028 0d0a  .            (..
+0000cdf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ce00: 782e 6372 6561 7465 5f76 6572 7369 6f6e  x.create_version
+0000ce10: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
+0000ce20: 2020 2078 2e63 7265 6174 655f 7379 7374     x.create_syst
+0000ce30: 656d 2c0d 0a20 2020 2020 2020 2020 2020  em,..           
+0000ce40: 2020 2020 2078 2e65 7874 7261 6374 5f76       x.extract_v
+0000ce50: 6572 7369 6f6e 2c0d 0a20 2020 2020 2020  ersion,..       
+0000ce60: 2020 2020 2020 2020 2078 2e72 6573 6572           x.reser
+0000ce70: 7665 642c 0d0a 2020 2020 2020 2020 2020  ved,..          
+0000ce80: 2020 2020 2020 782e 666c 6167 5f62 6974        x.flag_bit
+0000ce90: 732c 0d0a 2020 2020 2020 2020 2020 2020  s,..            
+0000cea0: 2020 2020 782e 636f 6d70 7265 7373 5f74      x.compress_t
+0000ceb0: 7970 652c 0d0a 2020 2020 2020 2020 2020  ype,..          
+0000cec0: 2020 2020 2020 742c 0d0a 2020 2020 2020        t,..      
+0000ced0: 2020 2020 2020 2020 2020 642c 0d0a 2020            d,..  
+0000cee0: 2020 2020 2020 2020 2020 2020 2020 782e                x.
+0000cef0: 4352 432c 0d0a 2020 2020 2020 2020 2020  CRC,..          
+0000cf00: 2020 2020 2020 782e 636f 6d70 7265 7373        x.compress
+0000cf10: 5f73 697a 652c 0d0a 2020 2020 2020 2020  _size,..        
+0000cf20: 2020 2020 2020 2020 782e 6669 6c65 5f73          x.file_s
+0000cf30: 697a 652c 0d0a 2020 2020 2020 2020 2020  ize,..          
+0000cf40: 2020 2920 3d20 6365 6e74 6469 725b 313a    ) = centdir[1:
+0000cf50: 3132 5d0d 0a20 2020 2020 2020 2020 2020  12]..           
+0000cf60: 2069 6620 782e 6578 7472 6163 745f 7665   if x.extract_ve
+0000cf70: 7273 696f 6e20 3e20 4d41 585f 4558 5452  rsion > MAX_EXTR
+0000cf80: 4143 545f 5645 5253 494f 4e3a 0d0a 2020  ACT_VERSION:..  
+0000cf90: 2020 2020 2020 2020 2020 2020 2020 7261                ra
+0000cfa0: 6973 6520 4e6f 7449 6d70 6c65 6d65 6e74  ise NotImplement
+0000cfb0: 6564 4572 726f 7228 0d0a 2020 2020 2020  edError(..      
+0000cfc0: 2020 2020 2020 2020 2020 2020 2020 227a                "z
+0000cfd0: 6970 2066 696c 6520 7665 7273 696f 6e20  ip file version 
+0000cfe0: 252e 3166 2220 2520 2878 2e65 7874 7261  %.1f" % (x.extra
+0000cff0: 6374 5f76 6572 7369 6f6e 202f 2031 3029  ct_version / 10)
+0000d000: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
+0000d010: 2020 2029 0d0a 2020 2020 2020 2020 2020     )..          
+0000d020: 2020 782e 766f 6c75 6d65 2c20 782e 696e    x.volume, x.in
+0000d030: 7465 726e 616c 5f61 7474 722c 2078 2e65  ternal_attr, x.e
+0000d040: 7874 6572 6e61 6c5f 6174 7472 203d 2063  xternal_attr = c
+0000d050: 656e 7464 6972 5b31 353a 3138 5d0d 0a20  entdir[15:18].. 
+0000d060: 2020 2020 2020 2020 2020 2023 2043 6f6e             # Con
+0000d070: 7665 7274 2064 6174 652f 7469 6d65 2063  vert date/time c
+0000d080: 6f64 6520 746f 2028 7965 6172 2c20 6d6f  ode to (year, mo
+0000d090: 6e74 682c 2064 6179 2c20 686f 7572 2c20  nth, day, hour, 
+0000d0a0: 6d69 6e2c 2073 6563 290d 0a20 2020 2020  min, sec)..     
+0000d0b0: 2020 2020 2020 2078 2e5f 7261 775f 7469         x._raw_ti
+0000d0c0: 6d65 203d 2074 0d0a 2020 2020 2020 2020  me = t..        
+0000d0d0: 2020 2020 782e 6461 7465 5f74 696d 6520      x.date_time 
+0000d0e0: 3d20 280d 0a20 2020 2020 2020 2020 2020  = (..           
+0000d0f0: 2020 2020 2028 6420 3e3e 2039 2920 2b20       (d >> 9) + 
+0000d100: 3139 3830 2c0d 0a20 2020 2020 2020 2020  1980,..         
+0000d110: 2020 2020 2020 2028 6420 3e3e 2035 2920         (d >> 5) 
+0000d120: 2620 3078 462c 0d0a 2020 2020 2020 2020  & 0xF,..        
+0000d130: 2020 2020 2020 2020 6420 2620 3078 3146          d & 0x1F
+0000d140: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
+0000d150: 2020 2074 203e 3e20 3131 2c0d 0a20 2020     t >> 11,..   
+0000d160: 2020 2020 2020 2020 2020 2020 2028 7420               (t 
+0000d170: 3e3e 2035 2920 2620 3078 3346 2c0d 0a20  >> 5) & 0x3F,.. 
+0000d180: 2020 2020 2020 2020 2020 2020 2020 2028                 (
+0000d190: 7420 2620 3078 3146 2920 2a20 322c 0d0a  t & 0x1F) * 2,..
+0000d1a0: 2020 2020 2020 2020 2020 2020 290d 0a0d              )...
+0000d1b0: 0a20 2020 2020 2020 2020 2020 2078 2e5f  .            x._
+0000d1c0: 6465 636f 6465 4578 7472 6128 290d 0a20  decodeExtra().. 
+0000d1d0: 2020 2020 2020 2020 2020 2078 2e68 6561             x.hea
+0000d1e0: 6465 725f 6f66 6673 6574 203d 2078 2e68  der_offset = x.h
+0000d1f0: 6561 6465 725f 6f66 6673 6574 202b 2063  eader_offset + c
+0000d200: 6f6e 6361 740d 0a20 2020 2020 2020 2020  oncat..         
+0000d210: 2020 2073 656c 662e 6669 6c65 6c69 7374     self.filelist
+0000d220: 2e61 7070 656e 6428 7829 0d0a 2020 2020  .append(x)..    
+0000d230: 2020 2020 2020 2020 7365 6c66 2e4e 616d          self.Nam
+0000d240: 6554 6f49 6e66 6f5b 782e 6669 6c65 6e61  eToInfo[x.filena
+0000d250: 6d65 5d20 3d20 780d 0a0d 0a20 2020 2020  me] = x....     
+0000d260: 2020 2020 2020 2023 2075 7064 6174 6520         # update 
+0000d270: 746f 7461 6c20 6279 7465 7320 7265 6164  total bytes read
+0000d280: 2066 726f 6d20 6365 6e74 7261 6c20 6469   from central di
+0000d290: 7265 6374 6f72 790d 0a20 2020 2020 2020  rectory..       
+0000d2a0: 2020 2020 2074 6f74 616c 203d 2028 0d0a       total = (..
+0000d2b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d2c0: 746f 7461 6c0d 0a20 2020 2020 2020 2020  total..         
+0000d2d0: 2020 2020 2020 202b 2073 697a 6543 656e         + sizeCen
+0000d2e0: 7472 616c 4469 720d 0a20 2020 2020 2020  tralDir..       
+0000d2f0: 2020 2020 2020 2020 202b 2063 656e 7464           + centd
+0000d300: 6972 5b5f 4344 5f46 494c 454e 414d 455f  ir[_CD_FILENAME_
+0000d310: 4c45 4e47 5448 5d0d 0a20 2020 2020 2020  LENGTH]..       
+0000d320: 2020 2020 2020 2020 202b 2063 656e 7464           + centd
+0000d330: 6972 5b5f 4344 5f45 5854 5241 5f46 4945  ir[_CD_EXTRA_FIE
+0000d340: 4c44 5f4c 454e 4754 485d 0d0a 2020 2020  LD_LENGTH]..    
+0000d350: 2020 2020 2020 2020 2020 2020 2b20 6365              + ce
+0000d360: 6e74 6469 725b 5f43 445f 434f 4d4d 454e  ntdir[_CD_COMMEN
+0000d370: 545f 4c45 4e47 5448 5d0d 0a20 2020 2020  T_LENGTH]..     
+0000d380: 2020 2020 2020 2029 0d0a 0d0a 2020 2020         )....    
+0000d390: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
+0000d3a0: 6465 6275 6720 3e20 323a 0d0a 2020 2020  debug > 2:..    
+0000d3b0: 2020 2020 2020 2020 2020 2020 7072 696e              prin
+0000d3c0: 7428 2274 6f74 616c 222c 2074 6f74 616c  t("total", total
+0000d3d0: 290d 0a0d 0a20 2020 2064 6566 206e 616d  )....    def nam
+0000d3e0: 656c 6973 7428 7365 6c66 293a 0d0a 2020  elist(self):..  
+0000d3f0: 2020 2020 2020 2222 2252 6574 7572 6e20        """Return 
+0000d400: 6120 6c69 7374 206f 6620 6669 6c65 206e  a list of file n
+0000d410: 616d 6573 2069 6e20 7468 6520 6172 6368  ames in the arch
+0000d420: 6976 652e 2222 220d 0a20 2020 2020 2020  ive."""..       
+0000d430: 2072 6574 7572 6e20 5b64 6174 612e 6669   return [data.fi
+0000d440: 6c65 6e61 6d65 2066 6f72 2064 6174 6120  lename for data 
+0000d450: 696e 2073 656c 662e 6669 6c65 6c69 7374  in self.filelist
+0000d460: 5d0d 0a0d 0a20 2020 2064 6566 2069 6e66  ]....    def inf
+0000d470: 6f6c 6973 7428 7365 6c66 293a 0d0a 2020  olist(self):..  
+0000d480: 2020 2020 2020 2222 2252 6574 7572 6e20        """Return 
+0000d490: 6120 6c69 7374 206f 6620 636c 6173 7320  a list of class 
+0000d4a0: 5a69 7049 6e66 6f20 696e 7374 616e 6365  ZipInfo instance
+0000d4b0: 7320 666f 7220 6669 6c65 7320 696e 2074  s for files in t
+0000d4c0: 6865 0d0a 2020 2020 2020 2020 6172 6368  he..        arch
+0000d4d0: 6976 652e 0d0a 2020 2020 2020 2020 2222  ive...        ""
+0000d4e0: 220d 0a20 2020 2020 2020 2072 6574 7572  "..        retur
+0000d4f0: 6e20 7365 6c66 2e66 696c 656c 6973 740d  n self.filelist.
+0000d500: 0a0d 0a20 2020 2064 6566 2070 7269 6e74  ...    def print
+0000d510: 6469 7228 7365 6c66 2c20 6669 6c65 3d4e  dir(self, file=N
+0000d520: 6f6e 6529 3a0d 0a20 2020 2020 2020 2022  one):..        "
+0000d530: 2222 5072 696e 7420 6120 7461 626c 6520  ""Print a table 
+0000d540: 6f66 2063 6f6e 7465 6e74 7320 666f 7220  of contents for 
+0000d550: 7468 6520 7a69 7020 6669 6c65 2e22 2222  the zip file."""
+0000d560: 0d0a 2020 2020 2020 2020 7072 696e 7428  ..        print(
+0000d570: 0d0a 2020 2020 2020 2020 2020 2020 2225  ..            "%
+0000d580: 2d34 3673 2025 3139 7320 2531 3273 2220  -46s %19s %12s" 
+0000d590: 2520 2822 4669 6c65 204e 616d 6522 2c20  % ("File Name", 
+0000d5a0: 224d 6f64 6966 6965 6420 2020 2022 2c20  "Modified    ", 
+0000d5b0: 2253 697a 6522 292c 0d0a 2020 2020 2020  "Size"),..      
+0000d5c0: 2020 2020 2020 6669 6c65 3d66 696c 652c        file=file,
+0000d5d0: 0d0a 2020 2020 2020 2020 290d 0a20 2020  ..        )..   
+0000d5e0: 2020 2020 2066 6f72 207a 696e 666f 2069       for zinfo i
+0000d5f0: 6e20 7365 6c66 2e66 696c 656c 6973 743a  n self.filelist:
+0000d600: 0d0a 2020 2020 2020 2020 2020 2020 6461  ..            da
+0000d610: 7465 203d 2022 2564 2d25 3032 642d 2530  te = "%d-%02d-%0
+0000d620: 3264 2025 3032 643a 2530 3264 3a25 3032  2d %02d:%02d:%02
+0000d630: 6422 2025 207a 696e 666f 2e64 6174 655f  d" % zinfo.date_
+0000d640: 7469 6d65 5b3a 365d 0d0a 2020 2020 2020  time[:6]..      
+0000d650: 2020 2020 2020 7072 696e 7428 0d0a 2020        print(..  
+0000d660: 2020 2020 2020 2020 2020 2020 2020 2225                "%
+0000d670: 2d34 3673 2025 7320 2531 3264 2220 2520  -46s %s %12d" % 
+0000d680: 287a 696e 666f 2e66 696c 656e 616d 652c  (zinfo.filename,
+0000d690: 2064 6174 652c 207a 696e 666f 2e66 696c   date, zinfo.fil
+0000d6a0: 655f 7369 7a65 292c 0d0a 2020 2020 2020  e_size),..      
+0000d6b0: 2020 2020 2020 2020 2020 6669 6c65 3d66            file=f
+0000d6c0: 696c 652c 0d0a 2020 2020 2020 2020 2020  ile,..          
+0000d6d0: 2020 290d 0a0d 0a20 2020 2064 6566 2074    )....    def t
+0000d6e0: 6573 747a 6970 2873 656c 6629 3a0d 0a20  estzip(self):.. 
+0000d6f0: 2020 2020 2020 2022 2222 5265 6164 2061         """Read a
+0000d700: 6c6c 2074 6865 2066 696c 6573 2061 6e64  ll the files and
+0000d710: 2063 6865 636b 2074 6865 2043 5243 2e22   check the CRC."
+0000d720: 2222 0d0a 2020 2020 2020 2020 6368 756e  ""..        chun
+0000d730: 6b5f 7369 7a65 203d 2032 2a2a 3230 0d0a  k_size = 2**20..
+0000d740: 2020 2020 2020 2020 666f 7220 7a69 6e66          for zinf
+0000d750: 6f20 696e 2073 656c 662e 6669 6c65 6c69  o in self.fileli
+0000d760: 7374 3a0d 0a20 2020 2020 2020 2020 2020  st:..           
+0000d770: 2074 7279 3a0d 0a20 2020 2020 2020 2020   try:..         
+0000d780: 2020 2020 2020 2023 2052 6561 6420 6279         # Read by
+0000d790: 2063 6875 6e6b 732c 2074 6f20 6176 6f69   chunks, to avoi
+0000d7a0: 6420 616e 204f 7665 7266 6c6f 7745 7272  d an OverflowErr
+0000d7b0: 6f72 206f 7220 610d 0a20 2020 2020 2020  or or a..       
+0000d7c0: 2020 2020 2020 2020 2023 204d 656d 6f72           # Memor
+0000d7d0: 7945 7272 6f72 2077 6974 6820 7665 7279  yError with very
+0000d7e0: 206c 6172 6765 2065 6d62 6564 6465 6420   large embedded 
+0000d7f0: 6669 6c65 732e 0d0a 2020 2020 2020 2020  files...        
+0000d800: 2020 2020 2020 2020 7769 7468 2073 656c          with sel
+0000d810: 662e 6f70 656e 287a 696e 666f 2e66 696c  f.open(zinfo.fil
+0000d820: 656e 616d 652c 2022 7222 2920 6173 2066  ename, "r") as f
+0000d830: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+0000d840: 2020 2020 2020 2077 6869 6c65 2066 2e72         while f.r
+0000d850: 6561 6428 6368 756e 6b5f 7369 7a65 293a  ead(chunk_size):
+0000d860: 2020 2320 4368 6563 6b20 4352 432d 3332    # Check CRC-32
+0000d870: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0000d880: 2020 2020 2020 2020 2020 7061 7373 0d0a            pass..
+0000d890: 2020 2020 2020 2020 2020 2020 6578 6365              exce
+0000d8a0: 7074 2042 6164 5a69 7046 696c 653a 0d0a  pt BadZipFile:..
+0000d8b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d8c0: 7265 7475 726e 207a 696e 666f 2e66 696c  return zinfo.fil
+0000d8d0: 656e 616d 650d 0a20 2020 2020 2020 2072  ename..        r
+0000d8e0: 6574 7572 6e20 4e6f 6e65 0d0a 0d0a 2020  eturn None....  
+0000d8f0: 2020 6465 6620 6765 7469 6e66 6f28 7365    def getinfo(se
+0000d900: 6c66 2c20 6e61 6d65 293a 0d0a 2020 2020  lf, name):..    
+0000d910: 2020 2020 2222 2252 6574 7572 6e20 7468      """Return th
+0000d920: 6520 696e 7374 616e 6365 206f 6620 5a69  e instance of Zi
+0000d930: 7049 6e66 6f20 6769 7665 6e20 276e 616d  pInfo given 'nam
+0000d940: 6527 2e22 2222 0d0a 2020 2020 2020 2020  e'."""..        
+0000d950: 696e 666f 203d 2073 656c 662e 4e61 6d65  info = self.Name
+0000d960: 546f 496e 666f 2e67 6574 286e 616d 6529  ToInfo.get(name)
+0000d970: 0d0a 2020 2020 2020 2020 6966 2069 6e66  ..        if inf
+0000d980: 6f20 6973 204e 6f6e 653a 0d0a 2020 2020  o is None:..    
+0000d990: 2020 2020 2020 2020 7261 6973 6520 4b65          raise Ke
+0000d9a0: 7945 7272 6f72 2822 5468 6572 6520 6973  yError("There is
+0000d9b0: 206e 6f20 6974 656d 206e 616d 6564 2025   no item named %
+0000d9c0: 7220 696e 2074 6865 2061 7263 6869 7665  r in the archive
+0000d9d0: 2220 2520 6e61 6d65 290d 0a0d 0a20 2020  " % name)....   
+0000d9e0: 2020 2020 2072 6574 7572 6e20 696e 666f       return info
+0000d9f0: 0d0a 0d0a 2020 2020 6465 6620 7365 7470  ....    def setp
+0000da00: 6173 7377 6f72 6428 7365 6c66 2c20 7077  assword(self, pw
+0000da10: 6429 3a0d 0a20 2020 2020 2020 2022 2222  d):..        """
+0000da20: 5365 7420 6465 6661 756c 7420 7061 7373  Set default pass
+0000da30: 776f 7264 2066 6f72 2065 6e63 7279 7074  word for encrypt
+0000da40: 6564 2066 696c 6573 2e22 2222 0d0a 2020  ed files."""..  
+0000da50: 2020 2020 2020 6966 2070 7764 2061 6e64        if pwd and
+0000da60: 206e 6f74 2069 7369 6e73 7461 6e63 6528   not isinstance(
+0000da70: 7077 642c 2062 7974 6573 293a 0d0a 2020  pwd, bytes):..  
+0000da80: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
+0000da90: 5479 7065 4572 726f 7228 2270 7764 3a20  TypeError("pwd: 
+0000daa0: 6578 7065 6374 6564 2062 7974 6573 2c20  expected bytes, 
+0000dab0: 676f 7420 2573 2220 2520 7479 7065 2870  got %s" % type(p
+0000dac0: 7764 292e 5f5f 6e61 6d65 5f5f 290d 0a20  wd).__name__).. 
+0000dad0: 2020 2020 2020 2069 6620 7077 643a 0d0a         if pwd:..
+0000dae0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+0000daf0: 2e70 7764 203d 2070 7764 0d0a 2020 2020  .pwd = pwd..    
+0000db00: 2020 2020 656c 7365 3a0d 0a20 2020 2020      else:..     
+0000db10: 2020 2020 2020 2073 656c 662e 7077 6420         self.pwd 
+0000db20: 3d20 4e6f 6e65 0d0a 0d0a 2020 2020 4070  = None....    @p
+0000db30: 726f 7065 7274 790d 0a20 2020 2064 6566  roperty..    def
+0000db40: 2063 6f6d 6d65 6e74 2873 656c 6629 3a0d   comment(self):.
+0000db50: 0a20 2020 2020 2020 2022 2222 5468 6520  .        """The 
+0000db60: 636f 6d6d 656e 7420 7465 7874 2061 7373  comment text ass
+0000db70: 6f63 6961 7465 6420 7769 7468 2074 6865  ociated with the
+0000db80: 205a 4950 2066 696c 652e 2222 220d 0a20   ZIP file.""".. 
+0000db90: 2020 2020 2020 2072 6574 7572 6e20 7365         return se
+0000dba0: 6c66 2e5f 636f 6d6d 656e 740d 0a0d 0a20  lf._comment.... 
+0000dbb0: 2020 2040 636f 6d6d 656e 742e 7365 7474     @comment.sett
+0000dbc0: 6572 0d0a 2020 2020 6465 6620 636f 6d6d  er..    def comm
+0000dbd0: 656e 7428 7365 6c66 2c20 636f 6d6d 656e  ent(self, commen
+0000dbe0: 7429 3a0d 0a20 2020 2020 2020 2069 6620  t):..        if 
+0000dbf0: 6e6f 7420 6973 696e 7374 616e 6365 2863  not isinstance(c
+0000dc00: 6f6d 6d65 6e74 2c20 6279 7465 7329 3a0d  omment, bytes):.
+0000dc10: 0a20 2020 2020 2020 2020 2020 2072 6169  .            rai
+0000dc20: 7365 2054 7970 6545 7272 6f72 280d 0a20  se TypeError(.. 
+0000dc30: 2020 2020 2020 2020 2020 2020 2020 2022                 "
+0000dc40: 636f 6d6d 656e 743a 2065 7870 6563 7465  comment: expecte
+0000dc50: 6420 6279 7465 732c 2067 6f74 2025 7322  d bytes, got %s"
+0000dc60: 2025 2074 7970 6528 636f 6d6d 656e 7429   % type(comment)
+0000dc70: 2e5f 5f6e 616d 655f 5f2c 0d0a 2020 2020  .__name__,..    
+0000dc80: 2020 2020 2020 2020 290d 0a20 2020 2020          )..     
+0000dc90: 2020 2023 2063 6865 636b 2066 6f72 2076     # check for v
+0000dca0: 616c 6964 2063 6f6d 6d65 6e74 206c 656e  alid comment len
+0000dcb0: 6774 680d 0a20 2020 2020 2020 2069 6620  gth..        if 
+0000dcc0: 6c65 6e28 636f 6d6d 656e 7429 203e 205a  len(comment) > Z
+0000dcd0: 4950 5f4d 4158 5f43 4f4d 4d45 4e54 3a0d  IP_MAX_COMMENT:.
+0000dce0: 0a20 2020 2020 2020 2020 2020 2069 6d70  .            imp
+0000dcf0: 6f72 7420 7761 726e 696e 6773 0d0a 0d0a  ort warnings....
+0000dd00: 2020 2020 2020 2020 2020 2020 7761 726e              warn
+0000dd10: 696e 6773 2e77 6172 6e28 0d0a 2020 2020  ings.warn(..    
+0000dd20: 2020 2020 2020 2020 2020 2020 2241 7263              "Arc
+0000dd30: 6869 7665 2063 6f6d 6d65 6e74 2069 7320  hive comment is 
+0000dd40: 746f 6f20 6c6f 6e67 3b20 7472 756e 6361  too long; trunca
+0000dd50: 7469 6e67 2074 6f20 2564 2062 7974 6573  ting to %d bytes
+0000dd60: 220d 0a20 2020 2020 2020 2020 2020 2020  "..             
+0000dd70: 2020 2025 205a 4950 5f4d 4158 5f43 4f4d     % ZIP_MAX_COM
+0000dd80: 4d45 4e54 2c0d 0a20 2020 2020 2020 2020  MENT,..         
+0000dd90: 2020 2020 2020 2073 7461 636b 6c65 7665         stackleve
+0000dda0: 6c3d 322c 0d0a 2020 2020 2020 2020 2020  l=2,..          
+0000ddb0: 2020 290d 0a20 2020 2020 2020 2020 2020    )..           
+0000ddc0: 2063 6f6d 6d65 6e74 203d 2063 6f6d 6d65   comment = comme
+0000ddd0: 6e74 5b3a 5a49 505f 4d41 585f 434f 4d4d  nt[:ZIP_MAX_COMM
+0000dde0: 454e 545d 0d0a 2020 2020 2020 2020 7365  ENT]..        se
+0000ddf0: 6c66 2e5f 636f 6d6d 656e 7420 3d20 636f  lf._comment = co
+0000de00: 6d6d 656e 740d 0a20 2020 2020 2020 2073  mment..        s
+0000de10: 656c 662e 5f64 6964 4d6f 6469 6679 203d  elf._didModify =
+0000de20: 2054 7275 650d 0a0d 0a20 2020 2064 6566   True....    def
+0000de30: 2072 6561 6428 7365 6c66 2c20 6e61 6d65   read(self, name
+0000de40: 2c20 7077 643d 4e6f 6e65 293a 0d0a 2020  , pwd=None):..  
+0000de50: 2020 2020 2020 2222 2252 6574 7572 6e20        """Return 
+0000de60: 6669 6c65 2062 7974 6573 2066 6f72 206e  file bytes for n
+0000de70: 616d 652e 2222 220d 0a20 2020 2020 2020  ame."""..       
+0000de80: 2077 6974 6820 7365 6c66 2e6f 7065 6e28   with self.open(
+0000de90: 6e61 6d65 2c20 2272 222c 2070 7764 2920  name, "r", pwd) 
+0000dea0: 6173 2066 703a 0d0a 2020 2020 2020 2020  as fp:..        
+0000deb0: 2020 2020 7265 7475 726e 2066 702e 7265      return fp.re
+0000dec0: 6164 2829 0d0a 0d0a 2020 2020 6465 6620  ad()....    def 
+0000ded0: 6f70 656e 2873 656c 662c 206e 616d 652c  open(self, name,
+0000dee0: 206d 6f64 653d 2272 222c 2070 7764 3d4e   mode="r", pwd=N
+0000def0: 6f6e 652c 202a 2c20 666f 7263 655f 7a69  one, *, force_zi
+0000df00: 7036 343d 4661 6c73 6529 3a0d 0a20 2020  p64=False):..   
+0000df10: 2020 2020 2022 2222 5265 7475 726e 2066       """Return f
+0000df20: 696c 652d 6c69 6b65 206f 626a 6563 7420  ile-like object 
+0000df30: 666f 7220 276e 616d 6527 2e0d 0a0d 0a20  for 'name'..... 
+0000df40: 2020 2020 2020 206e 616d 6520 6973 2061         name is a
+0000df50: 2073 7472 696e 6720 666f 7220 7468 6520   string for the 
+0000df60: 6669 6c65 206e 616d 6520 7769 7468 696e  file name within
+0000df70: 2074 6865 205a 4950 2066 696c 652c 206f   the ZIP file, o
+0000df80: 7220 6120 5a69 7049 6e66 6f0d 0a20 2020  r a ZipInfo..   
+0000df90: 2020 2020 206f 626a 6563 742e 0d0a 0d0a       object.....
+0000dfa0: 2020 2020 2020 2020 6d6f 6465 2073 686f          mode sho
+0000dfb0: 756c 6420 6265 2027 7227 2074 6f20 7265  uld be 'r' to re
+0000dfc0: 6164 2061 2066 696c 6520 616c 7265 6164  ad a file alread
+0000dfd0: 7920 696e 2074 6865 205a 4950 2066 696c  y in the ZIP fil
+0000dfe0: 652c 206f 7220 2777 2720 746f 0d0a 2020  e, or 'w' to..  
+0000dff0: 2020 2020 2020 7772 6974 6520 746f 2061        write to a
+0000e000: 2066 696c 6520 6e65 776c 7920 6164 6465   file newly adde
+0000e010: 6420 746f 2074 6865 2061 7263 6869 7665  d to the archive
+0000e020: 2e0d 0a0d 0a20 2020 2020 2020 2070 7764  .....        pwd
+0000e030: 2069 7320 7468 6520 7061 7373 776f 7264   is the password
+0000e040: 2074 6f20 6465 6372 7970 7420 6669 6c65   to decrypt file
+0000e050: 7320 286f 6e6c 7920 7573 6564 2066 6f72  s (only used for
+0000e060: 2072 6561 6469 6e67 292e 0d0a 0d0a 2020   reading).....  
+0000e070: 2020 2020 2020 5768 656e 2077 7269 7469        When writi
+0000e080: 6e67 2c20 6966 2074 6865 2066 696c 6520  ng, if the file 
+0000e090: 7369 7a65 2069 7320 6e6f 7420 6b6e 6f77  size is not know
+0000e0a0: 6e20 696e 2061 6476 616e 6365 2062 7574  n in advance but
+0000e0b0: 206d 6179 2065 7863 6565 640d 0a20 2020   may exceed..   
+0000e0c0: 2020 2020 2032 2047 6942 2c20 7061 7373       2 GiB, pass
+0000e0d0: 2066 6f72 6365 5f7a 6970 3634 2074 6f20   force_zip64 to 
+0000e0e0: 7573 6520 7468 6520 5a49 5036 3420 666f  use the ZIP64 fo
+0000e0f0: 726d 6174 2c20 7768 6963 6820 6361 6e20  rmat, which can 
+0000e100: 6861 6e64 6c65 206c 6172 6765 0d0a 2020  handle large..  
+0000e110: 2020 2020 2020 6669 6c65 732e 2020 4966        files.  If
+0000e120: 2074 6865 2073 697a 6520 6973 206b 6e6f   the size is kno
+0000e130: 776e 2069 6e20 6164 7661 6e63 652c 2069  wn in advance, i
+0000e140: 7420 6973 2062 6573 7420 746f 2070 6173  t is best to pas
+0000e150: 7320 6120 5a69 7049 6e66 6f0d 0a20 2020  s a ZipInfo..   
+0000e160: 2020 2020 2069 6e73 7461 6e63 6520 666f       instance fo
+0000e170: 7220 6e61 6d65 2c20 7769 7468 207a 696e  r name, with zin
+0000e180: 666f 2e66 696c 655f 7369 7a65 2073 6574  fo.file_size set
+0000e190: 2e0d 0a20 2020 2020 2020 2022 2222 0d0a  ...        """..
+0000e1a0: 2020 2020 2020 2020 6966 206d 6f64 6520          if mode 
+0000e1b0: 6e6f 7420 696e 207b 2272 222c 2022 7722  not in {"r", "w"
+0000e1c0: 7d3a 0d0a 2020 2020 2020 2020 2020 2020  }:..            
+0000e1d0: 7261 6973 6520 5661 6c75 6545 7272 6f72  raise ValueError
+0000e1e0: 2827 6f70 656e 2829 2072 6571 7569 7265  ('open() require
+0000e1f0: 7320 6d6f 6465 2022 7222 206f 7220 2277  s mode "r" or "w
+0000e200: 2227 290d 0a20 2020 2020 2020 2069 6620  "')..        if 
+0000e210: 7077 6420 616e 6420 6e6f 7420 6973 696e  pwd and not isin
+0000e220: 7374 616e 6365 2870 7764 2c20 6279 7465  stance(pwd, byte
+0000e230: 7329 3a0d 0a20 2020 2020 2020 2020 2020  s):..           
+0000e240: 2072 6169 7365 2054 7970 6545 7272 6f72   raise TypeError
+0000e250: 2822 7077 643a 2065 7870 6563 7465 6420  ("pwd: expected 
+0000e260: 6279 7465 732c 2067 6f74 2025 7322 2025  bytes, got %s" %
+0000e270: 2074 7970 6528 7077 6429 2e5f 5f6e 616d   type(pwd).__nam
+0000e280: 655f 5f29 0d0a 2020 2020 2020 2020 6966  e__)..        if
+0000e290: 2070 7764 2061 6e64 2028 6d6f 6465 203d   pwd and (mode =
+0000e2a0: 3d20 2277 2229 3a0d 0a20 2020 2020 2020  = "w"):..       
+0000e2b0: 2020 2020 2072 6169 7365 2056 616c 7565       raise Value
+0000e2c0: 4572 726f 7228 2270 7764 2069 7320 6f6e  Error("pwd is on
+0000e2d0: 6c79 2073 7570 706f 7274 6564 2066 6f72  ly supported for
+0000e2e0: 2072 6561 6469 6e67 2066 696c 6573 2229   reading files")
+0000e2f0: 0d0a 2020 2020 2020 2020 6966 206e 6f74  ..        if not
+0000e300: 2073 656c 662e 6670 3a0d 0a20 2020 2020   self.fp:..     
+0000e310: 2020 2020 2020 2072 6169 7365 2056 616c         raise Val
+0000e320: 7565 4572 726f 7228 0d0a 2020 2020 2020  ueError(..      
+0000e330: 2020 2020 2020 2020 2020 2241 7474 656d            "Attem
+0000e340: 7074 2074 6f20 7573 6520 5a49 5020 6172  pt to use ZIP ar
+0000e350: 6368 6976 6520 7468 6174 2077 6173 2061  chive that was a
+0000e360: 6c72 6561 6479 2063 6c6f 7365 6422 2c0d  lready closed",.
+0000e370: 0a20 2020 2020 2020 2020 2020 2029 0d0a  .            )..
+0000e380: 0d0a 2020 2020 2020 2020 2320 4d61 6b65  ..        # Make
+0000e390: 2073 7572 6520 7765 2068 6176 6520 616e   sure we have an
+0000e3a0: 2069 6e66 6f20 6f62 6a65 6374 0d0a 2020   info object..  
+0000e3b0: 2020 2020 2020 6966 2069 7369 6e73 7461        if isinsta
+0000e3c0: 6e63 6528 6e61 6d65 2c20 5a69 7049 6e66  nce(name, ZipInf
+0000e3d0: 6f29 3a0d 0a20 2020 2020 2020 2020 2020  o):..           
+0000e3e0: 2023 2027 6e61 6d65 2720 6973 2061 6c72   # 'name' is alr
+0000e3f0: 6561 6479 2061 6e20 696e 666f 206f 626a  eady an info obj
+0000e400: 6563 740d 0a20 2020 2020 2020 2020 2020  ect..           
+0000e410: 207a 696e 666f 203d 206e 616d 650d 0a20   zinfo = name.. 
+0000e420: 2020 2020 2020 2065 6c69 6620 6d6f 6465         elif mode
+0000e430: 203d 3d20 2277 223a 0d0a 2020 2020 2020   == "w":..      
+0000e440: 2020 2020 2020 7a69 6e66 6f20 3d20 5a69        zinfo = Zi
+0000e450: 7049 6e66 6f28 6e61 6d65 290d 0a20 2020  pInfo(name)..   
+0000e460: 2020 2020 2020 2020 207a 696e 666f 2e63           zinfo.c
+0000e470: 6f6d 7072 6573 735f 7479 7065 203d 2073  ompress_type = s
+0000e480: 656c 662e 636f 6d70 7265 7373 696f 6e0d  elf.compression.
+0000e490: 0a20 2020 2020 2020 2020 2020 207a 696e  .            zin
+0000e4a0: 666f 2e5f 636f 6d70 7265 7373 6c65 7665  fo._compressleve
+0000e4b0: 6c20 3d20 7365 6c66 2e63 6f6d 7072 6573  l = self.compres
+0000e4c0: 736c 6576 656c 0d0a 2020 2020 2020 2020  slevel..        
+0000e4d0: 656c 7365 3a0d 0a20 2020 2020 2020 2020  else:..         
+0000e4e0: 2020 2023 2047 6574 2069 6e66 6f20 6f62     # Get info ob
+0000e4f0: 6a65 6374 2066 6f72 206e 616d 650d 0a20  ject for name.. 
+0000e500: 2020 2020 2020 2020 2020 207a 696e 666f             zinfo
+0000e510: 203d 2073 656c 662e 6765 7469 6e66 6f28   = self.getinfo(
+0000e520: 6e61 6d65 290d 0a0d 0a20 2020 2020 2020  name)....       
+0000e530: 2069 6620 6d6f 6465 203d 3d20 2277 223a   if mode == "w":
+0000e540: 0d0a 2020 2020 2020 2020 2020 2020 7265  ..            re
+0000e550: 7475 726e 2073 656c 662e 5f6f 7065 6e5f  turn self._open_
+0000e560: 746f 5f77 7269 7465 287a 696e 666f 2c20  to_write(zinfo, 
+0000e570: 666f 7263 655f 7a69 7036 343d 666f 7263  force_zip64=forc
+0000e580: 655f 7a69 7036 3429 0d0a 0d0a 2020 2020  e_zip64)....    
+0000e590: 2020 2020 6966 2073 656c 662e 5f77 7269      if self._wri
+0000e5a0: 7469 6e67 3a0d 0a20 2020 2020 2020 2020  ting:..         
+0000e5b0: 2020 2072 6169 7365 2056 616c 7565 4572     raise ValueEr
+0000e5c0: 726f 7228 0d0a 2020 2020 2020 2020 2020  ror(..          
+0000e5d0: 2020 2020 2020 2243 616e 2774 2072 6561        "Can't rea
+0000e5e0: 6420 6672 6f6d 2074 6865 205a 4950 2066  d from the ZIP f
+0000e5f0: 696c 6520 7768 696c 6520 7468 6572 6520  ile while there 
+0000e600: 220d 0a20 2020 2020 2020 2020 2020 2020  "..             
+0000e610: 2020 2022 6973 2061 6e20 6f70 656e 2077     "is an open w
+0000e620: 7269 7469 6e67 2068 616e 646c 6520 6f6e  riting handle on
+0000e630: 2069 742e 2022 0d0a 2020 2020 2020 2020   it. "..        
+0000e640: 2020 2020 2020 2020 2243 6c6f 7365 2074          "Close t
+0000e650: 6865 2077 7269 7469 6e67 2068 616e 646c  he writing handl
+0000e660: 6520 6265 666f 7265 2074 7279 696e 6720  e before trying 
+0000e670: 746f 2072 6561 642e 222c 0d0a 2020 2020  to read.",..    
+0000e680: 2020 2020 2020 2020 290d 0a0d 0a20 2020          )....   
+0000e690: 2020 2020 2023 204f 7065 6e20 666f 7220       # Open for 
+0000e6a0: 7265 6164 696e 673a 0d0a 2020 2020 2020  reading:..      
+0000e6b0: 2020 7365 6c66 2e5f 6669 6c65 5265 6643    self._fileRefC
+0000e6c0: 6e74 202b 3d20 310d 0a20 2020 2020 2020  nt += 1..       
+0000e6d0: 207a 6566 5f66 696c 6520 3d20 5f53 6861   zef_file = _Sha
+0000e6e0: 7265 6446 696c 6528 0d0a 2020 2020 2020  redFile(..      
+0000e6f0: 2020 2020 2020 7365 6c66 2e66 702c 0d0a        self.fp,..
+0000e700: 2020 2020 2020 2020 2020 2020 7a69 6e66              zinf
+0000e710: 6f2e 6865 6164 6572 5f6f 6666 7365 742c  o.header_offset,
+0000e720: 0d0a 2020 2020 2020 2020 2020 2020 7365  ..            se
+0000e730: 6c66 2e5f 6670 636c 6f73 652c 0d0a 2020  lf._fpclose,..  
+0000e740: 2020 2020 2020 2020 2020 7365 6c66 2e5f            self._
+0000e750: 6c6f 636b 2c0d 0a20 2020 2020 2020 2020  lock,..         
+0000e760: 2020 206c 616d 6264 613a 2073 656c 662e     lambda: self.
+0000e770: 5f77 7269 7469 6e67 2c0d 0a20 2020 2020  _writing,..     
+0000e780: 2020 2029 0d0a 2020 2020 2020 2020 7472     )..        tr
+0000e790: 793a 0d0a 2020 2020 2020 2020 2020 2020  y:..            
+0000e7a0: 2320 536b 6970 2074 6865 2066 696c 6520  # Skip the file 
+0000e7b0: 6865 6164 6572 3a0d 0a20 2020 2020 2020  header:..       
+0000e7c0: 2020 2020 2066 6865 6164 6572 203d 207a       fheader = z
+0000e7d0: 6566 5f66 696c 652e 7265 6164 2873 697a  ef_file.read(siz
+0000e7e0: 6546 696c 6548 6561 6465 7229 0d0a 2020  eFileHeader)..  
+0000e7f0: 2020 2020 2020 2020 2020 6966 206c 656e            if len
+0000e800: 2866 6865 6164 6572 2920 213d 2073 697a  (fheader) != siz
+0000e810: 6546 696c 6548 6561 6465 723a 0d0a 2020  eFileHeader:..  
+0000e820: 2020 2020 2020 2020 2020 2020 2020 7261                ra
+0000e830: 6973 6520 4261 645a 6970 4669 6c65 2822  ise BadZipFile("
+0000e840: 5472 756e 6361 7465 6420 6669 6c65 2068  Truncated file h
+0000e850: 6561 6465 7222 290d 0a20 2020 2020 2020  eader")..       
+0000e860: 2020 2020 2066 6865 6164 6572 203d 2073       fheader = s
+0000e870: 7472 7563 742e 756e 7061 636b 2873 7472  truct.unpack(str
+0000e880: 7563 7446 696c 6548 6561 6465 722c 2066  uctFileHeader, f
+0000e890: 6865 6164 6572 290d 0a20 2020 2020 2020  header)..       
+0000e8a0: 2020 2020 2069 6620 6668 6561 6465 725b       if fheader[
+0000e8b0: 5f46 485f 5349 474e 4154 5552 455d 2021  _FH_SIGNATURE] !
+0000e8c0: 3d20 7374 7269 6e67 4669 6c65 4865 6164  = stringFileHead
+0000e8d0: 6572 3a0d 0a20 2020 2020 2020 2020 2020  er:..           
+0000e8e0: 2020 2020 2072 6169 7365 2042 6164 5a69       raise BadZi
+0000e8f0: 7046 696c 6528 2242 6164 206d 6167 6963  pFile("Bad magic
+0000e900: 206e 756d 6265 7220 666f 7220 6669 6c65   number for file
+0000e910: 2068 6561 6465 7222 290d 0a0d 0a20 2020   header")....   
+0000e920: 2020 2020 2020 2020 2066 6e61 6d65 203d           fname =
+0000e930: 207a 6566 5f66 696c 652e 7265 6164 2866   zef_file.read(f
+0000e940: 6865 6164 6572 5b5f 4648 5f46 494c 454e  header[_FH_FILEN
+0000e950: 414d 455f 4c45 4e47 5448 5d29 0d0a 2020  AME_LENGTH])..  
+0000e960: 2020 2020 2020 2020 2020 6966 2066 6865            if fhe
+0000e970: 6164 6572 5b5f 4648 5f45 5854 5241 5f46  ader[_FH_EXTRA_F
+0000e980: 4945 4c44 5f4c 454e 4754 485d 3a0d 0a20  IELD_LENGTH]:.. 
+0000e990: 2020 2020 2020 2020 2020 2020 2020 207a                 z
+0000e9a0: 6566 5f66 696c 652e 7265 6164 2866 6865  ef_file.read(fhe
+0000e9b0: 6164 6572 5b5f 4648 5f45 5854 5241 5f46  ader[_FH_EXTRA_F
+0000e9c0: 4945 4c44 5f4c 454e 4754 485d 290d 0a0d  IELD_LENGTH])...
+0000e9d0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+0000e9e0: 7a69 6e66 6f2e 666c 6167 5f62 6974 7320  zinfo.flag_bits 
+0000e9f0: 2620 3078 3230 3a0d 0a20 2020 2020 2020  & 0x20:..       
+0000ea00: 2020 2020 2020 2020 2023 205a 6970 2032           # Zip 2
+0000ea10: 2e37 3a20 636f 6d70 7265 7373 6564 2070  .7: compressed p
+0000ea20: 6174 6368 6564 2064 6174 610d 0a20 2020  atched data..   
+0000ea30: 2020 2020 2020 2020 2020 2020 2072 6169               rai
+0000ea40: 7365 204e 6f74 496d 706c 656d 656e 7465  se NotImplemente
+0000ea50: 6445 7272 6f72 280d 0a20 2020 2020 2020  dError(..       
+0000ea60: 2020 2020 2020 2020 2020 2020 2022 636f               "co
+0000ea70: 6d70 7265 7373 6564 2070 6174 6368 6564  mpressed patched
+0000ea80: 2064 6174 6120 2866 6c61 6720 6269 7420   data (flag bit 
+0000ea90: 3529 222c 0d0a 2020 2020 2020 2020 2020  5)",..          
+0000eaa0: 2020 2020 2020 290d 0a0d 0a20 2020 2020        )....     
+0000eab0: 2020 2020 2020 2069 6620 7a69 6e66 6f2e         if zinfo.
+0000eac0: 666c 6167 5f62 6974 7320 2620 3078 3430  flag_bits & 0x40
+0000ead0: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+0000eae0: 2020 2023 2073 7472 6f6e 6720 656e 6372     # strong encr
+0000eaf0: 7970 7469 6f6e 0d0a 2020 2020 2020 2020  yption..        
+0000eb00: 2020 2020 2020 2020 7261 6973 6520 4e6f          raise No
+0000eb10: 7449 6d70 6c65 6d65 6e74 6564 4572 726f  tImplementedErro
+0000eb20: 7228 2273 7472 6f6e 6720 656e 6372 7970  r("strong encryp
+0000eb30: 7469 6f6e 2028 666c 6167 2062 6974 2036  tion (flag bit 6
+0000eb40: 2922 290d 0a0d 0a20 2020 2020 2020 2020  )")....         
+0000eb50: 2020 2069 6620 7a69 6e66 6f2e 666c 6167     if zinfo.flag
+0000eb60: 5f62 6974 7320 2620 3078 3830 303a 0d0a  _bits & 0x800:..
+0000eb70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000eb80: 2320 5554 462d 3820 6669 6c65 6e61 6d65  # UTF-8 filename
+0000eb90: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0000eba0: 2020 666e 616d 655f 7374 7220 3d20 666e    fname_str = fn
+0000ebb0: 616d 652e 6465 636f 6465 2822 7574 662d  ame.decode("utf-
+0000ebc0: 3822 290d 0a20 2020 2020 2020 2020 2020  8")..           
+0000ebd0: 2065 6c73 653a 0d0a 2020 2020 2020 2020   else:..        
+0000ebe0: 2020 2020 2020 2020 666e 616d 655f 7374          fname_st
+0000ebf0: 7220 3d20 666e 616d 652e 6465 636f 6465  r = fname.decode
+0000ec00: 2822 6370 3433 3722 290d 0a0d 0a20 2020  ("cp437")....   
+0000ec10: 2020 2020 2020 2020 2069 6620 666e 616d           if fnam
+0000ec20: 655f 7374 7220 213d 207a 696e 666f 2e6f  e_str != zinfo.o
+0000ec30: 7269 675f 6669 6c65 6e61 6d65 3a0d 0a20  rig_filename:.. 
+0000ec40: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+0000ec50: 6169 7365 2042 6164 5a69 7046 696c 6528  aise BadZipFile(
+0000ec60: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0000ec70: 2020 2020 2020 6622 4669 6c65 206e 616d        f"File nam
+0000ec80: 6520 696e 2064 6972 6563 746f 7279 207b  e in directory {
+0000ec90: 7a69 6e66 6f2e 6f72 6967 5f66 696c 656e  zinfo.orig_filen
+0000eca0: 616d 6521 727d 2061 6e64 2068 6561 6465  ame!r} and heade
+0000ecb0: 7220 7b66 6e61 6d65 2172 7d20 6469 6666  r {fname!r} diff
+0000ecc0: 6572 2e22 2c0d 0a20 2020 2020 2020 2020  er.",..         
+0000ecd0: 2020 2020 2020 2029 0d0a 0d0a 2020 2020         )....    
+0000ece0: 2020 2020 2020 2020 2320 6368 6563 6b20          # check 
+0000ecf0: 666f 7220 656e 6372 7970 7465 6420 666c  for encrypted fl
+0000ed00: 6167 2026 2068 616e 646c 6520 7061 7373  ag & handle pass
+0000ed10: 776f 7264 0d0a 2020 2020 2020 2020 2020  word..          
+0000ed20: 2020 6973 5f65 6e63 7279 7074 6564 203d    is_encrypted =
+0000ed30: 207a 696e 666f 2e66 6c61 675f 6269 7473   zinfo.flag_bits
+0000ed40: 2026 2030 7831 0d0a 2020 2020 2020 2020   & 0x1..        
+0000ed50: 2020 2020 6966 2069 735f 656e 6372 7970      if is_encryp
+0000ed60: 7465 643a 0d0a 2020 2020 2020 2020 2020  ted:..          
+0000ed70: 2020 2020 2020 6966 206e 6f74 2070 7764        if not pwd
+0000ed80: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+0000ed90: 2020 2020 2020 2070 7764 203d 2073 656c         pwd = sel
+0000eda0: 662e 7077 640d 0a20 2020 2020 2020 2020  f.pwd..         
+0000edb0: 2020 2020 2020 2069 6620 6e6f 7420 7077         if not pw
+0000edc0: 643a 0d0a 2020 2020 2020 2020 2020 2020  d:..            
+0000edd0: 2020 2020 2020 2020 7261 6973 6520 5275          raise Ru
+0000ede0: 6e74 696d 6545 7272 6f72 280d 0a20 2020  ntimeError(..   
+0000edf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ee00: 2020 2020 2022 4669 6c65 2025 7220 6973       "File %r is
+0000ee10: 2065 6e63 7279 7074 6564 2c20 7061 7373   encrypted, pass
+0000ee20: 776f 7264 2022 0d0a 2020 2020 2020 2020  word "..        
+0000ee30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ee40: 2272 6571 7569 7265 6420 666f 7220 6578  "required for ex
+0000ee50: 7472 6163 7469 6f6e 2220 2520 6e61 6d65  traction" % name
+0000ee60: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
+0000ee70: 2020 2020 2020 2029 0d0a 2020 2020 2020         )..      
+0000ee80: 2020 2020 2020 656c 7365 3a0d 0a20 2020        else:..   
+0000ee90: 2020 2020 2020 2020 2020 2020 2070 7764               pwd
+0000eea0: 203d 204e 6f6e 650d 0a0d 0a20 2020 2020   = None....     
+0000eeb0: 2020 2020 2020 2072 6574 7572 6e20 5a69         return Zi
+0000eec0: 7045 7874 4669 6c65 287a 6566 5f66 696c  pExtFile(zef_fil
+0000eed0: 652c 206d 6f64 652c 207a 696e 666f 2c20  e, mode, zinfo, 
+0000eee0: 7077 642c 2054 7275 6529 0d0a 2020 2020  pwd, True)..    
+0000eef0: 2020 2020 6578 6365 7074 3a0d 0a20 2020      except:..   
+0000ef00: 2020 2020 2020 2020 207a 6566 5f66 696c           zef_fil
+0000ef10: 652e 636c 6f73 6528 290d 0a20 2020 2020  e.close()..     
+0000ef20: 2020 2020 2020 2072 6169 7365 0d0a 0d0a         raise....
+0000ef30: 2020 2020 6465 6620 5f6f 7065 6e5f 746f      def _open_to
+0000ef40: 5f77 7269 7465 2873 656c 662c 207a 696e  _write(self, zin
+0000ef50: 666f 2c20 666f 7263 655f 7a69 7036 343d  fo, force_zip64=
+0000ef60: 4661 6c73 6529 3a0d 0a20 2020 2020 2020  False):..       
+0000ef70: 2069 6620 666f 7263 655f 7a69 7036 3420   if force_zip64 
+0000ef80: 616e 6420 6e6f 7420 7365 6c66 2e5f 616c  and not self._al
+0000ef90: 6c6f 775a 6970 3634 3a0d 0a20 2020 2020  lowZip64:..     
+0000efa0: 2020 2020 2020 2072 6169 7365 2056 616c         raise Val
+0000efb0: 7565 4572 726f 7228 0d0a 2020 2020 2020  ueError(..      
+0000efc0: 2020 2020 2020 2020 2020 2266 6f72 6365            "force
+0000efd0: 5f7a 6970 3634 2069 7320 5472 7565 2c20  _zip64 is True, 
+0000efe0: 6275 7420 616c 6c6f 775a 6970 3634 2077  but allowZip64 w
+0000eff0: 6173 2046 616c 7365 2077 6865 6e20 6f70  as False when op
+0000f000: 656e 696e 6720 220d 0a20 2020 2020 2020  ening "..       
+0000f010: 2020 2020 2020 2020 2022 7468 6520 5a49           "the ZI
+0000f020: 5020 6669 6c65 2e22 2c0d 0a20 2020 2020  P file.",..     
+0000f030: 2020 2020 2020 2029 0d0a 2020 2020 2020         )..      
+0000f040: 2020 6966 2073 656c 662e 5f77 7269 7469    if self._writi
+0000f050: 6e67 3a0d 0a20 2020 2020 2020 2020 2020  ng:..           
+0000f060: 2072 6169 7365 2056 616c 7565 4572 726f   raise ValueErro
+0000f070: 7228 0d0a 2020 2020 2020 2020 2020 2020  r(..            
+0000f080: 2020 2020 2243 616e 2774 2077 7269 7465      "Can't write
+0000f090: 2074 6f20 7468 6520 5a49 5020 6669 6c65   to the ZIP file
+0000f0a0: 2077 6869 6c65 2074 6865 7265 2069 7320   while there is 
+0000f0b0: 220d 0a20 2020 2020 2020 2020 2020 2020  "..             
+0000f0c0: 2020 2022 616e 6f74 6865 7220 7772 6974     "another writ
+0000f0d0: 6520 6861 6e64 6c65 206f 7065 6e20 6f6e  e handle open on
+0000f0e0: 2069 742e 2022 0d0a 2020 2020 2020 2020   it. "..        
+0000f0f0: 2020 2020 2020 2020 2243 6c6f 7365 2074          "Close t
+0000f100: 6865 2066 6972 7374 2068 616e 646c 6520  he first handle 
+0000f110: 6265 666f 7265 206f 7065 6e69 6e67 2061  before opening a
+0000f120: 6e6f 7468 6572 2e22 2c0d 0a20 2020 2020  nother.",..     
+0000f130: 2020 2020 2020 2029 0d0a 0d0a 2020 2020         )....    
+0000f140: 2020 2020 2320 5369 7a65 2061 6e64 2043      # Size and C
+0000f150: 5243 2061 7265 206f 7665 7277 7269 7474  RC are overwritt
+0000f160: 656e 2077 6974 6820 636f 7272 6563 7420  en with correct 
+0000f170: 6461 7461 2061 6674 6572 2070 726f 6365  data after proce
+0000f180: 7373 696e 6720 7468 6520 6669 6c65 0d0a  ssing the file..
+0000f190: 2020 2020 2020 2020 7a69 6e66 6f2e 636f          zinfo.co
+0000f1a0: 6d70 7265 7373 5f73 697a 6520 3d20 300d  mpress_size = 0.
+0000f1b0: 0a20 2020 2020 2020 207a 696e 666f 2e43  .        zinfo.C
+0000f1c0: 5243 203d 2030 0d0a 0d0a 2020 2020 2020  RC = 0....      
+0000f1d0: 2020 7a69 6e66 6f2e 666c 6167 5f62 6974    zinfo.flag_bit
+0000f1e0: 7320 3d20 3078 3030 0d0a 2020 2020 2020  s = 0x00..      
+0000f1f0: 2020 6966 207a 696e 666f 2e63 6f6d 7072    if zinfo.compr
+0000f200: 6573 735f 7479 7065 203d 3d20 5a49 505f  ess_type == ZIP_
+0000f210: 4c5a 4d41 3a0d 0a20 2020 2020 2020 2020  LZMA:..         
+0000f220: 2020 2023 2043 6f6d 7072 6573 7365 6420     # Compressed 
+0000f230: 6461 7461 2069 6e63 6c75 6465 7320 616e  data includes an
+0000f240: 2065 6e64 2d6f 662d 7374 7265 616d 2028   end-of-stream (
+0000f250: 454f 5329 206d 6172 6b65 720d 0a20 2020  EOS) marker..   
+0000f260: 2020 2020 2020 2020 207a 696e 666f 2e66           zinfo.f
+0000f270: 6c61 675f 6269 7473 207c 3d20 3078 3032  lag_bits |= 0x02
+0000f280: 0d0a 2020 2020 2020 2020 6966 206e 6f74  ..        if not
+0000f290: 2073 656c 662e 5f73 6565 6b61 626c 653a   self._seekable:
+0000f2a0: 0d0a 2020 2020 2020 2020 2020 2020 7a69  ..            zi
+0000f2b0: 6e66 6f2e 666c 6167 5f62 6974 7320 7c3d  nfo.flag_bits |=
+0000f2c0: 2030 7830 380d 0a0d 0a20 2020 2020 2020   0x08....       
+0000f2d0: 2069 6620 6e6f 7420 7a69 6e66 6f2e 6578   if not zinfo.ex
+0000f2e0: 7465 726e 616c 5f61 7474 723a 0d0a 2020  ternal_attr:..  
+0000f2f0: 2020 2020 2020 2020 2020 7a69 6e66 6f2e            zinfo.
+0000f300: 6578 7465 726e 616c 5f61 7474 7220 3d20  external_attr = 
+0000f310: 306f 3630 3020 3c3c 2031 3620 2023 2070  0o600 << 16  # p
+0000f320: 6572 6d69 7373 696f 6e73 3a20 3f72 772d  ermissions: ?rw-
+0000f330: 2d2d 2d2d 2d2d 0d0a 0d0a 2020 2020 2020  ------....      
+0000f340: 2020 2320 436f 6d70 7265 7373 6564 2073    # Compressed s
+0000f350: 697a 6520 6361 6e20 6265 206c 6172 6765  ize can be large
+0000f360: 7220 7468 616e 2075 6e63 6f6d 7072 6573  r than uncompres
+0000f370: 7365 6420 7369 7a65 0d0a 2020 2020 2020  sed size..      
+0000f380: 2020 7a69 7036 3420 3d20 7365 6c66 2e5f    zip64 = self._
+0000f390: 616c 6c6f 775a 6970 3634 2061 6e64 2028  allowZip64 and (
+0000f3a0: 0d0a 2020 2020 2020 2020 2020 2020 666f  ..            fo
+0000f3b0: 7263 655f 7a69 7036 3420 6f72 207a 696e  rce_zip64 or zin
+0000f3c0: 666f 2e66 696c 655f 7369 7a65 202a 2031  fo.file_size * 1
+0000f3d0: 2e30 3520 3e20 5a49 5036 345f 4c49 4d49  .05 > ZIP64_LIMI
+0000f3e0: 540d 0a20 2020 2020 2020 2029 0d0a 0d0a  T..        )....
+0000f3f0: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
+0000f400: 5f73 6565 6b61 626c 653a 0d0a 2020 2020  _seekable:..    
+0000f410: 2020 2020 2020 2020 7365 6c66 2e66 702e          self.fp.
+0000f420: 7365 656b 2873 656c 662e 7374 6172 745f  seek(self.start_
+0000f430: 6469 7229 0d0a 2020 2020 2020 2020 7a69  dir)..        zi
+0000f440: 6e66 6f2e 6865 6164 6572 5f6f 6666 7365  nfo.header_offse
+0000f450: 7420 3d20 7365 6c66 2e66 702e 7465 6c6c  t = self.fp.tell
+0000f460: 2829 0d0a 0d0a 2020 2020 2020 2020 7365  ()....        se
+0000f470: 6c66 2e5f 7772 6974 6563 6865 636b 287a  lf._writecheck(z
+0000f480: 696e 666f 290d 0a20 2020 2020 2020 2073  info)..        s
+0000f490: 656c 662e 5f64 6964 4d6f 6469 6679 203d  elf._didModify =
+0000f4a0: 2054 7275 650d 0a0d 0a20 2020 2020 2020   True....       
+0000f4b0: 2073 656c 662e 6670 2e77 7269 7465 287a   self.fp.write(z
+0000f4c0: 696e 666f 2e46 696c 6548 6561 6465 7228  info.FileHeader(
+0000f4d0: 7a69 7036 3429 290d 0a0d 0a20 2020 2020  zip64))....     
+0000f4e0: 2020 2073 656c 662e 5f77 7269 7469 6e67     self._writing
+0000f4f0: 203d 2054 7275 650d 0a20 2020 2020 2020   = True..       
+0000f500: 2072 6574 7572 6e20 5f5a 6970 5772 6974   return _ZipWrit
+0000f510: 6546 696c 6528 7365 6c66 2c20 7a69 6e66  eFile(self, zinf
+0000f520: 6f2c 207a 6970 3634 290d 0a0d 0a20 2020  o, zip64)....   
+0000f530: 2064 6566 2065 7874 7261 6374 2873 656c   def extract(sel
+0000f540: 662c 206d 656d 6265 722c 2070 6174 683d  f, member, path=
+0000f550: 4e6f 6e65 2c20 7077 643d 4e6f 6e65 293a  None, pwd=None):
+0000f560: 0d0a 2020 2020 2020 2020 2222 2245 7874  ..        """Ext
+0000f570: 7261 6374 2061 206d 656d 6265 7220 6672  ract a member fr
+0000f580: 6f6d 2074 6865 2061 7263 6869 7665 2074  om the archive t
+0000f590: 6f20 7468 6520 6375 7272 656e 7420 776f  o the current wo
+0000f5a0: 726b 696e 6720 6469 7265 6374 6f72 792c  rking directory,
+0000f5b0: 0d0a 2020 2020 2020 2020 7573 696e 6720  ..        using 
+0000f5c0: 6974 7320 6675 6c6c 206e 616d 652e 2049  its full name. I
+0000f5d0: 7473 2066 696c 6520 696e 666f 726d 6174  ts file informat
+0000f5e0: 696f 6e20 6973 2065 7874 7261 6374 6564  ion is extracted
+0000f5f0: 2061 7320 6163 6375 7261 7465 6c79 0d0a   as accurately..
+0000f600: 2020 2020 2020 2020 6173 2070 6f73 7369          as possi
+0000f610: 626c 652e 2060 6d65 6d62 6572 2720 6d61  ble. `member' ma
+0000f620: 7920 6265 2061 2066 696c 656e 616d 6520  y be a filename 
+0000f630: 6f72 2061 205a 6970 496e 666f 206f 626a  or a ZipInfo obj
+0000f640: 6563 742e 2059 6f75 2063 616e 0d0a 2020  ect. You can..  
+0000f650: 2020 2020 2020 7370 6563 6966 7920 6120        specify a 
+0000f660: 6469 6666 6572 656e 7420 6469 7265 6374  different direct
+0000f670: 6f72 7920 7573 696e 6720 6070 6174 6827  ory using `path'
+0000f680: 2e0d 0a20 2020 2020 2020 2022 2222 0d0a  ...        """..
+0000f690: 2020 2020 2020 2020 7061 7468 203d 206f          path = o
+0000f6a0: 732e 6765 7463 7764 2829 2069 6620 7061  s.getcwd() if pa
+0000f6b0: 7468 2069 7320 4e6f 6e65 2065 6c73 6520  th is None else 
+0000f6c0: 6f73 2e66 7370 6174 6828 7061 7468 290d  os.fspath(path).
+0000f6d0: 0a0d 0a20 2020 2020 2020 2072 6574 7572  ...        retur
+0000f6e0: 6e20 7365 6c66 2e5f 6578 7472 6163 745f  n self._extract_
+0000f6f0: 6d65 6d62 6572 286d 656d 6265 722c 2070  member(member, p
+0000f700: 6174 682c 2070 7764 290d 0a0d 0a20 2020  ath, pwd)....   
+0000f710: 2064 6566 2065 7874 7261 6374 616c 6c28   def extractall(
+0000f720: 7365 6c66 2c20 7061 7468 3d4e 6f6e 652c  self, path=None,
+0000f730: 206d 656d 6265 7273 3d4e 6f6e 652c 2070   members=None, p
+0000f740: 7764 3d4e 6f6e 6529 3a0d 0a20 2020 2020  wd=None):..     
+0000f750: 2020 2022 2222 4578 7472 6163 7420 616c     """Extract al
+0000f760: 6c20 6d65 6d62 6572 7320 6672 6f6d 2074  l members from t
+0000f770: 6865 2061 7263 6869 7665 2074 6f20 7468  he archive to th
+0000f780: 6520 6375 7272 656e 7420 776f 726b 696e  e current workin
+0000f790: 670d 0a20 2020 2020 2020 2064 6972 6563  g..        direc
+0000f7a0: 746f 7279 2e20 6070 6174 6827 2073 7065  tory. `path' spe
+0000f7b0: 6369 6669 6573 2061 2064 6966 6665 7265  cifies a differe
+0000f7c0: 6e74 2064 6972 6563 746f 7279 2074 6f20  nt directory to 
+0000f7d0: 6578 7472 6163 7420 746f 2e0d 0a20 2020  extract to...   
+0000f7e0: 2020 2020 2060 6d65 6d62 6572 7327 2069       `members' i
+0000f7f0: 7320 6f70 7469 6f6e 616c 2061 6e64 206d  s optional and m
+0000f800: 7573 7420 6265 2061 2073 7562 7365 7420  ust be a subset 
+0000f810: 6f66 2074 6865 206c 6973 7420 7265 7475  of the list retu
+0000f820: 726e 6564 0d0a 2020 2020 2020 2020 6279  rned..        by
+0000f830: 206e 616d 656c 6973 7428 292e 0d0a 2020   namelist()...  
+0000f840: 2020 2020 2020 2222 220d 0a20 2020 2020        """..     
+0000f850: 2020 2069 6620 6d65 6d62 6572 7320 6973     if members is
+0000f860: 204e 6f6e 653a 0d0a 2020 2020 2020 2020   None:..        
+0000f870: 2020 2020 6d65 6d62 6572 7320 3d20 7365      members = se
+0000f880: 6c66 2e6e 616d 656c 6973 7428 290d 0a0d  lf.namelist()...
+0000f890: 0a20 2020 2020 2020 2070 6174 6820 3d20  .        path = 
+0000f8a0: 6f73 2e67 6574 6377 6428 2920 6966 2070  os.getcwd() if p
+0000f8b0: 6174 6820 6973 204e 6f6e 6520 656c 7365  ath is None else
+0000f8c0: 206f 732e 6673 7061 7468 2870 6174 6829   os.fspath(path)
+0000f8d0: 0d0a 0d0a 2020 2020 2020 2020 666f 7220  ....        for 
+0000f8e0: 7a69 7069 6e66 6f20 696e 206d 656d 6265  zipinfo in membe
+0000f8f0: 7273 3a0d 0a20 2020 2020 2020 2020 2020  rs:..           
+0000f900: 2073 656c 662e 5f65 7874 7261 6374 5f6d   self._extract_m
+0000f910: 656d 6265 7228 7a69 7069 6e66 6f2c 2070  ember(zipinfo, p
+0000f920: 6174 682c 2070 7764 290d 0a0d 0a20 2020  ath, pwd)....   
+0000f930: 2064 6566 2072 656d 6f76 6528 7365 6c66   def remove(self
+0000f940: 2c20 6d65 6d62 6572 293a 0d0a 2020 2020  , member):..    
+0000f950: 2020 2020 2222 2252 656d 6f76 6520 6120      """Remove a 
+0000f960: 6669 6c65 2066 726f 6d20 7468 6520 6172  file from the ar
+0000f970: 6368 6976 652e 2054 6865 2061 7263 6869  chive. The archi
+0000f980: 7665 206d 7573 7420 6265 206f 7065 6e20  ve must be open 
+0000f990: 7769 7468 206d 6f64 6520 2761 272e 2222  with mode 'a'.""
+0000f9a0: 220d 0a20 2020 2020 2020 2069 6620 7365  "..        if se
+0000f9b0: 6c66 2e6d 6f64 6520 213d 2022 6122 3a0d  lf.mode != "a":.
+0000f9c0: 0a20 2020 2020 2020 2020 2020 2072 6169  .            rai
+0000f9d0: 7365 2052 756e 7469 6d65 4572 726f 7228  se RuntimeError(
+0000f9e0: 2272 656d 6f76 6528 2920 7265 7175 6972  "remove() requir
+0000f9f0: 6573 206d 6f64 6520 2761 2722 290d 0a20  es mode 'a'").. 
+0000fa00: 2020 2020 2020 2069 6620 6e6f 7420 7365         if not se
+0000fa10: 6c66 2e66 703a 0d0a 2020 2020 2020 2020  lf.fp:..        
+0000fa20: 2020 2020 7261 6973 6520 5661 6c75 6545      raise ValueE
+0000fa30: 7272 6f72 280d 0a20 2020 2020 2020 2020  rror(..         
+0000fa40: 2020 2020 2020 2022 4174 7465 6d70 7420         "Attempt 
+0000fa50: 746f 2077 7269 7465 2074 6f20 5a49 5020  to write to ZIP 
+0000fa60: 6172 6368 6976 6520 7468 6174 2077 6173  archive that was
+0000fa70: 2061 6c72 6561 6479 2063 6c6f 7365 6422   already closed"
+0000fa80: 2c0d 0a20 2020 2020 2020 2020 2020 2029  ,..            )
+0000fa90: 0d0a 2020 2020 2020 2020 6966 2073 656c  ..        if sel
+0000faa0: 662e 5f77 7269 7469 6e67 3a0d 0a20 2020  f._writing:..   
+0000fab0: 2020 2020 2020 2020 2072 6169 7365 2056           raise V
+0000fac0: 616c 7565 4572 726f 7228 0d0a 2020 2020  alueError(..    
+0000fad0: 2020 2020 2020 2020 2020 2020 2243 616e              "Can
+0000fae0: 2774 2077 7269 7465 2074 6f20 5a49 5020  't write to ZIP 
+0000faf0: 6172 6368 6976 6520 7768 696c 6520 616e  archive while an
+0000fb00: 206f 7065 6e20 7772 6974 696e 6720 6861   open writing ha
+0000fb10: 6e64 6c65 2065 7869 7374 732e 222c 0d0a  ndle exists.",..
+0000fb20: 2020 2020 2020 2020 2020 2020 290d 0a0d              )...
+0000fb30: 0a20 2020 2020 2020 2023 204d 616b 6520  .        # Make 
+0000fb40: 7375 7265 2077 6520 6861 7665 2061 6e20  sure we have an 
+0000fb50: 696e 666f 206f 626a 6563 740d 0a20 2020  info object..   
+0000fb60: 2020 2020 2069 6620 6973 696e 7374 616e       if isinstan
+0000fb70: 6365 286d 656d 6265 722c 205a 6970 496e  ce(member, ZipIn
+0000fb80: 666f 293a 0d0a 2020 2020 2020 2020 2020  fo):..          
+0000fb90: 2020 2320 276d 656d 6265 7227 2069 7320    # 'member' is 
+0000fba0: 616c 7265 6164 7920 616e 2069 6e66 6f20  already an info 
+0000fbb0: 6f62 6a65 6374 0d0a 2020 2020 2020 2020  object..        
+0000fbc0: 2020 2020 7a69 6e66 6f20 3d20 6d65 6d62      zinfo = memb
+0000fbd0: 6572 0d0a 2020 2020 2020 2020 656c 7365  er..        else
+0000fbe0: 3a0d 0a20 2020 2020 2020 2020 2020 2023  :..            #
+0000fbf0: 2067 6574 2074 6865 2069 6e66 6f20 6f62   get the info ob
+0000fc00: 6a65 6374 0d0a 2020 2020 2020 2020 2020  ject..          
+0000fc10: 2020 7a69 6e66 6f20 3d20 7365 6c66 2e67    zinfo = self.g
+0000fc20: 6574 696e 666f 286d 656d 6265 7229 0d0a  etinfo(member)..
+0000fc30: 0d0a 2020 2020 2020 2020 7265 7475 726e  ..        return
+0000fc40: 2073 656c 662e 5f72 656d 6f76 655f 6d65   self._remove_me
+0000fc50: 6d62 6572 287a 696e 666f 290d 0a0d 0a20  mber(zinfo).... 
+0000fc60: 2020 2040 636c 6173 736d 6574 686f 640d     @classmethod.
+0000fc70: 0a20 2020 2064 6566 205f 7361 6e69 7469  .    def _saniti
+0000fc80: 7a65 5f77 696e 646f 7773 5f6e 616d 6528  ze_windows_name(
+0000fc90: 636c 732c 2061 7263 6e61 6d65 2c20 7061  cls, arcname, pa
+0000fca0: 7468 7365 7029 3a0d 0a20 2020 2020 2020  thsep):..       
+0000fcb0: 2022 2222 5265 706c 6163 6520 6261 6420   """Replace bad 
+0000fcc0: 6368 6172 6163 7465 7273 2061 6e64 2072  characters and r
+0000fcd0: 656d 6f76 6520 7472 6169 6c69 6e67 2064  emove trailing d
+0000fce0: 6f74 7320 6672 6f6d 2070 6172 7473 2e22  ots from parts."
+0000fcf0: 2222 0d0a 2020 2020 2020 2020 7461 626c  ""..        tabl
+0000fd00: 6520 3d20 636c 732e 5f77 696e 646f 7773  e = cls._windows
+0000fd10: 5f69 6c6c 6567 616c 5f6e 616d 655f 7472  _illegal_name_tr
+0000fd20: 616e 735f 7461 626c 650d 0a20 2020 2020  ans_table..     
+0000fd30: 2020 2069 6620 6e6f 7420 7461 626c 653a     if not table:
+0000fd40: 0d0a 2020 2020 2020 2020 2020 2020 696c  ..            il
+0000fd50: 6c65 6761 6c20 3d20 273a 3c3e 7c22 3f2a  legal = ':<>|"?*
+0000fd60: 270d 0a20 2020 2020 2020 2020 2020 2074  '..            t
+0000fd70: 6162 6c65 203d 2073 7472 2e6d 616b 6574  able = str.maket
+0000fd80: 7261 6e73 2869 6c6c 6567 616c 2c20 225f  rans(illegal, "_
+0000fd90: 2220 2a20 6c65 6e28 696c 6c65 6761 6c29  " * len(illegal)
+0000fda0: 290d 0a20 2020 2020 2020 2020 2020 2063  )..            c
+0000fdb0: 6c73 2e5f 7769 6e64 6f77 735f 696c 6c65  ls._windows_ille
+0000fdc0: 6761 6c5f 6e61 6d65 5f74 7261 6e73 5f74  gal_name_trans_t
+0000fdd0: 6162 6c65 203d 2074 6162 6c65 0d0a 2020  able = table..  
+0000fde0: 2020 2020 2020 6172 636e 616d 6520 3d20        arcname = 
+0000fdf0: 6172 636e 616d 652e 7472 616e 736c 6174  arcname.translat
+0000fe00: 6528 7461 626c 6529 0d0a 2020 2020 2020  e(table)..      
+0000fe10: 2020 2320 7265 6d6f 7665 2074 7261 696c    # remove trail
+0000fe20: 696e 6720 646f 7473 0d0a 2020 2020 2020  ing dots..      
+0000fe30: 2020 6172 636e 616d 6520 3d20 2878 2e72    arcname = (x.r
+0000fe40: 7374 7269 7028 222e 2229 2066 6f72 2078  strip(".") for x
+0000fe50: 2069 6e20 6172 636e 616d 652e 7370 6c69   in arcname.spli
+0000fe60: 7428 7061 7468 7365 7029 290d 0a20 2020  t(pathsep))..   
+0000fe70: 2020 2020 2023 2072 656a 6f69 6e2c 2072       # rejoin, r
+0000fe80: 656d 6f76 696e 6720 656d 7074 7920 7061  emoving empty pa
+0000fe90: 7274 732e 0d0a 2020 2020 2020 2020 6172  rts...        ar
+0000fea0: 636e 616d 6520 3d20 7061 7468 7365 702e  cname = pathsep.
+0000feb0: 6a6f 696e 2878 2066 6f72 2078 2069 6e20  join(x for x in 
+0000fec0: 6172 636e 616d 6520 6966 2078 290d 0a20  arcname if x).. 
+0000fed0: 2020 2020 2020 2072 6574 7572 6e20 6172         return ar
+0000fee0: 636e 616d 650d 0a0d 0a20 2020 2064 6566  cname....    def
+0000fef0: 205f 6578 7472 6163 745f 6d65 6d62 6572   _extract_member
+0000ff00: 2873 656c 662c 206d 656d 6265 722c 2074  (self, member, t
+0000ff10: 6172 6765 7470 6174 682c 2070 7764 293a  argetpath, pwd):
+0000ff20: 0d0a 2020 2020 2020 2020 2222 2245 7874  ..        """Ext
+0000ff30: 7261 6374 2074 6865 205a 6970 496e 666f  ract the ZipInfo
+0000ff40: 206f 626a 6563 7420 276d 656d 6265 7227   object 'member'
+0000ff50: 2074 6f20 6120 7068 7973 6963 616c 0d0a   to a physical..
+0000ff60: 2020 2020 2020 2020 6669 6c65 206f 6e20          file on 
+0000ff70: 7468 6520 7061 7468 2074 6172 6765 7470  the path targetp
+0000ff80: 6174 682e 0d0a 2020 2020 2020 2020 2222  ath...        ""
+0000ff90: 220d 0a20 2020 2020 2020 2069 6620 6e6f  "..        if no
+0000ffa0: 7420 6973 696e 7374 616e 6365 286d 656d  t isinstance(mem
+0000ffb0: 6265 722c 205a 6970 496e 666f 293a 0d0a  ber, ZipInfo):..
+0000ffc0: 2020 2020 2020 2020 2020 2020 6d65 6d62              memb
+0000ffd0: 6572 203d 2073 656c 662e 6765 7469 6e66  er = self.getinf
+0000ffe0: 6f28 6d65 6d62 6572 290d 0a0d 0a20 2020  o(member)....   
+0000fff0: 2020 2020 2023 2062 7569 6c64 2074 6865       # build the
+00010000: 2064 6573 7469 6e61 7469 6f6e 2070 6174   destination pat
+00010010: 686e 616d 652c 2072 6570 6c61 6369 6e67  hname, replacing
+00010020: 0d0a 2020 2020 2020 2020 2320 666f 7277  ..        # forw
+00010030: 6172 6420 736c 6173 6865 7320 746f 2070  ard slashes to p
+00010040: 6c61 7466 6f72 6d20 7370 6563 6966 6963  latform specific
+00010050: 2073 6570 6172 6174 6f72 732e 0d0a 2020   separators...  
+00010060: 2020 2020 2020 6172 636e 616d 6520 3d20        arcname = 
+00010070: 6d65 6d62 6572 2e66 696c 656e 616d 652e  member.filename.
+00010080: 7265 706c 6163 6528 222f 222c 206f 732e  replace("/", os.
+00010090: 7061 7468 2e73 6570 290d 0a0d 0a20 2020  path.sep)....   
+000100a0: 2020 2020 2069 6620 6f73 2e70 6174 682e       if os.path.
+000100b0: 616c 7473 6570 3a0d 0a20 2020 2020 2020  altsep:..       
+000100c0: 2020 2020 2061 7263 6e61 6d65 203d 2061       arcname = a
+000100d0: 7263 6e61 6d65 2e72 6570 6c61 6365 286f  rcname.replace(o
+000100e0: 732e 7061 7468 2e61 6c74 7365 702c 206f  s.path.altsep, o
+000100f0: 732e 7061 7468 2e73 6570 290d 0a20 2020  s.path.sep)..   
+00010100: 2020 2020 2023 2069 6e74 6572 7072 6574       # interpret
+00010110: 2061 6273 6f6c 7574 6520 7061 7468 6e61   absolute pathna
+00010120: 6d65 2061 7320 7265 6c61 7469 7665 2c20  me as relative, 
+00010130: 7265 6d6f 7665 2064 7269 7665 206c 6574  remove drive let
+00010140: 7465 7220 6f72 0d0a 2020 2020 2020 2020  ter or..        
+00010150: 2320 554e 4320 7061 7468 2c20 7265 6475  # UNC path, redu
+00010160: 6e64 616e 7420 7365 7061 7261 746f 7273  ndant separators
+00010170: 2c20 222e 2220 616e 6420 222e 2e22 2063  , "." and ".." c
+00010180: 6f6d 706f 6e65 6e74 732e 0d0a 2020 2020  omponents...    
+00010190: 2020 2020 6172 636e 616d 6520 3d20 6f73      arcname = os
+000101a0: 2e70 6174 682e 7370 6c69 7464 7269 7665  .path.splitdrive
+000101b0: 2861 7263 6e61 6d65 295b 315d 0d0a 2020  (arcname)[1]..  
+000101c0: 2020 2020 2020 696e 7661 6c69 645f 7061        invalid_pa
+000101d0: 7468 5f70 6172 7473 203d 2028 2222 2c20  th_parts = ("", 
+000101e0: 6f73 2e70 6174 682e 6375 7264 6972 2c20  os.path.curdir, 
+000101f0: 6f73 2e70 6174 682e 7061 7264 6972 290d  os.path.pardir).
+00010200: 0a20 2020 2020 2020 2061 7263 6e61 6d65  .        arcname
+00010210: 203d 206f 732e 7061 7468 2e73 6570 2e6a   = os.path.sep.j
+00010220: 6f69 6e28 0d0a 2020 2020 2020 2020 2020  oin(..          
+00010230: 2020 780d 0a20 2020 2020 2020 2020 2020    x..           
+00010240: 2066 6f72 2078 2069 6e20 6172 636e 616d   for x in arcnam
+00010250: 652e 7370 6c69 7428 6f73 2e70 6174 682e  e.split(os.path.
+00010260: 7365 7029 0d0a 2020 2020 2020 2020 2020  sep)..          
+00010270: 2020 6966 2078 206e 6f74 2069 6e20 696e    if x not in in
+00010280: 7661 6c69 645f 7061 7468 5f70 6172 7473  valid_path_parts
+00010290: 0d0a 2020 2020 2020 2020 290d 0a20 2020  ..        )..   
+000102a0: 2020 2020 2069 6620 6f73 2e70 6174 682e       if os.path.
+000102b0: 7365 7020 3d3d 2022 5c5c 223a 0d0a 2020  sep == "\\":..  
+000102c0: 2020 2020 2020 2020 2020 2320 6669 6c74            # filt
+000102d0: 6572 2069 6c6c 6567 616c 2063 6861 7261  er illegal chara
+000102e0: 6374 6572 7320 6f6e 2057 696e 646f 7773  cters on Windows
+000102f0: 0d0a 2020 2020 2020 2020 2020 2020 6172  ..            ar
+00010300: 636e 616d 6520 3d20 7365 6c66 2e5f 7361  cname = self._sa
+00010310: 6e69 7469 7a65 5f77 696e 646f 7773 5f6e  nitize_windows_n
+00010320: 616d 6528 6172 636e 616d 652c 206f 732e  ame(arcname, os.
+00010330: 7061 7468 2e73 6570 290d 0a0d 0a20 2020  path.sep)....   
+00010340: 2020 2020 2074 6172 6765 7470 6174 6820       targetpath 
+00010350: 3d20 6f73 2e70 6174 682e 6a6f 696e 2874  = os.path.join(t
+00010360: 6172 6765 7470 6174 682c 2061 7263 6e61  argetpath, arcna
+00010370: 6d65 290d 0a20 2020 2020 2020 2074 6172  me)..        tar
+00010380: 6765 7470 6174 6820 3d20 6f73 2e70 6174  getpath = os.pat
+00010390: 682e 6e6f 726d 7061 7468 2874 6172 6765  h.normpath(targe
+000103a0: 7470 6174 6829 0d0a 0d0a 2020 2020 2020  tpath)....      
+000103b0: 2020 2320 4372 6561 7465 2061 6c6c 2075    # Create all u
+000103c0: 7070 6572 2064 6972 6563 746f 7269 6573  pper directories
+000103d0: 2069 6620 6e65 6365 7373 6172 792e 0d0a   if necessary...
+000103e0: 2020 2020 2020 2020 7570 7065 7264 6972          upperdir
+000103f0: 7320 3d20 6f73 2e70 6174 682e 6469 726e  s = os.path.dirn
+00010400: 616d 6528 7461 7267 6574 7061 7468 290d  ame(targetpath).
+00010410: 0a20 2020 2020 2020 2069 6620 7570 7065  .        if uppe
+00010420: 7264 6972 7320 616e 6420 6e6f 7420 6f73  rdirs and not os
+00010430: 2e70 6174 682e 6578 6973 7473 2875 7070  .path.exists(upp
+00010440: 6572 6469 7273 293a 0d0a 2020 2020 2020  erdirs):..      
+00010450: 2020 2020 2020 6f73 2e6d 616b 6564 6972        os.makedir
+00010460: 7328 7570 7065 7264 6972 7329 0d0a 0d0a  s(upperdirs)....
+00010470: 2020 2020 2020 2020 6966 206d 656d 6265          if membe
+00010480: 722e 6973 5f64 6972 2829 3a0d 0a20 2020  r.is_dir():..   
+00010490: 2020 2020 2020 2020 2069 6620 6e6f 7420           if not 
+000104a0: 6f73 2e70 6174 682e 6973 6469 7228 7461  os.path.isdir(ta
+000104b0: 7267 6574 7061 7468 293a 0d0a 2020 2020  rgetpath):..    
+000104c0: 2020 2020 2020 2020 2020 2020 6f73 2e6d              os.m
+000104d0: 6b64 6972 2874 6172 6765 7470 6174 6829  kdir(targetpath)
+000104e0: 0d0a 2020 2020 2020 2020 2020 2020 7265  ..            re
+000104f0: 7475 726e 2074 6172 6765 7470 6174 680d  turn targetpath.
+00010500: 0a0d 0a20 2020 2020 2020 2077 6974 6820  ...        with 
+00010510: 7365 6c66 2e6f 7065 6e28 6d65 6d62 6572  self.open(member
+00010520: 2c20 7077 643d 7077 6429 2061 7320 736f  , pwd=pwd) as so
+00010530: 7572 6365 2c20 6f70 656e 280d 0a20 2020  urce, open(..   
+00010540: 2020 2020 2020 2020 2074 6172 6765 7470           targetp
+00010550: 6174 682c 0d0a 2020 2020 2020 2020 2020  ath,..          
+00010560: 2020 2277 6222 2c0d 0a20 2020 2020 2020    "wb",..       
+00010570: 2029 2061 7320 7461 7267 6574 3a0d 0a20   ) as target:.. 
+00010580: 2020 2020 2020 2020 2020 2073 6875 7469             shuti
+00010590: 6c2e 636f 7079 6669 6c65 6f62 6a28 736f  l.copyfileobj(so
+000105a0: 7572 6365 2c20 7461 7267 6574 290d 0a0d  urce, target)...
+000105b0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+000105c0: 7461 7267 6574 7061 7468 0d0a 0d0a 2020  targetpath....  
+000105d0: 2020 6465 6620 5f72 656d 6f76 655f 6d65    def _remove_me
+000105e0: 6d62 6572 2873 656c 662c 206d 656d 6265  mber(self, membe
+000105f0: 7229 3a0d 0a20 2020 2020 2020 2023 2067  r):..        # g
+00010600: 6574 2061 2073 6f72 7465 6420 6669 6c65  et a sorted file
+00010610: 6c69 7374 2062 7920 6865 6164 6572 206f  list by header o
+00010620: 6666 7365 742c 2069 6e20 6361 7365 2074  ffset, in case t
+00010630: 6865 2064 6972 206f 7264 6572 0d0a 2020  he dir order..  
+00010640: 2020 2020 2020 2320 646f 6573 6e27 7420        # doesn't 
+00010650: 6d61 7463 6820 7468 6520 6163 7475 616c  match the actual
+00010660: 2065 6e74 7279 206f 7264 6572 0d0a 2020   entry order..  
+00010670: 2020 2020 2020 6670 203d 2073 656c 662e        fp = self.
+00010680: 6670 0d0a 2020 2020 2020 2020 656e 7472  fp..        entr
+00010690: 795f 6f66 6673 6574 203d 2030 0d0a 2020  y_offset = 0..  
+000106a0: 2020 2020 2020 6669 6c65 6c69 7374 203d        filelist =
+000106b0: 2073 6f72 7465 6428 7365 6c66 2e66 696c   sorted(self.fil
+000106c0: 656c 6973 742c 206b 6579 3d61 7474 7267  elist, key=attrg
+000106d0: 6574 7465 7228 2268 6561 6465 725f 6f66  etter("header_of
+000106e0: 6673 6574 2229 290d 0a20 2020 2020 2020  fset"))..       
+000106f0: 2066 6f72 2069 2069 6e20 7261 6e67 6528   for i in range(
+00010700: 6c65 6e28 6669 6c65 6c69 7374 2929 3a0d  len(filelist)):.
+00010710: 0a20 2020 2020 2020 2020 2020 2069 6e66  .            inf
+00010720: 6f20 3d20 6669 6c65 6c69 7374 5b69 5d0d  o = filelist[i].
+00010730: 0a20 2020 2020 2020 2020 2020 2023 2066  .            # f
+00010740: 696e 6420 7468 6520 7461 7267 6574 206d  ind the target m
+00010750: 656d 6265 720d 0a20 2020 2020 2020 2020  ember..         
+00010760: 2020 2069 6620 696e 666f 2e68 6561 6465     if info.heade
+00010770: 725f 6f66 6673 6574 203c 206d 656d 6265  r_offset < membe
+00010780: 722e 6865 6164 6572 5f6f 6666 7365 743a  r.header_offset:
+00010790: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+000107a0: 2020 636f 6e74 696e 7565 0d0a 0d0a 2020    continue....  
+000107b0: 2020 2020 2020 2020 2020 2320 6765 7420            # get 
+000107c0: 7468 6520 746f 7461 6c20 7369 7a65 206f  the total size o
+000107d0: 6620 7468 6520 656e 7472 790d 0a20 2020  f the entry..   
+000107e0: 2020 2020 2020 2020 2065 6e74 7279 5f73           entry_s
+000107f0: 697a 6520 3d20 4e6f 6e65 0d0a 2020 2020  ize = None..    
+00010800: 2020 2020 2020 2020 6966 2069 203d 3d20          if i == 
+00010810: 6c65 6e28 6669 6c65 6c69 7374 2920 2d20  len(filelist) - 
+00010820: 313a 0d0a 2020 2020 2020 2020 2020 2020  1:..            
+00010830: 2020 2020 656e 7472 795f 7369 7a65 203d      entry_size =
+00010840: 2073 656c 662e 7374 6172 745f 6469 7220   self.start_dir 
+00010850: 2d20 696e 666f 2e68 6561 6465 725f 6f66  - info.header_of
+00010860: 6673 6574 0d0a 2020 2020 2020 2020 2020  fset..          
+00010870: 2020 656c 7365 3a0d 0a20 2020 2020 2020    else:..       
+00010880: 2020 2020 2020 2020 2065 6e74 7279 5f73           entry_s
+00010890: 697a 6520 3d20 6669 6c65 6c69 7374 5b69  ize = filelist[i
+000108a0: 202b 2031 5d2e 6865 6164 6572 5f6f 6666   + 1].header_off
+000108b0: 7365 7420 2d20 696e 666f 2e68 6561 6465  set - info.heade
+000108c0: 725f 6f66 6673 6574 0d0a 0d0a 2020 2020  r_offset....    
+000108d0: 2020 2020 2020 2020 2320 666f 756e 6420          # found 
+000108e0: 7468 6520 6d65 6d62 6572 2c20 7365 7420  the member, set 
+000108f0: 7468 6520 656e 7472 7920 6f66 6673 6574  the entry offset
+00010900: 0d0a 2020 2020 2020 2020 2020 2020 6966  ..            if
+00010910: 206d 656d 6265 7220 3d3d 2069 6e66 6f3a   member == info:
+00010920: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00010930: 2020 656e 7472 795f 6f66 6673 6574 203d    entry_offset =
+00010940: 2065 6e74 7279 5f73 697a 650d 0a20 2020   entry_size..   
+00010950: 2020 2020 2020 2020 2020 2020 2063 6f6e               con
+00010960: 7469 6e75 650d 0a0d 0a20 2020 2020 2020  tinue....       
+00010970: 2020 2020 2023 204d 6f76 6520 656e 7472       # Move entr
+00010980: 790d 0a20 2020 2020 2020 2020 2020 2023  y..            #
+00010990: 2072 6561 6420 7468 6520 6163 7475 616c   read the actual
+000109a0: 2065 6e74 7279 2064 6174 610d 0a20 2020   entry data..   
+000109b0: 2020 2020 2020 2020 2066 702e 7365 656b           fp.seek
+000109c0: 2869 6e66 6f2e 6865 6164 6572 5f6f 6666  (info.header_off
+000109d0: 7365 7429 0d0a 2020 2020 2020 2020 2020  set)..          
+000109e0: 2020 656e 7472 795f 6461 7461 203d 2066    entry_data = f
+000109f0: 702e 7265 6164 2865 6e74 7279 5f73 697a  p.read(entry_siz
+00010a00: 6529 0d0a 0d0a 2020 2020 2020 2020 2020  e)....          
+00010a10: 2020 2320 7570 6461 7465 2074 6865 2068    # update the h
+00010a20: 6561 6465 720d 0a20 2020 2020 2020 2020  eader..         
+00010a30: 2020 2069 6e66 6f2e 6865 6164 6572 5f6f     info.header_o
+00010a40: 6666 7365 7420 2d3d 2065 6e74 7279 5f6f  ffset -= entry_o
+00010a50: 6666 7365 740d 0a0d 0a20 2020 2020 2020  ffset....       
+00010a60: 2020 2020 2023 2077 7269 7465 2074 6865       # write the
+00010a70: 2065 6e74 7279 2074 6f20 7468 6520 6e65   entry to the ne
+00010a80: 7720 706f 7369 7469 6f6e 0d0a 2020 2020  w position..    
+00010a90: 2020 2020 2020 2020 6670 2e73 6565 6b28          fp.seek(
+00010aa0: 696e 666f 2e68 6561 6465 725f 6f66 6673  info.header_offs
+00010ab0: 6574 290d 0a20 2020 2020 2020 2020 2020  et)..           
+00010ac0: 2066 702e 7772 6974 6528 656e 7472 795f   fp.write(entry_
+00010ad0: 6461 7461 290d 0a20 2020 2020 2020 2020  data)..         
+00010ae0: 2020 2066 702e 666c 7573 6828 290d 0a0d     fp.flush()...
+00010af0: 0a20 2020 2020 2020 2023 2075 7064 6174  .        # updat
+00010b00: 6520 7374 6174 650d 0a20 2020 2020 2020  e state..       
+00010b10: 2073 656c 662e 7374 6172 745f 6469 7220   self.start_dir 
+00010b20: 2d3d 2065 6e74 7279 5f6f 6666 7365 740d  -= entry_offset.
+00010b30: 0a20 2020 2020 2020 2073 656c 662e 6669  .        self.fi
+00010b40: 6c65 6c69 7374 2e72 656d 6f76 6528 6d65  lelist.remove(me
+00010b50: 6d62 6572 290d 0a20 2020 2020 2020 2064  mber)..        d
+00010b60: 656c 2073 656c 662e 4e61 6d65 546f 496e  el self.NameToIn
+00010b70: 666f 5b6d 656d 6265 722e 6669 6c65 6e61  fo[member.filena
+00010b80: 6d65 5d0d 0a20 2020 2020 2020 2073 656c  me]..        sel
+00010b90: 662e 5f64 6964 4d6f 6469 6679 203d 2054  f._didModify = T
+00010ba0: 7275 650d 0a0d 0a20 2020 2020 2020 2023  rue....        #
+00010bb0: 2073 6565 6b20 746f 2074 6865 2073 7461   seek to the sta
+00010bc0: 7274 206f 6620 7468 6520 6365 6e74 7261  rt of the centra
+00010bd0: 6c20 6469 720d 0a20 2020 2020 2020 2066  l dir..        f
+00010be0: 702e 7365 656b 2873 656c 662e 7374 6172  p.seek(self.star
+00010bf0: 745f 6469 7229 0d0a 0d0a 2020 2020 6465  t_dir)....    de
+00010c00: 6620 5f77 7269 7465 6368 6563 6b28 7365  f _writecheck(se
+00010c10: 6c66 2c20 7a69 6e66 6f29 3a0d 0a20 2020  lf, zinfo):..   
+00010c20: 2020 2020 2022 2222 4368 6563 6b20 666f       """Check fo
+00010c30: 7220 6572 726f 7273 2062 6566 6f72 6520  r errors before 
+00010c40: 7772 6974 696e 6720 6120 6669 6c65 2074  writing a file t
+00010c50: 6f20 7468 6520 6172 6368 6976 652e 2222  o the archive.""
+00010c60: 220d 0a20 2020 2020 2020 2069 6620 7a69  "..        if zi
+00010c70: 6e66 6f2e 6669 6c65 6e61 6d65 2069 6e20  nfo.filename in 
+00010c80: 7365 6c66 2e4e 616d 6554 6f49 6e66 6f3a  self.NameToInfo:
+00010c90: 0d0a 2020 2020 2020 2020 2020 2020 696d  ..            im
+00010ca0: 706f 7274 2077 6172 6e69 6e67 730d 0a0d  port warnings...
+00010cb0: 0a20 2020 2020 2020 2020 2020 2077 6172  .            war
+00010cc0: 6e69 6e67 732e 7761 726e 2822 4475 706c  nings.warn("Dupl
+00010cd0: 6963 6174 6520 6e61 6d65 3a20 2572 2220  icate name: %r" 
+00010ce0: 2520 7a69 6e66 6f2e 6669 6c65 6e61 6d65  % zinfo.filename
+00010cf0: 2c20 7374 6163 6b6c 6576 656c 3d33 290d  , stacklevel=3).
+00010d00: 0a20 2020 2020 2020 2069 6620 7365 6c66  .        if self
+00010d10: 2e6d 6f64 6520 6e6f 7420 696e 2028 2277  .mode not in ("w
+00010d20: 222c 2022 7822 2c20 2261 2229 3a0d 0a20  ", "x", "a"):.. 
+00010d30: 2020 2020 2020 2020 2020 2072 6169 7365             raise
+00010d40: 2056 616c 7565 4572 726f 7228 2277 7269   ValueError("wri
+00010d50: 7465 2829 2072 6571 7569 7265 7320 6d6f  te() requires mo
+00010d60: 6465 2027 7727 2c20 2778 272c 206f 7220  de 'w', 'x', or 
+00010d70: 2761 2722 290d 0a20 2020 2020 2020 2069  'a'")..        i
+00010d80: 6620 6e6f 7420 7365 6c66 2e66 703a 0d0a  f not self.fp:..
+00010d90: 2020 2020 2020 2020 2020 2020 7261 6973              rais
+00010da0: 6520 5661 6c75 6545 7272 6f72 280d 0a20  e ValueError(.. 
+00010db0: 2020 2020 2020 2020 2020 2020 2020 2022                 "
+00010dc0: 4174 7465 6d70 7420 746f 2077 7269 7465  Attempt to write
+00010dd0: 205a 4950 2061 7263 6869 7665 2074 6861   ZIP archive tha
+00010de0: 7420 7761 7320 616c 7265 6164 7920 636c  t was already cl
+00010df0: 6f73 6564 222c 0d0a 2020 2020 2020 2020  osed",..        
+00010e00: 2020 2020 290d 0a20 2020 2020 2020 205f      )..        _
+00010e10: 6368 6563 6b5f 636f 6d70 7265 7373 696f  check_compressio
+00010e20: 6e28 7a69 6e66 6f2e 636f 6d70 7265 7373  n(zinfo.compress
+00010e30: 5f74 7970 6529 0d0a 2020 2020 2020 2020  _type)..        
+00010e40: 6966 206e 6f74 2073 656c 662e 5f61 6c6c  if not self._all
+00010e50: 6f77 5a69 7036 343a 0d0a 2020 2020 2020  owZip64:..      
+00010e60: 2020 2020 2020 7265 7175 6972 6573 5f7a        requires_z
+00010e70: 6970 3634 203d 204e 6f6e 650d 0a20 2020  ip64 = None..   
+00010e80: 2020 2020 2020 2020 2069 6620 6c65 6e28           if len(
+00010e90: 7365 6c66 2e66 696c 656c 6973 7429 203e  self.filelist) >
+00010ea0: 3d20 5a49 505f 4649 4c45 434f 554e 545f  = ZIP_FILECOUNT_
+00010eb0: 4c49 4d49 543a 0d0a 2020 2020 2020 2020  LIMIT:..        
+00010ec0: 2020 2020 2020 2020 7265 7175 6972 6573          requires
+00010ed0: 5f7a 6970 3634 203d 2022 4669 6c65 7320  _zip64 = "Files 
+00010ee0: 636f 756e 7422 0d0a 2020 2020 2020 2020  count"..        
+00010ef0: 2020 2020 656c 6966 207a 696e 666f 2e66      elif zinfo.f
+00010f00: 696c 655f 7369 7a65 203e 205a 4950 3634  ile_size > ZIP64
+00010f10: 5f4c 494d 4954 3a0d 0a20 2020 2020 2020  _LIMIT:..       
+00010f20: 2020 2020 2020 2020 2072 6571 7569 7265           require
+00010f30: 735f 7a69 7036 3420 3d20 2246 696c 6573  s_zip64 = "Files
+00010f40: 697a 6522 0d0a 2020 2020 2020 2020 2020  ize"..          
+00010f50: 2020 656c 6966 207a 696e 666f 2e68 6561    elif zinfo.hea
+00010f60: 6465 725f 6f66 6673 6574 203e 205a 4950  der_offset > ZIP
+00010f70: 3634 5f4c 494d 4954 3a0d 0a20 2020 2020  64_LIMIT:..     
+00010f80: 2020 2020 2020 2020 2020 2072 6571 7569             requi
+00010f90: 7265 735f 7a69 7036 3420 3d20 225a 6970  res_zip64 = "Zip
+00010fa0: 6669 6c65 2073 697a 6522 0d0a 2020 2020  file size"..    
+00010fb0: 2020 2020 2020 2020 6966 2072 6571 7569          if requi
+00010fc0: 7265 735f 7a69 7036 343a 0d0a 2020 2020  res_zip64:..    
+00010fd0: 2020 2020 2020 2020 2020 2020 7261 6973              rais
+00010fe0: 6520 4c61 7267 655a 6970 4669 6c65 280d  e LargeZipFile(.
+00010ff0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00011000: 2020 2020 2072 6571 7569 7265 735f 7a69       requires_zi
+00011010: 7036 3420 2b20 2220 776f 756c 6420 7265  p64 + " would re
+00011020: 7175 6972 6520 5a49 5036 3420 6578 7465  quire ZIP64 exte
+00011030: 6e73 696f 6e73 222c 0d0a 2020 2020 2020  nsions",..      
+00011040: 2020 2020 2020 2020 2020 290d 0a0d 0a20            ).... 
+00011050: 2020 2064 6566 2077 7269 7465 280d 0a20     def write(.. 
+00011060: 2020 2020 2020 2073 656c 662c 0d0a 2020         self,..  
+00011070: 2020 2020 2020 6669 6c65 6e61 6d65 2c0d        filename,.
+00011080: 0a20 2020 2020 2020 2061 7263 6e61 6d65  .        arcname
+00011090: 3d4e 6f6e 652c 0d0a 2020 2020 2020 2020  =None,..        
+000110a0: 636f 6d70 7265 7373 5f74 7970 653d 4e6f  compress_type=No
+000110b0: 6e65 2c0d 0a20 2020 2020 2020 2063 6f6d  ne,..        com
+000110c0: 7072 6573 736c 6576 656c 3d4e 6f6e 652c  presslevel=None,
+000110d0: 0d0a 2020 2020 293a 0d0a 2020 2020 2020  ..    ):..      
+000110e0: 2020 2222 2250 7574 2074 6865 2062 7974    """Put the byt
+000110f0: 6573 2066 726f 6d20 6669 6c65 6e61 6d65  es from filename
+00011100: 2069 6e74 6f20 7468 6520 6172 6368 6976   into the archiv
+00011110: 6520 756e 6465 7220 7468 6520 6e61 6d65  e under the name
+00011120: 0d0a 2020 2020 2020 2020 6172 636e 616d  ..        arcnam
+00011130: 652e 0d0a 2020 2020 2020 2020 2222 220d  e...        """.
+00011140: 0a20 2020 2020 2020 2069 6620 6e6f 7420  .        if not 
+00011150: 7365 6c66 2e66 703a 0d0a 2020 2020 2020  self.fp:..      
+00011160: 2020 2020 2020 7261 6973 6520 5661 6c75        raise Valu
+00011170: 6545 7272 6f72 280d 0a20 2020 2020 2020  eError(..       
+00011180: 2020 2020 2020 2020 2022 4174 7465 6d70           "Attemp
+00011190: 7420 746f 2077 7269 7465 2074 6f20 5a49  t to write to ZI
+000111a0: 5020 6172 6368 6976 6520 7468 6174 2077  P archive that w
+000111b0: 6173 2061 6c72 6561 6479 2063 6c6f 7365  as already close
+000111c0: 6422 2c0d 0a20 2020 2020 2020 2020 2020  d",..           
+000111d0: 2029 0d0a 2020 2020 2020 2020 6966 2073   )..        if s
+000111e0: 656c 662e 5f77 7269 7469 6e67 3a0d 0a20  elf._writing:.. 
+000111f0: 2020 2020 2020 2020 2020 2072 6169 7365             raise
+00011200: 2056 616c 7565 4572 726f 7228 0d0a 2020   ValueError(..  
+00011210: 2020 2020 2020 2020 2020 2020 2020 2243                "C
+00011220: 616e 2774 2077 7269 7465 2074 6f20 5a49  an't write to ZI
+00011230: 5020 6172 6368 6976 6520 7768 696c 6520  P archive while 
+00011240: 616e 206f 7065 6e20 7772 6974 696e 6720  an open writing 
+00011250: 6861 6e64 6c65 2065 7869 7374 7322 2c0d  handle exists",.
+00011260: 0a20 2020 2020 2020 2020 2020 2029 0d0a  .            )..
+00011270: 0d0a 2020 2020 2020 2020 7a69 6e66 6f20  ..        zinfo 
+00011280: 3d20 5a69 7049 6e66 6f2e 6672 6f6d 5f66  = ZipInfo.from_f
+00011290: 696c 6528 0d0a 2020 2020 2020 2020 2020  ile(..          
+000112a0: 2020 6669 6c65 6e61 6d65 2c0d 0a20 2020    filename,..   
+000112b0: 2020 2020 2020 2020 2061 7263 6e61 6d65           arcname
+000112c0: 2c0d 0a20 2020 2020 2020 2020 2020 2073  ,..            s
+000112d0: 7472 6963 745f 7469 6d65 7374 616d 7073  trict_timestamps
+000112e0: 3d73 656c 662e 5f73 7472 6963 745f 7469  =self._strict_ti
+000112f0: 6d65 7374 616d 7073 2c0d 0a20 2020 2020  mestamps,..     
+00011300: 2020 2029 0d0a 0d0a 2020 2020 2020 2020     )....        
+00011310: 6966 207a 696e 666f 2e69 735f 6469 7228  if zinfo.is_dir(
+00011320: 293a 0d0a 2020 2020 2020 2020 2020 2020  ):..            
+00011330: 7a69 6e66 6f2e 636f 6d70 7265 7373 5f73  zinfo.compress_s
+00011340: 697a 6520 3d20 300d 0a20 2020 2020 2020  ize = 0..       
+00011350: 2020 2020 207a 696e 666f 2e43 5243 203d       zinfo.CRC =
+00011360: 2030 0d0a 2020 2020 2020 2020 656c 7365   0..        else
+00011370: 3a0d 0a20 2020 2020 2020 2020 2020 2069  :..            i
+00011380: 6620 636f 6d70 7265 7373 5f74 7970 6520  f compress_type 
+00011390: 6973 206e 6f74 204e 6f6e 653a 0d0a 2020  is not None:..  
+000113a0: 2020 2020 2020 2020 2020 2020 2020 7a69                zi
+000113b0: 6e66 6f2e 636f 6d70 7265 7373 5f74 7970  nfo.compress_typ
+000113c0: 6520 3d20 636f 6d70 7265 7373 5f74 7970  e = compress_typ
+000113d0: 650d 0a20 2020 2020 2020 2020 2020 2065  e..            e
+000113e0: 6c73 653a 0d0a 2020 2020 2020 2020 2020  lse:..          
+000113f0: 2020 2020 2020 7a69 6e66 6f2e 636f 6d70        zinfo.comp
+00011400: 7265 7373 5f74 7970 6520 3d20 7365 6c66  ress_type = self
+00011410: 2e63 6f6d 7072 6573 7369 6f6e 0d0a 0d0a  .compression....
+00011420: 2020 2020 2020 2020 2020 2020 6966 2063              if c
+00011430: 6f6d 7072 6573 736c 6576 656c 2069 7320  ompresslevel is 
+00011440: 6e6f 7420 4e6f 6e65 3a0d 0a20 2020 2020  not None:..     
+00011450: 2020 2020 2020 2020 2020 207a 696e 666f             zinfo
+00011460: 2e5f 636f 6d70 7265 7373 6c65 7665 6c20  ._compresslevel 
+00011470: 3d20 636f 6d70 7265 7373 6c65 7665 6c0d  = compresslevel.
+00011480: 0a20 2020 2020 2020 2020 2020 2065 6c73  .            els
 00011490: 653a 0d0a 2020 2020 2020 2020 2020 2020  e:..            
-000114a0: 7a69 6e66 6f2e 5f63 6f6d 7072 6573 736c  zinfo._compressl
-000114b0: 6576 656c 203d 2063 6f6d 7072 6573 736c  evel = compressl
-000114c0: 6576 656c 0d0a 0d0a 2020 2020 2020 2020  evel....        
-000114d0: 7a69 6e66 6f2e 6669 6c65 5f73 697a 6520  zinfo.file_size 
-000114e0: 3d20 6c65 6e28 6461 7461 2920 2023 2055  = len(data)  # U
-000114f0: 6e63 6f6d 7072 6573 7365 6420 7369 7a65  ncompressed size
-00011500: 0d0a 2020 2020 2020 2020 7769 7468 2073  ..        with s
-00011510: 656c 662e 5f6c 6f63 6b2c 2073 656c 662e  elf._lock, self.
-00011520: 6f70 656e 287a 696e 666f 2c20 6d6f 6465  open(zinfo, mode
-00011530: 3d22 7722 2920 6173 2064 6573 743a 0d0a  ="w") as dest:..
-00011540: 2020 2020 2020 2020 2020 2020 6465 7374              dest
-00011550: 2e77 7269 7465 2864 6174 6129 0d0a 0d0a  .write(data)....
-00011560: 2020 2020 6465 6620 5f5f 6465 6c5f 5f28      def __del__(
-00011570: 7365 6c66 2920 2d3e 204e 6f6e 653a 0d0a  self) -> None:..
-00011580: 2020 2020 2020 2020 2222 2243 616c 6c20          """Call 
-00011590: 7468 6520 2263 6c6f 7365 2829 2220 6d65  the "close()" me
-000115a0: 7468 6f64 2069 6e20 6361 7365 2074 6865  thod in case the
-000115b0: 2075 7365 7220 666f 7267 6f74 2e22 2222   user forgot."""
-000115c0: 0d0a 2020 2020 2020 2020 7365 6c66 2e63  ..        self.c
-000115d0: 6c6f 7365 2829 0d0a 0d0a 2020 2020 6465  lose()....    de
-000115e0: 6620 636c 6f73 6528 7365 6c66 293a 0d0a  f close(self):..
-000115f0: 2020 2020 2020 2020 2222 2243 6c6f 7365          """Close
-00011600: 2074 6865 2066 696c 652c 2061 6e64 2066   the file, and f
-00011610: 6f72 206d 6f64 6520 2777 272c 2027 7827  or mode 'w', 'x'
-00011620: 2061 6e64 2027 6127 2077 7269 7465 2074   and 'a' write t
-00011630: 6865 2065 6e64 696e 670d 0a20 2020 2020  he ending..     
-00011640: 2020 2072 6563 6f72 6473 2e0d 0a20 2020     records...   
-00011650: 2020 2020 2022 2222 0d0a 2020 2020 2020       """..      
-00011660: 2020 6966 2073 656c 662e 6670 2069 7320    if self.fp is 
-00011670: 4e6f 6e65 3a0d 0a20 2020 2020 2020 2020  None:..         
-00011680: 2020 2072 6574 7572 6e0d 0a0d 0a20 2020     return....   
-00011690: 2020 2020 2069 6620 7365 6c66 2e5f 7772       if self._wr
-000116a0: 6974 696e 673a 0d0a 2020 2020 2020 2020  iting:..        
-000116b0: 2020 2020 7261 6973 6520 5661 6c75 6545      raise ValueE
-000116c0: 7272 6f72 280d 0a20 2020 2020 2020 2020  rror(..         
-000116d0: 2020 2020 2020 2022 4361 6e27 7420 636c         "Can't cl
-000116e0: 6f73 6520 7468 6520 5a49 5020 6669 6c65  ose the ZIP file
-000116f0: 2077 6869 6c65 2074 6865 7265 2069 7320   while there is 
-00011700: 220d 0a20 2020 2020 2020 2020 2020 2020  "..             
-00011710: 2020 2022 616e 206f 7065 6e20 7772 6974     "an open writ
-00011720: 696e 6720 6861 6e64 6c65 206f 6e20 6974  ing handle on it
-00011730: 2e20 220d 0a20 2020 2020 2020 2020 2020  . "..           
-00011740: 2020 2020 2022 436c 6f73 6520 7468 6520       "Close the 
-00011750: 7772 6974 696e 6720 6861 6e64 6c65 2062  writing handle b
-00011760: 6566 6f72 6520 636c 6f73 696e 6720 7468  efore closing th
-00011770: 6520 7a69 702e 222c 0d0a 2020 2020 2020  e zip.",..      
-00011780: 2020 2020 2020 290d 0a0d 0a20 2020 2020        )....     
-00011790: 2020 2074 7279 3a0d 0a20 2020 2020 2020     try:..       
-000117a0: 2020 2020 2069 6620 280d 0a20 2020 2020       if (..     
-000117b0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-000117c0: 6d6f 6465 2069 6e20 2822 7722 2c20 2278  mode in ("w", "x
-000117d0: 222c 2022 6122 2920 616e 6420 7365 6c66  ", "a") and self
-000117e0: 2e5f 6469 644d 6f64 6966 790d 0a20 2020  ._didModify..   
-000117f0: 2020 2020 2020 2020 2029 3a20 2023 2077           ):  # w
-00011800: 7269 7465 2065 6e64 696e 6720 7265 636f  rite ending reco
-00011810: 7264 730d 0a20 2020 2020 2020 2020 2020  rds..           
-00011820: 2020 2020 2077 6974 6820 7365 6c66 2e5f       with self._
-00011830: 6c6f 636b 3a0d 0a20 2020 2020 2020 2020  lock:..         
-00011840: 2020 2020 2020 2020 2020 2069 6620 7365             if se
-00011850: 6c66 2e5f 7365 656b 6162 6c65 3a0d 0a20  lf._seekable:.. 
-00011860: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011870: 2020 2020 2020 2073 656c 662e 6670 2e73         self.fp.s
-00011880: 6565 6b28 7365 6c66 2e73 7461 7274 5f64  eek(self.start_d
-00011890: 6972 290d 0a20 2020 2020 2020 2020 2020  ir)..           
-000118a0: 2020 2020 2020 2020 2073 656c 662e 5f77           self._w
-000118b0: 7269 7465 5f65 6e64 5f72 6563 6f72 6428  rite_end_record(
-000118c0: 290d 0a20 2020 2020 2020 2066 696e 616c  )..        final
-000118d0: 6c79 3a0d 0a20 2020 2020 2020 2020 2020  ly:..           
-000118e0: 2066 7020 3d20 7365 6c66 2e66 700d 0a20   fp = self.fp.. 
-000118f0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-00011900: 6670 203d 204e 6f6e 650d 0a20 2020 2020  fp = None..     
-00011910: 2020 2020 2020 2073 656c 662e 5f66 7063         self._fpc
-00011920: 6c6f 7365 2866 7029 0d0a 0d0a 2020 2020  lose(fp)....    
-00011930: 6465 6620 5f77 7269 7465 5f65 6e64 5f72  def _write_end_r
-00011940: 6563 6f72 6428 7365 6c66 293a 0d0a 2020  ecord(self):..  
-00011950: 2020 2020 2020 666f 7220 7a69 6e66 6f20        for zinfo 
-00011960: 696e 2073 656c 662e 6669 6c65 6c69 7374  in self.filelist
-00011970: 3a20 2023 2077 7269 7465 2063 656e 7472  :  # write centr
-00011980: 616c 2064 6972 6563 746f 7279 0d0a 2020  al directory..  
-00011990: 2020 2020 2020 2020 2020 6474 203d 207a            dt = z
-000119a0: 696e 666f 2e64 6174 655f 7469 6d65 0d0a  info.date_time..
-000119b0: 2020 2020 2020 2020 2020 2020 646f 7364              dosd
-000119c0: 6174 6520 3d20 2864 745b 305d 202d 2031  ate = (dt[0] - 1
-000119d0: 3938 3029 203c 3c20 3920 7c20 6474 5b31  980) << 9 | dt[1
-000119e0: 5d20 3c3c 2035 207c 2064 745b 325d 0d0a  ] << 5 | dt[2]..
-000119f0: 2020 2020 2020 2020 2020 2020 646f 7374              dost
-00011a00: 696d 6520 3d20 6474 5b33 5d20 3c3c 2031  ime = dt[3] << 1
-00011a10: 3120 7c20 6474 5b34 5d20 3c3c 2035 207c  1 | dt[4] << 5 |
-00011a20: 2028 6474 5b35 5d20 2f2f 2032 290d 0a20   (dt[5] // 2).. 
-00011a30: 2020 2020 2020 2020 2020 2065 7874 7261             extra
-00011a40: 203d 205b 5d0d 0a20 2020 2020 2020 2020   = []..         
-00011a50: 2020 2069 6620 280d 0a20 2020 2020 2020     if (..       
-00011a60: 2020 2020 2020 2020 207a 696e 666f 2e66           zinfo.f
-00011a70: 696c 655f 7369 7a65 203e 205a 4950 3634  ile_size > ZIP64
-00011a80: 5f4c 494d 4954 0d0a 2020 2020 2020 2020  _LIMIT..        
-00011a90: 2020 2020 2020 2020 6f72 207a 696e 666f          or zinfo
-00011aa0: 2e63 6f6d 7072 6573 735f 7369 7a65 203e  .compress_size >
-00011ab0: 205a 4950 3634 5f4c 494d 4954 0d0a 2020   ZIP64_LIMIT..  
-00011ac0: 2020 2020 2020 2020 2020 293a 0d0a 2020            ):..  
-00011ad0: 2020 2020 2020 2020 2020 2020 2020 6578                ex
-00011ae0: 7472 612e 6170 7065 6e64 287a 696e 666f  tra.append(zinfo
-00011af0: 2e66 696c 655f 7369 7a65 290d 0a20 2020  .file_size)..   
-00011b00: 2020 2020 2020 2020 2020 2020 2065 7874               ext
-00011b10: 7261 2e61 7070 656e 6428 7a69 6e66 6f2e  ra.append(zinfo.
-00011b20: 636f 6d70 7265 7373 5f73 697a 6529 0d0a  compress_size)..
-00011b30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011b40: 6669 6c65 5f73 697a 6520 3d20 3078 4646  file_size = 0xFF
-00011b50: 4646 4646 4646 0d0a 2020 2020 2020 2020  FFFFFF..        
-00011b60: 2020 2020 2020 2020 636f 6d70 7265 7373          compress
-00011b70: 5f73 697a 6520 3d20 3078 4646 4646 4646  _size = 0xFFFFFF
-00011b80: 4646 0d0a 2020 2020 2020 2020 2020 2020  FF..            
-00011b90: 656c 7365 3a0d 0a20 2020 2020 2020 2020  else:..         
-00011ba0: 2020 2020 2020 2066 696c 655f 7369 7a65         file_size
-00011bb0: 203d 207a 696e 666f 2e66 696c 655f 7369   = zinfo.file_si
-00011bc0: 7a65 0d0a 2020 2020 2020 2020 2020 2020  ze..            
-00011bd0: 2020 2020 636f 6d70 7265 7373 5f73 697a      compress_siz
-00011be0: 6520 3d20 7a69 6e66 6f2e 636f 6d70 7265  e = zinfo.compre
-00011bf0: 7373 5f73 697a 650d 0a0d 0a20 2020 2020  ss_size....     
-00011c00: 2020 2020 2020 2069 6620 7a69 6e66 6f2e         if zinfo.
-00011c10: 6865 6164 6572 5f6f 6666 7365 7420 3e20  header_offset > 
-00011c20: 5a49 5036 345f 4c49 4d49 543a 0d0a 2020  ZIP64_LIMIT:..  
-00011c30: 2020 2020 2020 2020 2020 2020 2020 6578                ex
-00011c40: 7472 612e 6170 7065 6e64 287a 696e 666f  tra.append(zinfo
-00011c50: 2e68 6561 6465 725f 6f66 6673 6574 290d  .header_offset).
-00011c60: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00011c70: 2068 6561 6465 725f 6f66 6673 6574 203d   header_offset =
-00011c80: 2030 7846 4646 4646 4646 460d 0a20 2020   0xFFFFFFFF..   
-00011c90: 2020 2020 2020 2020 2065 6c73 653a 0d0a           else:..
-00011ca0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011cb0: 6865 6164 6572 5f6f 6666 7365 7420 3d20  header_offset = 
-00011cc0: 7a69 6e66 6f2e 6865 6164 6572 5f6f 6666  zinfo.header_off
-00011cd0: 7365 740d 0a0d 0a20 2020 2020 2020 2020  set....         
-00011ce0: 2020 2065 7874 7261 5f64 6174 6120 3d20     extra_data = 
-00011cf0: 7a69 6e66 6f2e 6578 7472 610d 0a20 2020  zinfo.extra..   
-00011d00: 2020 2020 2020 2020 206d 696e 5f76 6572           min_ver
-00011d10: 7369 6f6e 203d 2030 0d0a 2020 2020 2020  sion = 0..      
-00011d20: 2020 2020 2020 6966 2065 7874 7261 3a0d        if extra:.
-00011d30: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00011d40: 2023 2041 7070 656e 6420 6120 5a49 5036   # Append a ZIP6
-00011d50: 3420 6669 656c 6420 746f 2074 6865 2065  4 field to the e
-00011d60: 7874 7261 2773 0d0a 2020 2020 2020 2020  xtra's..        
-00011d70: 2020 2020 2020 2020 6578 7472 615f 6461          extra_da
-00011d80: 7461 203d 205f 7374 7269 705f 6578 7472  ta = _strip_extr
-00011d90: 6128 6578 7472 615f 6461 7461 2c20 2831  a(extra_data, (1
-00011da0: 2c29 290d 0a20 2020 2020 2020 2020 2020  ,))..           
-00011db0: 2020 2020 2065 7874 7261 5f64 6174 6120       extra_data 
-00011dc0: 3d20 280d 0a20 2020 2020 2020 2020 2020  = (..           
-00011dd0: 2020 2020 2020 2020 2073 7472 7563 742e           struct.
-00011de0: 7061 636b 280d 0a20 2020 2020 2020 2020  pack(..         
-00011df0: 2020 2020 2020 2020 2020 2020 2020 2022                 "
-00011e00: 3c48 4822 202b 2022 5122 202a 206c 656e  <HH" + "Q" * len
-00011e10: 2865 7874 7261 292c 0d0a 2020 2020 2020  (extra),..      
-00011e20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011e30: 2020 312c 0d0a 2020 2020 2020 2020 2020    1,..          
-00011e40: 2020 2020 2020 2020 2020 2020 2020 3820                8 
-00011e50: 2a20 6c65 6e28 6578 7472 6129 2c0d 0a20  * len(extra),.. 
-00011e60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011e70: 2020 2020 2020 202a 6578 7472 612c 0d0a         *extra,..
-00011e80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011e90: 2020 2020 290d 0a20 2020 2020 2020 2020      )..         
-00011ea0: 2020 2020 2020 2020 2020 202b 2065 7874             + ext
-00011eb0: 7261 5f64 6174 610d 0a20 2020 2020 2020  ra_data..       
-00011ec0: 2020 2020 2020 2020 2029 0d0a 0d0a 2020           )....  
-00011ed0: 2020 2020 2020 2020 2020 2020 2020 6d69                mi
-00011ee0: 6e5f 7665 7273 696f 6e20 3d20 5a49 5036  n_version = ZIP6
-00011ef0: 345f 5645 5253 494f 4e0d 0a0d 0a20 2020  4_VERSION....   
-00011f00: 2020 2020 2020 2020 2069 6620 7a69 6e66           if zinf
-00011f10: 6f2e 636f 6d70 7265 7373 5f74 7970 6520  o.compress_type 
-00011f20: 3d3d 205a 4950 5f42 5a49 5032 3a0d 0a20  == ZIP_BZIP2:.. 
-00011f30: 2020 2020 2020 2020 2020 2020 2020 206d                 m
-00011f40: 696e 5f76 6572 7369 6f6e 203d 206d 6178  in_version = max
-00011f50: 2842 5a49 5032 5f56 4552 5349 4f4e 2c20  (BZIP2_VERSION, 
-00011f60: 6d69 6e5f 7665 7273 696f 6e29 0d0a 2020  min_version)..  
-00011f70: 2020 2020 2020 2020 2020 656c 6966 207a            elif z
-00011f80: 696e 666f 2e63 6f6d 7072 6573 735f 7479  info.compress_ty
-00011f90: 7065 203d 3d20 5a49 505f 4c5a 4d41 3a0d  pe == ZIP_LZMA:.
-00011fa0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00011fb0: 206d 696e 5f76 6572 7369 6f6e 203d 206d   min_version = m
-00011fc0: 6178 284c 5a4d 415f 5645 5253 494f 4e2c  ax(LZMA_VERSION,
-00011fd0: 206d 696e 5f76 6572 7369 6f6e 290d 0a0d   min_version)...
-00011fe0: 0a20 2020 2020 2020 2020 2020 2065 7874  .            ext
-00011ff0: 7261 6374 5f76 6572 7369 6f6e 203d 206d  ract_version = m
-00012000: 6178 286d 696e 5f76 6572 7369 6f6e 2c20  ax(min_version, 
-00012010: 7a69 6e66 6f2e 6578 7472 6163 745f 7665  zinfo.extract_ve
-00012020: 7273 696f 6e29 0d0a 2020 2020 2020 2020  rsion)..        
-00012030: 2020 2020 6372 6561 7465 5f76 6572 7369      create_versi
-00012040: 6f6e 203d 206d 6178 286d 696e 5f76 6572  on = max(min_ver
-00012050: 7369 6f6e 2c20 7a69 6e66 6f2e 6372 6561  sion, zinfo.crea
-00012060: 7465 5f76 6572 7369 6f6e 290d 0a20 2020  te_version)..   
-00012070: 2020 2020 2020 2020 2066 696c 656e 616d           filenam
-00012080: 652c 2066 6c61 675f 6269 7473 203d 207a  e, flag_bits = z
-00012090: 696e 666f 2e5f 656e 636f 6465 4669 6c65  info._encodeFile
-000120a0: 6e61 6d65 466c 6167 7328 290d 0a20 2020  nameFlags()..   
-000120b0: 2020 2020 2020 2020 2063 656e 7464 6972           centdir
-000120c0: 203d 2073 7472 7563 742e 7061 636b 280d   = struct.pack(.
-000120d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000120e0: 2073 7472 7563 7443 656e 7472 616c 4469   structCentralDi
-000120f0: 722c 0d0a 2020 2020 2020 2020 2020 2020  r,..            
-00012100: 2020 2020 7374 7269 6e67 4365 6e74 7261      stringCentra
-00012110: 6c44 6972 2c0d 0a20 2020 2020 2020 2020  lDir,..         
-00012120: 2020 2020 2020 2063 7265 6174 655f 7665         create_ve
-00012130: 7273 696f 6e2c 0d0a 2020 2020 2020 2020  rsion,..        
-00012140: 2020 2020 2020 2020 7a69 6e66 6f2e 6372          zinfo.cr
-00012150: 6561 7465 5f73 7973 7465 6d2c 0d0a 2020  eate_system,..  
-00012160: 2020 2020 2020 2020 2020 2020 2020 6578                ex
-00012170: 7472 6163 745f 7665 7273 696f 6e2c 0d0a  tract_version,..
-00012180: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012190: 7a69 6e66 6f2e 7265 7365 7276 6564 2c0d  zinfo.reserved,.
-000121a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000121b0: 2066 6c61 675f 6269 7473 2c0d 0a20 2020   flag_bits,..   
-000121c0: 2020 2020 2020 2020 2020 2020 207a 696e               zin
-000121d0: 666f 2e63 6f6d 7072 6573 735f 7479 7065  fo.compress_type
-000121e0: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
-000121f0: 2020 2064 6f73 7469 6d65 2c0d 0a20 2020     dostime,..   
-00012200: 2020 2020 2020 2020 2020 2020 2064 6f73               dos
-00012210: 6461 7465 2c0d 0a20 2020 2020 2020 2020  date,..         
-00012220: 2020 2020 2020 207a 696e 666f 2e43 5243         zinfo.CRC
-00012230: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
-00012240: 2020 2063 6f6d 7072 6573 735f 7369 7a65     compress_size
-00012250: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
-00012260: 2020 2066 696c 655f 7369 7a65 2c0d 0a20     file_size,.. 
-00012270: 2020 2020 2020 2020 2020 2020 2020 206c                 l
-00012280: 656e 2866 696c 656e 616d 6529 2c0d 0a20  en(filename),.. 
-00012290: 2020 2020 2020 2020 2020 2020 2020 206c                 l
-000122a0: 656e 2865 7874 7261 5f64 6174 6129 2c0d  en(extra_data),.
-000122b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000122c0: 206c 656e 287a 696e 666f 2e63 6f6d 6d65   len(zinfo.comme
-000122d0: 6e74 292c 0d0a 2020 2020 2020 2020 2020  nt),..          
-000122e0: 2020 2020 2020 302c 0d0a 2020 2020 2020        0,..      
-000122f0: 2020 2020 2020 2020 2020 7a69 6e66 6f2e            zinfo.
-00012300: 696e 7465 726e 616c 5f61 7474 722c 0d0a  internal_attr,..
-00012310: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012320: 7a69 6e66 6f2e 6578 7465 726e 616c 5f61  zinfo.external_a
-00012330: 7474 722c 0d0a 2020 2020 2020 2020 2020  ttr,..          
-00012340: 2020 2020 2020 6865 6164 6572 5f6f 6666        header_off
-00012350: 7365 742c 0d0a 2020 2020 2020 2020 2020  set,..          
-00012360: 2020 290d 0a20 2020 2020 2020 2020 2020    )..           
-00012370: 2073 656c 662e 6670 2e77 7269 7465 2863   self.fp.write(c
-00012380: 656e 7464 6972 290d 0a20 2020 2020 2020  entdir)..       
-00012390: 2020 2020 2073 656c 662e 6670 2e77 7269       self.fp.wri
-000123a0: 7465 2866 696c 656e 616d 6529 0d0a 2020  te(filename)..  
-000123b0: 2020 2020 2020 2020 2020 7365 6c66 2e66            self.f
-000123c0: 702e 7772 6974 6528 6578 7472 615f 6461  p.write(extra_da
-000123d0: 7461 290d 0a20 2020 2020 2020 2020 2020  ta)..           
-000123e0: 2073 656c 662e 6670 2e77 7269 7465 287a   self.fp.write(z
-000123f0: 696e 666f 2e63 6f6d 6d65 6e74 290d 0a0d  info.comment)...
-00012400: 0a20 2020 2020 2020 2070 6f73 3220 3d20  .        pos2 = 
-00012410: 7365 6c66 2e66 702e 7465 6c6c 2829 0d0a  self.fp.tell()..
-00012420: 2020 2020 2020 2020 2320 5772 6974 6520          # Write 
-00012430: 656e 642d 6f66 2d7a 6970 2d61 7263 6869  end-of-zip-archi
-00012440: 7665 2072 6563 6f72 640d 0a20 2020 2020  ve record..     
-00012450: 2020 2063 656e 7444 6972 436f 756e 7420     centDirCount 
-00012460: 3d20 6c65 6e28 7365 6c66 2e66 696c 656c  = len(self.filel
-00012470: 6973 7429 0d0a 2020 2020 2020 2020 6365  ist)..        ce
-00012480: 6e74 4469 7253 697a 6520 3d20 706f 7332  ntDirSize = pos2
-00012490: 202d 2073 656c 662e 7374 6172 745f 6469   - self.start_di
-000124a0: 720d 0a20 2020 2020 2020 2063 656e 7444  r..        centD
-000124b0: 6972 4f66 6673 6574 203d 2073 656c 662e  irOffset = self.
-000124c0: 7374 6172 745f 6469 720d 0a20 2020 2020  start_dir..     
-000124d0: 2020 2072 6571 7569 7265 735f 7a69 7036     requires_zip6
-000124e0: 3420 3d20 4e6f 6e65 0d0a 2020 2020 2020  4 = None..      
-000124f0: 2020 6966 2063 656e 7444 6972 436f 756e    if centDirCoun
-00012500: 7420 3e20 5a49 505f 4649 4c45 434f 554e  t > ZIP_FILECOUN
-00012510: 545f 4c49 4d49 543a 0d0a 2020 2020 2020  T_LIMIT:..      
-00012520: 2020 2020 2020 7265 7175 6972 6573 5f7a        requires_z
-00012530: 6970 3634 203d 2022 4669 6c65 7320 636f  ip64 = "Files co
-00012540: 756e 7422 0d0a 2020 2020 2020 2020 656c  unt"..        el
-00012550: 6966 2063 656e 7444 6972 4f66 6673 6574  if centDirOffset
-00012560: 203e 205a 4950 3634 5f4c 494d 4954 3a0d   > ZIP64_LIMIT:.
-00012570: 0a20 2020 2020 2020 2020 2020 2072 6571  .            req
-00012580: 7569 7265 735f 7a69 7036 3420 3d20 2243  uires_zip64 = "C
-00012590: 656e 7472 616c 2064 6972 6563 746f 7279  entral directory
-000125a0: 206f 6666 7365 7422 0d0a 2020 2020 2020   offset"..      
-000125b0: 2020 656c 6966 2063 656e 7444 6972 5369    elif centDirSi
-000125c0: 7a65 203e 205a 4950 3634 5f4c 494d 4954  ze > ZIP64_LIMIT
-000125d0: 3a0d 0a20 2020 2020 2020 2020 2020 2072  :..            r
-000125e0: 6571 7569 7265 735f 7a69 7036 3420 3d20  equires_zip64 = 
-000125f0: 2243 656e 7472 616c 2064 6972 6563 746f  "Central directo
-00012600: 7279 2073 697a 6522 0d0a 2020 2020 2020  ry size"..      
-00012610: 2020 6966 2072 6571 7569 7265 735f 7a69    if requires_zi
-00012620: 7036 343a 0d0a 2020 2020 2020 2020 2020  p64:..          
-00012630: 2020 2320 4e65 6564 2074 6f20 7772 6974    # Need to writ
-00012640: 6520 7468 6520 5a49 5036 3420 656e 642d  e the ZIP64 end-
-00012650: 6f66 2d61 7263 6869 7665 2072 6563 6f72  of-archive recor
-00012660: 6473 0d0a 2020 2020 2020 2020 2020 2020  ds..            
-00012670: 6966 206e 6f74 2073 656c 662e 5f61 6c6c  if not self._all
-00012680: 6f77 5a69 7036 343a 0d0a 2020 2020 2020  owZip64:..      
-00012690: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
-000126a0: 4c61 7267 655a 6970 4669 6c65 280d 0a20  LargeZipFile(.. 
-000126b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000126c0: 2020 2072 6571 7569 7265 735f 7a69 7036     requires_zip6
-000126d0: 3420 2b20 2220 776f 756c 6420 7265 7175  4 + " would requ
-000126e0: 6972 6520 5a49 5036 3420 6578 7465 6e73  ire ZIP64 extens
-000126f0: 696f 6e73 222c 0d0a 2020 2020 2020 2020  ions",..        
-00012700: 2020 2020 2020 2020 290d 0a20 2020 2020          )..     
-00012710: 2020 2020 2020 207a 6970 3634 656e 6472         zip64endr
-00012720: 6563 203d 2073 7472 7563 742e 7061 636b  ec = struct.pack
-00012730: 280d 0a20 2020 2020 2020 2020 2020 2020  (..             
-00012740: 2020 2073 7472 7563 7445 6e64 4172 6368     structEndArch
-00012750: 6976 6536 342c 0d0a 2020 2020 2020 2020  ive64,..        
-00012760: 2020 2020 2020 2020 7374 7269 6e67 456e          stringEn
-00012770: 6441 7263 6869 7665 3634 2c0d 0a20 2020  dArchive64,..   
-00012780: 2020 2020 2020 2020 2020 2020 2034 342c               44,
-00012790: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-000127a0: 2020 3435 2c0d 0a20 2020 2020 2020 2020    45,..         
-000127b0: 2020 2020 2020 2034 352c 0d0a 2020 2020         45,..    
-000127c0: 2020 2020 2020 2020 2020 2020 302c 0d0a              0,..
-000127d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000127e0: 302c 0d0a 2020 2020 2020 2020 2020 2020  0,..            
-000127f0: 2020 2020 6365 6e74 4469 7243 6f75 6e74      centDirCount
-00012800: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
-00012810: 2020 2063 656e 7444 6972 436f 756e 742c     centDirCount,
-00012820: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00012830: 2020 6365 6e74 4469 7253 697a 652c 0d0a    centDirSize,..
-00012840: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012850: 6365 6e74 4469 724f 6666 7365 742c 0d0a  centDirOffset,..
-00012860: 2020 2020 2020 2020 2020 2020 290d 0a20              ).. 
-00012870: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-00012880: 6670 2e77 7269 7465 287a 6970 3634 656e  fp.write(zip64en
-00012890: 6472 6563 290d 0a0d 0a20 2020 2020 2020  drec)....       
-000128a0: 2020 2020 207a 6970 3634 6c6f 6372 6563       zip64locrec
-000128b0: 203d 2073 7472 7563 742e 7061 636b 280d   = struct.pack(.
-000128c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000128d0: 2073 7472 7563 7445 6e64 4172 6368 6976   structEndArchiv
-000128e0: 6536 344c 6f63 6174 6f72 2c0d 0a20 2020  e64Locator,..   
-000128f0: 2020 2020 2020 2020 2020 2020 2073 7472               str
-00012900: 696e 6745 6e64 4172 6368 6976 6536 344c  ingEndArchive64L
-00012910: 6f63 6174 6f72 2c0d 0a20 2020 2020 2020  ocator,..       
-00012920: 2020 2020 2020 2020 2030 2c0d 0a20 2020           0,..   
-00012930: 2020 2020 2020 2020 2020 2020 2070 6f73               pos
-00012940: 322c 0d0a 2020 2020 2020 2020 2020 2020  2,..            
-00012950: 2020 2020 312c 0d0a 2020 2020 2020 2020      1,..        
-00012960: 2020 2020 290d 0a20 2020 2020 2020 2020      )..         
-00012970: 2020 2073 656c 662e 6670 2e77 7269 7465     self.fp.write
-00012980: 287a 6970 3634 6c6f 6372 6563 290d 0a20  (zip64locrec).. 
-00012990: 2020 2020 2020 2020 2020 2063 656e 7444             centD
-000129a0: 6972 436f 756e 7420 3d20 6d69 6e28 6365  irCount = min(ce
-000129b0: 6e74 4469 7243 6f75 6e74 2c20 3078 4646  ntDirCount, 0xFF
-000129c0: 4646 290d 0a20 2020 2020 2020 2020 2020  FF)..           
-000129d0: 2063 656e 7444 6972 5369 7a65 203d 206d   centDirSize = m
-000129e0: 696e 2863 656e 7444 6972 5369 7a65 2c20  in(centDirSize, 
-000129f0: 3078 4646 4646 4646 4646 290d 0a20 2020  0xFFFFFFFF)..   
-00012a00: 2020 2020 2020 2020 2063 656e 7444 6972           centDir
-00012a10: 4f66 6673 6574 203d 206d 696e 2863 656e  Offset = min(cen
-00012a20: 7444 6972 4f66 6673 6574 2c20 3078 4646  tDirOffset, 0xFF
-00012a30: 4646 4646 4646 290d 0a0d 0a20 2020 2020  FFFFFF)....     
-00012a40: 2020 2065 6e64 7265 6320 3d20 7374 7275     endrec = stru
-00012a50: 6374 2e70 6163 6b28 0d0a 2020 2020 2020  ct.pack(..      
-00012a60: 2020 2020 2020 7374 7275 6374 456e 6441        structEndA
-00012a70: 7263 6869 7665 2c0d 0a20 2020 2020 2020  rchive,..       
-00012a80: 2020 2020 2073 7472 696e 6745 6e64 4172       stringEndAr
-00012a90: 6368 6976 652c 0d0a 2020 2020 2020 2020  chive,..        
-00012aa0: 2020 2020 302c 0d0a 2020 2020 2020 2020      0,..        
-00012ab0: 2020 2020 302c 0d0a 2020 2020 2020 2020      0,..        
-00012ac0: 2020 2020 6365 6e74 4469 7243 6f75 6e74      centDirCount
-00012ad0: 2c0d 0a20 2020 2020 2020 2020 2020 2063  ,..            c
-00012ae0: 656e 7444 6972 436f 756e 742c 0d0a 2020  entDirCount,..  
-00012af0: 2020 2020 2020 2020 2020 6365 6e74 4469            centDi
-00012b00: 7253 697a 652c 0d0a 2020 2020 2020 2020  rSize,..        
-00012b10: 2020 2020 6365 6e74 4469 724f 6666 7365      centDirOffse
-00012b20: 742c 0d0a 2020 2020 2020 2020 2020 2020  t,..            
-00012b30: 6c65 6e28 7365 6c66 2e5f 636f 6d6d 656e  len(self._commen
-00012b40: 7429 2c0d 0a20 2020 2020 2020 2029 0d0a  t),..        )..
-00012b50: 2020 2020 2020 2020 7365 6c66 2e66 702e          self.fp.
-00012b60: 7772 6974 6528 656e 6472 6563 290d 0a20  write(endrec).. 
-00012b70: 2020 2020 2020 2073 656c 662e 6670 2e77         self.fp.w
-00012b80: 7269 7465 2873 656c 662e 5f63 6f6d 6d65  rite(self._comme
-00012b90: 6e74 290d 0a20 2020 2020 2020 2073 656c  nt)..        sel
-00012ba0: 662e 6670 2e66 6c75 7368 2829 0d0a 0d0a  f.fp.flush()....
-00012bb0: 2020 2020 6465 6620 5f66 7063 6c6f 7365      def _fpclose
-00012bc0: 2873 656c 662c 2066 7029 3a0d 0a20 2020  (self, fp):..   
-00012bd0: 2020 2020 2061 7373 6572 7420 7365 6c66       assert self
-00012be0: 2e5f 6669 6c65 5265 6643 6e74 203e 2030  ._fileRefCnt > 0
-00012bf0: 0d0a 2020 2020 2020 2020 7365 6c66 2e5f  ..        self._
-00012c00: 6669 6c65 5265 6643 6e74 202d 3d20 310d  fileRefCnt -= 1.
-00012c10: 0a20 2020 2020 2020 2069 6620 6e6f 7420  .        if not 
-00012c20: 7365 6c66 2e5f 6669 6c65 5265 6643 6e74  self._fileRefCnt
-00012c30: 2061 6e64 206e 6f74 2073 656c 662e 5f66   and not self._f
-00012c40: 696c 6550 6173 7365 643a 0d0a 2020 2020  ilePassed:..    
-00012c50: 2020 2020 2020 2020 6670 2e63 6c6f 7365          fp.close
-00012c60: 2829 0d0a 0d0a 0d0a 636c 6173 7320 5079  ()......class Py
-00012c70: 5a69 7046 696c 6528 5a69 7046 696c 6529  ZipFile(ZipFile)
-00012c80: 3a0d 0a20 2020 2022 2222 436c 6173 7320  :..    """Class 
-00012c90: 746f 2063 7265 6174 6520 5a49 5020 6172  to create ZIP ar
-00012ca0: 6368 6976 6573 2077 6974 6820 5079 7468  chives with Pyth
-00012cb0: 6f6e 206c 6962 7261 7279 2066 696c 6573  on library files
-00012cc0: 2061 6e64 2070 6163 6b61 6765 732e 2222   and packages.""
-00012cd0: 220d 0a0d 0a20 2020 2064 6566 205f 5f69  "....    def __i
-00012ce0: 6e69 745f 5f28 0d0a 2020 2020 2020 2020  nit__(..        
-00012cf0: 7365 6c66 2c0d 0a20 2020 2020 2020 2066  self,..        f
-00012d00: 696c 652c 0d0a 2020 2020 2020 2020 6d6f  ile,..        mo
-00012d10: 6465 3d22 7222 2c0d 0a20 2020 2020 2020  de="r",..       
-00012d20: 2063 6f6d 7072 6573 7369 6f6e 3d5a 4950   compression=ZIP
-00012d30: 5f53 544f 5245 442c 0d0a 2020 2020 2020  _STORED,..      
-00012d40: 2020 616c 6c6f 775a 6970 3634 3d54 7275    allowZip64=Tru
-00012d50: 652c 0d0a 2020 2020 2020 2020 6f70 7469  e,..        opti
-00012d60: 6d69 7a65 3d2d 312c 0d0a 2020 2020 2920  mize=-1,..    ) 
-00012d70: 2d3e 204e 6f6e 653a 0d0a 2020 2020 2020  -> None:..      
-00012d80: 2020 5a69 7046 696c 652e 5f5f 696e 6974    ZipFile.__init
-00012d90: 5f5f 280d 0a20 2020 2020 2020 2020 2020  __(..           
-00012da0: 2073 656c 662c 0d0a 2020 2020 2020 2020   self,..        
-00012db0: 2020 2020 6669 6c65 2c0d 0a20 2020 2020      file,..     
-00012dc0: 2020 2020 2020 206d 6f64 653d 6d6f 6465         mode=mode
-00012dd0: 2c0d 0a20 2020 2020 2020 2020 2020 2063  ,..            c
-00012de0: 6f6d 7072 6573 7369 6f6e 3d63 6f6d 7072  ompression=compr
-00012df0: 6573 7369 6f6e 2c0d 0a20 2020 2020 2020  ession,..       
-00012e00: 2020 2020 2061 6c6c 6f77 5a69 7036 343d       allowZip64=
-00012e10: 616c 6c6f 775a 6970 3634 2c0d 0a20 2020  allowZip64,..   
-00012e20: 2020 2020 2029 0d0a 2020 2020 2020 2020       )..        
-00012e30: 7365 6c66 2e5f 6f70 7469 6d69 7a65 203d  self._optimize =
-00012e40: 206f 7074 696d 697a 650d 0a0d 0a20 2020   optimize....   
-00012e50: 2064 6566 2077 7269 7465 7079 2873 656c   def writepy(sel
-00012e60: 662c 2070 6174 686e 616d 652c 2062 6173  f, pathname, bas
-00012e70: 656e 616d 653d 2222 2c20 6669 6c74 6572  ename="", filter
-00012e80: 6675 6e63 3d4e 6f6e 6529 3a0d 0a20 2020  func=None):..   
-00012e90: 2020 2020 2022 2222 4164 6420 616c 6c20       """Add all 
-00012ea0: 6669 6c65 7320 6672 6f6d 2022 7061 7468  files from "path
-00012eb0: 6e61 6d65 2220 746f 2074 6865 205a 4950  name" to the ZIP
-00012ec0: 2061 7263 6869 7665 2e0d 0a0d 0a20 2020   archive.....   
-00012ed0: 2020 2020 2049 6620 7061 7468 6e61 6d65       If pathname
-00012ee0: 2069 7320 6120 7061 636b 6167 6520 6469   is a package di
-00012ef0: 7265 6374 6f72 792c 2073 6561 7263 6820  rectory, search 
-00012f00: 7468 6520 6469 7265 6374 6f72 7920 616e  the directory an
-00012f10: 640d 0a20 2020 2020 2020 2061 6c6c 2070  d..        all p
-00012f20: 6163 6b61 6765 2073 7562 6469 7265 6374  ackage subdirect
-00012f30: 6f72 6965 7320 7265 6375 7273 6976 656c  ories recursivel
-00012f40: 7920 666f 7220 616c 6c20 2a2e 7079 2061  y for all *.py a
-00012f50: 6e64 2065 6e74 6572 0d0a 2020 2020 2020  nd enter..      
-00012f60: 2020 7468 6520 6d6f 6475 6c65 7320 696e    the modules in
-00012f70: 746f 2074 6865 2061 7263 6869 7665 2e20  to the archive. 
-00012f80: 2049 6620 7061 7468 6e61 6d65 2069 7320   If pathname is 
-00012f90: 6120 706c 6169 6e0d 0a20 2020 2020 2020  a plain..       
-00012fa0: 2064 6972 6563 746f 7279 2c20 6c69 7374   directory, list
-00012fb0: 6469 7220 2a2e 7079 2061 6e64 2065 6e74  dir *.py and ent
-00012fc0: 6572 2061 6c6c 206d 6f64 756c 6573 2e20  er all modules. 
-00012fd0: 2045 6c73 652c 2070 6174 686e 616d 650d   Else, pathname.
-00012fe0: 0a20 2020 2020 2020 206d 7573 7420 6265  .        must be
-00012ff0: 2061 2050 7974 686f 6e20 2a2e 7079 2066   a Python *.py f
-00013000: 696c 6520 616e 6420 7468 6520 6d6f 6475  ile and the modu
-00013010: 6c65 2077 696c 6c20 6265 2070 7574 2069  le will be put i
-00013020: 6e74 6f20 7468 650d 0a20 2020 2020 2020  nto the..       
-00013030: 2061 7263 6869 7665 2e20 2041 6464 6564   archive.  Added
-00013040: 206d 6f64 756c 6573 2061 7265 2061 6c77   modules are alw
-00013050: 6179 7320 6d6f 6475 6c65 2e70 7963 2e0d  ays module.pyc..
-00013060: 0a20 2020 2020 2020 2054 6869 7320 6d65  .        This me
-00013070: 7468 6f64 2077 696c 6c20 636f 6d70 696c  thod will compil
-00013080: 6520 7468 6520 6d6f 6475 6c65 2e70 7920  e the module.py 
-00013090: 696e 746f 206d 6f64 756c 652e 7079 6320  into module.pyc 
-000130a0: 6966 0d0a 2020 2020 2020 2020 6e65 6365  if..        nece
-000130b0: 7373 6172 792e 0d0a 2020 2020 2020 2020  ssary...        
-000130c0: 4966 2066 696c 7465 7266 756e 6328 7061  If filterfunc(pa
-000130d0: 7468 6e61 6d65 2920 6973 2067 6976 656e  thname) is given
-000130e0: 2c20 6974 2069 7320 6361 6c6c 6564 2077  , it is called w
-000130f0: 6974 6820 6576 6572 7920 6172 6775 6d65  ith every argume
-00013100: 6e74 2e0d 0a20 2020 2020 2020 2057 6865  nt...        Whe
-00013110: 6e20 6974 2069 7320 4661 6c73 652c 2074  n it is False, t
-00013120: 6865 2066 696c 6520 6f72 2064 6972 6563  he file or direc
-00013130: 746f 7279 2069 7320 736b 6970 7065 642e  tory is skipped.
-00013140: 0d0a 2020 2020 2020 2020 2222 220d 0a20  ..        """.. 
-00013150: 2020 2020 2020 2070 6174 686e 616d 6520         pathname 
-00013160: 3d20 6f73 2e66 7370 6174 6828 7061 7468  = os.fspath(path
-00013170: 6e61 6d65 290d 0a20 2020 2020 2020 2069  name)..        i
-00013180: 6620 6669 6c74 6572 6675 6e63 2061 6e64  f filterfunc and
-00013190: 206e 6f74 2066 696c 7465 7266 756e 6328   not filterfunc(
-000131a0: 7061 7468 6e61 6d65 293a 0d0a 2020 2020  pathname):..    
-000131b0: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
-000131c0: 6465 6275 673a 0d0a 2020 2020 2020 2020  debug:..        
-000131d0: 2020 2020 2020 2020 6c61 6265 6c20 3d20          label = 
-000131e0: 2270 6174 6822 2069 6620 6f73 2e70 6174  "path" if os.pat
-000131f0: 682e 6973 6469 7228 7061 7468 6e61 6d65  h.isdir(pathname
-00013200: 2920 656c 7365 2022 6669 6c65 220d 0a20  ) else "file".. 
-00013210: 2020 2020 2020 2020 2020 2020 2020 2070                 p
-00013220: 7269 6e74 2866 227b 6c61 6265 6c7d 207b  rint(f"{label} {
-00013230: 7061 7468 6e61 6d65 2172 7d20 736b 6970  pathname!r} skip
-00013240: 7065 6420 6279 2066 696c 7465 7266 756e  ped by filterfun
-00013250: 6322 290d 0a20 2020 2020 2020 2020 2020  c")..           
-00013260: 2072 6574 7572 6e0d 0a20 2020 2020 2020   return..       
-00013270: 2064 6972 2c20 6e61 6d65 203d 206f 732e   dir, name = os.
-00013280: 7061 7468 2e73 706c 6974 2870 6174 686e  path.split(pathn
-00013290: 616d 6529 0d0a 2020 2020 2020 2020 6966  ame)..        if
-000132a0: 206f 732e 7061 7468 2e69 7364 6972 2870   os.path.isdir(p
-000132b0: 6174 686e 616d 6529 3a0d 0a20 2020 2020  athname):..     
-000132c0: 2020 2020 2020 2069 6e69 746e 616d 6520         initname 
-000132d0: 3d20 6f73 2e70 6174 682e 6a6f 696e 2870  = os.path.join(p
-000132e0: 6174 686e 616d 652c 2022 5f5f 696e 6974  athname, "__init
-000132f0: 5f5f 2e70 7922 290d 0a20 2020 2020 2020  __.py")..       
-00013300: 2020 2020 2069 6620 6f73 2e70 6174 682e       if os.path.
-00013310: 6973 6669 6c65 2869 6e69 746e 616d 6529  isfile(initname)
-00013320: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
-00013330: 2020 2023 2054 6869 7320 6973 2061 2070     # This is a p
-00013340: 6163 6b61 6765 2064 6972 6563 746f 7279  ackage directory
-00013350: 2c20 6164 6420 6974 0d0a 2020 2020 2020  , add it..      
-00013360: 2020 2020 2020 2020 2020 6261 7365 6e61            basena
-00013370: 6d65 203d 2066 227b 6261 7365 6e61 6d65  me = f"{basename
-00013380: 7d2f 7b6e 616d 657d 2220 6966 2062 6173  }/{name}" if bas
-00013390: 656e 616d 6520 656c 7365 206e 616d 650d  ename else name.
-000133a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000133b0: 2069 6620 7365 6c66 2e64 6562 7567 3a0d   if self.debug:.
-000133c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000133d0: 2020 2020 2070 7269 6e74 2822 4164 6469       print("Addi
-000133e0: 6e67 2070 6163 6b61 6765 2069 6e22 2c20  ng package in", 
-000133f0: 7061 7468 6e61 6d65 2c20 2261 7322 2c20  pathname, "as", 
-00013400: 6261 7365 6e61 6d65 290d 0a20 2020 2020  basename)..     
-00013410: 2020 2020 2020 2020 2020 2066 6e61 6d65             fname
-00013420: 2c20 6172 636e 616d 6520 3d20 7365 6c66  , arcname = self
-00013430: 2e5f 6765 745f 636f 6465 6e61 6d65 2869  ._get_codename(i
-00013440: 6e69 746e 616d 655b 303a 2d33 5d2c 2062  nitname[0:-3], b
-00013450: 6173 656e 616d 6529 0d0a 2020 2020 2020  asename)..      
-00013460: 2020 2020 2020 2020 2020 6966 2073 656c            if sel
-00013470: 662e 6465 6275 673a 0d0a 2020 2020 2020  f.debug:..      
-00013480: 2020 2020 2020 2020 2020 2020 2020 7072                pr
-00013490: 696e 7428 2241 6464 696e 6722 2c20 6172  int("Adding", ar
-000134a0: 636e 616d 6529 0d0a 2020 2020 2020 2020  cname)..        
-000134b0: 2020 2020 2020 2020 7365 6c66 2e77 7269          self.wri
-000134c0: 7465 2866 6e61 6d65 2c20 6172 636e 616d  te(fname, arcnam
-000134d0: 6529 0d0a 2020 2020 2020 2020 2020 2020  e)..            
-000134e0: 2020 2020 6469 726c 6973 7420 3d20 736f      dirlist = so
-000134f0: 7274 6564 286f 732e 6c69 7374 6469 7228  rted(os.listdir(
-00013500: 7061 7468 6e61 6d65 2929 0d0a 2020 2020  pathname))..    
-00013510: 2020 2020 2020 2020 2020 2020 6469 726c              dirl
-00013520: 6973 742e 7265 6d6f 7665 2822 5f5f 696e  ist.remove("__in
-00013530: 6974 5f5f 2e70 7922 290d 0a20 2020 2020  it__.py")..     
-00013540: 2020 2020 2020 2020 2020 2023 2041 6464             # Add
-00013550: 2061 6c6c 202a 2e70 7920 6669 6c65 7320   all *.py files 
-00013560: 616e 6420 7061 636b 6167 6520 7375 6264  and package subd
-00013570: 6972 6563 746f 7269 6573 0d0a 2020 2020  irectories..    
-00013580: 2020 2020 2020 2020 2020 2020 666f 7220              for 
-00013590: 6669 6c65 6e61 6d65 2069 6e20 6469 726c  filename in dirl
-000135a0: 6973 743a 0d0a 2020 2020 2020 2020 2020  ist:..          
-000135b0: 2020 2020 2020 2020 2020 7061 7468 203d            path =
-000135c0: 206f 732e 7061 7468 2e6a 6f69 6e28 7061   os.path.join(pa
-000135d0: 7468 6e61 6d65 2c20 6669 6c65 6e61 6d65  thname, filename
-000135e0: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
-000135f0: 2020 2020 2020 2072 6f6f 742c 2065 7874         root, ext
-00013600: 203d 206f 732e 7061 7468 2e73 706c 6974   = os.path.split
-00013610: 6578 7428 6669 6c65 6e61 6d65 290d 0a20  ext(filename).. 
-00013620: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013630: 2020 2069 6620 6f73 2e70 6174 682e 6973     if os.path.is
-00013640: 6469 7228 7061 7468 293a 0d0a 2020 2020  dir(path):..    
-00013650: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013660: 2020 2020 6966 206f 732e 7061 7468 2e69      if os.path.i
-00013670: 7366 696c 6528 6f73 2e70 6174 682e 6a6f  sfile(os.path.jo
-00013680: 696e 2870 6174 682c 2022 5f5f 696e 6974  in(path, "__init
-00013690: 5f5f 2e70 7922 2929 3a0d 0a20 2020 2020  __.py")):..     
-000136a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000136b0: 2020 2020 2020 2023 2054 6869 7320 6973         # This is
-000136c0: 2061 2070 6163 6b61 6765 2064 6972 6563   a package direc
-000136d0: 746f 7279 2c20 6164 6420 6974 0d0a 2020  tory, add it..  
-000136e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000136f0: 2020 2020 2020 2020 2020 7365 6c66 2e77            self.w
-00013700: 7269 7465 7079 280d 0a20 2020 2020 2020  ritepy(..       
-00013710: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013720: 2020 2020 2020 2020 2070 6174 682c 0d0a           path,..
-00013730: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013740: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013750: 6261 7365 6e61 6d65 2c0d 0a20 2020 2020  basename,..     
-00013760: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013770: 2020 2020 2020 2020 2020 2066 696c 7465             filte
-00013780: 7266 756e 633d 6669 6c74 6572 6675 6e63  rfunc=filterfunc
-00013790: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
-000137a0: 2020 2020 2020 2020 2020 2020 2020 2029                 )
-000137b0: 2020 2320 5265 6375 7273 6976 6520 6361    # Recursive ca
-000137c0: 6c6c 0d0a 2020 2020 2020 2020 2020 2020  ll..            
-000137d0: 2020 2020 2020 2020 656c 6966 2065 7874          elif ext
-000137e0: 203d 3d20 222e 7079 223a 0d0a 2020 2020   == ".py":..    
-000137f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013800: 2020 2020 6966 2066 696c 7465 7266 756e      if filterfun
-00013810: 6320 616e 6420 6e6f 7420 6669 6c74 6572  c and not filter
-00013820: 6675 6e63 2870 6174 6829 3a0d 0a20 2020  func(path):..   
-00013830: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013840: 2020 2020 2020 2020 2069 6620 7365 6c66           if self
-00013850: 2e64 6562 7567 3a0d 0a20 2020 2020 2020  .debug:..       
-00013860: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013870: 2020 2020 2020 2020 2070 7269 6e74 2822           print("
-00013880: 6669 6c65 2025 7220 736b 6970 7065 6420  file %r skipped 
-00013890: 6279 2066 696c 7465 7266 756e 6322 2025  by filterfunc" %
-000138a0: 2070 6174 6829 0d0a 2020 2020 2020 2020   path)..        
-000138b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000138c0: 2020 2020 636f 6e74 696e 7565 0d0a 2020      continue..  
-000138d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000138e0: 2020 2020 2020 666e 616d 652c 2061 7263        fname, arc
-000138f0: 6e61 6d65 203d 2073 656c 662e 5f67 6574  name = self._get
-00013900: 5f63 6f64 656e 616d 6528 0d0a 2020 2020  _codename(..    
-00013910: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013920: 2020 2020 2020 2020 7061 7468 5b30 3a2d          path[0:-
-00013930: 335d 2c0d 0a20 2020 2020 2020 2020 2020  3],..           
-00013940: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013950: 2062 6173 656e 616d 652c 0d0a 2020 2020   basename,..    
-00013960: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013970: 2020 2020 290d 0a20 2020 2020 2020 2020      )..         
-00013980: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-00013990: 6620 7365 6c66 2e64 6562 7567 3a0d 0a20  f self.debug:.. 
-000139a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000139b0: 2020 2020 2020 2020 2020 2070 7269 6e74             print
-000139c0: 2822 4164 6469 6e67 222c 2061 7263 6e61  ("Adding", arcna
-000139d0: 6d65 290d 0a20 2020 2020 2020 2020 2020  me)..           
-000139e0: 2020 2020 2020 2020 2020 2020 2073 656c               sel
-000139f0: 662e 7772 6974 6528 666e 616d 652c 2061  f.write(fname, a
-00013a00: 7263 6e61 6d65 290d 0a20 2020 2020 2020  rcname)..       
-00013a10: 2020 2020 2065 6c73 653a 0d0a 2020 2020       else:..    
-00013a20: 2020 2020 2020 2020 2020 2020 2320 5468              # Th
-00013a30: 6973 2069 7320 4e4f 5420 6120 7061 636b  is is NOT a pack
-00013a40: 6167 6520 6469 7265 6374 6f72 792c 2061  age directory, a
-00013a50: 6464 2069 7473 2066 696c 6573 2061 7420  dd its files at 
-00013a60: 746f 7020 6c65 7665 6c0d 0a20 2020 2020  top level..     
-00013a70: 2020 2020 2020 2020 2020 2069 6620 7365             if se
-00013a80: 6c66 2e64 6562 7567 3a0d 0a20 2020 2020  lf.debug:..     
-00013a90: 2020 2020 2020 2020 2020 2020 2020 2070                 p
-00013aa0: 7269 6e74 2822 4164 6469 6e67 2066 696c  rint("Adding fil
-00013ab0: 6573 2066 726f 6d20 6469 7265 6374 6f72  es from director
-00013ac0: 7922 2c20 7061 7468 6e61 6d65 290d 0a20  y", pathname).. 
-00013ad0: 2020 2020 2020 2020 2020 2020 2020 2066                 f
-00013ae0: 6f72 2066 696c 656e 616d 6520 696e 2073  or filename in s
-00013af0: 6f72 7465 6428 6f73 2e6c 6973 7464 6972  orted(os.listdir
-00013b00: 2870 6174 686e 616d 6529 293a 0d0a 2020  (pathname)):..  
-00013b10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013b20: 2020 7061 7468 203d 206f 732e 7061 7468    path = os.path
-00013b30: 2e6a 6f69 6e28 7061 7468 6e61 6d65 2c20  .join(pathname, 
-00013b40: 6669 6c65 6e61 6d65 290d 0a20 2020 2020  filename)..     
-00013b50: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-00013b60: 6f6f 742c 2065 7874 203d 206f 732e 7061  oot, ext = os.pa
-00013b70: 7468 2e73 706c 6974 6578 7428 6669 6c65  th.splitext(file
-00013b80: 6e61 6d65 290d 0a20 2020 2020 2020 2020  name)..         
-00013b90: 2020 2020 2020 2020 2020 2069 6620 6578             if ex
-00013ba0: 7420 3d3d 2022 2e70 7922 3a0d 0a20 2020  t == ".py":..   
-00013bb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013bc0: 2020 2020 2069 6620 6669 6c74 6572 6675       if filterfu
-00013bd0: 6e63 2061 6e64 206e 6f74 2066 696c 7465  nc and not filte
-00013be0: 7266 756e 6328 7061 7468 293a 0d0a 2020  rfunc(path):..  
-00013bf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013c00: 2020 2020 2020 2020 2020 6966 2073 656c            if sel
-00013c10: 662e 6465 6275 673a 0d0a 2020 2020 2020  f.debug:..      
-00013c20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013c30: 2020 2020 2020 2020 2020 7072 696e 7428            print(
-00013c40: 2266 696c 6520 2572 2073 6b69 7070 6564  "file %r skipped
-00013c50: 2062 7920 6669 6c74 6572 6675 6e63 2220   by filterfunc" 
-00013c60: 2520 7061 7468 290d 0a20 2020 2020 2020  % path)..       
-00013c70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013c80: 2020 2020 2063 6f6e 7469 6e75 650d 0a20       continue.. 
-00013c90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013ca0: 2020 2020 2020 2066 6e61 6d65 2c20 6172         fname, ar
-00013cb0: 636e 616d 6520 3d20 7365 6c66 2e5f 6765  cname = self._ge
-00013cc0: 745f 636f 6465 6e61 6d65 280d 0a20 2020  t_codename(..   
-00013cd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013ce0: 2020 2020 2020 2020 2070 6174 685b 303a           path[0:
-00013cf0: 2d33 5d2c 0d0a 2020 2020 2020 2020 2020  -3],..          
-00013d00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013d10: 2020 6261 7365 6e61 6d65 2c0d 0a20 2020    basename,..   
-00013d20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013d30: 2020 2020 2029 0d0a 2020 2020 2020 2020       )..        
-00013d40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013d50: 6966 2073 656c 662e 6465 6275 673a 0d0a  if self.debug:..
-00013d60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013d70: 2020 2020 2020 2020 2020 2020 7072 696e              prin
-00013d80: 7428 2241 6464 696e 6722 2c20 6172 636e  t("Adding", arcn
-00013d90: 616d 6529 0d0a 2020 2020 2020 2020 2020  ame)..          
-00013da0: 2020 2020 2020 2020 2020 2020 2020 7365                se
-00013db0: 6c66 2e77 7269 7465 2866 6e61 6d65 2c20  lf.write(fname, 
-00013dc0: 6172 636e 616d 6529 0d0a 2020 2020 2020  arcname)..      
-00013dd0: 2020 656c 7365 3a0d 0a20 2020 2020 2020    else:..       
-00013de0: 2020 2020 2069 6620 7061 7468 6e61 6d65       if pathname
-00013df0: 5b2d 333a 5d20 213d 2022 2e70 7922 3a0d  [-3:] != ".py":.
-00013e00: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00013e10: 2072 6169 7365 2052 756e 7469 6d65 4572   raise RuntimeEr
-00013e20: 726f 7228 0d0a 2020 2020 2020 2020 2020  ror(..          
-00013e30: 2020 2020 2020 2020 2020 2746 696c 6573            'Files
-00013e40: 2061 6464 6564 2077 6974 6820 7772 6974   added with writ
-00013e50: 6570 7928 2920 6d75 7374 2065 6e64 2077  epy() must end w
-00013e60: 6974 6820 222e 7079 2227 2c0d 0a20 2020  ith ".py"',..   
-00013e70: 2020 2020 2020 2020 2020 2020 2029 0d0a               )..
-00013e80: 2020 2020 2020 2020 2020 2020 666e 616d              fnam
-00013e90: 652c 2061 7263 6e61 6d65 203d 2073 656c  e, arcname = sel
-00013ea0: 662e 5f67 6574 5f63 6f64 656e 616d 6528  f._get_codename(
-00013eb0: 7061 7468 6e61 6d65 5b30 3a2d 335d 2c20  pathname[0:-3], 
-00013ec0: 6261 7365 6e61 6d65 290d 0a20 2020 2020  basename)..     
-00013ed0: 2020 2020 2020 2069 6620 7365 6c66 2e64         if self.d
-00013ee0: 6562 7567 3a0d 0a20 2020 2020 2020 2020  ebug:..         
-00013ef0: 2020 2020 2020 2070 7269 6e74 2822 4164         print("Ad
-00013f00: 6469 6e67 2066 696c 6522 2c20 6172 636e  ding file", arcn
-00013f10: 616d 6529 0d0a 2020 2020 2020 2020 2020  ame)..          
-00013f20: 2020 7365 6c66 2e77 7269 7465 2866 6e61    self.write(fna
-00013f30: 6d65 2c20 6172 636e 616d 6529 0d0a 0d0a  me, arcname)....
-00013f40: 2020 2020 6465 6620 5f67 6574 5f63 6f64      def _get_cod
-00013f50: 656e 616d 6528 7365 6c66 2c20 7061 7468  ename(self, path
-00013f60: 6e61 6d65 2c20 6261 7365 6e61 6d65 293a  name, basename):
-00013f70: 0d0a 2020 2020 2020 2020 2222 2252 6574  ..        """Ret
-00013f80: 7572 6e20 2866 696c 656e 616d 652c 2061  urn (filename, a
-00013f90: 7263 6869 7665 6e61 6d65 2920 666f 7220  rchivename) for 
-00013fa0: 7468 6520 7061 7468 2e0d 0a0d 0a20 2020  the path.....   
-00013fb0: 2020 2020 2047 6976 656e 2061 206d 6f64       Given a mod
-00013fc0: 756c 6520 6e61 6d65 2070 6174 682c 2072  ule name path, r
-00013fd0: 6574 7572 6e20 7468 6520 636f 7272 6563  eturn the correc
-00013fe0: 7420 6669 6c65 2070 6174 6820 616e 640d  t file path and.
-00013ff0: 0a20 2020 2020 2020 2061 7263 6869 7665  .        archive
-00014000: 206e 616d 652c 2063 6f6d 7069 6c69 6e67   name, compiling
-00014010: 2069 6620 6e65 6365 7373 6172 792e 2020   if necessary.  
-00014020: 466f 7220 6578 616d 706c 652c 2067 6976  For example, giv
-00014030: 656e 0d0a 2020 2020 2020 2020 2f70 7974  en..        /pyt
-00014040: 686f 6e2f 6c69 622f 7374 7269 6e67 2c20  hon/lib/string, 
-00014050: 7265 7475 726e 2028 2f70 7974 686f 6e2f  return (/python/
-00014060: 6c69 622f 7374 7269 6e67 2e70 7963 2c20  lib/string.pyc, 
-00014070: 7374 7269 6e67 292e 0d0a 2020 2020 2020  string)...      
-00014080: 2020 2222 220d 0a0d 0a20 2020 2020 2020    """....       
-00014090: 2064 6566 205f 636f 6d70 696c 6528 6669   def _compile(fi
-000140a0: 6c65 2c20 6f70 7469 6d69 7a65 3d2d 3129  le, optimize=-1)
-000140b0: 3a0d 0a20 2020 2020 2020 2020 2020 2069  :..            i
-000140c0: 6d70 6f72 7420 7079 5f63 6f6d 7069 6c65  mport py_compile
-000140d0: 0d0a 0d0a 2020 2020 2020 2020 2020 2020  ....            
-000140e0: 6966 2073 656c 662e 6465 6275 673a 0d0a  if self.debug:..
+000114a0: 2020 2020 7a69 6e66 6f2e 5f63 6f6d 7072      zinfo._compr
+000114b0: 6573 736c 6576 656c 203d 2073 656c 662e  esslevel = self.
+000114c0: 636f 6d70 7265 7373 6c65 7665 6c0d 0a0d  compresslevel...
+000114d0: 0a20 2020 2020 2020 2069 6620 7a69 6e66  .        if zinf
+000114e0: 6f2e 6973 5f64 6972 2829 3a0d 0a20 2020  o.is_dir():..   
+000114f0: 2020 2020 2020 2020 2077 6974 6820 7365           with se
+00011500: 6c66 2e5f 6c6f 636b 3a0d 0a20 2020 2020  lf._lock:..     
+00011510: 2020 2020 2020 2020 2020 2069 6620 7365             if se
+00011520: 6c66 2e5f 7365 656b 6162 6c65 3a0d 0a20  lf._seekable:.. 
+00011530: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011540: 2020 2073 656c 662e 6670 2e73 6565 6b28     self.fp.seek(
+00011550: 7365 6c66 2e73 7461 7274 5f64 6972 290d  self.start_dir).
+00011560: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00011570: 207a 696e 666f 2e68 6561 6465 725f 6f66   zinfo.header_of
+00011580: 6673 6574 203d 2073 656c 662e 6670 2e74  fset = self.fp.t
+00011590: 656c 6c28 2920 2023 2053 7461 7274 206f  ell()  # Start o
+000115a0: 6620 6865 6164 6572 2062 7974 6573 0d0a  f header bytes..
+000115b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000115c0: 6966 207a 696e 666f 2e63 6f6d 7072 6573  if zinfo.compres
+000115d0: 735f 7479 7065 203d 3d20 5a49 505f 4c5a  s_type == ZIP_LZ
+000115e0: 4d41 3a0d 0a20 2020 2020 2020 2020 2020  MA:..           
+000115f0: 2020 2020 2020 2020 2023 2043 6f6d 7072           # Compr
+00011600: 6573 7365 6420 6461 7461 2069 6e63 6c75  essed data inclu
+00011610: 6465 7320 616e 2065 6e64 2d6f 662d 7374  des an end-of-st
+00011620: 7265 616d 2028 454f 5329 206d 6172 6b65  ream (EOS) marke
+00011630: 720d 0a20 2020 2020 2020 2020 2020 2020  r..             
+00011640: 2020 2020 2020 207a 696e 666f 2e66 6c61         zinfo.fla
+00011650: 675f 6269 7473 207c 3d20 3078 3032 0d0a  g_bits |= 0x02..
+00011660: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00011670: 2020 7365 6c66 2e5f 7772 6974 6563 6865    self._writeche
+00011680: 636b 287a 696e 666f 290d 0a20 2020 2020  ck(zinfo)..     
+00011690: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+000116a0: 5f64 6964 4d6f 6469 6679 203d 2054 7275  _didModify = Tru
+000116b0: 650d 0a0d 0a20 2020 2020 2020 2020 2020  e....           
+000116c0: 2020 2020 2073 656c 662e 6669 6c65 6c69       self.fileli
+000116d0: 7374 2e61 7070 656e 6428 7a69 6e66 6f29  st.append(zinfo)
+000116e0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+000116f0: 2020 7365 6c66 2e4e 616d 6554 6f49 6e66    self.NameToInf
+00011700: 6f5b 7a69 6e66 6f2e 6669 6c65 6e61 6d65  o[zinfo.filename
+00011710: 5d20 3d20 7a69 6e66 6f0d 0a20 2020 2020  ] = zinfo..     
+00011720: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00011730: 6670 2e77 7269 7465 287a 696e 666f 2e46  fp.write(zinfo.F
+00011740: 696c 6548 6561 6465 7228 4661 6c73 6529  ileHeader(False)
+00011750: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
+00011760: 2020 2073 656c 662e 7374 6172 745f 6469     self.start_di
+00011770: 7220 3d20 7365 6c66 2e66 702e 7465 6c6c  r = self.fp.tell
+00011780: 2829 0d0a 2020 2020 2020 2020 656c 7365  ()..        else
+00011790: 3a0d 0a20 2020 2020 2020 2020 2020 2077  :..            w
+000117a0: 6974 6820 6f70 656e 2866 696c 656e 616d  ith open(filenam
+000117b0: 652c 2022 7262 2229 2061 7320 7372 632c  e, "rb") as src,
+000117c0: 2073 656c 662e 6f70 656e 287a 696e 666f   self.open(zinfo
+000117d0: 2c20 2277 2229 2061 7320 6465 7374 3a0d  , "w") as dest:.
+000117e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000117f0: 2073 6875 7469 6c2e 636f 7079 6669 6c65   shutil.copyfile
+00011800: 6f62 6a28 7372 632c 2064 6573 742c 2031  obj(src, dest, 1
+00011810: 3032 3420 2a20 3829 0d0a 0d0a 2020 2020  024 * 8)....    
+00011820: 6465 6620 7772 6974 6573 7472 280d 0a20  def writestr(.. 
+00011830: 2020 2020 2020 2073 656c 662c 0d0a 2020         self,..  
+00011840: 2020 2020 2020 7a69 6e66 6f5f 6f72 5f61        zinfo_or_a
+00011850: 7263 6e61 6d65 2c0d 0a20 2020 2020 2020  rcname,..       
+00011860: 2064 6174 612c 0d0a 2020 2020 2020 2020   data,..        
+00011870: 636f 6d70 7265 7373 5f74 7970 653d 4e6f  compress_type=No
+00011880: 6e65 2c0d 0a20 2020 2020 2020 2063 6f6d  ne,..        com
+00011890: 7072 6573 736c 6576 656c 3d4e 6f6e 652c  presslevel=None,
+000118a0: 0d0a 2020 2020 293a 0d0a 2020 2020 2020  ..    ):..      
+000118b0: 2020 2222 2257 7269 7465 2061 2066 696c    """Write a fil
+000118c0: 6520 696e 746f 2074 6865 2061 7263 6869  e into the archi
+000118d0: 7665 2e20 2054 6865 2063 6f6e 7465 6e74  ve.  The content
+000118e0: 7320 6973 2027 6461 7461 272c 2077 6869  s is 'data', whi
+000118f0: 6368 0d0a 2020 2020 2020 2020 6d61 7920  ch..        may 
+00011900: 6265 2065 6974 6865 7220 6120 2773 7472  be either a 'str
+00011910: 2720 6f72 2061 2027 6279 7465 7327 2069  ' or a 'bytes' i
+00011920: 6e73 7461 6e63 653b 2069 6620 6974 2069  nstance; if it i
+00011930: 7320 6120 2773 7472 272c 0d0a 2020 2020  s a 'str',..    
+00011940: 2020 2020 6974 2069 7320 656e 636f 6465      it is encode
+00011950: 6420 6173 2055 5446 2d38 2066 6972 7374  d as UTF-8 first
+00011960: 2e0d 0a20 2020 2020 2020 2027 7a69 6e66  ...        'zinf
+00011970: 6f5f 6f72 5f61 7263 6e61 6d65 2720 6973  o_or_arcname' is
+00011980: 2065 6974 6865 7220 6120 5a69 7049 6e66   either a ZipInf
+00011990: 6f20 696e 7374 616e 6365 206f 720d 0a20  o instance or.. 
+000119a0: 2020 2020 2020 2074 6865 206e 616d 6520         the name 
+000119b0: 6f66 2074 6865 2066 696c 6520 696e 2074  of the file in t
+000119c0: 6865 2061 7263 6869 7665 2e0d 0a20 2020  he archive...   
+000119d0: 2020 2020 2022 2222 0d0a 2020 2020 2020       """..      
+000119e0: 2020 6966 2069 7369 6e73 7461 6e63 6528    if isinstance(
+000119f0: 6461 7461 2c20 7374 7229 3a0d 0a20 2020  data, str):..   
+00011a00: 2020 2020 2020 2020 2064 6174 6120 3d20           data = 
+00011a10: 6461 7461 2e65 6e63 6f64 6528 2275 7466  data.encode("utf
+00011a20: 2d38 2229 0d0a 2020 2020 2020 2020 6966  -8")..        if
+00011a30: 206e 6f74 2069 7369 6e73 7461 6e63 6528   not isinstance(
+00011a40: 7a69 6e66 6f5f 6f72 5f61 7263 6e61 6d65  zinfo_or_arcname
+00011a50: 2c20 5a69 7049 6e66 6f29 3a0d 0a20 2020  , ZipInfo):..   
+00011a60: 2020 2020 2020 2020 207a 696e 666f 203d           zinfo =
+00011a70: 205a 6970 496e 666f 280d 0a20 2020 2020   ZipInfo(..     
+00011a80: 2020 2020 2020 2020 2020 2066 696c 656e             filen
+00011a90: 616d 653d 7a69 6e66 6f5f 6f72 5f61 7263  ame=zinfo_or_arc
+00011aa0: 6e61 6d65 2c0d 0a20 2020 2020 2020 2020  name,..         
+00011ab0: 2020 2020 2020 2064 6174 655f 7469 6d65         date_time
+00011ac0: 3d74 696d 652e 6c6f 6361 6c74 696d 6528  =time.localtime(
+00011ad0: 7469 6d65 2e74 696d 6528 2929 5b3a 365d  time.time())[:6]
+00011ae0: 2c0d 0a20 2020 2020 2020 2020 2020 2029  ,..            )
+00011af0: 0d0a 2020 2020 2020 2020 2020 2020 7a69  ..            zi
+00011b00: 6e66 6f2e 636f 6d70 7265 7373 5f74 7970  nfo.compress_typ
+00011b10: 6520 3d20 7365 6c66 2e63 6f6d 7072 6573  e = self.compres
+00011b20: 7369 6f6e 0d0a 2020 2020 2020 2020 2020  sion..          
+00011b30: 2020 7a69 6e66 6f2e 5f63 6f6d 7072 6573    zinfo._compres
+00011b40: 736c 6576 656c 203d 2073 656c 662e 636f  slevel = self.co
+00011b50: 6d70 7265 7373 6c65 7665 6c0d 0a20 2020  mpresslevel..   
+00011b60: 2020 2020 2020 2020 2069 6620 7a69 6e66           if zinf
+00011b70: 6f2e 6669 6c65 6e61 6d65 5b2d 315d 203d  o.filename[-1] =
+00011b80: 3d20 222f 223a 0d0a 2020 2020 2020 2020  = "/":..        
+00011b90: 2020 2020 2020 2020 7a69 6e66 6f2e 6578          zinfo.ex
+00011ba0: 7465 726e 616c 5f61 7474 7220 3d20 306f  ternal_attr = 0o
+00011bb0: 3430 3737 3520 3c3c 2031 3620 2023 2064  40775 << 16  # d
+00011bc0: 7277 7872 7778 722d 780d 0a20 2020 2020  rwxrwxr-x..     
+00011bd0: 2020 2020 2020 2020 2020 207a 696e 666f             zinfo
+00011be0: 2e65 7874 6572 6e61 6c5f 6174 7472 207c  .external_attr |
+00011bf0: 3d20 3078 3130 2020 2320 4d53 2d44 4f53  = 0x10  # MS-DOS
+00011c00: 2064 6972 6563 746f 7279 2066 6c61 670d   directory flag.
+00011c10: 0a20 2020 2020 2020 2020 2020 2065 6c73  .            els
+00011c20: 653a 0d0a 2020 2020 2020 2020 2020 2020  e:..            
+00011c30: 2020 2020 7a69 6e66 6f2e 6578 7465 726e      zinfo.extern
+00011c40: 616c 5f61 7474 7220 3d20 306f 3630 3020  al_attr = 0o600 
+00011c50: 3c3c 2031 3620 2023 203f 7277 2d2d 2d2d  << 16  # ?rw----
+00011c60: 2d2d 2d0d 0a20 2020 2020 2020 2065 6c73  ---..        els
+00011c70: 653a 0d0a 2020 2020 2020 2020 2020 2020  e:..            
+00011c80: 7a69 6e66 6f20 3d20 7a69 6e66 6f5f 6f72  zinfo = zinfo_or
+00011c90: 5f61 7263 6e61 6d65 0d0a 0d0a 2020 2020  _arcname....    
+00011ca0: 2020 2020 6966 206e 6f74 2073 656c 662e      if not self.
+00011cb0: 6670 3a0d 0a20 2020 2020 2020 2020 2020  fp:..           
+00011cc0: 2072 6169 7365 2056 616c 7565 4572 726f   raise ValueErro
+00011cd0: 7228 0d0a 2020 2020 2020 2020 2020 2020  r(..            
+00011ce0: 2020 2020 2241 7474 656d 7074 2074 6f20      "Attempt to 
+00011cf0: 7772 6974 6520 746f 205a 4950 2061 7263  write to ZIP arc
+00011d00: 6869 7665 2074 6861 7420 7761 7320 616c  hive that was al
+00011d10: 7265 6164 7920 636c 6f73 6564 222c 0d0a  ready closed",..
+00011d20: 2020 2020 2020 2020 2020 2020 290d 0a20              ).. 
+00011d30: 2020 2020 2020 2069 6620 7365 6c66 2e5f         if self._
+00011d40: 7772 6974 696e 673a 0d0a 2020 2020 2020  writing:..      
+00011d50: 2020 2020 2020 7261 6973 6520 5661 6c75        raise Valu
+00011d60: 6545 7272 6f72 280d 0a20 2020 2020 2020  eError(..       
+00011d70: 2020 2020 2020 2020 2022 4361 6e27 7420           "Can't 
+00011d80: 7772 6974 6520 746f 205a 4950 2061 7263  write to ZIP arc
+00011d90: 6869 7665 2077 6869 6c65 2061 6e20 6f70  hive while an op
+00011da0: 656e 2077 7269 7469 6e67 2068 616e 646c  en writing handl
+00011db0: 6520 6578 6973 7473 2e22 2c0d 0a20 2020  e exists.",..   
+00011dc0: 2020 2020 2020 2020 2029 0d0a 0d0a 2020           )....  
+00011dd0: 2020 2020 2020 6966 2063 6f6d 7072 6573        if compres
+00011de0: 735f 7479 7065 2069 7320 6e6f 7420 4e6f  s_type is not No
+00011df0: 6e65 3a0d 0a20 2020 2020 2020 2020 2020  ne:..           
+00011e00: 207a 696e 666f 2e63 6f6d 7072 6573 735f   zinfo.compress_
+00011e10: 7479 7065 203d 2063 6f6d 7072 6573 735f  type = compress_
+00011e20: 7479 7065 0d0a 0d0a 2020 2020 2020 2020  type....        
+00011e30: 6966 2063 6f6d 7072 6573 736c 6576 656c  if compresslevel
+00011e40: 2069 7320 6e6f 7420 4e6f 6e65 3a0d 0a20   is not None:.. 
+00011e50: 2020 2020 2020 2020 2020 207a 696e 666f             zinfo
+00011e60: 2e5f 636f 6d70 7265 7373 6c65 7665 6c20  ._compresslevel 
+00011e70: 3d20 636f 6d70 7265 7373 6c65 7665 6c0d  = compresslevel.
+00011e80: 0a0d 0a20 2020 2020 2020 207a 696e 666f  ...        zinfo
+00011e90: 2e66 696c 655f 7369 7a65 203d 206c 656e  .file_size = len
+00011ea0: 2864 6174 6129 2020 2320 556e 636f 6d70  (data)  # Uncomp
+00011eb0: 7265 7373 6564 2073 697a 650d 0a20 2020  ressed size..   
+00011ec0: 2020 2020 2077 6974 6820 7365 6c66 2e5f       with self._
+00011ed0: 6c6f 636b 2c20 7365 6c66 2e6f 7065 6e28  lock, self.open(
+00011ee0: 7a69 6e66 6f2c 206d 6f64 653d 2277 2229  zinfo, mode="w")
+00011ef0: 2061 7320 6465 7374 3a0d 0a20 2020 2020   as dest:..     
+00011f00: 2020 2020 2020 2064 6573 742e 7772 6974         dest.writ
+00011f10: 6528 6461 7461 290d 0a0d 0a20 2020 2064  e(data)....    d
+00011f20: 6566 205f 5f64 656c 5f5f 2873 656c 6629  ef __del__(self)
+00011f30: 202d 3e20 4e6f 6e65 3a0d 0a20 2020 2020   -> None:..     
+00011f40: 2020 2022 2222 4361 6c6c 2074 6865 2022     """Call the "
+00011f50: 636c 6f73 6528 2922 206d 6574 686f 6420  close()" method 
+00011f60: 696e 2063 6173 6520 7468 6520 7573 6572  in case the user
+00011f70: 2066 6f72 676f 742e 2222 220d 0a20 2020   forgot."""..   
+00011f80: 2020 2020 2073 656c 662e 636c 6f73 6528       self.close(
+00011f90: 290d 0a0d 0a20 2020 2064 6566 2063 6c6f  )....    def clo
+00011fa0: 7365 2873 656c 6629 3a0d 0a20 2020 2020  se(self):..     
+00011fb0: 2020 2022 2222 436c 6f73 6520 7468 6520     """Close the 
+00011fc0: 6669 6c65 2c20 616e 6420 666f 7220 6d6f  file, and for mo
+00011fd0: 6465 2027 7727 2c20 2778 2720 616e 6420  de 'w', 'x' and 
+00011fe0: 2761 2720 7772 6974 6520 7468 6520 656e  'a' write the en
+00011ff0: 6469 6e67 0d0a 2020 2020 2020 2020 7265  ding..        re
+00012000: 636f 7264 732e 0d0a 2020 2020 2020 2020  cords...        
+00012010: 2222 220d 0a20 2020 2020 2020 2069 6620  """..        if 
+00012020: 7365 6c66 2e66 7020 6973 204e 6f6e 653a  self.fp is None:
+00012030: 0d0a 2020 2020 2020 2020 2020 2020 7265  ..            re
+00012040: 7475 726e 0d0a 0d0a 2020 2020 2020 2020  turn....        
+00012050: 6966 2073 656c 662e 5f77 7269 7469 6e67  if self._writing
+00012060: 3a0d 0a20 2020 2020 2020 2020 2020 2072  :..            r
+00012070: 6169 7365 2056 616c 7565 4572 726f 7228  aise ValueError(
+00012080: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00012090: 2020 2243 616e 2774 2063 6c6f 7365 2074    "Can't close t
+000120a0: 6865 205a 4950 2066 696c 6520 7768 696c  he ZIP file whil
+000120b0: 6520 7468 6572 6520 6973 2022 0d0a 2020  e there is "..  
+000120c0: 2020 2020 2020 2020 2020 2020 2020 2261                "a
+000120d0: 6e20 6f70 656e 2077 7269 7469 6e67 2068  n open writing h
+000120e0: 616e 646c 6520 6f6e 2069 742e 2022 0d0a  andle on it. "..
+000120f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012100: 2243 6c6f 7365 2074 6865 2077 7269 7469  "Close the writi
+00012110: 6e67 2068 616e 646c 6520 6265 666f 7265  ng handle before
+00012120: 2063 6c6f 7369 6e67 2074 6865 207a 6970   closing the zip
+00012130: 2e22 2c0d 0a20 2020 2020 2020 2020 2020  .",..           
+00012140: 2029 0d0a 0d0a 2020 2020 2020 2020 7472   )....        tr
+00012150: 793a 0d0a 2020 2020 2020 2020 2020 2020  y:..            
+00012160: 6966 2028 0d0a 2020 2020 2020 2020 2020  if (..          
+00012170: 2020 2020 2020 7365 6c66 2e6d 6f64 6520        self.mode 
+00012180: 696e 2028 2277 222c 2022 7822 2c20 2261  in ("w", "x", "a
+00012190: 2229 2061 6e64 2073 656c 662e 5f64 6964  ") and self._did
+000121a0: 4d6f 6469 6679 0d0a 2020 2020 2020 2020  Modify..        
+000121b0: 2020 2020 293a 2020 2320 7772 6974 6520      ):  # write 
+000121c0: 656e 6469 6e67 2072 6563 6f72 6473 0d0a  ending records..
+000121d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000121e0: 7769 7468 2073 656c 662e 5f6c 6f63 6b3a  with self._lock:
+000121f0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00012200: 2020 2020 2020 6966 2073 656c 662e 5f73        if self._s
+00012210: 6565 6b61 626c 653a 0d0a 2020 2020 2020  eekable:..      
+00012220: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012230: 2020 7365 6c66 2e66 702e 7365 656b 2873    self.fp.seek(s
+00012240: 656c 662e 7374 6172 745f 6469 7229 0d0a  elf.start_dir)..
+00012250: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012260: 2020 2020 7365 6c66 2e5f 7772 6974 655f      self._write_
+00012270: 656e 645f 7265 636f 7264 2829 0d0a 2020  end_record()..  
+00012280: 2020 2020 2020 6669 6e61 6c6c 793a 0d0a        finally:..
+00012290: 2020 2020 2020 2020 2020 2020 6670 203d              fp =
+000122a0: 2073 656c 662e 6670 0d0a 2020 2020 2020   self.fp..      
+000122b0: 2020 2020 2020 7365 6c66 2e66 7020 3d20        self.fp = 
+000122c0: 4e6f 6e65 0d0a 2020 2020 2020 2020 2020  None..          
+000122d0: 2020 7365 6c66 2e5f 6670 636c 6f73 6528    self._fpclose(
+000122e0: 6670 290d 0a0d 0a20 2020 2064 6566 205f  fp)....    def _
+000122f0: 7772 6974 655f 656e 645f 7265 636f 7264  write_end_record
+00012300: 2873 656c 6629 3a0d 0a20 2020 2020 2020  (self):..       
+00012310: 2066 6f72 207a 696e 666f 2069 6e20 7365   for zinfo in se
+00012320: 6c66 2e66 696c 656c 6973 743a 2020 2320  lf.filelist:  # 
+00012330: 7772 6974 6520 6365 6e74 7261 6c20 6469  write central di
+00012340: 7265 6374 6f72 790d 0a20 2020 2020 2020  rectory..       
+00012350: 2020 2020 2064 7420 3d20 7a69 6e66 6f2e       dt = zinfo.
+00012360: 6461 7465 5f74 696d 650d 0a20 2020 2020  date_time..     
+00012370: 2020 2020 2020 2064 6f73 6461 7465 203d         dosdate =
+00012380: 2028 6474 5b30 5d20 2d20 3139 3830 2920   (dt[0] - 1980) 
+00012390: 3c3c 2039 207c 2064 745b 315d 203c 3c20  << 9 | dt[1] << 
+000123a0: 3520 7c20 6474 5b32 5d0d 0a20 2020 2020  5 | dt[2]..     
+000123b0: 2020 2020 2020 2064 6f73 7469 6d65 203d         dostime =
+000123c0: 2064 745b 335d 203c 3c20 3131 207c 2064   dt[3] << 11 | d
+000123d0: 745b 345d 203c 3c20 3520 7c20 2864 745b  t[4] << 5 | (dt[
+000123e0: 355d 202f 2f20 3229 0d0a 2020 2020 2020  5] // 2)..      
+000123f0: 2020 2020 2020 6578 7472 6120 3d20 5b5d        extra = []
+00012400: 0d0a 2020 2020 2020 2020 2020 2020 6966  ..            if
+00012410: 2028 0d0a 2020 2020 2020 2020 2020 2020   (..            
+00012420: 2020 2020 7a69 6e66 6f2e 6669 6c65 5f73      zinfo.file_s
+00012430: 697a 6520 3e20 5a49 5036 345f 4c49 4d49  ize > ZIP64_LIMI
+00012440: 540d 0a20 2020 2020 2020 2020 2020 2020  T..             
+00012450: 2020 206f 7220 7a69 6e66 6f2e 636f 6d70     or zinfo.comp
+00012460: 7265 7373 5f73 697a 6520 3e20 5a49 5036  ress_size > ZIP6
+00012470: 345f 4c49 4d49 540d 0a20 2020 2020 2020  4_LIMIT..       
+00012480: 2020 2020 2029 3a0d 0a20 2020 2020 2020       ):..       
+00012490: 2020 2020 2020 2020 2065 7874 7261 2e61           extra.a
+000124a0: 7070 656e 6428 7a69 6e66 6f2e 6669 6c65  ppend(zinfo.file
+000124b0: 5f73 697a 6529 0d0a 2020 2020 2020 2020  _size)..        
+000124c0: 2020 2020 2020 2020 6578 7472 612e 6170          extra.ap
+000124d0: 7065 6e64 287a 696e 666f 2e63 6f6d 7072  pend(zinfo.compr
+000124e0: 6573 735f 7369 7a65 290d 0a20 2020 2020  ess_size)..     
+000124f0: 2020 2020 2020 2020 2020 2066 696c 655f             file_
+00012500: 7369 7a65 203d 2030 7846 4646 4646 4646  size = 0xFFFFFFF
+00012510: 460d 0a20 2020 2020 2020 2020 2020 2020  F..             
+00012520: 2020 2063 6f6d 7072 6573 735f 7369 7a65     compress_size
+00012530: 203d 2030 7846 4646 4646 4646 460d 0a20   = 0xFFFFFFFF.. 
+00012540: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
+00012550: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00012560: 2020 6669 6c65 5f73 697a 6520 3d20 7a69    file_size = zi
+00012570: 6e66 6f2e 6669 6c65 5f73 697a 650d 0a20  nfo.file_size.. 
+00012580: 2020 2020 2020 2020 2020 2020 2020 2063                 c
+00012590: 6f6d 7072 6573 735f 7369 7a65 203d 207a  ompress_size = z
+000125a0: 696e 666f 2e63 6f6d 7072 6573 735f 7369  info.compress_si
+000125b0: 7a65 0d0a 0d0a 2020 2020 2020 2020 2020  ze....          
+000125c0: 2020 6966 207a 696e 666f 2e68 6561 6465    if zinfo.heade
+000125d0: 725f 6f66 6673 6574 203e 205a 4950 3634  r_offset > ZIP64
+000125e0: 5f4c 494d 4954 3a0d 0a20 2020 2020 2020  _LIMIT:..       
+000125f0: 2020 2020 2020 2020 2065 7874 7261 2e61           extra.a
+00012600: 7070 656e 6428 7a69 6e66 6f2e 6865 6164  ppend(zinfo.head
+00012610: 6572 5f6f 6666 7365 7429 0d0a 2020 2020  er_offset)..    
+00012620: 2020 2020 2020 2020 2020 2020 6865 6164              head
+00012630: 6572 5f6f 6666 7365 7420 3d20 3078 4646  er_offset = 0xFF
+00012640: 4646 4646 4646 0d0a 2020 2020 2020 2020  FFFFFF..        
+00012650: 2020 2020 656c 7365 3a0d 0a20 2020 2020      else:..     
+00012660: 2020 2020 2020 2020 2020 2068 6561 6465             heade
+00012670: 725f 6f66 6673 6574 203d 207a 696e 666f  r_offset = zinfo
+00012680: 2e68 6561 6465 725f 6f66 6673 6574 0d0a  .header_offset..
+00012690: 0d0a 2020 2020 2020 2020 2020 2020 6578  ..            ex
+000126a0: 7472 615f 6461 7461 203d 207a 696e 666f  tra_data = zinfo
+000126b0: 2e65 7874 7261 0d0a 2020 2020 2020 2020  .extra..        
+000126c0: 2020 2020 6d69 6e5f 7665 7273 696f 6e20      min_version 
+000126d0: 3d20 300d 0a20 2020 2020 2020 2020 2020  = 0..           
+000126e0: 2069 6620 6578 7472 613a 0d0a 2020 2020   if extra:..    
+000126f0: 2020 2020 2020 2020 2020 2020 2320 4170              # Ap
+00012700: 7065 6e64 2061 205a 4950 3634 2066 6965  pend a ZIP64 fie
+00012710: 6c64 2074 6f20 7468 6520 6578 7472 6127  ld to the extra'
+00012720: 730d 0a20 2020 2020 2020 2020 2020 2020  s..             
+00012730: 2020 2065 7874 7261 5f64 6174 6120 3d20     extra_data = 
+00012740: 5f73 7472 6970 5f65 7874 7261 2865 7874  _strip_extra(ext
+00012750: 7261 5f64 6174 612c 2028 312c 2929 0d0a  ra_data, (1,))..
+00012760: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012770: 6578 7472 615f 6461 7461 203d 2028 0d0a  extra_data = (..
+00012780: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012790: 2020 2020 7374 7275 6374 2e70 6163 6b28      struct.pack(
+000127a0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+000127b0: 2020 2020 2020 2020 2020 223c 4848 2220            "<HH" 
+000127c0: 2b20 2251 2220 2a20 6c65 6e28 6578 7472  + "Q" * len(extr
+000127d0: 6129 2c0d 0a20 2020 2020 2020 2020 2020  a),..           
+000127e0: 2020 2020 2020 2020 2020 2020 2031 2c0d               1,.
+000127f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00012800: 2020 2020 2020 2020 2038 202a 206c 656e           8 * len
+00012810: 2865 7874 7261 292c 0d0a 2020 2020 2020  (extra),..      
+00012820: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012830: 2020 2a65 7874 7261 2c0d 0a20 2020 2020    *extra,..     
+00012840: 2020 2020 2020 2020 2020 2020 2020 2029                 )
+00012850: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00012860: 2020 2020 2020 2b20 6578 7472 615f 6461        + extra_da
+00012870: 7461 0d0a 2020 2020 2020 2020 2020 2020  ta..            
+00012880: 2020 2020 290d 0a0d 0a20 2020 2020 2020      )....       
+00012890: 2020 2020 2020 2020 206d 696e 5f76 6572           min_ver
+000128a0: 7369 6f6e 203d 205a 4950 3634 5f56 4552  sion = ZIP64_VER
+000128b0: 5349 4f4e 0d0a 0d0a 2020 2020 2020 2020  SION....        
+000128c0: 2020 2020 6966 207a 696e 666f 2e63 6f6d      if zinfo.com
+000128d0: 7072 6573 735f 7479 7065 203d 3d20 5a49  press_type == ZI
+000128e0: 505f 425a 4950 323a 0d0a 2020 2020 2020  P_BZIP2:..      
+000128f0: 2020 2020 2020 2020 2020 6d69 6e5f 7665            min_ve
+00012900: 7273 696f 6e20 3d20 6d61 7828 425a 4950  rsion = max(BZIP
+00012910: 325f 5645 5253 494f 4e2c 206d 696e 5f76  2_VERSION, min_v
+00012920: 6572 7369 6f6e 290d 0a20 2020 2020 2020  ersion)..       
+00012930: 2020 2020 2065 6c69 6620 7a69 6e66 6f2e       elif zinfo.
+00012940: 636f 6d70 7265 7373 5f74 7970 6520 3d3d  compress_type ==
+00012950: 205a 4950 5f4c 5a4d 413a 0d0a 2020 2020   ZIP_LZMA:..    
+00012960: 2020 2020 2020 2020 2020 2020 6d69 6e5f              min_
+00012970: 7665 7273 696f 6e20 3d20 6d61 7828 4c5a  version = max(LZ
+00012980: 4d41 5f56 4552 5349 4f4e 2c20 6d69 6e5f  MA_VERSION, min_
+00012990: 7665 7273 696f 6e29 0d0a 0d0a 2020 2020  version)....    
+000129a0: 2020 2020 2020 2020 6578 7472 6163 745f          extract_
+000129b0: 7665 7273 696f 6e20 3d20 6d61 7828 6d69  version = max(mi
+000129c0: 6e5f 7665 7273 696f 6e2c 207a 696e 666f  n_version, zinfo
+000129d0: 2e65 7874 7261 6374 5f76 6572 7369 6f6e  .extract_version
+000129e0: 290d 0a20 2020 2020 2020 2020 2020 2063  )..            c
+000129f0: 7265 6174 655f 7665 7273 696f 6e20 3d20  reate_version = 
+00012a00: 6d61 7828 6d69 6e5f 7665 7273 696f 6e2c  max(min_version,
+00012a10: 207a 696e 666f 2e63 7265 6174 655f 7665   zinfo.create_ve
+00012a20: 7273 696f 6e29 0d0a 2020 2020 2020 2020  rsion)..        
+00012a30: 2020 2020 6669 6c65 6e61 6d65 2c20 666c      filename, fl
+00012a40: 6167 5f62 6974 7320 3d20 7a69 6e66 6f2e  ag_bits = zinfo.
+00012a50: 5f65 6e63 6f64 6546 696c 656e 616d 6546  _encodeFilenameF
+00012a60: 6c61 6773 2829 0d0a 2020 2020 2020 2020  lags()..        
+00012a70: 2020 2020 6365 6e74 6469 7220 3d20 7374      centdir = st
+00012a80: 7275 6374 2e70 6163 6b28 0d0a 2020 2020  ruct.pack(..    
+00012a90: 2020 2020 2020 2020 2020 2020 7374 7275              stru
+00012aa0: 6374 4365 6e74 7261 6c44 6972 2c0d 0a20  ctCentralDir,.. 
+00012ab0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+00012ac0: 7472 696e 6743 656e 7472 616c 4469 722c  tringCentralDir,
+00012ad0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00012ae0: 2020 6372 6561 7465 5f76 6572 7369 6f6e    create_version
+00012af0: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
+00012b00: 2020 207a 696e 666f 2e63 7265 6174 655f     zinfo.create_
+00012b10: 7379 7374 656d 2c0d 0a20 2020 2020 2020  system,..       
+00012b20: 2020 2020 2020 2020 2065 7874 7261 6374           extract
+00012b30: 5f76 6572 7369 6f6e 2c0d 0a20 2020 2020  _version,..     
+00012b40: 2020 2020 2020 2020 2020 207a 696e 666f             zinfo
+00012b50: 2e72 6573 6572 7665 642c 0d0a 2020 2020  .reserved,..    
+00012b60: 2020 2020 2020 2020 2020 2020 666c 6167              flag
+00012b70: 5f62 6974 732c 0d0a 2020 2020 2020 2020  _bits,..        
+00012b80: 2020 2020 2020 2020 7a69 6e66 6f2e 636f          zinfo.co
+00012b90: 6d70 7265 7373 5f74 7970 652c 0d0a 2020  mpress_type,..  
+00012ba0: 2020 2020 2020 2020 2020 2020 2020 646f                do
+00012bb0: 7374 696d 652c 0d0a 2020 2020 2020 2020  stime,..        
+00012bc0: 2020 2020 2020 2020 646f 7364 6174 652c          dosdate,
+00012bd0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00012be0: 2020 7a69 6e66 6f2e 4352 432c 0d0a 2020    zinfo.CRC,..  
+00012bf0: 2020 2020 2020 2020 2020 2020 2020 636f                co
+00012c00: 6d70 7265 7373 5f73 697a 652c 0d0a 2020  mpress_size,..  
+00012c10: 2020 2020 2020 2020 2020 2020 2020 6669                fi
+00012c20: 6c65 5f73 697a 652c 0d0a 2020 2020 2020  le_size,..      
+00012c30: 2020 2020 2020 2020 2020 6c65 6e28 6669            len(fi
+00012c40: 6c65 6e61 6d65 292c 0d0a 2020 2020 2020  lename),..      
+00012c50: 2020 2020 2020 2020 2020 6c65 6e28 6578            len(ex
+00012c60: 7472 615f 6461 7461 292c 0d0a 2020 2020  tra_data),..    
+00012c70: 2020 2020 2020 2020 2020 2020 6c65 6e28              len(
+00012c80: 7a69 6e66 6f2e 636f 6d6d 656e 7429 2c0d  zinfo.comment),.
+00012c90: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00012ca0: 2030 2c0d 0a20 2020 2020 2020 2020 2020   0,..           
+00012cb0: 2020 2020 207a 696e 666f 2e69 6e74 6572       zinfo.inter
+00012cc0: 6e61 6c5f 6174 7472 2c0d 0a20 2020 2020  nal_attr,..     
+00012cd0: 2020 2020 2020 2020 2020 207a 696e 666f             zinfo
+00012ce0: 2e65 7874 6572 6e61 6c5f 6174 7472 2c0d  .external_attr,.
+00012cf0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00012d00: 2068 6561 6465 725f 6f66 6673 6574 2c0d   header_offset,.
+00012d10: 0a20 2020 2020 2020 2020 2020 2029 0d0a  .            )..
+00012d20: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00012d30: 2e66 702e 7772 6974 6528 6365 6e74 6469  .fp.write(centdi
+00012d40: 7229 0d0a 2020 2020 2020 2020 2020 2020  r)..            
+00012d50: 7365 6c66 2e66 702e 7772 6974 6528 6669  self.fp.write(fi
+00012d60: 6c65 6e61 6d65 290d 0a20 2020 2020 2020  lename)..       
+00012d70: 2020 2020 2073 656c 662e 6670 2e77 7269       self.fp.wri
+00012d80: 7465 2865 7874 7261 5f64 6174 6129 0d0a  te(extra_data)..
+00012d90: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00012da0: 2e66 702e 7772 6974 6528 7a69 6e66 6f2e  .fp.write(zinfo.
+00012db0: 636f 6d6d 656e 7429 0d0a 0d0a 2020 2020  comment)....    
+00012dc0: 2020 2020 706f 7332 203d 2073 656c 662e      pos2 = self.
+00012dd0: 6670 2e74 656c 6c28 290d 0a20 2020 2020  fp.tell()..     
+00012de0: 2020 2023 2057 7269 7465 2065 6e64 2d6f     # Write end-o
+00012df0: 662d 7a69 702d 6172 6368 6976 6520 7265  f-zip-archive re
+00012e00: 636f 7264 0d0a 2020 2020 2020 2020 6365  cord..        ce
+00012e10: 6e74 4469 7243 6f75 6e74 203d 206c 656e  ntDirCount = len
+00012e20: 2873 656c 662e 6669 6c65 6c69 7374 290d  (self.filelist).
+00012e30: 0a20 2020 2020 2020 2063 656e 7444 6972  .        centDir
+00012e40: 5369 7a65 203d 2070 6f73 3220 2d20 7365  Size = pos2 - se
+00012e50: 6c66 2e73 7461 7274 5f64 6972 0d0a 2020  lf.start_dir..  
+00012e60: 2020 2020 2020 6365 6e74 4469 724f 6666        centDirOff
+00012e70: 7365 7420 3d20 7365 6c66 2e73 7461 7274  set = self.start
+00012e80: 5f64 6972 0d0a 2020 2020 2020 2020 7265  _dir..        re
+00012e90: 7175 6972 6573 5f7a 6970 3634 203d 204e  quires_zip64 = N
+00012ea0: 6f6e 650d 0a20 2020 2020 2020 2069 6620  one..        if 
+00012eb0: 6365 6e74 4469 7243 6f75 6e74 203e 205a  centDirCount > Z
+00012ec0: 4950 5f46 494c 4543 4f55 4e54 5f4c 494d  IP_FILECOUNT_LIM
+00012ed0: 4954 3a0d 0a20 2020 2020 2020 2020 2020  IT:..           
+00012ee0: 2072 6571 7569 7265 735f 7a69 7036 3420   requires_zip64 
+00012ef0: 3d20 2246 696c 6573 2063 6f75 6e74 220d  = "Files count".
+00012f00: 0a20 2020 2020 2020 2065 6c69 6620 6365  .        elif ce
+00012f10: 6e74 4469 724f 6666 7365 7420 3e20 5a49  ntDirOffset > ZI
+00012f20: 5036 345f 4c49 4d49 543a 0d0a 2020 2020  P64_LIMIT:..    
+00012f30: 2020 2020 2020 2020 7265 7175 6972 6573          requires
+00012f40: 5f7a 6970 3634 203d 2022 4365 6e74 7261  _zip64 = "Centra
+00012f50: 6c20 6469 7265 6374 6f72 7920 6f66 6673  l directory offs
+00012f60: 6574 220d 0a20 2020 2020 2020 2065 6c69  et"..        eli
+00012f70: 6620 6365 6e74 4469 7253 697a 6520 3e20  f centDirSize > 
+00012f80: 5a49 5036 345f 4c49 4d49 543a 0d0a 2020  ZIP64_LIMIT:..  
+00012f90: 2020 2020 2020 2020 2020 7265 7175 6972            requir
+00012fa0: 6573 5f7a 6970 3634 203d 2022 4365 6e74  es_zip64 = "Cent
+00012fb0: 7261 6c20 6469 7265 6374 6f72 7920 7369  ral directory si
+00012fc0: 7a65 220d 0a20 2020 2020 2020 2069 6620  ze"..        if 
+00012fd0: 7265 7175 6972 6573 5f7a 6970 3634 3a0d  requires_zip64:.
+00012fe0: 0a20 2020 2020 2020 2020 2020 2023 204e  .            # N
+00012ff0: 6565 6420 746f 2077 7269 7465 2074 6865  eed to write the
+00013000: 205a 4950 3634 2065 6e64 2d6f 662d 6172   ZIP64 end-of-ar
+00013010: 6368 6976 6520 7265 636f 7264 730d 0a20  chive records.. 
+00013020: 2020 2020 2020 2020 2020 2069 6620 6e6f             if no
+00013030: 7420 7365 6c66 2e5f 616c 6c6f 775a 6970  t self._allowZip
+00013040: 3634 3a0d 0a20 2020 2020 2020 2020 2020  64:..           
+00013050: 2020 2020 2072 6169 7365 204c 6172 6765       raise Large
+00013060: 5a69 7046 696c 6528 0d0a 2020 2020 2020  ZipFile(..      
+00013070: 2020 2020 2020 2020 2020 2020 2020 7265                re
+00013080: 7175 6972 6573 5f7a 6970 3634 202b 2022  quires_zip64 + "
+00013090: 2077 6f75 6c64 2072 6571 7569 7265 205a   would require Z
+000130a0: 4950 3634 2065 7874 656e 7369 6f6e 7322  IP64 extensions"
+000130b0: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
+000130c0: 2020 2029 0d0a 2020 2020 2020 2020 2020     )..          
+000130d0: 2020 7a69 7036 3465 6e64 7265 6320 3d20    zip64endrec = 
+000130e0: 7374 7275 6374 2e70 6163 6b28 0d0a 2020  struct.pack(..  
+000130f0: 2020 2020 2020 2020 2020 2020 2020 7374                st
+00013100: 7275 6374 456e 6441 7263 6869 7665 3634  ructEndArchive64
+00013110: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
+00013120: 2020 2073 7472 696e 6745 6e64 4172 6368     stringEndArch
+00013130: 6976 6536 342c 0d0a 2020 2020 2020 2020  ive64,..        
+00013140: 2020 2020 2020 2020 3434 2c0d 0a20 2020          44,..   
+00013150: 2020 2020 2020 2020 2020 2020 2034 352c               45,
+00013160: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00013170: 2020 3435 2c0d 0a20 2020 2020 2020 2020    45,..         
+00013180: 2020 2020 2020 2030 2c0d 0a20 2020 2020         0,..     
+00013190: 2020 2020 2020 2020 2020 2030 2c0d 0a20             0,.. 
+000131a0: 2020 2020 2020 2020 2020 2020 2020 2063                 c
+000131b0: 656e 7444 6972 436f 756e 742c 0d0a 2020  entDirCount,..  
+000131c0: 2020 2020 2020 2020 2020 2020 2020 6365                ce
+000131d0: 6e74 4469 7243 6f75 6e74 2c0d 0a20 2020  ntDirCount,..   
+000131e0: 2020 2020 2020 2020 2020 2020 2063 656e               cen
+000131f0: 7444 6972 5369 7a65 2c0d 0a20 2020 2020  tDirSize,..     
+00013200: 2020 2020 2020 2020 2020 2063 656e 7444             centD
+00013210: 6972 4f66 6673 6574 2c0d 0a20 2020 2020  irOffset,..     
+00013220: 2020 2020 2020 2029 0d0a 2020 2020 2020         )..      
+00013230: 2020 2020 2020 7365 6c66 2e66 702e 7772        self.fp.wr
+00013240: 6974 6528 7a69 7036 3465 6e64 7265 6329  ite(zip64endrec)
+00013250: 0d0a 0d0a 2020 2020 2020 2020 2020 2020  ....            
+00013260: 7a69 7036 346c 6f63 7265 6320 3d20 7374  zip64locrec = st
+00013270: 7275 6374 2e70 6163 6b28 0d0a 2020 2020  ruct.pack(..    
+00013280: 2020 2020 2020 2020 2020 2020 7374 7275              stru
+00013290: 6374 456e 6441 7263 6869 7665 3634 4c6f  ctEndArchive64Lo
+000132a0: 6361 746f 722c 0d0a 2020 2020 2020 2020  cator,..        
+000132b0: 2020 2020 2020 2020 7374 7269 6e67 456e          stringEn
+000132c0: 6441 7263 6869 7665 3634 4c6f 6361 746f  dArchive64Locato
+000132d0: 722c 0d0a 2020 2020 2020 2020 2020 2020  r,..            
+000132e0: 2020 2020 302c 0d0a 2020 2020 2020 2020      0,..        
+000132f0: 2020 2020 2020 2020 706f 7332 2c0d 0a20          pos2,.. 
+00013300: 2020 2020 2020 2020 2020 2020 2020 2031                 1
+00013310: 2c0d 0a20 2020 2020 2020 2020 2020 2029  ,..            )
+00013320: 0d0a 2020 2020 2020 2020 2020 2020 7365  ..            se
+00013330: 6c66 2e66 702e 7772 6974 6528 7a69 7036  lf.fp.write(zip6
+00013340: 346c 6f63 7265 6329 0d0a 2020 2020 2020  4locrec)..      
+00013350: 2020 2020 2020 6365 6e74 4469 7243 6f75        centDirCou
+00013360: 6e74 203d 206d 696e 2863 656e 7444 6972  nt = min(centDir
+00013370: 436f 756e 742c 2030 7846 4646 4629 0d0a  Count, 0xFFFF)..
+00013380: 2020 2020 2020 2020 2020 2020 6365 6e74              cent
+00013390: 4469 7253 697a 6520 3d20 6d69 6e28 6365  DirSize = min(ce
+000133a0: 6e74 4469 7253 697a 652c 2030 7846 4646  ntDirSize, 0xFFF
+000133b0: 4646 4646 4629 0d0a 2020 2020 2020 2020  FFFFF)..        
+000133c0: 2020 2020 6365 6e74 4469 724f 6666 7365      centDirOffse
+000133d0: 7420 3d20 6d69 6e28 6365 6e74 4469 724f  t = min(centDirO
+000133e0: 6666 7365 742c 2030 7846 4646 4646 4646  ffset, 0xFFFFFFF
+000133f0: 4629 0d0a 0d0a 2020 2020 2020 2020 656e  F)....        en
+00013400: 6472 6563 203d 2073 7472 7563 742e 7061  drec = struct.pa
+00013410: 636b 280d 0a20 2020 2020 2020 2020 2020  ck(..           
+00013420: 2073 7472 7563 7445 6e64 4172 6368 6976   structEndArchiv
+00013430: 652c 0d0a 2020 2020 2020 2020 2020 2020  e,..            
+00013440: 7374 7269 6e67 456e 6441 7263 6869 7665  stringEndArchive
+00013450: 2c0d 0a20 2020 2020 2020 2020 2020 2030  ,..            0
+00013460: 2c0d 0a20 2020 2020 2020 2020 2020 2030  ,..            0
+00013470: 2c0d 0a20 2020 2020 2020 2020 2020 2063  ,..            c
+00013480: 656e 7444 6972 436f 756e 742c 0d0a 2020  entDirCount,..  
+00013490: 2020 2020 2020 2020 2020 6365 6e74 4469            centDi
+000134a0: 7243 6f75 6e74 2c0d 0a20 2020 2020 2020  rCount,..       
+000134b0: 2020 2020 2063 656e 7444 6972 5369 7a65       centDirSize
+000134c0: 2c0d 0a20 2020 2020 2020 2020 2020 2063  ,..            c
+000134d0: 656e 7444 6972 4f66 6673 6574 2c0d 0a20  entDirOffset,.. 
+000134e0: 2020 2020 2020 2020 2020 206c 656e 2873             len(s
+000134f0: 656c 662e 5f63 6f6d 6d65 6e74 292c 0d0a  elf._comment),..
+00013500: 2020 2020 2020 2020 290d 0a20 2020 2020          )..     
+00013510: 2020 2073 656c 662e 6670 2e77 7269 7465     self.fp.write
+00013520: 2865 6e64 7265 6329 0d0a 2020 2020 2020  (endrec)..      
+00013530: 2020 7365 6c66 2e66 702e 7772 6974 6528    self.fp.write(
+00013540: 7365 6c66 2e5f 636f 6d6d 656e 7429 0d0a  self._comment)..
+00013550: 2020 2020 2020 2020 7365 6c66 2e66 702e          self.fp.
+00013560: 666c 7573 6828 290d 0a0d 0a20 2020 2064  flush()....    d
+00013570: 6566 205f 6670 636c 6f73 6528 7365 6c66  ef _fpclose(self
+00013580: 2c20 6670 293a 0d0a 2020 2020 2020 2020  , fp):..        
+00013590: 6173 7365 7274 2073 656c 662e 5f66 696c  assert self._fil
+000135a0: 6552 6566 436e 7420 3e20 300d 0a20 2020  eRefCnt > 0..   
+000135b0: 2020 2020 2073 656c 662e 5f66 696c 6552       self._fileR
+000135c0: 6566 436e 7420 2d3d 2031 0d0a 2020 2020  efCnt -= 1..    
+000135d0: 2020 2020 6966 206e 6f74 2073 656c 662e      if not self.
+000135e0: 5f66 696c 6552 6566 436e 7420 616e 6420  _fileRefCnt and 
+000135f0: 6e6f 7420 7365 6c66 2e5f 6669 6c65 5061  not self._filePa
+00013600: 7373 6564 3a0d 0a20 2020 2020 2020 2020  ssed:..         
+00013610: 2020 2066 702e 636c 6f73 6528 290d 0a0d     fp.close()...
+00013620: 0a0d 0a63 6c61 7373 2050 795a 6970 4669  ...class PyZipFi
+00013630: 6c65 285a 6970 4669 6c65 293a 0d0a 2020  le(ZipFile):..  
+00013640: 2020 2222 2243 6c61 7373 2074 6f20 6372    """Class to cr
+00013650: 6561 7465 205a 4950 2061 7263 6869 7665  eate ZIP archive
+00013660: 7320 7769 7468 2050 7974 686f 6e20 6c69  s with Python li
+00013670: 6272 6172 7920 6669 6c65 7320 616e 6420  brary files and 
+00013680: 7061 636b 6167 6573 2e22 2222 0d0a 0d0a  packages."""....
+00013690: 2020 2020 6465 6620 5f5f 696e 6974 5f5f      def __init__
+000136a0: 280d 0a20 2020 2020 2020 2073 656c 662c  (..        self,
+000136b0: 0d0a 2020 2020 2020 2020 6669 6c65 2c0d  ..        file,.
+000136c0: 0a20 2020 2020 2020 206d 6f64 653d 2272  .        mode="r
+000136d0: 222c 0d0a 2020 2020 2020 2020 636f 6d70  ",..        comp
+000136e0: 7265 7373 696f 6e3d 5a49 505f 5354 4f52  ression=ZIP_STOR
+000136f0: 4544 2c0d 0a20 2020 2020 2020 2061 6c6c  ED,..        all
+00013700: 6f77 5a69 7036 343d 5472 7565 2c0d 0a20  owZip64=True,.. 
+00013710: 2020 2020 2020 206f 7074 696d 697a 653d         optimize=
+00013720: 2d31 2c0d 0a20 2020 2029 202d 3e20 4e6f  -1,..    ) -> No
+00013730: 6e65 3a0d 0a20 2020 2020 2020 205a 6970  ne:..        Zip
+00013740: 4669 6c65 2e5f 5f69 6e69 745f 5f28 0d0a  File.__init__(..
+00013750: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00013760: 2c0d 0a20 2020 2020 2020 2020 2020 2066  ,..            f
+00013770: 696c 652c 0d0a 2020 2020 2020 2020 2020  ile,..          
+00013780: 2020 6d6f 6465 3d6d 6f64 652c 0d0a 2020    mode=mode,..  
+00013790: 2020 2020 2020 2020 2020 636f 6d70 7265            compre
+000137a0: 7373 696f 6e3d 636f 6d70 7265 7373 696f  ssion=compressio
+000137b0: 6e2c 0d0a 2020 2020 2020 2020 2020 2020  n,..            
+000137c0: 616c 6c6f 775a 6970 3634 3d61 6c6c 6f77  allowZip64=allow
+000137d0: 5a69 7036 342c 0d0a 2020 2020 2020 2020  Zip64,..        
+000137e0: 290d 0a20 2020 2020 2020 2073 656c 662e  )..        self.
+000137f0: 5f6f 7074 696d 697a 6520 3d20 6f70 7469  _optimize = opti
+00013800: 6d69 7a65 0d0a 0d0a 2020 2020 6465 6620  mize....    def 
+00013810: 7772 6974 6570 7928 7365 6c66 2c20 7061  writepy(self, pa
+00013820: 7468 6e61 6d65 2c20 6261 7365 6e61 6d65  thname, basename
+00013830: 3d22 222c 2066 696c 7465 7266 756e 633d  ="", filterfunc=
+00013840: 4e6f 6e65 293a 0d0a 2020 2020 2020 2020  None):..        
+00013850: 2222 2241 6464 2061 6c6c 2066 696c 6573  """Add all files
+00013860: 2066 726f 6d20 2270 6174 686e 616d 6522   from "pathname"
+00013870: 2074 6f20 7468 6520 5a49 5020 6172 6368   to the ZIP arch
+00013880: 6976 652e 0d0a 0d0a 2020 2020 2020 2020  ive.....        
+00013890: 4966 2070 6174 686e 616d 6520 6973 2061  If pathname is a
+000138a0: 2070 6163 6b61 6765 2064 6972 6563 746f   package directo
+000138b0: 7279 2c20 7365 6172 6368 2074 6865 2064  ry, search the d
+000138c0: 6972 6563 746f 7279 2061 6e64 0d0a 2020  irectory and..  
+000138d0: 2020 2020 2020 616c 6c20 7061 636b 6167        all packag
+000138e0: 6520 7375 6264 6972 6563 746f 7269 6573  e subdirectories
+000138f0: 2072 6563 7572 7369 7665 6c79 2066 6f72   recursively for
+00013900: 2061 6c6c 202a 2e70 7920 616e 6420 656e   all *.py and en
+00013910: 7465 720d 0a20 2020 2020 2020 2074 6865  ter..        the
+00013920: 206d 6f64 756c 6573 2069 6e74 6f20 7468   modules into th
+00013930: 6520 6172 6368 6976 652e 2020 4966 2070  e archive.  If p
+00013940: 6174 686e 616d 6520 6973 2061 2070 6c61  athname is a pla
+00013950: 696e 0d0a 2020 2020 2020 2020 6469 7265  in..        dire
+00013960: 6374 6f72 792c 206c 6973 7464 6972 202a  ctory, listdir *
+00013970: 2e70 7920 616e 6420 656e 7465 7220 616c  .py and enter al
+00013980: 6c20 6d6f 6475 6c65 732e 2020 456c 7365  l modules.  Else
+00013990: 2c20 7061 7468 6e61 6d65 0d0a 2020 2020  , pathname..    
+000139a0: 2020 2020 6d75 7374 2062 6520 6120 5079      must be a Py
+000139b0: 7468 6f6e 202a 2e70 7920 6669 6c65 2061  thon *.py file a
+000139c0: 6e64 2074 6865 206d 6f64 756c 6520 7769  nd the module wi
+000139d0: 6c6c 2062 6520 7075 7420 696e 746f 2074  ll be put into t
+000139e0: 6865 0d0a 2020 2020 2020 2020 6172 6368  he..        arch
+000139f0: 6976 652e 2020 4164 6465 6420 6d6f 6475  ive.  Added modu
+00013a00: 6c65 7320 6172 6520 616c 7761 7973 206d  les are always m
+00013a10: 6f64 756c 652e 7079 632e 0d0a 2020 2020  odule.pyc...    
+00013a20: 2020 2020 5468 6973 206d 6574 686f 6420      This method 
+00013a30: 7769 6c6c 2063 6f6d 7069 6c65 2074 6865  will compile the
+00013a40: 206d 6f64 756c 652e 7079 2069 6e74 6f20   module.py into 
+00013a50: 6d6f 6475 6c65 2e70 7963 2069 660d 0a20  module.pyc if.. 
+00013a60: 2020 2020 2020 206e 6563 6573 7361 7279         necessary
+00013a70: 2e0d 0a20 2020 2020 2020 2049 6620 6669  ...        If fi
+00013a80: 6c74 6572 6675 6e63 2870 6174 686e 616d  lterfunc(pathnam
+00013a90: 6529 2069 7320 6769 7665 6e2c 2069 7420  e) is given, it 
+00013aa0: 6973 2063 616c 6c65 6420 7769 7468 2065  is called with e
+00013ab0: 7665 7279 2061 7267 756d 656e 742e 0d0a  very argument...
+00013ac0: 2020 2020 2020 2020 5768 656e 2069 7420          When it 
+00013ad0: 6973 2046 616c 7365 2c20 7468 6520 6669  is False, the fi
+00013ae0: 6c65 206f 7220 6469 7265 6374 6f72 7920  le or directory 
+00013af0: 6973 2073 6b69 7070 6564 2e0d 0a20 2020  is skipped...   
+00013b00: 2020 2020 2022 2222 0d0a 2020 2020 2020       """..      
+00013b10: 2020 7061 7468 6e61 6d65 203d 206f 732e    pathname = os.
+00013b20: 6673 7061 7468 2870 6174 686e 616d 6529  fspath(pathname)
+00013b30: 0d0a 2020 2020 2020 2020 6966 2066 696c  ..        if fil
+00013b40: 7465 7266 756e 6320 616e 6420 6e6f 7420  terfunc and not 
+00013b50: 6669 6c74 6572 6675 6e63 2870 6174 686e  filterfunc(pathn
+00013b60: 616d 6529 3a0d 0a20 2020 2020 2020 2020  ame):..         
+00013b70: 2020 2069 6620 7365 6c66 2e64 6562 7567     if self.debug
+00013b80: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+00013b90: 2020 206c 6162 656c 203d 2022 7061 7468     label = "path
+00013ba0: 2220 6966 206f 732e 7061 7468 2e69 7364  " if os.path.isd
+00013bb0: 6972 2870 6174 686e 616d 6529 2065 6c73  ir(pathname) els
+00013bc0: 6520 2266 696c 6522 0d0a 2020 2020 2020  e "file"..      
+00013bd0: 2020 2020 2020 2020 2020 7072 696e 7428            print(
+00013be0: 6622 7b6c 6162 656c 7d20 7b70 6174 686e  f"{label} {pathn
+00013bf0: 616d 6521 727d 2073 6b69 7070 6564 2062  ame!r} skipped b
+00013c00: 7920 6669 6c74 6572 6675 6e63 2229 0d0a  y filterfunc")..
+00013c10: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+00013c20: 726e 0d0a 2020 2020 2020 2020 6469 722c  rn..        dir,
+00013c30: 206e 616d 6520 3d20 6f73 2e70 6174 682e   name = os.path.
+00013c40: 7370 6c69 7428 7061 7468 6e61 6d65 290d  split(pathname).
+00013c50: 0a20 2020 2020 2020 2069 6620 6f73 2e70  .        if os.p
+00013c60: 6174 682e 6973 6469 7228 7061 7468 6e61  ath.isdir(pathna
+00013c70: 6d65 293a 0d0a 2020 2020 2020 2020 2020  me):..          
+00013c80: 2020 696e 6974 6e61 6d65 203d 206f 732e    initname = os.
+00013c90: 7061 7468 2e6a 6f69 6e28 7061 7468 6e61  path.join(pathna
+00013ca0: 6d65 2c20 225f 5f69 6e69 745f 5f2e 7079  me, "__init__.py
+00013cb0: 2229 0d0a 2020 2020 2020 2020 2020 2020  ")..            
+00013cc0: 6966 206f 732e 7061 7468 2e69 7366 696c  if os.path.isfil
+00013cd0: 6528 696e 6974 6e61 6d65 293a 0d0a 2020  e(initname):..  
+00013ce0: 2020 2020 2020 2020 2020 2020 2020 2320                # 
+00013cf0: 5468 6973 2069 7320 6120 7061 636b 6167  This is a packag
+00013d00: 6520 6469 7265 6374 6f72 792c 2061 6464  e directory, add
+00013d10: 2069 740d 0a20 2020 2020 2020 2020 2020   it..           
+00013d20: 2020 2020 2062 6173 656e 616d 6520 3d20       basename = 
+00013d30: 6622 7b62 6173 656e 616d 657d 2f7b 6e61  f"{basename}/{na
+00013d40: 6d65 7d22 2069 6620 6261 7365 6e61 6d65  me}" if basename
+00013d50: 2065 6c73 6520 6e61 6d65 0d0a 2020 2020   else name..    
+00013d60: 2020 2020 2020 2020 2020 2020 6966 2073              if s
+00013d70: 656c 662e 6465 6275 673a 0d0a 2020 2020  elf.debug:..    
+00013d80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013d90: 7072 696e 7428 2241 6464 696e 6720 7061  print("Adding pa
+00013da0: 636b 6167 6520 696e 222c 2070 6174 686e  ckage in", pathn
+00013db0: 616d 652c 2022 6173 222c 2062 6173 656e  ame, "as", basen
+00013dc0: 616d 6529 0d0a 2020 2020 2020 2020 2020  ame)..          
+00013dd0: 2020 2020 2020 666e 616d 652c 2061 7263        fname, arc
+00013de0: 6e61 6d65 203d 2073 656c 662e 5f67 6574  name = self._get
+00013df0: 5f63 6f64 656e 616d 6528 696e 6974 6e61  _codename(initna
+00013e00: 6d65 5b30 3a2d 335d 2c20 6261 7365 6e61  me[0:-3], basena
+00013e10: 6d65 290d 0a20 2020 2020 2020 2020 2020  me)..           
+00013e20: 2020 2020 2069 6620 7365 6c66 2e64 6562       if self.deb
+00013e30: 7567 3a0d 0a20 2020 2020 2020 2020 2020  ug:..           
+00013e40: 2020 2020 2020 2020 2070 7269 6e74 2822           print("
+00013e50: 4164 6469 6e67 222c 2061 7263 6e61 6d65  Adding", arcname
+00013e60: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
+00013e70: 2020 2073 656c 662e 7772 6974 6528 666e     self.write(fn
+00013e80: 616d 652c 2061 7263 6e61 6d65 290d 0a20  ame, arcname).. 
+00013e90: 2020 2020 2020 2020 2020 2020 2020 2064                 d
+00013ea0: 6972 6c69 7374 203d 2073 6f72 7465 6428  irlist = sorted(
+00013eb0: 6f73 2e6c 6973 7464 6972 2870 6174 686e  os.listdir(pathn
+00013ec0: 616d 6529 290d 0a20 2020 2020 2020 2020  ame))..         
+00013ed0: 2020 2020 2020 2064 6972 6c69 7374 2e72         dirlist.r
+00013ee0: 656d 6f76 6528 225f 5f69 6e69 745f 5f2e  emove("__init__.
+00013ef0: 7079 2229 0d0a 2020 2020 2020 2020 2020  py")..          
+00013f00: 2020 2020 2020 2320 4164 6420 616c 6c20        # Add all 
+00013f10: 2a2e 7079 2066 696c 6573 2061 6e64 2070  *.py files and p
+00013f20: 6163 6b61 6765 2073 7562 6469 7265 6374  ackage subdirect
+00013f30: 6f72 6965 730d 0a20 2020 2020 2020 2020  ories..         
+00013f40: 2020 2020 2020 2066 6f72 2066 696c 656e         for filen
+00013f50: 616d 6520 696e 2064 6972 6c69 7374 3a0d  ame in dirlist:.
+00013f60: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00013f70: 2020 2020 2070 6174 6820 3d20 6f73 2e70       path = os.p
+00013f80: 6174 682e 6a6f 696e 2870 6174 686e 616d  ath.join(pathnam
+00013f90: 652c 2066 696c 656e 616d 6529 0d0a 2020  e, filename)..  
+00013fa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013fb0: 2020 726f 6f74 2c20 6578 7420 3d20 6f73    root, ext = os
+00013fc0: 2e70 6174 682e 7370 6c69 7465 7874 2866  .path.splitext(f
+00013fd0: 696c 656e 616d 6529 0d0a 2020 2020 2020  ilename)..      
+00013fe0: 2020 2020 2020 2020 2020 2020 2020 6966                if
+00013ff0: 206f 732e 7061 7468 2e69 7364 6972 2870   os.path.isdir(p
+00014000: 6174 6829 3a0d 0a20 2020 2020 2020 2020  ath):..         
+00014010: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+00014020: 6620 6f73 2e70 6174 682e 6973 6669 6c65  f os.path.isfile
+00014030: 286f 732e 7061 7468 2e6a 6f69 6e28 7061  (os.path.join(pa
+00014040: 7468 2c20 225f 5f69 6e69 745f 5f2e 7079  th, "__init__.py
+00014050: 2229 293a 0d0a 2020 2020 2020 2020 2020  ")):..          
+00014060: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014070: 2020 2320 5468 6973 2069 7320 6120 7061    # This is a pa
+00014080: 636b 6167 6520 6469 7265 6374 6f72 792c  ckage directory,
+00014090: 2061 6464 2069 740d 0a20 2020 2020 2020   add it..       
+000140a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000140b0: 2020 2020 2073 656c 662e 7772 6974 6570       self.writep
+000140c0: 7928 0d0a 2020 2020 2020 2020 2020 2020  y(..            
+000140d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000140e0: 2020 2020 7061 7468 2c0d 0a20 2020 2020      path,..     
 000140f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014100: 7072 696e 7428 2243 6f6d 7069 6c69 6e67  print("Compiling
-00014110: 222c 2066 696c 6529 0d0a 2020 2020 2020  ", file)..      
-00014120: 2020 2020 2020 7472 793a 0d0a 2020 2020        try:..    
-00014130: 2020 2020 2020 2020 2020 2020 7079 5f63              py_c
-00014140: 6f6d 7069 6c65 2e63 6f6d 7069 6c65 2866  ompile.compile(f
-00014150: 696c 652c 2064 6f72 6169 7365 3d54 7275  ile, doraise=Tru
-00014160: 652c 206f 7074 696d 697a 653d 6f70 7469  e, optimize=opti
-00014170: 6d69 7a65 290d 0a20 2020 2020 2020 2020  mize)..         
-00014180: 2020 2065 7863 6570 7420 7079 5f63 6f6d     except py_com
-00014190: 7069 6c65 2e50 7943 6f6d 7069 6c65 4572  pile.PyCompileEr
-000141a0: 726f 7220 6173 2065 7272 3a0d 0a20 2020  ror as err:..   
-000141b0: 2020 2020 2020 2020 2020 2020 2070 7269               pri
-000141c0: 6e74 2865 7272 2e6d 7367 290d 0a20 2020  nt(err.msg)..   
-000141d0: 2020 2020 2020 2020 2020 2020 2072 6574               ret
-000141e0: 7572 6e20 4661 6c73 650d 0a20 2020 2020  urn False..     
-000141f0: 2020 2020 2020 2072 6574 7572 6e20 5472         return Tr
-00014200: 7565 0d0a 0d0a 2020 2020 2020 2020 6669  ue....        fi
-00014210: 6c65 5f70 7920 3d20 7061 7468 6e61 6d65  le_py = pathname
-00014220: 202b 2022 2e70 7922 0d0a 2020 2020 2020   + ".py"..      
-00014230: 2020 6669 6c65 5f70 7963 203d 2070 6174    file_pyc = pat
-00014240: 686e 616d 6520 2b20 222e 7079 6322 0d0a  hname + ".pyc"..
-00014250: 2020 2020 2020 2020 7079 6361 6368 655f          pycache_
-00014260: 6f70 7430 203d 2069 6d70 6f72 746c 6962  opt0 = importlib
-00014270: 2e75 7469 6c2e 6361 6368 655f 6672 6f6d  .util.cache_from
-00014280: 5f73 6f75 7263 6528 0d0a 2020 2020 2020  _source(..      
-00014290: 2020 2020 2020 6669 6c65 5f70 792c 0d0a        file_py,..
-000142a0: 2020 2020 2020 2020 2020 2020 6f70 7469              opti
-000142b0: 6d69 7a61 7469 6f6e 3d22 222c 0d0a 2020  mization="",..  
-000142c0: 2020 2020 2020 290d 0a20 2020 2020 2020        )..       
-000142d0: 2070 7963 6163 6865 5f6f 7074 3120 3d20   pycache_opt1 = 
-000142e0: 696d 706f 7274 6c69 622e 7574 696c 2e63  importlib.util.c
-000142f0: 6163 6865 5f66 726f 6d5f 736f 7572 6365  ache_from_source
-00014300: 280d 0a20 2020 2020 2020 2020 2020 2066  (..            f
-00014310: 696c 655f 7079 2c0d 0a20 2020 2020 2020  ile_py,..       
-00014320: 2020 2020 206f 7074 696d 697a 6174 696f       optimizatio
-00014330: 6e3d 312c 0d0a 2020 2020 2020 2020 290d  n=1,..        ).
-00014340: 0a20 2020 2020 2020 2070 7963 6163 6865  .        pycache
-00014350: 5f6f 7074 3220 3d20 696d 706f 7274 6c69  _opt2 = importli
-00014360: 622e 7574 696c 2e63 6163 6865 5f66 726f  b.util.cache_fro
-00014370: 6d5f 736f 7572 6365 280d 0a20 2020 2020  m_source(..     
-00014380: 2020 2020 2020 2066 696c 655f 7079 2c0d         file_py,.
-00014390: 0a20 2020 2020 2020 2020 2020 206f 7074  .            opt
-000143a0: 696d 697a 6174 696f 6e3d 322c 0d0a 2020  imization=2,..  
-000143b0: 2020 2020 2020 290d 0a20 2020 2020 2020        )..       
-000143c0: 2069 6620 7365 6c66 2e5f 6f70 7469 6d69   if self._optimi
-000143d0: 7a65 203d 3d20 2d31 3a0d 0a20 2020 2020  ze == -1:..     
-000143e0: 2020 2020 2020 2023 206c 6567 6163 7920         # legacy 
-000143f0: 6d6f 6465 3a20 7573 6520 7768 6174 6576  mode: use whatev
-00014400: 6572 2066 696c 6520 6973 2070 7265 7365  er file is prese
-00014410: 6e74 0d0a 2020 2020 2020 2020 2020 2020  nt..            
-00014420: 6966 2028 0d0a 2020 2020 2020 2020 2020  if (..          
-00014430: 2020 2020 2020 6f73 2e70 6174 682e 6973        os.path.is
-00014440: 6669 6c65 2866 696c 655f 7079 6329 0d0a  file(file_pyc)..
-00014450: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014460: 616e 6420 6f73 2e73 7461 7428 6669 6c65  and os.stat(file
-00014470: 5f70 7963 292e 7374 5f6d 7469 6d65 203e  _pyc).st_mtime >
-00014480: 3d20 6f73 2e73 7461 7428 6669 6c65 5f70  = os.stat(file_p
-00014490: 7929 2e73 745f 6d74 696d 650d 0a20 2020  y).st_mtime..   
-000144a0: 2020 2020 2020 2020 2029 3a0d 0a20 2020           ):..   
-000144b0: 2020 2020 2020 2020 2020 2020 2023 2055               # U
-000144c0: 7365 202e 7079 6320 6669 6c65 2e0d 0a20  se .pyc file... 
-000144d0: 2020 2020 2020 2020 2020 2020 2020 2061                 a
-000144e0: 7263 6e61 6d65 203d 2066 6e61 6d65 203d  rcname = fname =
-000144f0: 2066 696c 655f 7079 630d 0a20 2020 2020   file_pyc..     
-00014500: 2020 2020 2020 2065 6c69 6620 280d 0a20         elif (.. 
-00014510: 2020 2020 2020 2020 2020 2020 2020 206f                 o
-00014520: 732e 7061 7468 2e69 7366 696c 6528 7079  s.path.isfile(py
-00014530: 6361 6368 655f 6f70 7430 290d 0a20 2020  cache_opt0)..   
-00014540: 2020 2020 2020 2020 2020 2020 2061 6e64               and
-00014550: 206f 732e 7374 6174 2870 7963 6163 6865   os.stat(pycache
-00014560: 5f6f 7074 3029 2e73 745f 6d74 696d 6520  _opt0).st_mtime 
-00014570: 3e3d 206f 732e 7374 6174 2866 696c 655f  >= os.stat(file_
-00014580: 7079 292e 7374 5f6d 7469 6d65 0d0a 2020  py).st_mtime..  
-00014590: 2020 2020 2020 2020 2020 293a 0d0a 2020            ):..  
-000145a0: 2020 2020 2020 2020 2020 2020 2020 2320                # 
-000145b0: 5573 6520 7468 6520 5f5f 7079 6361 6368  Use the __pycach
-000145c0: 655f 5f2f 2a2e 7079 6320 6669 6c65 2c20  e__/*.pyc file, 
-000145d0: 6275 7420 7772 6974 6520 6974 2074 6f20  but write it to 
-000145e0: 7468 6520 6c65 6761 6379 2070 7963 0d0a  the legacy pyc..
-000145f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014600: 2320 6669 6c65 206e 616d 6520 696e 2074  # file name in t
-00014610: 6865 2061 7263 6869 7665 2e0d 0a20 2020  he archive...   
-00014620: 2020 2020 2020 2020 2020 2020 2066 6e61               fna
-00014630: 6d65 203d 2070 7963 6163 6865 5f6f 7074  me = pycache_opt
-00014640: 300d 0a20 2020 2020 2020 2020 2020 2020  0..             
-00014650: 2020 2061 7263 6e61 6d65 203d 2066 696c     arcname = fil
-00014660: 655f 7079 630d 0a20 2020 2020 2020 2020  e_pyc..         
-00014670: 2020 2065 6c69 6620 280d 0a20 2020 2020     elif (..     
-00014680: 2020 2020 2020 2020 2020 206f 732e 7061             os.pa
-00014690: 7468 2e69 7366 696c 6528 7079 6361 6368  th.isfile(pycach
-000146a0: 655f 6f70 7431 290d 0a20 2020 2020 2020  e_opt1)..       
-000146b0: 2020 2020 2020 2020 2061 6e64 206f 732e           and os.
-000146c0: 7374 6174 2870 7963 6163 6865 5f6f 7074  stat(pycache_opt
-000146d0: 3129 2e73 745f 6d74 696d 6520 3e3d 206f  1).st_mtime >= o
-000146e0: 732e 7374 6174 2866 696c 655f 7079 292e  s.stat(file_py).
-000146f0: 7374 5f6d 7469 6d65 0d0a 2020 2020 2020  st_mtime..      
-00014700: 2020 2020 2020 293a 0d0a 2020 2020 2020        ):..      
-00014710: 2020 2020 2020 2020 2020 2320 5573 6520            # Use 
-00014720: 7468 6520 5f5f 7079 6361 6368 655f 5f2f  the __pycache__/
-00014730: 2a2e 7079 6320 6669 6c65 2c20 6275 7420  *.pyc file, but 
-00014740: 7772 6974 6520 6974 2074 6f20 7468 6520  write it to the 
-00014750: 6c65 6761 6379 2070 7963 0d0a 2020 2020  legacy pyc..    
-00014760: 2020 2020 2020 2020 2020 2020 2320 6669              # fi
-00014770: 6c65 206e 616d 6520 696e 2074 6865 2061  le name in the a
-00014780: 7263 6869 7665 2e0d 0a20 2020 2020 2020  rchive...       
-00014790: 2020 2020 2020 2020 2066 6e61 6d65 203d           fname =
-000147a0: 2070 7963 6163 6865 5f6f 7074 310d 0a20   pycache_opt1.. 
-000147b0: 2020 2020 2020 2020 2020 2020 2020 2061                 a
-000147c0: 7263 6e61 6d65 203d 2066 696c 655f 7079  rcname = file_py
-000147d0: 630d 0a20 2020 2020 2020 2020 2020 2065  c..            e
-000147e0: 6c69 6620 280d 0a20 2020 2020 2020 2020  lif (..         
-000147f0: 2020 2020 2020 206f 732e 7061 7468 2e69         os.path.i
-00014800: 7366 696c 6528 7079 6361 6368 655f 6f70  sfile(pycache_op
-00014810: 7432 290d 0a20 2020 2020 2020 2020 2020  t2)..           
-00014820: 2020 2020 2061 6e64 206f 732e 7374 6174       and os.stat
-00014830: 2870 7963 6163 6865 5f6f 7074 3229 2e73  (pycache_opt2).s
-00014840: 745f 6d74 696d 6520 3e3d 206f 732e 7374  t_mtime >= os.st
-00014850: 6174 2866 696c 655f 7079 292e 7374 5f6d  at(file_py).st_m
-00014860: 7469 6d65 0d0a 2020 2020 2020 2020 2020  time..          
-00014870: 2020 293a 0d0a 2020 2020 2020 2020 2020    ):..          
-00014880: 2020 2020 2020 2320 5573 6520 7468 6520        # Use the 
-00014890: 5f5f 7079 6361 6368 655f 5f2f 2a2e 7079  __pycache__/*.py
-000148a0: 6320 6669 6c65 2c20 6275 7420 7772 6974  c file, but writ
-000148b0: 6520 6974 2074 6f20 7468 6520 6c65 6761  e it to the lega
-000148c0: 6379 2070 7963 0d0a 2020 2020 2020 2020  cy pyc..        
-000148d0: 2020 2020 2020 2020 2320 6669 6c65 206e          # file n
-000148e0: 616d 6520 696e 2074 6865 2061 7263 6869  ame in the archi
-000148f0: 7665 2e0d 0a20 2020 2020 2020 2020 2020  ve...           
-00014900: 2020 2020 2066 6e61 6d65 203d 2070 7963       fname = pyc
-00014910: 6163 6865 5f6f 7074 320d 0a20 2020 2020  ache_opt2..     
-00014920: 2020 2020 2020 2020 2020 2061 7263 6e61             arcna
-00014930: 6d65 203d 2066 696c 655f 7079 630d 0a20  me = file_pyc.. 
-00014940: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
-00014950: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00014960: 2020 2320 436f 6d70 696c 6520 7079 2069    # Compile py i
-00014970: 6e74 6f20 5045 5020 3331 3437 2070 7963  nto PEP 3147 pyc
-00014980: 2066 696c 652e 0d0a 2020 2020 2020 2020   file...        
-00014990: 2020 2020 2020 2020 6966 205f 636f 6d70          if _comp
-000149a0: 696c 6528 6669 6c65 5f70 7929 3a0d 0a20  ile(file_py):.. 
-000149b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000149c0: 2020 2069 6620 7379 732e 666c 6167 732e     if sys.flags.
-000149d0: 6f70 7469 6d69 7a65 203d 3d20 303a 0d0a  optimize == 0:..
-000149e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000149f0: 2020 2020 2020 2020 666e 616d 6520 3d20          fname = 
-00014a00: 7079 6361 6368 655f 6f70 7430 0d0a 2020  pycache_opt0..  
-00014a10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014a20: 2020 656c 6966 2073 7973 2e66 6c61 6773    elif sys.flags
-00014a30: 2e6f 7074 696d 697a 6520 3d3d 2031 3a0d  .optimize == 1:.
-00014a40: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00014a50: 2020 2020 2020 2020 2066 6e61 6d65 203d           fname =
-00014a60: 2070 7963 6163 6865 5f6f 7074 310d 0a20   pycache_opt1.. 
-00014a70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014a80: 2020 2065 6c73 653a 0d0a 2020 2020 2020     else:..      
-00014a90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014aa0: 2020 666e 616d 6520 3d20 7079 6361 6368    fname = pycach
-00014ab0: 655f 6f70 7432 0d0a 2020 2020 2020 2020  e_opt2..        
-00014ac0: 2020 2020 2020 2020 2020 2020 6172 636e              arcn
-00014ad0: 616d 6520 3d20 6669 6c65 5f70 7963 0d0a  ame = file_pyc..
-00014ae0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014af0: 656c 7365 3a0d 0a20 2020 2020 2020 2020  else:..         
-00014b00: 2020 2020 2020 2020 2020 2066 6e61 6d65             fname
-00014b10: 203d 2061 7263 6e61 6d65 203d 2066 696c   = arcname = fil
-00014b20: 655f 7079 0d0a 2020 2020 2020 2020 656c  e_py..        el
-00014b30: 7365 3a0d 0a20 2020 2020 2020 2020 2020  se:..           
-00014b40: 2023 206e 6577 206d 6f64 653a 2075 7365   # new mode: use
-00014b50: 2067 6976 656e 206f 7074 696d 697a 6174   given optimizat
-00014b60: 696f 6e20 6c65 7665 6c0d 0a20 2020 2020  ion level..     
-00014b70: 2020 2020 2020 2069 6620 7365 6c66 2e5f         if self._
-00014b80: 6f70 7469 6d69 7a65 203d 3d20 303a 0d0a  optimize == 0:..
-00014b90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014ba0: 666e 616d 6520 3d20 7079 6361 6368 655f  fname = pycache_
-00014bb0: 6f70 7430 0d0a 2020 2020 2020 2020 2020  opt0..          
-00014bc0: 2020 2020 2020 6172 636e 616d 6520 3d20        arcname = 
-00014bd0: 6669 6c65 5f70 7963 0d0a 2020 2020 2020  file_pyc..      
-00014be0: 2020 2020 2020 656c 7365 3a0d 0a20 2020        else:..   
-00014bf0: 2020 2020 2020 2020 2020 2020 2061 7263               arc
-00014c00: 6e61 6d65 203d 2066 696c 655f 7079 630d  name = file_pyc.
-00014c10: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00014c20: 2069 6620 7365 6c66 2e5f 6f70 7469 6d69   if self._optimi
-00014c30: 7a65 203d 3d20 313a 0d0a 2020 2020 2020  ze == 1:..      
-00014c40: 2020 2020 2020 2020 2020 2020 2020 666e                fn
-00014c50: 616d 6520 3d20 7079 6361 6368 655f 6f70  ame = pycache_op
-00014c60: 7431 0d0a 2020 2020 2020 2020 2020 2020  t1..            
-00014c70: 2020 2020 656c 6966 2073 656c 662e 5f6f      elif self._o
-00014c80: 7074 696d 697a 6520 3d3d 2032 3a0d 0a20  ptimize == 2:.. 
-00014c90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014ca0: 2020 2066 6e61 6d65 203d 2070 7963 6163     fname = pycac
-00014cb0: 6865 5f6f 7074 320d 0a20 2020 2020 2020  he_opt2..       
-00014cc0: 2020 2020 2020 2020 2065 6c73 653a 0d0a           else:..
-00014cd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014ce0: 2020 2020 6d73 6720 3d20 2269 6e76 616c      msg = "inval
-00014cf0: 6964 2076 616c 7565 2066 6f72 2027 6f70  id value for 'op
-00014d00: 7469 6d69 7a65 273a 207b 2172 7d22 2e66  timize': {!r}".f
-00014d10: 6f72 6d61 7428 0d0a 2020 2020 2020 2020  ormat(..        
-00014d20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014d30: 7365 6c66 2e5f 6f70 7469 6d69 7a65 2c0d  self._optimize,.
-00014d40: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00014d50: 2020 2020 2029 0d0a 2020 2020 2020 2020       )..        
-00014d60: 2020 2020 2020 2020 2020 2020 7261 6973              rais
-00014d70: 6520 5661 6c75 6545 7272 6f72 286d 7367  e ValueError(msg
-00014d80: 290d 0a20 2020 2020 2020 2020 2020 2069  )..            i
-00014d90: 6620 6e6f 7420 280d 0a20 2020 2020 2020  f not (..       
-00014da0: 2020 2020 2020 2020 206f 732e 7061 7468           os.path
-00014db0: 2e69 7366 696c 6528 666e 616d 6529 0d0a  .isfile(fname)..
-00014dc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014dd0: 616e 6420 6f73 2e73 7461 7428 666e 616d  and os.stat(fnam
-00014de0: 6529 2e73 745f 6d74 696d 6520 3e3d 206f  e).st_mtime >= o
-00014df0: 732e 7374 6174 2866 696c 655f 7079 292e  s.stat(file_py).
-00014e00: 7374 5f6d 7469 6d65 0d0a 2020 2020 2020  st_mtime..      
-00014e10: 2020 2020 2020 2920 616e 6420 6e6f 7420        ) and not 
-00014e20: 5f63 6f6d 7069 6c65 2866 696c 655f 7079  _compile(file_py
-00014e30: 2c20 6f70 7469 6d69 7a65 3d73 656c 662e  , optimize=self.
-00014e40: 5f6f 7074 696d 697a 6529 3a0d 0a20 2020  _optimize):..   
-00014e50: 2020 2020 2020 2020 2020 2020 2066 6e61               fna
-00014e60: 6d65 203d 2061 7263 6e61 6d65 203d 2066  me = arcname = f
-00014e70: 696c 655f 7079 0d0a 2020 2020 2020 2020  ile_py..        
-00014e80: 6172 6368 6976 656e 616d 6520 3d20 6f73  archivename = os
-00014e90: 2e70 6174 682e 7370 6c69 7428 6172 636e  .path.split(arcn
-00014ea0: 616d 6529 5b31 5d0d 0a20 2020 2020 2020  ame)[1]..       
-00014eb0: 2069 6620 6261 7365 6e61 6d65 3a0d 0a20   if basename:.. 
-00014ec0: 2020 2020 2020 2020 2020 2061 7263 6869             archi
-00014ed0: 7665 6e61 6d65 203d 2066 227b 6261 7365  vename = f"{base
-00014ee0: 6e61 6d65 7d2f 7b61 7263 6869 7665 6e61  name}/{archivena
-00014ef0: 6d65 7d22 0d0a 2020 2020 2020 2020 7265  me}"..        re
-00014f00: 7475 726e 2028 666e 616d 652c 2061 7263  turn (fname, arc
-00014f10: 6869 7665 6e61 6d65 290d 0a0d 0a0d 0a64  hivename)......d
-00014f20: 6566 205f 7061 7265 6e74 7328 7061 7468  ef _parents(path
-00014f30: 293a 0d0a 2020 2020 2222 220d 0a20 2020  ):..    """..   
-00014f40: 2047 6976 656e 2061 2070 6174 6820 7769   Given a path wi
-00014f50: 7468 2065 6c65 6d65 6e74 7320 7365 7061  th elements sepa
-00014f60: 7261 7465 6420 6279 0d0a 2020 2020 706f  rated by..    po
-00014f70: 7369 7870 6174 682e 7365 702c 2067 656e  sixpath.sep, gen
-00014f80: 6572 6174 6520 616c 6c20 7061 7265 6e74  erate all parent
-00014f90: 7320 6f66 2074 6861 7420 7061 7468 2e0d  s of that path..
-00014fa0: 0a0d 0a20 2020 203e 3e3e 206c 6973 7428  ...    >>> list(
-00014fb0: 5f70 6172 656e 7473 2827 622f 6427 2929  _parents('b/d'))
-00014fc0: 0d0a 2020 2020 5b27 6227 5d0d 0a20 2020  ..    ['b']..   
-00014fd0: 203e 3e3e 206c 6973 7428 5f70 6172 656e   >>> list(_paren
-00014fe0: 7473 2827 2f62 2f64 2f27 2929 0d0a 2020  ts('/b/d/'))..  
-00014ff0: 2020 5b27 2f62 275d 0d0a 2020 2020 3e3e    ['/b']..    >>
-00015000: 3e20 6c69 7374 285f 7061 7265 6e74 7328  > list(_parents(
-00015010: 2762 2f64 2f66 2f27 2929 0d0a 2020 2020  'b/d/f/'))..    
-00015020: 5b27 622f 6427 2c20 2762 275d 0d0a 2020  ['b/d', 'b']..  
-00015030: 2020 3e3e 3e20 6c69 7374 285f 7061 7265    >>> list(_pare
-00015040: 6e74 7328 2762 2729 290d 0a20 2020 205b  nts('b'))..    [
-00015050: 5d0d 0a20 2020 203e 3e3e 206c 6973 7428  ]..    >>> list(
-00015060: 5f70 6172 656e 7473 2827 2729 290d 0a20  _parents('')).. 
-00015070: 2020 205b 5d0d 0a20 2020 2022 2222 0d0a     []..    """..
-00015080: 2020 2020 7265 7475 726e 2069 7465 7274      return itert
-00015090: 6f6f 6c73 2e69 736c 6963 6528 5f61 6e63  ools.islice(_anc
-000150a0: 6573 7472 7928 7061 7468 292c 2031 2c20  estry(path), 1, 
-000150b0: 4e6f 6e65 290d 0a0d 0a0d 0a64 6566 205f  None)......def _
-000150c0: 616e 6365 7374 7279 2870 6174 6829 3a0d  ancestry(path):.
-000150d0: 0a20 2020 2022 2222 0d0a 2020 2020 4769  .    """..    Gi
-000150e0: 7665 6e20 6120 7061 7468 2077 6974 6820  ven a path with 
-000150f0: 656c 656d 656e 7473 2073 6570 6172 6174  elements separat
-00015100: 6564 2062 790d 0a20 2020 2070 6f73 6978  ed by..    posix
-00015110: 7061 7468 2e73 6570 2c20 6765 6e65 7261  path.sep, genera
-00015120: 7465 2061 6c6c 2065 6c65 6d65 6e74 7320  te all elements 
-00015130: 6f66 2074 6861 7420 7061 7468 2e0d 0a0d  of that path....
-00015140: 0a20 2020 203e 3e3e 206c 6973 7428 5f61  .    >>> list(_a
-00015150: 6e63 6573 7472 7928 2762 2f64 2729 290d  ncestry('b/d')).
-00015160: 0a20 2020 205b 2762 2f64 272c 2027 6227  .    ['b/d', 'b'
-00015170: 5d0d 0a20 2020 203e 3e3e 206c 6973 7428  ]..    >>> list(
-00015180: 5f61 6e63 6573 7472 7928 272f 622f 642f  _ancestry('/b/d/
-00015190: 2729 290d 0a20 2020 205b 272f 622f 6427  '))..    ['/b/d'
-000151a0: 2c20 272f 6227 5d0d 0a20 2020 203e 3e3e  , '/b']..    >>>
-000151b0: 206c 6973 7428 5f61 6e63 6573 7472 7928   list(_ancestry(
-000151c0: 2762 2f64 2f66 2f27 2929 0d0a 2020 2020  'b/d/f/'))..    
-000151d0: 5b27 622f 642f 6627 2c20 2762 2f64 272c  ['b/d/f', 'b/d',
-000151e0: 2027 6227 5d0d 0a20 2020 203e 3e3e 206c   'b']..    >>> l
-000151f0: 6973 7428 5f61 6e63 6573 7472 7928 2762  ist(_ancestry('b
-00015200: 2729 290d 0a20 2020 205b 2762 275d 0d0a  '))..    ['b']..
-00015210: 2020 2020 3e3e 3e20 6c69 7374 285f 616e      >>> list(_an
-00015220: 6365 7374 7279 2827 2729 290d 0a20 2020  cestry(''))..   
-00015230: 205b 5d0d 0a20 2020 2022 2222 0d0a 2020   []..    """..  
-00015240: 2020 7061 7468 203d 2070 6174 682e 7273    path = path.rs
-00015250: 7472 6970 2870 6f73 6978 7061 7468 2e73  trip(posixpath.s
-00015260: 6570 290d 0a20 2020 2077 6869 6c65 2070  ep)..    while p
-00015270: 6174 6820 616e 6420 7061 7468 2021 3d20  ath and path != 
-00015280: 706f 7369 7870 6174 682e 7365 703a 0d0a  posixpath.sep:..
-00015290: 2020 2020 2020 2020 7969 656c 6420 7061          yield pa
-000152a0: 7468 0d0a 2020 2020 2020 2020 7061 7468  th..        path
-000152b0: 2c20 7461 696c 203d 2070 6f73 6978 7061  , tail = posixpa
-000152c0: 7468 2e73 706c 6974 2870 6174 6829 0d0a  th.split(path)..
-000152d0: 0d0a 0d0a 5f64 6564 7570 6520 3d20 6469  ...._dedupe = di
-000152e0: 6374 2e66 726f 6d6b 6579 730d 0a22 2222  ct.fromkeys.."""
-000152f0: 4465 6475 706c 6963 6174 6520 616e 2069  Deduplicate an i
-00015300: 7465 7261 626c 6520 696e 206f 7269 6769  terable in origi
-00015310: 6e61 6c20 6f72 6465 7222 2222 0d0a 0d0a  nal order"""....
-00015320: 0d0a 6465 6620 5f64 6966 6665 7265 6e63  ..def _differenc
-00015330: 6528 6d69 6e75 656e 642c 2073 7562 7472  e(minuend, subtr
-00015340: 6168 656e 6429 3a0d 0a20 2020 2022 2222  ahend):..    """
-00015350: 0d0a 2020 2020 5265 7475 726e 2069 7465  ..    Return ite
-00015360: 6d73 2069 6e20 6d69 6e75 656e 6420 6e6f  ms in minuend no
-00015370: 7420 696e 2073 7562 7472 6168 656e 642c  t in subtrahend,
-00015380: 2072 6574 6169 6e69 6e67 206f 7264 6572   retaining order
-00015390: 0d0a 2020 2020 7769 7468 204f 2831 2920  ..    with O(1) 
-000153a0: 6c6f 6f6b 7570 2e0d 0a20 2020 2022 2222  lookup...    """
-000153b0: 0d0a 2020 2020 7265 7475 726e 2069 7465  ..    return ite
-000153c0: 7274 6f6f 6c73 2e66 696c 7465 7266 616c  rtools.filterfal
-000153d0: 7365 2873 6574 2873 7562 7472 6168 656e  se(set(subtrahen
-000153e0: 6429 2e5f 5f63 6f6e 7461 696e 735f 5f2c  d).__contains__,
-000153f0: 206d 696e 7565 6e64 290d 0a0d 0a0d 0a63   minuend)......c
-00015400: 6c61 7373 2043 6f6d 706c 6574 6544 6972  lass CompleteDir
-00015410: 7328 5a69 7046 696c 6529 3a0d 0a20 2020  s(ZipFile):..   
-00015420: 2022 2222 0d0a 2020 2020 4120 5a69 7046   """..    A ZipF
-00015430: 696c 6520 7375 6263 6c61 7373 2074 6861  ile subclass tha
-00015440: 7420 656e 7375 7265 7320 7468 6174 2069  t ensures that i
-00015450: 6d70 6c69 6564 2064 6972 6563 746f 7269  mplied directori
-00015460: 6573 0d0a 2020 2020 6172 6520 616c 7761  es..    are alwa
-00015470: 7973 2069 6e63 6c75 6465 6420 696e 2074  ys included in t
-00015480: 6865 206e 616d 656c 6973 742e 0d0a 2020  he namelist...  
-00015490: 2020 2222 220d 0a0d 0a20 2020 2040 7374    """....    @st
-000154a0: 6174 6963 6d65 7468 6f64 0d0a 2020 2020  aticmethod..    
-000154b0: 6465 6620 5f69 6d70 6c69 6564 5f64 6972  def _implied_dir
-000154c0: 7328 6e61 6d65 7329 3a0d 0a20 2020 2020  s(names):..     
-000154d0: 2020 2070 6172 656e 7473 203d 2069 7465     parents = ite
-000154e0: 7274 6f6f 6c73 2e63 6861 696e 2e66 726f  rtools.chain.fro
-000154f0: 6d5f 6974 6572 6162 6c65 286d 6170 285f  m_iterable(map(_
-00015500: 7061 7265 6e74 732c 206e 616d 6573 2929  parents, names))
-00015510: 0d0a 2020 2020 2020 2020 6173 5f64 6972  ..        as_dir
-00015520: 7320 3d20 2870 202b 2070 6f73 6978 7061  s = (p + posixpa
-00015530: 7468 2e73 6570 2066 6f72 2070 2069 6e20  th.sep for p in 
-00015540: 7061 7265 6e74 7329 0d0a 2020 2020 2020  parents)..      
-00015550: 2020 7265 7475 726e 205f 6465 6475 7065    return _dedupe
-00015560: 285f 6469 6666 6572 656e 6365 2861 735f  (_difference(as_
-00015570: 6469 7273 2c20 6e61 6d65 7329 290d 0a0d  dirs, names))...
-00015580: 0a20 2020 2064 6566 206e 616d 656c 6973  .    def namelis
-00015590: 7428 7365 6c66 293a 0d0a 2020 2020 2020  t(self):..      
-000155a0: 2020 6e61 6d65 7320 3d20 7375 7065 7228    names = super(
-000155b0: 292e 6e61 6d65 6c69 7374 2829 0d0a 2020  ).namelist()..  
-000155c0: 2020 2020 2020 7265 7475 726e 206e 616d        return nam
-000155d0: 6573 202b 206c 6973 7428 7365 6c66 2e5f  es + list(self._
-000155e0: 696d 706c 6965 645f 6469 7273 286e 616d  implied_dirs(nam
-000155f0: 6573 2929 0d0a 0d0a 2020 2020 6465 6620  es))....    def 
-00015600: 5f6e 616d 655f 7365 7428 7365 6c66 293a  _name_set(self):
-00015610: 0d0a 2020 2020 2020 2020 7265 7475 726e  ..        return
-00015620: 2073 6574 2873 656c 662e 6e61 6d65 6c69   set(self.nameli
-00015630: 7374 2829 290d 0a0d 0a20 2020 2064 6566  st())....    def
-00015640: 2072 6573 6f6c 7665 5f64 6972 2873 656c   resolve_dir(sel
-00015650: 662c 206e 616d 6529 3a0d 0a20 2020 2020  f, name):..     
-00015660: 2020 2022 2222 0d0a 2020 2020 2020 2020     """..        
-00015670: 4966 2074 6865 206e 616d 6520 7265 7072  If the name repr
-00015680: 6573 656e 7473 2061 2064 6972 6563 746f  esents a directo
-00015690: 7279 2c20 7265 7475 726e 2074 6861 7420  ry, return that 
-000156a0: 6e61 6d65 0d0a 2020 2020 2020 2020 6173  name..        as
-000156b0: 2061 2064 6972 6563 746f 7279 2028 7769   a directory (wi
-000156c0: 7468 2074 6865 2074 7261 696c 696e 6720  th the trailing 
-000156d0: 736c 6173 6829 2e0d 0a20 2020 2020 2020  slash)...       
-000156e0: 2022 2222 0d0a 2020 2020 2020 2020 6e61   """..        na
-000156f0: 6d65 7320 3d20 7365 6c66 2e5f 6e61 6d65  mes = self._name
-00015700: 5f73 6574 2829 0d0a 2020 2020 2020 2020  _set()..        
-00015710: 6469 726e 616d 6520 3d20 6e61 6d65 202b  dirname = name +
-00015720: 2022 2f22 0d0a 2020 2020 2020 2020 6469   "/"..        di
-00015730: 725f 6d61 7463 6820 3d20 6e61 6d65 206e  r_match = name n
-00015740: 6f74 2069 6e20 6e61 6d65 7320 616e 6420  ot in names and 
-00015750: 6469 726e 616d 6520 696e 206e 616d 6573  dirname in names
-00015760: 0d0a 2020 2020 2020 2020 7265 7475 726e  ..        return
-00015770: 2064 6972 6e61 6d65 2069 6620 6469 725f   dirname if dir_
-00015780: 6d61 7463 6820 656c 7365 206e 616d 650d  match else name.
-00015790: 0a0d 0a20 2020 2040 636c 6173 736d 6574  ...    @classmet
-000157a0: 686f 640d 0a20 2020 2064 6566 206d 616b  hod..    def mak
-000157b0: 6528 636c 732c 2073 6f75 7263 6529 3a0d  e(cls, source):.
-000157c0: 0a20 2020 2020 2020 2022 2222 0d0a 2020  .        """..  
-000157d0: 2020 2020 2020 4769 7665 6e20 6120 736f        Given a so
-000157e0: 7572 6365 2028 6669 6c65 6e61 6d65 206f  urce (filename o
-000157f0: 7220 7a69 7066 696c 6529 2c20 7265 7475  r zipfile), retu
-00015800: 726e 2061 6e0d 0a20 2020 2020 2020 2061  rn an..        a
-00015810: 7070 726f 7072 6961 7465 2043 6f6d 706c  ppropriate Compl
-00015820: 6574 6544 6972 7320 7375 6263 6c61 7373  eteDirs subclass
-00015830: 2e0d 0a20 2020 2020 2020 2022 2222 0d0a  ...        """..
-00015840: 2020 2020 2020 2020 6966 2069 7369 6e73          if isins
-00015850: 7461 6e63 6528 736f 7572 6365 2c20 436f  tance(source, Co
-00015860: 6d70 6c65 7465 4469 7273 293a 0d0a 2020  mpleteDirs):..  
-00015870: 2020 2020 2020 2020 2020 7265 7475 726e            return
-00015880: 2073 6f75 7263 650d 0a0d 0a20 2020 2020   source....     
-00015890: 2020 2069 6620 6e6f 7420 6973 696e 7374     if not isinst
-000158a0: 616e 6365 2873 6f75 7263 652c 205a 6970  ance(source, Zip
-000158b0: 4669 6c65 293a 0d0a 2020 2020 2020 2020  File):..        
-000158c0: 2020 2020 7265 7475 726e 2063 6c73 2873      return cls(s
-000158d0: 6f75 7263 6529 0d0a 0d0a 2020 2020 2020  ource)....      
-000158e0: 2020 2320 4f6e 6c79 2061 6c6c 6f77 2066    # Only allow f
-000158f0: 6f72 2046 6173 7450 6174 6820 7768 656e  or FastPath when
-00015900: 2073 7570 706c 6965 6420 7a69 7066 696c   supplied zipfil
-00015910: 6520 6973 2072 6561 642d 6f6e 6c79 0d0a  e is read-only..
-00015920: 2020 2020 2020 2020 6966 2022 7222 206e          if "r" n
-00015930: 6f74 2069 6e20 736f 7572 6365 2e6d 6f64  ot in source.mod
-00015940: 653a 0d0a 2020 2020 2020 2020 2020 2020  e:..            
-00015950: 636c 7320 3d20 436f 6d70 6c65 7465 4469  cls = CompleteDi
-00015960: 7273 0d0a 0d0a 2020 2020 2020 2020 7265  rs....        re
-00015970: 7320 3d20 636c 732e 5f5f 6e65 775f 5f28  s = cls.__new__(
-00015980: 636c 7329 0d0a 2020 2020 2020 2020 7661  cls)..        va
-00015990: 7273 2872 6573 292e 7570 6461 7465 2876  rs(res).update(v
-000159a0: 6172 7328 736f 7572 6365 2929 0d0a 2020  ars(source))..  
-000159b0: 2020 2020 2020 7265 7475 726e 2072 6573        return res
-000159c0: 0d0a 0d0a 0d0a 636c 6173 7320 4661 7374  ......class Fast
-000159d0: 4c6f 6f6b 7570 2843 6f6d 706c 6574 6544  Lookup(CompleteD
-000159e0: 6972 7329 3a0d 0a20 2020 2022 2222 0d0a  irs):..    """..
-000159f0: 2020 2020 5a69 7046 696c 6520 7375 6263      ZipFile subc
-00015a00: 6c61 7373 2074 6f20 656e 7375 7265 2069  lass to ensure i
-00015a10: 6d70 6c69 6369 740d 0a20 2020 2064 6972  mplicit..    dir
-00015a20: 7320 6578 6973 7420 616e 6420 6172 6520  s exist and are 
-00015a30: 7265 736f 6c76 6564 2072 6170 6964 6c79  resolved rapidly
-00015a40: 2e0d 0a20 2020 2022 2222 0d0a 0d0a 2020  ...    """....  
-00015a50: 2020 6465 6620 6e61 6d65 6c69 7374 2873    def namelist(s
-00015a60: 656c 6629 3a0d 0a20 2020 2020 2020 2077  elf):..        w
-00015a70: 6974 6820 636f 6e74 6578 746c 6962 2e73  ith contextlib.s
-00015a80: 7570 7072 6573 7328 4174 7472 6962 7574  uppress(Attribut
-00015a90: 6545 7272 6f72 293a 0d0a 2020 2020 2020  eError):..      
-00015aa0: 2020 2020 2020 7265 7475 726e 2073 656c        return sel
-00015ab0: 662e 5f5f 6e61 6d65 730d 0a20 2020 2020  f.__names..     
-00015ac0: 2020 2073 656c 662e 5f5f 6e61 6d65 7320     self.__names 
-00015ad0: 3d20 7375 7065 7228 292e 6e61 6d65 6c69  = super().nameli
-00015ae0: 7374 2829 0d0a 2020 2020 2020 2020 7265  st()..        re
-00015af0: 7475 726e 2073 656c 662e 5f5f 6e61 6d65  turn self.__name
-00015b00: 730d 0a0d 0a20 2020 2064 6566 205f 6e61  s....    def _na
-00015b10: 6d65 5f73 6574 2873 656c 6629 3a0d 0a20  me_set(self):.. 
-00015b20: 2020 2020 2020 2077 6974 6820 636f 6e74         with cont
-00015b30: 6578 746c 6962 2e73 7570 7072 6573 7328  extlib.suppress(
-00015b40: 4174 7472 6962 7574 6545 7272 6f72 293a  AttributeError):
-00015b50: 0d0a 2020 2020 2020 2020 2020 2020 7265  ..            re
-00015b60: 7475 726e 2073 656c 662e 5f5f 6c6f 6f6b  turn self.__look
-00015b70: 7570 0d0a 2020 2020 2020 2020 7365 6c66  up..        self
-00015b80: 2e5f 5f6c 6f6f 6b75 7020 3d20 7375 7065  .__lookup = supe
-00015b90: 7228 292e 5f6e 616d 655f 7365 7428 290d  r()._name_set().
-00015ba0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-00015bb0: 7365 6c66 2e5f 5f6c 6f6f 6b75 700d 0a0d  self.__lookup...
-00015bc0: 0a0d 0a63 6c61 7373 2050 6174 683a 0d0a  ...class Path:..
-00015bd0: 2020 2020 2222 220d 0a20 2020 2041 2070      """..    A p
-00015be0: 6174 686c 6962 2d63 6f6d 7061 7469 626c  athlib-compatibl
-00015bf0: 6520 696e 7465 7266 6163 6520 666f 7220  e interface for 
-00015c00: 7a69 7020 6669 6c65 732e 0d0a 0d0a 2020  zip files.....  
-00015c10: 2020 436f 6e73 6964 6572 2061 207a 6970    Consider a zip
-00015c20: 2066 696c 6520 7769 7468 2074 6869 7320   file with this 
-00015c30: 7374 7275 6374 7572 653a 3a0d 0a0d 0a20  structure::.... 
-00015c40: 2020 2020 2020 202e 0d0a 2020 2020 2020         ...      
-00015c50: 2020 e294 9ce2 9480 e294 8020 612e 7478    ......... a.tx
-00015c60: 740d 0a20 2020 2020 2020 20e2 9494 e294  t..        .....
-00015c70: 80e2 9480 2062 0d0a 2020 2020 2020 2020  .... b..        
-00015c80: 2020 2020 e294 9ce2 9480 e294 8020 632e      ......... c.
-00015c90: 7478 740d 0a20 2020 2020 2020 2020 2020  txt..           
-00015ca0: 20e2 9494 e294 80e2 9480 2064 0d0a 2020   ......... d..  
-00015cb0: 2020 2020 2020 2020 2020 2020 2020 e294                ..
-00015cc0: 94e2 9480 e294 8020 652e 7478 740d 0a0d  ....... e.txt...
-00015cd0: 0a20 2020 203e 3e3e 2064 6174 6120 3d20  .    >>> data = 
-00015ce0: 696f 2e42 7974 6573 494f 2829 0d0a 2020  io.BytesIO()..  
-00015cf0: 2020 3e3e 3e20 7a66 203d 205a 6970 4669    >>> zf = ZipFi
-00015d00: 6c65 2864 6174 612c 2027 7727 290d 0a20  le(data, 'w').. 
-00015d10: 2020 203e 3e3e 207a 662e 7772 6974 6573     >>> zf.writes
-00015d20: 7472 2827 612e 7478 7427 2c20 2763 6f6e  tr('a.txt', 'con
-00015d30: 7465 6e74 206f 6620 6127 290d 0a20 2020  tent of a')..   
-00015d40: 203e 3e3e 207a 662e 7772 6974 6573 7472   >>> zf.writestr
-00015d50: 2827 622f 632e 7478 7427 2c20 2763 6f6e  ('b/c.txt', 'con
-00015d60: 7465 6e74 206f 6620 6327 290d 0a20 2020  tent of c')..   
-00015d70: 203e 3e3e 207a 662e 7772 6974 6573 7472   >>> zf.writestr
-00015d80: 2827 622f 642f 652e 7478 7427 2c20 2763  ('b/d/e.txt', 'c
-00015d90: 6f6e 7465 6e74 206f 6620 6527 290d 0a20  ontent of e').. 
-00015da0: 2020 203e 3e3e 207a 662e 6669 6c65 6e61     >>> zf.filena
-00015db0: 6d65 203d 2027 6162 6364 652e 7a69 7027  me = 'abcde.zip'
-00015dc0: 0d0a 0d0a 2020 2020 5061 7468 2061 6363  ....    Path acc
-00015dd0: 6570 7473 2074 6865 207a 6970 6669 6c65  epts the zipfile
-00015de0: 206f 626a 6563 7420 6974 7365 6c66 206f   object itself o
-00015df0: 7220 6120 6669 6c65 6e61 6d65 0d0a 0d0a  r a filename....
-00015e00: 2020 2020 3e3e 3e20 726f 6f74 203d 2050      >>> root = P
-00015e10: 6174 6828 7a66 290d 0a0d 0a20 2020 2046  ath(zf)....    F
-00015e20: 726f 6d20 7468 6572 652c 2073 6576 6572  rom there, sever
-00015e30: 616c 2070 6174 6820 6f70 6572 6174 696f  al path operatio
-00015e40: 6e73 2061 7265 2061 7661 696c 6162 6c65  ns are available
-00015e50: 2e0d 0a0d 0a20 2020 2044 6972 6563 746f  .....    Directo
-00015e60: 7279 2069 7465 7261 7469 6f6e 2028 696e  ry iteration (in
-00015e70: 636c 7564 696e 6720 7468 6520 7a69 7020  cluding the zip 
-00015e80: 6669 6c65 2069 7473 656c 6629 3a0d 0a0d  file itself):...
-00015e90: 0a20 2020 203e 3e3e 2061 2c20 6220 3d20  .    >>> a, b = 
-00015ea0: 726f 6f74 2e69 7465 7264 6972 2829 0d0a  root.iterdir()..
-00015eb0: 2020 2020 3e3e 3e20 610d 0a20 2020 2050      >>> a..    P
-00015ec0: 6174 6828 2761 6263 6465 2e7a 6970 272c  ath('abcde.zip',
-00015ed0: 2027 612e 7478 7427 290d 0a20 2020 203e   'a.txt')..    >
-00015ee0: 3e3e 2062 0d0a 2020 2020 5061 7468 2827  >> b..    Path('
-00015ef0: 6162 6364 652e 7a69 7027 2c20 2762 2f27  abcde.zip', 'b/'
-00015f00: 290d 0a0d 0a20 2020 206e 616d 6520 7072  )....    name pr
-00015f10: 6f70 6572 7479 3a0d 0a0d 0a20 2020 203e  operty:....    >
-00015f20: 3e3e 2062 2e6e 616d 650d 0a20 2020 2027  >> b.name..    '
-00015f30: 6227 0d0a 0d0a 2020 2020 6a6f 696e 2077  b'....    join w
-00015f40: 6974 6820 6469 7669 6465 206f 7065 7261  ith divide opera
-00015f50: 746f 723a 0d0a 0d0a 2020 2020 3e3e 3e20  tor:....    >>> 
-00015f60: 6320 3d20 6220 2f20 2763 2e74 7874 270d  c = b / 'c.txt'.
-00015f70: 0a20 2020 203e 3e3e 2063 0d0a 2020 2020  .    >>> c..    
-00015f80: 5061 7468 2827 6162 6364 652e 7a69 7027  Path('abcde.zip'
-00015f90: 2c20 2762 2f63 2e74 7874 2729 0d0a 2020  , 'b/c.txt')..  
-00015fa0: 2020 3e3e 3e20 632e 6e61 6d65 0d0a 2020    >>> c.name..  
-00015fb0: 2020 2763 2e74 7874 270d 0a0d 0a20 2020    'c.txt'....   
-00015fc0: 2052 6561 6420 7465 7874 3a0d 0a0d 0a20   Read text:.... 
-00015fd0: 2020 203e 3e3e 2063 2e72 6561 645f 7465     >>> c.read_te
-00015fe0: 7874 2829 0d0a 2020 2020 2763 6f6e 7465  xt()..    'conte
-00015ff0: 6e74 206f 6620 6327 0d0a 0d0a 2020 2020  nt of c'....    
-00016000: 6578 6973 7465 6e63 653a 0d0a 0d0a 2020  existence:....  
-00016010: 2020 3e3e 3e20 632e 6578 6973 7473 2829    >>> c.exists()
-00016020: 0d0a 2020 2020 5472 7565 0d0a 2020 2020  ..    True..    
-00016030: 3e3e 3e20 2862 202f 2027 6d69 7373 696e  >>> (b / 'missin
-00016040: 672e 7478 7427 292e 6578 6973 7473 2829  g.txt').exists()
-00016050: 0d0a 2020 2020 4661 6c73 650d 0a0d 0a20  ..    False.... 
-00016060: 2020 2043 6f65 7263 696f 6e20 746f 2073     Coercion to s
-00016070: 7472 696e 673a 0d0a 0d0a 2020 2020 3e3e  tring:....    >>
-00016080: 3e20 7374 7228 6329 0d0a 2020 2020 2761  > str(c)..    'a
-00016090: 6263 6465 2e7a 6970 2f62 2f63 2e74 7874  bcde.zip/b/c.txt
-000160a0: 270d 0a20 2020 2022 2222 0d0a 0d0a 2020  '..    """....  
-000160b0: 2020 5f5f 7265 7072 203d 2022 7b73 656c    __repr = "{sel
-000160c0: 662e 5f5f 636c 6173 735f 5f2e 5f5f 6e61  f.__class__.__na
-000160d0: 6d65 5f5f 7d28 7b73 656c 662e 726f 6f74  me__}({self.root
-000160e0: 2e66 696c 656e 616d 6521 727d 2c20 7b73  .filename!r}, {s
-000160f0: 656c 662e 6174 2172 7d29 220d 0a0d 0a20  elf.at!r})".... 
-00016100: 2020 2064 6566 205f 5f69 6e69 745f 5f28     def __init__(
-00016110: 7365 6c66 2c20 726f 6f74 2c20 6174 3d22  self, root, at="
-00016120: 2229 202d 3e20 4e6f 6e65 3a0d 0a20 2020  ") -> None:..   
-00016130: 2020 2020 2073 656c 662e 726f 6f74 203d       self.root =
-00016140: 2046 6173 744c 6f6f 6b75 702e 6d61 6b65   FastLookup.make
-00016150: 2872 6f6f 7429 0d0a 2020 2020 2020 2020  (root)..        
-00016160: 7365 6c66 2e61 7420 3d20 6174 0d0a 0d0a  self.at = at....
-00016170: 2020 2020 6465 6620 6f70 656e 2873 656c      def open(sel
-00016180: 662c 206d 6f64 653d 2272 222c 202a 6172  f, mode="r", *ar
-00016190: 6773 2c20 2a2a 6b77 6172 6773 293a 0d0a  gs, **kwargs):..
-000161a0: 2020 2020 2020 2020 2222 220d 0a20 2020          """..   
-000161b0: 2020 2020 204f 7065 6e20 7468 6973 2065       Open this e
-000161c0: 6e74 7279 2061 7320 7465 7874 206f 7220  ntry as text or 
-000161d0: 6269 6e61 7279 2066 6f6c 6c6f 7769 6e67  binary following
-000161e0: 2074 6865 2073 656d 616e 7469 6373 0d0a   the semantics..
-000161f0: 2020 2020 2020 2020 6f66 2060 6070 6174          of ``pat
-00016200: 686c 6962 2e50 6174 682e 6f70 656e 2829  hlib.Path.open()
-00016210: 6060 2062 7920 7061 7373 696e 6720 6172  `` by passing ar
-00016220: 6775 6d65 6e74 7320 7468 726f 7567 680d  guments through.
-00016230: 0a20 2020 2020 2020 2074 6f20 696f 2e54  .        to io.T
-00016240: 6578 7449 4f57 7261 7070 6572 2829 2e0d  extIOWrapper()..
-00016250: 0a20 2020 2020 2020 2022 2222 0d0a 2020  .        """..  
-00016260: 2020 2020 2020 7077 6420 3d20 6b77 6172        pwd = kwar
-00016270: 6773 2e70 6f70 2822 7077 6422 2c20 4e6f  gs.pop("pwd", No
-00016280: 6e65 290d 0a20 2020 2020 2020 207a 6970  ne)..        zip
-00016290: 5f6d 6f64 6520 3d20 6d6f 6465 5b30 5d0d  _mode = mode[0].
-000162a0: 0a20 2020 2020 2020 2073 7472 6561 6d20  .        stream 
-000162b0: 3d20 7365 6c66 2e72 6f6f 742e 6f70 656e  = self.root.open
-000162c0: 2873 656c 662e 6174 2c20 7a69 705f 6d6f  (self.at, zip_mo
-000162d0: 6465 2c20 7077 643d 7077 6429 0d0a 2020  de, pwd=pwd)..  
-000162e0: 2020 2020 2020 6966 2022 6222 2069 6e20        if "b" in 
-000162f0: 6d6f 6465 3a0d 0a20 2020 2020 2020 2020  mode:..         
-00016300: 2020 2069 6620 6172 6773 206f 7220 6b77     if args or kw
-00016310: 6172 6773 3a0d 0a20 2020 2020 2020 2020  args:..         
-00016320: 2020 2020 2020 2072 6169 7365 2056 616c         raise Val
-00016330: 7565 4572 726f 7228 2265 6e63 6f64 696e  ueError("encodin
-00016340: 6720 6172 6773 2069 6e76 616c 6964 2066  g args invalid f
-00016350: 6f72 2062 696e 6172 7920 6f70 6572 6174  or binary operat
-00016360: 696f 6e22 290d 0a20 2020 2020 2020 2020  ion")..         
-00016370: 2020 2072 6574 7572 6e20 7374 7265 616d     return stream
-00016380: 0d0a 2020 2020 2020 2020 7265 7475 726e  ..        return
-00016390: 2069 6f2e 5465 7874 494f 5772 6170 7065   io.TextIOWrappe
-000163a0: 7228 7374 7265 616d 2c20 2a61 7267 732c  r(stream, *args,
-000163b0: 202a 2a6b 7761 7267 7329 0d0a 0d0a 2020   **kwargs)....  
-000163c0: 2020 4070 726f 7065 7274 790d 0a20 2020    @property..   
-000163d0: 2064 6566 206e 616d 6528 7365 6c66 293a   def name(self):
-000163e0: 0d0a 2020 2020 2020 2020 7265 7475 726e  ..        return
-000163f0: 2070 6f73 6978 7061 7468 2e62 6173 656e   posixpath.basen
-00016400: 616d 6528 7365 6c66 2e61 742e 7273 7472  ame(self.at.rstr
-00016410: 6970 2822 2f22 2929 0d0a 0d0a 2020 2020  ip("/"))....    
-00016420: 6465 6620 7265 6164 5f74 6578 7428 7365  def read_text(se
-00016430: 6c66 2c20 2a61 7267 732c 202a 2a6b 7761  lf, *args, **kwa
-00016440: 7267 7329 3a0d 0a20 2020 2020 2020 2077  rgs):..        w
-00016450: 6974 6820 7365 6c66 2e6f 7065 6e28 2272  ith self.open("r
-00016460: 222c 202a 6172 6773 2c20 2a2a 6b77 6172  ", *args, **kwar
-00016470: 6773 2920 6173 2073 7472 6d3a 0d0a 2020  gs) as strm:..  
-00016480: 2020 2020 2020 2020 2020 7265 7475 726e            return
-00016490: 2073 7472 6d2e 7265 6164 2829 0d0a 0d0a   strm.read()....
-000164a0: 2020 2020 6465 6620 7265 6164 5f62 7974      def read_byt
-000164b0: 6573 2873 656c 6629 3a0d 0a20 2020 2020  es(self):..     
-000164c0: 2020 2077 6974 6820 7365 6c66 2e6f 7065     with self.ope
-000164d0: 6e28 2272 6222 2920 6173 2073 7472 6d3a  n("rb") as strm:
-000164e0: 0d0a 2020 2020 2020 2020 2020 2020 7265  ..            re
-000164f0: 7475 726e 2073 7472 6d2e 7265 6164 2829  turn strm.read()
-00016500: 0d0a 0d0a 2020 2020 6465 6620 5f69 735f  ....    def _is_
-00016510: 6368 696c 6428 7365 6c66 2c20 7061 7468  child(self, path
-00016520: 293a 0d0a 2020 2020 2020 2020 7265 7475  ):..        retu
-00016530: 726e 2070 6f73 6978 7061 7468 2e64 6972  rn posixpath.dir
-00016540: 6e61 6d65 2870 6174 682e 6174 2e72 7374  name(path.at.rst
-00016550: 7269 7028 222f 2229 2920 3d3d 2073 656c  rip("/")) == sel
-00016560: 662e 6174 2e72 7374 7269 7028 222f 2229  f.at.rstrip("/")
-00016570: 0d0a 0d0a 2020 2020 6465 6620 5f6e 6578  ....    def _nex
-00016580: 7428 7365 6c66 2c20 6174 293a 0d0a 2020  t(self, at):..  
-00016590: 2020 2020 2020 7265 7475 726e 2050 6174        return Pat
-000165a0: 6828 7365 6c66 2e72 6f6f 742c 2061 7429  h(self.root, at)
-000165b0: 0d0a 0d0a 2020 2020 6465 6620 6973 5f64  ....    def is_d
-000165c0: 6972 2873 656c 6629 3a0d 0a20 2020 2020  ir(self):..     
-000165d0: 2020 2072 6574 7572 6e20 6e6f 7420 7365     return not se
-000165e0: 6c66 2e61 7420 6f72 2073 656c 662e 6174  lf.at or self.at
-000165f0: 2e65 6e64 7377 6974 6828 222f 2229 0d0a  .endswith("/")..
-00016600: 0d0a 2020 2020 6465 6620 6973 5f66 696c  ..    def is_fil
-00016610: 6528 7365 6c66 293a 0d0a 2020 2020 2020  e(self):..      
-00016620: 2020 7265 7475 726e 206e 6f74 2073 656c    return not sel
-00016630: 662e 6973 5f64 6972 2829 0d0a 0d0a 2020  f.is_dir()....  
-00016640: 2020 6465 6620 6578 6973 7473 2873 656c    def exists(sel
-00016650: 6629 3a0d 0a20 2020 2020 2020 2072 6574  f):..        ret
-00016660: 7572 6e20 7365 6c66 2e61 7420 696e 2073  urn self.at in s
-00016670: 656c 662e 726f 6f74 2e5f 6e61 6d65 5f73  elf.root._name_s
-00016680: 6574 2829 0d0a 0d0a 2020 2020 6465 6620  et()....    def 
-00016690: 6974 6572 6469 7228 7365 6c66 293a 0d0a  iterdir(self):..
-000166a0: 2020 2020 2020 2020 6966 206e 6f74 2073          if not s
-000166b0: 656c 662e 6973 5f64 6972 2829 3a0d 0a20  elf.is_dir():.. 
-000166c0: 2020 2020 2020 2020 2020 2072 6169 7365             raise
-000166d0: 2056 616c 7565 4572 726f 7228 2243 616e   ValueError("Can
-000166e0: 2774 206c 6973 7464 6972 2061 2066 696c  't listdir a fil
-000166f0: 6522 290d 0a20 2020 2020 2020 2073 7562  e")..        sub
-00016700: 7320 3d20 6d61 7028 7365 6c66 2e5f 6e65  s = map(self._ne
-00016710: 7874 2c20 7365 6c66 2e72 6f6f 742e 6e61  xt, self.root.na
-00016720: 6d65 6c69 7374 2829 290d 0a20 2020 2020  melist())..     
-00016730: 2020 2072 6574 7572 6e20 6669 6c74 6572     return filter
-00016740: 2873 656c 662e 5f69 735f 6368 696c 642c  (self._is_child,
-00016750: 2073 7562 7329 0d0a 0d0a 2020 2020 6465   subs)....    de
-00016760: 6620 5f5f 7374 725f 5f28 7365 6c66 2920  f __str__(self) 
-00016770: 2d3e 2073 7472 3a0d 0a20 2020 2020 2020  -> str:..       
-00016780: 2072 6574 7572 6e20 706f 7369 7870 6174   return posixpat
-00016790: 682e 6a6f 696e 2873 656c 662e 726f 6f74  h.join(self.root
-000167a0: 2e66 696c 656e 616d 652c 2073 656c 662e  .filename, self.
-000167b0: 6174 290d 0a0d 0a20 2020 2064 6566 205f  at)....    def _
-000167c0: 5f72 6570 725f 5f28 7365 6c66 2920 2d3e  _repr__(self) ->
-000167d0: 2073 7472 3a0d 0a20 2020 2020 2020 2072   str:..        r
-000167e0: 6574 7572 6e20 7365 6c66 2e5f 5f72 6570  eturn self.__rep
-000167f0: 722e 666f 726d 6174 2873 656c 663d 7365  r.format(self=se
-00016800: 6c66 290d 0a0d 0a20 2020 2064 6566 206a  lf)....    def j
-00016810: 6f69 6e70 6174 6828 7365 6c66 2c20 6164  oinpath(self, ad
-00016820: 6429 3a0d 0a20 2020 2020 2020 206e 6578  d):..        nex
-00016830: 7420 3d20 706f 7369 7870 6174 682e 6a6f  t = posixpath.jo
-00016840: 696e 2873 656c 662e 6174 2c20 6164 6429  in(self.at, add)
-00016850: 0d0a 2020 2020 2020 2020 7265 7475 726e  ..        return
-00016860: 2073 656c 662e 5f6e 6578 7428 7365 6c66   self._next(self
-00016870: 2e72 6f6f 742e 7265 736f 6c76 655f 6469  .root.resolve_di
-00016880: 7228 6e65 7874 2929 0d0a 0d0a 2020 2020  r(next))....    
-00016890: 5f5f 7472 7565 6469 765f 5f20 3d20 6a6f  __truediv__ = jo
-000168a0: 696e 7061 7468 0d0a 0d0a 2020 2020 4070  inpath....    @p
-000168b0: 726f 7065 7274 790d 0a20 2020 2064 6566  roperty..    def
-000168c0: 2070 6172 656e 7428 7365 6c66 293a 0d0a   parent(self):..
-000168d0: 2020 2020 2020 2020 7061 7265 6e74 5f61          parent_a
-000168e0: 7420 3d20 706f 7369 7870 6174 682e 6469  t = posixpath.di
-000168f0: 726e 616d 6528 7365 6c66 2e61 742e 7273  rname(self.at.rs
-00016900: 7472 6970 2822 2f22 2929 0d0a 2020 2020  trip("/"))..    
-00016910: 2020 2020 6966 2070 6172 656e 745f 6174      if parent_at
-00016920: 3a0d 0a20 2020 2020 2020 2020 2020 2070  :..            p
-00016930: 6172 656e 745f 6174 202b 3d20 222f 220d  arent_at += "/".
-00016940: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-00016950: 7365 6c66 2e5f 6e65 7874 2870 6172 656e  self._next(paren
-00016960: 745f 6174 290d 0a0d 0a0d 0a64 6566 206d  t_at)......def m
-00016970: 6169 6e28 6172 6773 3d4e 6f6e 6529 3a0d  ain(args=None):.
-00016980: 0a20 2020 2069 6d70 6f72 7420 6172 6770  .    import argp
-00016990: 6172 7365 0d0a 0d0a 2020 2020 6465 7363  arse....    desc
-000169a0: 7269 7074 696f 6e20 3d20 2241 2073 696d  ription = "A sim
-000169b0: 706c 6520 636f 6d6d 616e 642d 6c69 6e65  ple command-line
-000169c0: 2069 6e74 6572 6661 6365 2066 6f72 207a   interface for z
-000169d0: 6970 6669 6c65 206d 6f64 756c 652e 220d  ipfile module.".
-000169e0: 0a20 2020 2070 6172 7365 7220 3d20 6172  .    parser = ar
-000169f0: 6770 6172 7365 2e41 7267 756d 656e 7450  gparse.ArgumentP
-00016a00: 6172 7365 7228 6465 7363 7269 7074 696f  arser(descriptio
-00016a10: 6e3d 6465 7363 7269 7074 696f 6e29 0d0a  n=description)..
-00016a20: 2020 2020 6772 6f75 7020 3d20 7061 7273      group = pars
-00016a30: 6572 2e61 6464 5f6d 7574 7561 6c6c 795f  er.add_mutually_
-00016a40: 6578 636c 7573 6976 655f 6772 6f75 7028  exclusive_group(
-00016a50: 7265 7175 6972 6564 3d54 7275 6529 0d0a  required=True)..
-00016a60: 2020 2020 6772 6f75 702e 6164 645f 6172      group.add_ar
-00016a70: 6775 6d65 6e74 280d 0a20 2020 2020 2020  gument(..       
-00016a80: 2022 2d6c 222c 0d0a 2020 2020 2020 2020   "-l",..        
-00016a90: 222d 2d6c 6973 7422 2c0d 0a20 2020 2020  "--list",..     
-00016aa0: 2020 206d 6574 6176 6172 3d22 3c7a 6970     metavar="<zip
-00016ab0: 6669 6c65 3e22 2c0d 0a20 2020 2020 2020  file>",..       
-00016ac0: 2068 656c 703d 2253 686f 7720 6c69 7374   help="Show list
-00016ad0: 696e 6720 6f66 2061 207a 6970 6669 6c65  ing of a zipfile
-00016ae0: 222c 0d0a 2020 2020 290d 0a20 2020 2067  ",..    )..    g
-00016af0: 726f 7570 2e61 6464 5f61 7267 756d 656e  roup.add_argumen
-00016b00: 7428 0d0a 2020 2020 2020 2020 222d 6522  t(..        "-e"
-00016b10: 2c0d 0a20 2020 2020 2020 2022 2d2d 6578  ,..        "--ex
-00016b20: 7472 6163 7422 2c0d 0a20 2020 2020 2020  tract",..       
-00016b30: 206e 6172 6773 3d32 2c0d 0a20 2020 2020   nargs=2,..     
-00016b40: 2020 206d 6574 6176 6172 3d28 223c 7a69     metavar=("<zi
-00016b50: 7066 696c 653e 222c 2022 3c6f 7574 7075  pfile>", "<outpu
-00016b60: 745f 6469 723e 2229 2c0d 0a20 2020 2020  t_dir>"),..     
-00016b70: 2020 2068 656c 703d 2245 7874 7261 6374     help="Extract
-00016b80: 207a 6970 6669 6c65 2069 6e74 6f20 7461   zipfile into ta
-00016b90: 7267 6574 2064 6972 222c 0d0a 2020 2020  rget dir",..    
-00016ba0: 290d 0a20 2020 2067 726f 7570 2e61 6464  )..    group.add
-00016bb0: 5f61 7267 756d 656e 7428 0d0a 2020 2020  _argument(..    
-00016bc0: 2020 2020 222d 6322 2c0d 0a20 2020 2020      "-c",..     
-00016bd0: 2020 2022 2d2d 6372 6561 7465 222c 0d0a     "--create",..
-00016be0: 2020 2020 2020 2020 6e61 7267 733d 222b          nargs="+
-00016bf0: 222c 0d0a 2020 2020 2020 2020 6d65 7461  ",..        meta
-00016c00: 7661 723d 2822 3c6e 616d 653e 222c 2022  var=("<name>", "
-00016c10: 3c66 696c 653e 2229 2c0d 0a20 2020 2020  <file>"),..     
-00016c20: 2020 2068 656c 703d 2243 7265 6174 6520     help="Create 
-00016c30: 7a69 7066 696c 6520 6672 6f6d 2073 6f75  zipfile from sou
-00016c40: 7263 6573 222c 0d0a 2020 2020 290d 0a20  rces",..    ).. 
-00016c50: 2020 2067 726f 7570 2e61 6464 5f61 7267     group.add_arg
-00016c60: 756d 656e 7428 0d0a 2020 2020 2020 2020  ument(..        
-00016c70: 222d 7422 2c0d 0a20 2020 2020 2020 2022  "-t",..        "
-00016c80: 2d2d 7465 7374 222c 0d0a 2020 2020 2020  --test",..      
-00016c90: 2020 6d65 7461 7661 723d 223c 7a69 7066    metavar="<zipf
-00016ca0: 696c 653e 222c 0d0a 2020 2020 2020 2020  ile>",..        
-00016cb0: 6865 6c70 3d22 5465 7374 2069 6620 6120  help="Test if a 
-00016cc0: 7a69 7066 696c 6520 6973 2076 616c 6964  zipfile is valid
-00016cd0: 222c 0d0a 2020 2020 290d 0a20 2020 2061  ",..    )..    a
-00016ce0: 7267 7320 3d20 7061 7273 6572 2e70 6172  rgs = parser.par
-00016cf0: 7365 5f61 7267 7328 6172 6773 290d 0a0d  se_args(args)...
-00016d00: 0a20 2020 2069 6620 6172 6773 2e74 6573  .    if args.tes
-00016d10: 7420 6973 206e 6f74 204e 6f6e 653a 0d0a  t is not None:..
-00016d20: 2020 2020 2020 2020 7372 6320 3d20 6172          src = ar
-00016d30: 6773 2e74 6573 740d 0a20 2020 2020 2020  gs.test..       
-00016d40: 2077 6974 6820 5a69 7046 696c 6528 7372   with ZipFile(sr
-00016d50: 632c 2022 7222 2920 6173 207a 663a 0d0a  c, "r") as zf:..
-00016d60: 2020 2020 2020 2020 2020 2020 6261 6466              badf
-00016d70: 696c 6520 3d20 7a66 2e74 6573 747a 6970  ile = zf.testzip
-00016d80: 2829 0d0a 2020 2020 2020 2020 6966 2062  ()..        if b
-00016d90: 6164 6669 6c65 3a0d 0a20 2020 2020 2020  adfile:..       
-00016da0: 2020 2020 2070 7269 6e74 280d 0a20 2020       print(..   
-00016db0: 2020 2020 2020 2020 2020 2020 2022 5468               "Th
-00016dc0: 6520 666f 6c6c 6f77 696e 6720 656e 636c  e following encl
-00016dd0: 6f73 6564 2066 696c 6520 6973 2063 6f72  osed file is cor
-00016de0: 7275 7074 6564 3a20 7b21 727d 222e 666f  rupted: {!r}".fo
-00016df0: 726d 6174 280d 0a20 2020 2020 2020 2020  rmat(..         
-00016e00: 2020 2020 2020 2020 2020 2062 6164 6669             badfi
-00016e10: 6c65 2c0d 0a20 2020 2020 2020 2020 2020  le,..           
-00016e20: 2020 2020 2029 2c0d 0a20 2020 2020 2020       ),..       
-00016e30: 2020 2020 2029 0d0a 2020 2020 2020 2020       )..        
-00016e40: 7072 696e 7428 2244 6f6e 6520 7465 7374  print("Done test
-00016e50: 696e 6722 290d 0a0d 0a20 2020 2065 6c69  ing")....    eli
-00016e60: 6620 6172 6773 2e6c 6973 7420 6973 206e  f args.list is n
-00016e70: 6f74 204e 6f6e 653a 0d0a 2020 2020 2020  ot None:..      
-00016e80: 2020 7372 6320 3d20 6172 6773 2e6c 6973    src = args.lis
-00016e90: 740d 0a20 2020 2020 2020 2077 6974 6820  t..        with 
-00016ea0: 5a69 7046 696c 6528 7372 632c 2022 7222  ZipFile(src, "r"
-00016eb0: 2920 6173 207a 663a 0d0a 2020 2020 2020  ) as zf:..      
-00016ec0: 2020 2020 2020 7a66 2e70 7269 6e74 6469        zf.printdi
-00016ed0: 7228 290d 0a0d 0a20 2020 2065 6c69 6620  r()....    elif 
-00016ee0: 6172 6773 2e65 7874 7261 6374 2069 7320  args.extract is 
-00016ef0: 6e6f 7420 4e6f 6e65 3a0d 0a20 2020 2020  not None:..     
-00016f00: 2020 2073 7263 2c20 6375 7264 6972 203d     src, curdir =
-00016f10: 2061 7267 732e 6578 7472 6163 740d 0a20   args.extract.. 
-00016f20: 2020 2020 2020 2077 6974 6820 5a69 7046         with ZipF
-00016f30: 696c 6528 7372 632c 2022 7222 2920 6173  ile(src, "r") as
-00016f40: 207a 663a 0d0a 2020 2020 2020 2020 2020   zf:..          
-00016f50: 2020 7a66 2e65 7874 7261 6374 616c 6c28    zf.extractall(
-00016f60: 6375 7264 6972 290d 0a0d 0a20 2020 2065  curdir)....    e
-00016f70: 6c69 6620 6172 6773 2e63 7265 6174 6520  lif args.create 
-00016f80: 6973 206e 6f74 204e 6f6e 653a 0d0a 2020  is not None:..  
-00016f90: 2020 2020 2020 7a69 705f 6e61 6d65 203d        zip_name =
-00016fa0: 2061 7267 732e 6372 6561 7465 2e70 6f70   args.create.pop
-00016fb0: 2830 290d 0a20 2020 2020 2020 2066 696c  (0)..        fil
-00016fc0: 6573 203d 2061 7267 732e 6372 6561 7465  es = args.create
-00016fd0: 0d0a 0d0a 2020 2020 2020 2020 6465 6620  ....        def 
-00016fe0: 6164 6454 6f5a 6970 287a 662c 2070 6174  addToZip(zf, pat
-00016ff0: 682c 207a 6970 7061 7468 293a 0d0a 2020  h, zippath):..  
-00017000: 2020 2020 2020 2020 2020 6966 206f 732e            if os.
-00017010: 7061 7468 2e69 7366 696c 6528 7061 7468  path.isfile(path
-00017020: 293a 0d0a 2020 2020 2020 2020 2020 2020  ):..            
-00017030: 2020 2020 7a66 2e77 7269 7465 2870 6174      zf.write(pat
-00017040: 682c 207a 6970 7061 7468 2c20 5a49 505f  h, zippath, ZIP_
-00017050: 4445 464c 4154 4544 290d 0a20 2020 2020  DEFLATED)..     
-00017060: 2020 2020 2020 2065 6c69 6620 6f73 2e70         elif os.p
-00017070: 6174 682e 6973 6469 7228 7061 7468 293a  ath.isdir(path):
-00017080: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00017090: 2020 6966 207a 6970 7061 7468 3a0d 0a20    if zippath:.. 
-000170a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000170b0: 2020 207a 662e 7772 6974 6528 7061 7468     zf.write(path
-000170c0: 2c20 7a69 7070 6174 6829 0d0a 2020 2020  , zippath)..    
-000170d0: 2020 2020 2020 2020 2020 2020 666f 7220              for 
-000170e0: 6e6d 2069 6e20 736f 7274 6564 286f 732e  nm in sorted(os.
-000170f0: 6c69 7374 6469 7228 7061 7468 2929 3a0d  listdir(path)):.
-00017100: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00017110: 2020 2020 2061 6464 546f 5a69 7028 0d0a       addToZip(..
-00017120: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017130: 2020 2020 2020 2020 7a66 2c0d 0a20 2020          zf,..   
-00017140: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017150: 2020 2020 206f 732e 7061 7468 2e6a 6f69       os.path.joi
-00017160: 6e28 7061 7468 2c20 6e6d 292c 0d0a 2020  n(path, nm),..  
-00017170: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017180: 2020 2020 2020 6f73 2e70 6174 682e 6a6f        os.path.jo
-00017190: 696e 287a 6970 7061 7468 2c20 6e6d 292c  in(zippath, nm),
-000171a0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-000171b0: 2020 2020 2020 290d 0a20 2020 2020 2020        )..       
-000171c0: 2020 2020 2023 2065 6c73 653a 2069 676e       # else: ign
-000171d0: 6f72 650d 0a0d 0a20 2020 2020 2020 2077  ore....        w
-000171e0: 6974 6820 5a69 7046 696c 6528 7a69 705f  ith ZipFile(zip_
-000171f0: 6e61 6d65 2c20 2277 2229 2061 7320 7a66  name, "w") as zf
-00017200: 3a0d 0a20 2020 2020 2020 2020 2020 2066  :..            f
-00017210: 6f72 2070 6174 6820 696e 2066 696c 6573  or path in files
-00017220: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
-00017230: 2020 207a 6970 7061 7468 203d 206f 732e     zippath = os.
-00017240: 7061 7468 2e62 6173 656e 616d 6528 7061  path.basename(pa
-00017250: 7468 290d 0a20 2020 2020 2020 2020 2020  th)..           
-00017260: 2020 2020 2069 6620 6e6f 7420 7a69 7070       if not zipp
-00017270: 6174 683a 0d0a 2020 2020 2020 2020 2020  ath:..          
-00017280: 2020 2020 2020 2020 2020 7a69 7070 6174            zippat
-00017290: 6820 3d20 6f73 2e70 6174 682e 6261 7365  h = os.path.base
-000172a0: 6e61 6d65 286f 732e 7061 7468 2e64 6972  name(os.path.dir
-000172b0: 6e61 6d65 2870 6174 6829 290d 0a20 2020  name(path))..   
-000172c0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-000172d0: 7a69 7070 6174 6820 696e 2028 2222 2c20  zippath in ("", 
-000172e0: 6f73 2e63 7572 6469 722c 206f 732e 7061  os.curdir, os.pa
-000172f0: 7264 6972 293a 0d0a 2020 2020 2020 2020  rdir):..        
-00017300: 2020 2020 2020 2020 2020 2020 7a69 7070              zipp
-00017310: 6174 6820 3d20 2222 0d0a 2020 2020 2020  ath = ""..      
-00017320: 2020 2020 2020 2020 2020 6164 6454 6f5a            addToZ
-00017330: 6970 287a 662c 2070 6174 682c 207a 6970  ip(zf, path, zip
-00017340: 7061 7468 290d 0a0d 0a0d 0a69 6620 5f5f  path)......if __
-00017350: 6e61 6d65 5f5f 203d 3d20 225f 5f6d 6169  name__ == "__mai
-00017360: 6e5f 5f22 3a0d 0a20 2020 206d 6169 6e28  n__":..    main(
-00017370: 290d 0a                                  )..
+00014100: 2020 2020 2020 2020 2020 2062 6173 656e             basen
+00014110: 616d 652c 0d0a 2020 2020 2020 2020 2020  ame,..          
+00014120: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014130: 2020 2020 2020 6669 6c74 6572 6675 6e63        filterfunc
+00014140: 3d66 696c 7465 7266 756e 632c 0d0a 2020  =filterfunc,..  
+00014150: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014160: 2020 2020 2020 2020 2020 2920 2023 2052            )  # R
+00014170: 6563 7572 7369 7665 2063 616c 6c0d 0a20  ecursive call.. 
+00014180: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014190: 2020 2065 6c69 6620 6578 7420 3d3d 2022     elif ext == "
+000141a0: 2e70 7922 3a0d 0a20 2020 2020 2020 2020  .py":..         
+000141b0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+000141c0: 6620 6669 6c74 6572 6675 6e63 2061 6e64  f filterfunc and
+000141d0: 206e 6f74 2066 696c 7465 7266 756e 6328   not filterfunc(
+000141e0: 7061 7468 293a 0d0a 2020 2020 2020 2020  path):..        
+000141f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014200: 2020 2020 6966 2073 656c 662e 6465 6275      if self.debu
+00014210: 673a 0d0a 2020 2020 2020 2020 2020 2020  g:..            
+00014220: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014230: 2020 2020 7072 696e 7428 2266 696c 6520      print("file 
+00014240: 2572 2073 6b69 7070 6564 2062 7920 6669  %r skipped by fi
+00014250: 6c74 6572 6675 6e63 2220 2520 7061 7468  lterfunc" % path
+00014260: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
+00014270: 2020 2020 2020 2020 2020 2020 2020 2063                 c
+00014280: 6f6e 7469 6e75 650d 0a20 2020 2020 2020  ontinue..       
+00014290: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000142a0: 2066 6e61 6d65 2c20 6172 636e 616d 6520   fname, arcname 
+000142b0: 3d20 7365 6c66 2e5f 6765 745f 636f 6465  = self._get_code
+000142c0: 6e61 6d65 280d 0a20 2020 2020 2020 2020  name(..         
+000142d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000142e0: 2020 2070 6174 685b 303a 2d33 5d2c 0d0a     path[0:-3],..
+000142f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014300: 2020 2020 2020 2020 2020 2020 6261 7365              base
+00014310: 6e61 6d65 2c0d 0a20 2020 2020 2020 2020  name,..         
+00014320: 2020 2020 2020 2020 2020 2020 2020 2029                 )
+00014330: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00014340: 2020 2020 2020 2020 2020 6966 2073 656c            if sel
+00014350: 662e 6465 6275 673a 0d0a 2020 2020 2020  f.debug:..      
+00014360: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014370: 2020 2020 2020 7072 696e 7428 2241 6464        print("Add
+00014380: 696e 6722 2c20 6172 636e 616d 6529 0d0a  ing", arcname)..
+00014390: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000143a0: 2020 2020 2020 2020 7365 6c66 2e77 7269          self.wri
+000143b0: 7465 2866 6e61 6d65 2c20 6172 636e 616d  te(fname, arcnam
+000143c0: 6529 0d0a 2020 2020 2020 2020 2020 2020  e)..            
+000143d0: 656c 7365 3a0d 0a20 2020 2020 2020 2020  else:..         
+000143e0: 2020 2020 2020 2023 2054 6869 7320 6973         # This is
+000143f0: 204e 4f54 2061 2070 6163 6b61 6765 2064   NOT a package d
+00014400: 6972 6563 746f 7279 2c20 6164 6420 6974  irectory, add it
+00014410: 7320 6669 6c65 7320 6174 2074 6f70 206c  s files at top l
+00014420: 6576 656c 0d0a 2020 2020 2020 2020 2020  evel..          
+00014430: 2020 2020 2020 6966 2073 656c 662e 6465        if self.de
+00014440: 6275 673a 0d0a 2020 2020 2020 2020 2020  bug:..          
+00014450: 2020 2020 2020 2020 2020 7072 696e 7428            print(
+00014460: 2241 6464 696e 6720 6669 6c65 7320 6672  "Adding files fr
+00014470: 6f6d 2064 6972 6563 746f 7279 222c 2070  om directory", p
+00014480: 6174 686e 616d 6529 0d0a 2020 2020 2020  athname)..      
+00014490: 2020 2020 2020 2020 2020 666f 7220 6669            for fi
+000144a0: 6c65 6e61 6d65 2069 6e20 736f 7274 6564  lename in sorted
+000144b0: 286f 732e 6c69 7374 6469 7228 7061 7468  (os.listdir(path
+000144c0: 6e61 6d65 2929 3a0d 0a20 2020 2020 2020  name)):..       
+000144d0: 2020 2020 2020 2020 2020 2020 2070 6174               pat
+000144e0: 6820 3d20 6f73 2e70 6174 682e 6a6f 696e  h = os.path.join
+000144f0: 2870 6174 686e 616d 652c 2066 696c 656e  (pathname, filen
+00014500: 616d 6529 0d0a 2020 2020 2020 2020 2020  ame)..          
+00014510: 2020 2020 2020 2020 2020 726f 6f74 2c20            root, 
+00014520: 6578 7420 3d20 6f73 2e70 6174 682e 7370  ext = os.path.sp
+00014530: 6c69 7465 7874 2866 696c 656e 616d 6529  litext(filename)
+00014540: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00014550: 2020 2020 2020 6966 2065 7874 203d 3d20        if ext == 
+00014560: 222e 7079 223a 0d0a 2020 2020 2020 2020  ".py":..        
+00014570: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014580: 6966 2066 696c 7465 7266 756e 6320 616e  if filterfunc an
+00014590: 6420 6e6f 7420 6669 6c74 6572 6675 6e63  d not filterfunc
+000145a0: 2870 6174 6829 3a0d 0a20 2020 2020 2020  (path):..       
+000145b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000145c0: 2020 2020 2069 6620 7365 6c66 2e64 6562       if self.deb
+000145d0: 7567 3a0d 0a20 2020 2020 2020 2020 2020  ug:..           
+000145e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000145f0: 2020 2020 2070 7269 6e74 2822 6669 6c65       print("file
+00014600: 2025 7220 736b 6970 7065 6420 6279 2066   %r skipped by f
+00014610: 696c 7465 7266 756e 6322 2025 2070 6174  ilterfunc" % pat
+00014620: 6829 0d0a 2020 2020 2020 2020 2020 2020  h)..            
+00014630: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014640: 636f 6e74 696e 7565 0d0a 2020 2020 2020  continue..      
+00014650: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014660: 2020 666e 616d 652c 2061 7263 6e61 6d65    fname, arcname
+00014670: 203d 2073 656c 662e 5f67 6574 5f63 6f64   = self._get_cod
+00014680: 656e 616d 6528 0d0a 2020 2020 2020 2020  ename(..        
+00014690: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000146a0: 2020 2020 7061 7468 5b30 3a2d 335d 2c0d      path[0:-3],.
+000146b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000146c0: 2020 2020 2020 2020 2020 2020 2062 6173               bas
+000146d0: 656e 616d 652c 0d0a 2020 2020 2020 2020  ename,..        
+000146e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000146f0: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
+00014700: 2020 2020 2020 2020 2020 2069 6620 7365             if se
+00014710: 6c66 2e64 6562 7567 3a0d 0a20 2020 2020  lf.debug:..     
+00014720: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014730: 2020 2020 2020 2070 7269 6e74 2822 4164         print("Ad
+00014740: 6469 6e67 222c 2061 7263 6e61 6d65 290d  ding", arcname).
+00014750: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00014760: 2020 2020 2020 2020 2073 656c 662e 7772           self.wr
+00014770: 6974 6528 666e 616d 652c 2061 7263 6e61  ite(fname, arcna
+00014780: 6d65 290d 0a20 2020 2020 2020 2065 6c73  me)..        els
+00014790: 653a 0d0a 2020 2020 2020 2020 2020 2020  e:..            
+000147a0: 6966 2070 6174 686e 616d 655b 2d33 3a5d  if pathname[-3:]
+000147b0: 2021 3d20 222e 7079 223a 0d0a 2020 2020   != ".py":..    
+000147c0: 2020 2020 2020 2020 2020 2020 7261 6973              rais
+000147d0: 6520 5275 6e74 696d 6545 7272 6f72 280d  e RuntimeError(.
+000147e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000147f0: 2020 2020 2027 4669 6c65 7320 6164 6465       'Files adde
+00014800: 6420 7769 7468 2077 7269 7465 7079 2829  d with writepy()
+00014810: 206d 7573 7420 656e 6420 7769 7468 2022   must end with "
+00014820: 2e70 7922 272c 0d0a 2020 2020 2020 2020  .py"',..        
+00014830: 2020 2020 2020 2020 290d 0a20 2020 2020          )..     
+00014840: 2020 2020 2020 2066 6e61 6d65 2c20 6172         fname, ar
+00014850: 636e 616d 6520 3d20 7365 6c66 2e5f 6765  cname = self._ge
+00014860: 745f 636f 6465 6e61 6d65 2870 6174 686e  t_codename(pathn
+00014870: 616d 655b 303a 2d33 5d2c 2062 6173 656e  ame[0:-3], basen
+00014880: 616d 6529 0d0a 2020 2020 2020 2020 2020  ame)..          
+00014890: 2020 6966 2073 656c 662e 6465 6275 673a    if self.debug:
+000148a0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+000148b0: 2020 7072 696e 7428 2241 6464 696e 6720    print("Adding 
+000148c0: 6669 6c65 222c 2061 7263 6e61 6d65 290d  file", arcname).
+000148d0: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+000148e0: 662e 7772 6974 6528 666e 616d 652c 2061  f.write(fname, a
+000148f0: 7263 6e61 6d65 290d 0a0d 0a20 2020 2064  rcname)....    d
+00014900: 6566 205f 6765 745f 636f 6465 6e61 6d65  ef _get_codename
+00014910: 2873 656c 662c 2070 6174 686e 616d 652c  (self, pathname,
+00014920: 2062 6173 656e 616d 6529 3a0d 0a20 2020   basename):..   
+00014930: 2020 2020 2022 2222 5265 7475 726e 2028       """Return (
+00014940: 6669 6c65 6e61 6d65 2c20 6172 6368 6976  filename, archiv
+00014950: 656e 616d 6529 2066 6f72 2074 6865 2070  ename) for the p
+00014960: 6174 682e 0d0a 0d0a 2020 2020 2020 2020  ath.....        
+00014970: 4769 7665 6e20 6120 6d6f 6475 6c65 206e  Given a module n
+00014980: 616d 6520 7061 7468 2c20 7265 7475 726e  ame path, return
+00014990: 2074 6865 2063 6f72 7265 6374 2066 696c   the correct fil
+000149a0: 6520 7061 7468 2061 6e64 0d0a 2020 2020  e path and..    
+000149b0: 2020 2020 6172 6368 6976 6520 6e61 6d65      archive name
+000149c0: 2c20 636f 6d70 696c 696e 6720 6966 206e  , compiling if n
+000149d0: 6563 6573 7361 7279 2e20 2046 6f72 2065  ecessary.  For e
+000149e0: 7861 6d70 6c65 2c20 6769 7665 6e0d 0a20  xample, given.. 
+000149f0: 2020 2020 2020 202f 7079 7468 6f6e 2f6c         /python/l
+00014a00: 6962 2f73 7472 696e 672c 2072 6574 7572  ib/string, retur
+00014a10: 6e20 282f 7079 7468 6f6e 2f6c 6962 2f73  n (/python/lib/s
+00014a20: 7472 696e 672e 7079 632c 2073 7472 696e  tring.pyc, strin
+00014a30: 6729 2e0d 0a20 2020 2020 2020 2022 2222  g)...        """
+00014a40: 0d0a 0d0a 2020 2020 2020 2020 6465 6620  ....        def 
+00014a50: 5f63 6f6d 7069 6c65 2866 696c 652c 206f  _compile(file, o
+00014a60: 7074 696d 697a 653d 2d31 293a 0d0a 2020  ptimize=-1):..  
+00014a70: 2020 2020 2020 2020 2020 696d 706f 7274            import
+00014a80: 2070 795f 636f 6d70 696c 650d 0a0d 0a20   py_compile.... 
+00014a90: 2020 2020 2020 2020 2020 2069 6620 7365             if se
+00014aa0: 6c66 2e64 6562 7567 3a0d 0a20 2020 2020  lf.debug:..     
+00014ab0: 2020 2020 2020 2020 2020 2070 7269 6e74             print
+00014ac0: 2822 436f 6d70 696c 696e 6722 2c20 6669  ("Compiling", fi
+00014ad0: 6c65 290d 0a20 2020 2020 2020 2020 2020  le)..           
+00014ae0: 2074 7279 3a0d 0a20 2020 2020 2020 2020   try:..         
+00014af0: 2020 2020 2020 2070 795f 636f 6d70 696c         py_compil
+00014b00: 652e 636f 6d70 696c 6528 6669 6c65 2c20  e.compile(file, 
+00014b10: 646f 7261 6973 653d 5472 7565 2c20 6f70  doraise=True, op
+00014b20: 7469 6d69 7a65 3d6f 7074 696d 697a 6529  timize=optimize)
+00014b30: 0d0a 2020 2020 2020 2020 2020 2020 6578  ..            ex
+00014b40: 6365 7074 2070 795f 636f 6d70 696c 652e  cept py_compile.
+00014b50: 5079 436f 6d70 696c 6545 7272 6f72 2061  PyCompileError a
+00014b60: 7320 6572 723a 0d0a 2020 2020 2020 2020  s err:..        
+00014b70: 2020 2020 2020 2020 7072 696e 7428 6572          print(er
+00014b80: 722e 6d73 6729 0d0a 2020 2020 2020 2020  r.msg)..        
+00014b90: 2020 2020 2020 2020 7265 7475 726e 2046          return F
+00014ba0: 616c 7365 0d0a 2020 2020 2020 2020 2020  alse..          
+00014bb0: 2020 7265 7475 726e 2054 7275 650d 0a0d    return True...
+00014bc0: 0a20 2020 2020 2020 2066 696c 655f 7079  .        file_py
+00014bd0: 203d 2070 6174 686e 616d 6520 2b20 222e   = pathname + ".
+00014be0: 7079 220d 0a20 2020 2020 2020 2066 696c  py"..        fil
+00014bf0: 655f 7079 6320 3d20 7061 7468 6e61 6d65  e_pyc = pathname
+00014c00: 202b 2022 2e70 7963 220d 0a20 2020 2020   + ".pyc"..     
+00014c10: 2020 2070 7963 6163 6865 5f6f 7074 3020     pycache_opt0 
+00014c20: 3d20 696d 706f 7274 6c69 622e 7574 696c  = importlib.util
+00014c30: 2e63 6163 6865 5f66 726f 6d5f 736f 7572  .cache_from_sour
+00014c40: 6365 280d 0a20 2020 2020 2020 2020 2020  ce(..           
+00014c50: 2066 696c 655f 7079 2c0d 0a20 2020 2020   file_py,..     
+00014c60: 2020 2020 2020 206f 7074 696d 697a 6174         optimizat
+00014c70: 696f 6e3d 2222 2c0d 0a20 2020 2020 2020  ion="",..       
+00014c80: 2029 0d0a 2020 2020 2020 2020 7079 6361   )..        pyca
+00014c90: 6368 655f 6f70 7431 203d 2069 6d70 6f72  che_opt1 = impor
+00014ca0: 746c 6962 2e75 7469 6c2e 6361 6368 655f  tlib.util.cache_
+00014cb0: 6672 6f6d 5f73 6f75 7263 6528 0d0a 2020  from_source(..  
+00014cc0: 2020 2020 2020 2020 2020 6669 6c65 5f70            file_p
+00014cd0: 792c 0d0a 2020 2020 2020 2020 2020 2020  y,..            
+00014ce0: 6f70 7469 6d69 7a61 7469 6f6e 3d31 2c0d  optimization=1,.
+00014cf0: 0a20 2020 2020 2020 2029 0d0a 2020 2020  .        )..    
+00014d00: 2020 2020 7079 6361 6368 655f 6f70 7432      pycache_opt2
+00014d10: 203d 2069 6d70 6f72 746c 6962 2e75 7469   = importlib.uti
+00014d20: 6c2e 6361 6368 655f 6672 6f6d 5f73 6f75  l.cache_from_sou
+00014d30: 7263 6528 0d0a 2020 2020 2020 2020 2020  rce(..          
+00014d40: 2020 6669 6c65 5f70 792c 0d0a 2020 2020    file_py,..    
+00014d50: 2020 2020 2020 2020 6f70 7469 6d69 7a61          optimiza
+00014d60: 7469 6f6e 3d32 2c0d 0a20 2020 2020 2020  tion=2,..       
+00014d70: 2029 0d0a 2020 2020 2020 2020 6966 2073   )..        if s
+00014d80: 656c 662e 5f6f 7074 696d 697a 6520 3d3d  elf._optimize ==
+00014d90: 202d 313a 0d0a 2020 2020 2020 2020 2020   -1:..          
+00014da0: 2020 2320 6c65 6761 6379 206d 6f64 653a    # legacy mode:
+00014db0: 2075 7365 2077 6861 7465 7665 7220 6669   use whatever fi
+00014dc0: 6c65 2069 7320 7072 6573 656e 740d 0a20  le is present.. 
+00014dd0: 2020 2020 2020 2020 2020 2069 6620 280d             if (.
+00014de0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00014df0: 206f 732e 7061 7468 2e69 7366 696c 6528   os.path.isfile(
+00014e00: 6669 6c65 5f70 7963 290d 0a20 2020 2020  file_pyc)..     
+00014e10: 2020 2020 2020 2020 2020 2061 6e64 206f             and o
+00014e20: 732e 7374 6174 2866 696c 655f 7079 6329  s.stat(file_pyc)
+00014e30: 2e73 745f 6d74 696d 6520 3e3d 206f 732e  .st_mtime >= os.
+00014e40: 7374 6174 2866 696c 655f 7079 292e 7374  stat(file_py).st
+00014e50: 5f6d 7469 6d65 0d0a 2020 2020 2020 2020  _mtime..        
+00014e60: 2020 2020 293a 0d0a 2020 2020 2020 2020      ):..        
+00014e70: 2020 2020 2020 2020 2320 5573 6520 2e70          # Use .p
+00014e80: 7963 2066 696c 652e 0d0a 2020 2020 2020  yc file...      
+00014e90: 2020 2020 2020 2020 2020 6172 636e 616d            arcnam
+00014ea0: 6520 3d20 666e 616d 6520 3d20 6669 6c65  e = fname = file
+00014eb0: 5f70 7963 0d0a 2020 2020 2020 2020 2020  _pyc..          
+00014ec0: 2020 656c 6966 2028 0d0a 2020 2020 2020    elif (..      
+00014ed0: 2020 2020 2020 2020 2020 6f73 2e70 6174            os.pat
+00014ee0: 682e 6973 6669 6c65 2870 7963 6163 6865  h.isfile(pycache
+00014ef0: 5f6f 7074 3029 0d0a 2020 2020 2020 2020  _opt0)..        
+00014f00: 2020 2020 2020 2020 616e 6420 6f73 2e73          and os.s
+00014f10: 7461 7428 7079 6361 6368 655f 6f70 7430  tat(pycache_opt0
+00014f20: 292e 7374 5f6d 7469 6d65 203e 3d20 6f73  ).st_mtime >= os
+00014f30: 2e73 7461 7428 6669 6c65 5f70 7929 2e73  .stat(file_py).s
+00014f40: 745f 6d74 696d 650d 0a20 2020 2020 2020  t_mtime..       
+00014f50: 2020 2020 2029 3a0d 0a20 2020 2020 2020       ):..       
+00014f60: 2020 2020 2020 2020 2023 2055 7365 2074           # Use t
+00014f70: 6865 205f 5f70 7963 6163 6865 5f5f 2f2a  he __pycache__/*
+00014f80: 2e70 7963 2066 696c 652c 2062 7574 2077  .pyc file, but w
+00014f90: 7269 7465 2069 7420 746f 2074 6865 206c  rite it to the l
+00014fa0: 6567 6163 7920 7079 630d 0a20 2020 2020  egacy pyc..     
+00014fb0: 2020 2020 2020 2020 2020 2023 2066 696c             # fil
+00014fc0: 6520 6e61 6d65 2069 6e20 7468 6520 6172  e name in the ar
+00014fd0: 6368 6976 652e 0d0a 2020 2020 2020 2020  chive...        
+00014fe0: 2020 2020 2020 2020 666e 616d 6520 3d20          fname = 
+00014ff0: 7079 6361 6368 655f 6f70 7430 0d0a 2020  pycache_opt0..  
+00015000: 2020 2020 2020 2020 2020 2020 2020 6172                ar
+00015010: 636e 616d 6520 3d20 6669 6c65 5f70 7963  cname = file_pyc
+00015020: 0d0a 2020 2020 2020 2020 2020 2020 656c  ..            el
+00015030: 6966 2028 0d0a 2020 2020 2020 2020 2020  if (..          
+00015040: 2020 2020 2020 6f73 2e70 6174 682e 6973        os.path.is
+00015050: 6669 6c65 2870 7963 6163 6865 5f6f 7074  file(pycache_opt
+00015060: 3129 0d0a 2020 2020 2020 2020 2020 2020  1)..            
+00015070: 2020 2020 616e 6420 6f73 2e73 7461 7428      and os.stat(
+00015080: 7079 6361 6368 655f 6f70 7431 292e 7374  pycache_opt1).st
+00015090: 5f6d 7469 6d65 203e 3d20 6f73 2e73 7461  _mtime >= os.sta
+000150a0: 7428 6669 6c65 5f70 7929 2e73 745f 6d74  t(file_py).st_mt
+000150b0: 696d 650d 0a20 2020 2020 2020 2020 2020  ime..           
+000150c0: 2029 3a0d 0a20 2020 2020 2020 2020 2020   ):..           
+000150d0: 2020 2020 2023 2055 7365 2074 6865 205f       # Use the _
+000150e0: 5f70 7963 6163 6865 5f5f 2f2a 2e70 7963  _pycache__/*.pyc
+000150f0: 2066 696c 652c 2062 7574 2077 7269 7465   file, but write
+00015100: 2069 7420 746f 2074 6865 206c 6567 6163   it to the legac
+00015110: 7920 7079 630d 0a20 2020 2020 2020 2020  y pyc..         
+00015120: 2020 2020 2020 2023 2066 696c 6520 6e61         # file na
+00015130: 6d65 2069 6e20 7468 6520 6172 6368 6976  me in the archiv
+00015140: 652e 0d0a 2020 2020 2020 2020 2020 2020  e...            
+00015150: 2020 2020 666e 616d 6520 3d20 7079 6361      fname = pyca
+00015160: 6368 655f 6f70 7431 0d0a 2020 2020 2020  che_opt1..      
+00015170: 2020 2020 2020 2020 2020 6172 636e 616d            arcnam
+00015180: 6520 3d20 6669 6c65 5f70 7963 0d0a 2020  e = file_pyc..  
+00015190: 2020 2020 2020 2020 2020 656c 6966 2028            elif (
+000151a0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+000151b0: 2020 6f73 2e70 6174 682e 6973 6669 6c65    os.path.isfile
+000151c0: 2870 7963 6163 6865 5f6f 7074 3229 0d0a  (pycache_opt2)..
+000151d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000151e0: 616e 6420 6f73 2e73 7461 7428 7079 6361  and os.stat(pyca
+000151f0: 6368 655f 6f70 7432 292e 7374 5f6d 7469  che_opt2).st_mti
+00015200: 6d65 203e 3d20 6f73 2e73 7461 7428 6669  me >= os.stat(fi
+00015210: 6c65 5f70 7929 2e73 745f 6d74 696d 650d  le_py).st_mtime.
+00015220: 0a20 2020 2020 2020 2020 2020 2029 3a0d  .            ):.
+00015230: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00015240: 2023 2055 7365 2074 6865 205f 5f70 7963   # Use the __pyc
+00015250: 6163 6865 5f5f 2f2a 2e70 7963 2066 696c  ache__/*.pyc fil
+00015260: 652c 2062 7574 2077 7269 7465 2069 7420  e, but write it 
+00015270: 746f 2074 6865 206c 6567 6163 7920 7079  to the legacy py
+00015280: 630d 0a20 2020 2020 2020 2020 2020 2020  c..             
+00015290: 2020 2023 2066 696c 6520 6e61 6d65 2069     # file name i
+000152a0: 6e20 7468 6520 6172 6368 6976 652e 0d0a  n the archive...
+000152b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000152c0: 666e 616d 6520 3d20 7079 6361 6368 655f  fname = pycache_
+000152d0: 6f70 7432 0d0a 2020 2020 2020 2020 2020  opt2..          
+000152e0: 2020 2020 2020 6172 636e 616d 6520 3d20        arcname = 
+000152f0: 6669 6c65 5f70 7963 0d0a 2020 2020 2020  file_pyc..      
+00015300: 2020 2020 2020 656c 7365 3a0d 0a20 2020        else:..   
+00015310: 2020 2020 2020 2020 2020 2020 2023 2043               # C
+00015320: 6f6d 7069 6c65 2070 7920 696e 746f 2050  ompile py into P
+00015330: 4550 2033 3134 3720 7079 6320 6669 6c65  EP 3147 pyc file
+00015340: 2e0d 0a20 2020 2020 2020 2020 2020 2020  ...             
+00015350: 2020 2069 6620 5f63 6f6d 7069 6c65 2866     if _compile(f
+00015360: 696c 655f 7079 293a 0d0a 2020 2020 2020  ile_py):..      
+00015370: 2020 2020 2020 2020 2020 2020 2020 6966                if
+00015380: 2073 7973 2e66 6c61 6773 2e6f 7074 696d   sys.flags.optim
+00015390: 697a 6520 3d3d 2030 3a0d 0a20 2020 2020  ize == 0:..     
+000153a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000153b0: 2020 2066 6e61 6d65 203d 2070 7963 6163     fname = pycac
+000153c0: 6865 5f6f 7074 300d 0a20 2020 2020 2020  he_opt0..       
+000153d0: 2020 2020 2020 2020 2020 2020 2065 6c69               eli
+000153e0: 6620 7379 732e 666c 6167 732e 6f70 7469  f sys.flags.opti
+000153f0: 6d69 7a65 203d 3d20 313a 0d0a 2020 2020  mize == 1:..    
+00015400: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015410: 2020 2020 666e 616d 6520 3d20 7079 6361      fname = pyca
+00015420: 6368 655f 6f70 7431 0d0a 2020 2020 2020  che_opt1..      
+00015430: 2020 2020 2020 2020 2020 2020 2020 656c                el
+00015440: 7365 3a0d 0a20 2020 2020 2020 2020 2020  se:..           
+00015450: 2020 2020 2020 2020 2020 2020 2066 6e61               fna
+00015460: 6d65 203d 2070 7963 6163 6865 5f6f 7074  me = pycache_opt
+00015470: 320d 0a20 2020 2020 2020 2020 2020 2020  2..             
+00015480: 2020 2020 2020 2061 7263 6e61 6d65 203d         arcname =
+00015490: 2066 696c 655f 7079 630d 0a20 2020 2020   file_pyc..     
+000154a0: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
+000154b0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+000154c0: 2020 2020 2020 666e 616d 6520 3d20 6172        fname = ar
+000154d0: 636e 616d 6520 3d20 6669 6c65 5f70 790d  cname = file_py.
+000154e0: 0a20 2020 2020 2020 2065 6c73 653a 0d0a  .        else:..
+000154f0: 2020 2020 2020 2020 2020 2020 2320 6e65              # ne
+00015500: 7720 6d6f 6465 3a20 7573 6520 6769 7665  w mode: use give
+00015510: 6e20 6f70 7469 6d69 7a61 7469 6f6e 206c  n optimization l
+00015520: 6576 656c 0d0a 2020 2020 2020 2020 2020  evel..          
+00015530: 2020 6966 2073 656c 662e 5f6f 7074 696d    if self._optim
+00015540: 697a 6520 3d3d 2030 3a0d 0a20 2020 2020  ize == 0:..     
+00015550: 2020 2020 2020 2020 2020 2066 6e61 6d65             fname
+00015560: 203d 2070 7963 6163 6865 5f6f 7074 300d   = pycache_opt0.
+00015570: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00015580: 2061 7263 6e61 6d65 203d 2066 696c 655f   arcname = file_
+00015590: 7079 630d 0a20 2020 2020 2020 2020 2020  pyc..           
+000155a0: 2065 6c73 653a 0d0a 2020 2020 2020 2020   else:..        
+000155b0: 2020 2020 2020 2020 6172 636e 616d 6520          arcname 
+000155c0: 3d20 6669 6c65 5f70 7963 0d0a 2020 2020  = file_pyc..    
+000155d0: 2020 2020 2020 2020 2020 2020 6966 2073              if s
+000155e0: 656c 662e 5f6f 7074 696d 697a 6520 3d3d  elf._optimize ==
+000155f0: 2031 3a0d 0a20 2020 2020 2020 2020 2020   1:..           
+00015600: 2020 2020 2020 2020 2066 6e61 6d65 203d           fname =
+00015610: 2070 7963 6163 6865 5f6f 7074 310d 0a20   pycache_opt1.. 
+00015620: 2020 2020 2020 2020 2020 2020 2020 2065                 e
+00015630: 6c69 6620 7365 6c66 2e5f 6f70 7469 6d69  lif self._optimi
+00015640: 7a65 203d 3d20 323a 0d0a 2020 2020 2020  ze == 2:..      
+00015650: 2020 2020 2020 2020 2020 2020 2020 666e                fn
+00015660: 616d 6520 3d20 7079 6361 6368 655f 6f70  ame = pycache_op
+00015670: 7432 0d0a 2020 2020 2020 2020 2020 2020  t2..            
+00015680: 2020 2020 656c 7365 3a0d 0a20 2020 2020      else:..     
+00015690: 2020 2020 2020 2020 2020 2020 2020 206d                 m
+000156a0: 7367 203d 2022 696e 7661 6c69 6420 7661  sg = "invalid va
+000156b0: 6c75 6520 666f 7220 276f 7074 696d 697a  lue for 'optimiz
+000156c0: 6527 3a20 7b21 727d 222e 666f 726d 6174  e': {!r}".format
+000156d0: 280d 0a20 2020 2020 2020 2020 2020 2020  (..             
+000156e0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+000156f0: 5f6f 7074 696d 697a 652c 0d0a 2020 2020  _optimize,..    
+00015700: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015710: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
+00015720: 2020 2020 2020 2072 6169 7365 2056 616c         raise Val
+00015730: 7565 4572 726f 7228 6d73 6729 0d0a 2020  ueError(msg)..  
+00015740: 2020 2020 2020 2020 2020 6966 206e 6f74            if not
+00015750: 2028 0d0a 2020 2020 2020 2020 2020 2020   (..            
+00015760: 2020 2020 6f73 2e70 6174 682e 6973 6669      os.path.isfi
+00015770: 6c65 2866 6e61 6d65 290d 0a20 2020 2020  le(fname)..     
+00015780: 2020 2020 2020 2020 2020 2061 6e64 206f             and o
+00015790: 732e 7374 6174 2866 6e61 6d65 292e 7374  s.stat(fname).st
+000157a0: 5f6d 7469 6d65 203e 3d20 6f73 2e73 7461  _mtime >= os.sta
+000157b0: 7428 6669 6c65 5f70 7929 2e73 745f 6d74  t(file_py).st_mt
+000157c0: 696d 650d 0a20 2020 2020 2020 2020 2020  ime..           
+000157d0: 2029 2061 6e64 206e 6f74 205f 636f 6d70   ) and not _comp
+000157e0: 696c 6528 6669 6c65 5f70 792c 206f 7074  ile(file_py, opt
+000157f0: 696d 697a 653d 7365 6c66 2e5f 6f70 7469  imize=self._opti
+00015800: 6d69 7a65 293a 0d0a 2020 2020 2020 2020  mize):..        
+00015810: 2020 2020 2020 2020 666e 616d 6520 3d20          fname = 
+00015820: 6172 636e 616d 6520 3d20 6669 6c65 5f70  arcname = file_p
+00015830: 790d 0a20 2020 2020 2020 2061 7263 6869  y..        archi
+00015840: 7665 6e61 6d65 203d 206f 732e 7061 7468  vename = os.path
+00015850: 2e73 706c 6974 2861 7263 6e61 6d65 295b  .split(arcname)[
+00015860: 315d 0d0a 2020 2020 2020 2020 6966 2062  1]..        if b
+00015870: 6173 656e 616d 653a 0d0a 2020 2020 2020  asename:..      
+00015880: 2020 2020 2020 6172 6368 6976 656e 616d        archivenam
+00015890: 6520 3d20 6622 7b62 6173 656e 616d 657d  e = f"{basename}
+000158a0: 2f7b 6172 6368 6976 656e 616d 657d 220d  /{archivename}".
+000158b0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+000158c0: 2866 6e61 6d65 2c20 6172 6368 6976 656e  (fname, archiven
+000158d0: 616d 6529 0d0a 0d0a 0d0a 6465 6620 5f70  ame)......def _p
+000158e0: 6172 656e 7473 2870 6174 6829 3a0d 0a20  arents(path):.. 
+000158f0: 2020 2022 2222 0d0a 2020 2020 4769 7665     """..    Give
+00015900: 6e20 6120 7061 7468 2077 6974 6820 656c  n a path with el
+00015910: 656d 656e 7473 2073 6570 6172 6174 6564  ements separated
+00015920: 2062 790d 0a20 2020 2070 6f73 6978 7061   by..    posixpa
+00015930: 7468 2e73 6570 2c20 6765 6e65 7261 7465  th.sep, generate
+00015940: 2061 6c6c 2070 6172 656e 7473 206f 6620   all parents of 
+00015950: 7468 6174 2070 6174 682e 0d0a 0d0a 2020  that path.....  
+00015960: 2020 3e3e 3e20 6c69 7374 285f 7061 7265    >>> list(_pare
+00015970: 6e74 7328 2762 2f64 2729 290d 0a20 2020  nts('b/d'))..   
+00015980: 205b 2762 275d 0d0a 2020 2020 3e3e 3e20   ['b']..    >>> 
+00015990: 6c69 7374 285f 7061 7265 6e74 7328 272f  list(_parents('/
+000159a0: 622f 642f 2729 290d 0a20 2020 205b 272f  b/d/'))..    ['/
+000159b0: 6227 5d0d 0a20 2020 203e 3e3e 206c 6973  b']..    >>> lis
+000159c0: 7428 5f70 6172 656e 7473 2827 622f 642f  t(_parents('b/d/
+000159d0: 662f 2729 290d 0a20 2020 205b 2762 2f64  f/'))..    ['b/d
+000159e0: 272c 2027 6227 5d0d 0a20 2020 203e 3e3e  ', 'b']..    >>>
+000159f0: 206c 6973 7428 5f70 6172 656e 7473 2827   list(_parents('
+00015a00: 6227 2929 0d0a 2020 2020 5b5d 0d0a 2020  b'))..    []..  
+00015a10: 2020 3e3e 3e20 6c69 7374 285f 7061 7265    >>> list(_pare
+00015a20: 6e74 7328 2727 2929 0d0a 2020 2020 5b5d  nts(''))..    []
+00015a30: 0d0a 2020 2020 2222 220d 0a20 2020 2072  ..    """..    r
+00015a40: 6574 7572 6e20 6974 6572 746f 6f6c 732e  eturn itertools.
+00015a50: 6973 6c69 6365 285f 616e 6365 7374 7279  islice(_ancestry
+00015a60: 2870 6174 6829 2c20 312c 204e 6f6e 6529  (path), 1, None)
+00015a70: 0d0a 0d0a 0d0a 6465 6620 5f61 6e63 6573  ......def _ances
+00015a80: 7472 7928 7061 7468 293a 0d0a 2020 2020  try(path):..    
+00015a90: 2222 220d 0a20 2020 2047 6976 656e 2061  """..    Given a
+00015aa0: 2070 6174 6820 7769 7468 2065 6c65 6d65   path with eleme
+00015ab0: 6e74 7320 7365 7061 7261 7465 6420 6279  nts separated by
+00015ac0: 0d0a 2020 2020 706f 7369 7870 6174 682e  ..    posixpath.
+00015ad0: 7365 702c 2067 656e 6572 6174 6520 616c  sep, generate al
+00015ae0: 6c20 656c 656d 656e 7473 206f 6620 7468  l elements of th
+00015af0: 6174 2070 6174 682e 0d0a 0d0a 2020 2020  at path.....    
+00015b00: 3e3e 3e20 6c69 7374 285f 616e 6365 7374  >>> list(_ancest
+00015b10: 7279 2827 622f 6427 2929 0d0a 2020 2020  ry('b/d'))..    
+00015b20: 5b27 622f 6427 2c20 2762 275d 0d0a 2020  ['b/d', 'b']..  
+00015b30: 2020 3e3e 3e20 6c69 7374 285f 616e 6365    >>> list(_ance
+00015b40: 7374 7279 2827 2f62 2f64 2f27 2929 0d0a  stry('/b/d/'))..
+00015b50: 2020 2020 5b27 2f62 2f64 272c 2027 2f62      ['/b/d', '/b
+00015b60: 275d 0d0a 2020 2020 3e3e 3e20 6c69 7374  ']..    >>> list
+00015b70: 285f 616e 6365 7374 7279 2827 622f 642f  (_ancestry('b/d/
+00015b80: 662f 2729 290d 0a20 2020 205b 2762 2f64  f/'))..    ['b/d
+00015b90: 2f66 272c 2027 622f 6427 2c20 2762 275d  /f', 'b/d', 'b']
+00015ba0: 0d0a 2020 2020 3e3e 3e20 6c69 7374 285f  ..    >>> list(_
+00015bb0: 616e 6365 7374 7279 2827 6227 2929 0d0a  ancestry('b'))..
+00015bc0: 2020 2020 5b27 6227 5d0d 0a20 2020 203e      ['b']..    >
+00015bd0: 3e3e 206c 6973 7428 5f61 6e63 6573 7472  >> list(_ancestr
+00015be0: 7928 2727 2929 0d0a 2020 2020 5b5d 0d0a  y(''))..    []..
+00015bf0: 2020 2020 2222 220d 0a20 2020 2070 6174      """..    pat
+00015c00: 6820 3d20 7061 7468 2e72 7374 7269 7028  h = path.rstrip(
+00015c10: 706f 7369 7870 6174 682e 7365 7029 0d0a  posixpath.sep)..
+00015c20: 2020 2020 7768 696c 6520 7061 7468 2061      while path a
+00015c30: 6e64 2070 6174 6820 213d 2070 6f73 6978  nd path != posix
+00015c40: 7061 7468 2e73 6570 3a0d 0a20 2020 2020  path.sep:..     
+00015c50: 2020 2079 6965 6c64 2070 6174 680d 0a20     yield path.. 
+00015c60: 2020 2020 2020 2070 6174 682c 2074 6169         path, tai
+00015c70: 6c20 3d20 706f 7369 7870 6174 682e 7370  l = posixpath.sp
+00015c80: 6c69 7428 7061 7468 290d 0a0d 0a0d 0a5f  lit(path)......_
+00015c90: 6465 6475 7065 203d 2064 6963 742e 6672  dedupe = dict.fr
+00015ca0: 6f6d 6b65 7973 0d0a 2222 2244 6564 7570  omkeys.."""Dedup
+00015cb0: 6c69 6361 7465 2061 6e20 6974 6572 6162  licate an iterab
+00015cc0: 6c65 2069 6e20 6f72 6967 696e 616c 206f  le in original o
+00015cd0: 7264 6572 2222 220d 0a0d 0a0d 0a64 6566  rder"""......def
+00015ce0: 205f 6469 6666 6572 656e 6365 286d 696e   _difference(min
+00015cf0: 7565 6e64 2c20 7375 6274 7261 6865 6e64  uend, subtrahend
+00015d00: 293a 0d0a 2020 2020 2222 220d 0a20 2020  ):..    """..   
+00015d10: 2052 6574 7572 6e20 6974 656d 7320 696e   Return items in
+00015d20: 206d 696e 7565 6e64 206e 6f74 2069 6e20   minuend not in 
+00015d30: 7375 6274 7261 6865 6e64 2c20 7265 7461  subtrahend, reta
+00015d40: 696e 696e 6720 6f72 6465 720d 0a20 2020  ining order..   
+00015d50: 2077 6974 6820 4f28 3129 206c 6f6f 6b75   with O(1) looku
+00015d60: 702e 0d0a 2020 2020 2222 220d 0a20 2020  p...    """..   
+00015d70: 2072 6574 7572 6e20 6974 6572 746f 6f6c   return itertool
+00015d80: 732e 6669 6c74 6572 6661 6c73 6528 7365  s.filterfalse(se
+00015d90: 7428 7375 6274 7261 6865 6e64 292e 5f5f  t(subtrahend).__
+00015da0: 636f 6e74 6169 6e73 5f5f 2c20 6d69 6e75  contains__, minu
+00015db0: 656e 6429 0d0a 0d0a 0d0a 636c 6173 7320  end)......class 
+00015dc0: 436f 6d70 6c65 7465 4469 7273 285a 6970  CompleteDirs(Zip
+00015dd0: 4669 6c65 293a 0d0a 2020 2020 2222 220d  File):..    """.
+00015de0: 0a20 2020 2041 205a 6970 4669 6c65 2073  .    A ZipFile s
+00015df0: 7562 636c 6173 7320 7468 6174 2065 6e73  ubclass that ens
+00015e00: 7572 6573 2074 6861 7420 696d 706c 6965  ures that implie
+00015e10: 6420 6469 7265 6374 6f72 6965 730d 0a20  d directories.. 
+00015e20: 2020 2061 7265 2061 6c77 6179 7320 696e     are always in
+00015e30: 636c 7564 6564 2069 6e20 7468 6520 6e61  cluded in the na
+00015e40: 6d65 6c69 7374 2e0d 0a20 2020 2022 2222  melist...    """
+00015e50: 0d0a 0d0a 2020 2020 4073 7461 7469 636d  ....    @staticm
+00015e60: 6574 686f 640d 0a20 2020 2064 6566 205f  ethod..    def _
+00015e70: 696d 706c 6965 645f 6469 7273 286e 616d  implied_dirs(nam
+00015e80: 6573 293a 0d0a 2020 2020 2020 2020 7061  es):..        pa
+00015e90: 7265 6e74 7320 3d20 6974 6572 746f 6f6c  rents = itertool
+00015ea0: 732e 6368 6169 6e2e 6672 6f6d 5f69 7465  s.chain.from_ite
+00015eb0: 7261 626c 6528 6d61 7028 5f70 6172 656e  rable(map(_paren
+00015ec0: 7473 2c20 6e61 6d65 7329 290d 0a20 2020  ts, names))..   
+00015ed0: 2020 2020 2061 735f 6469 7273 203d 2028       as_dirs = (
+00015ee0: 7020 2b20 706f 7369 7870 6174 682e 7365  p + posixpath.se
+00015ef0: 7020 666f 7220 7020 696e 2070 6172 656e  p for p in paren
+00015f00: 7473 290d 0a20 2020 2020 2020 2072 6574  ts)..        ret
+00015f10: 7572 6e20 5f64 6564 7570 6528 5f64 6966  urn _dedupe(_dif
+00015f20: 6665 7265 6e63 6528 6173 5f64 6972 732c  ference(as_dirs,
+00015f30: 206e 616d 6573 2929 0d0a 0d0a 2020 2020   names))....    
+00015f40: 6465 6620 6e61 6d65 6c69 7374 2873 656c  def namelist(sel
+00015f50: 6629 3a0d 0a20 2020 2020 2020 206e 616d  f):..        nam
+00015f60: 6573 203d 2073 7570 6572 2829 2e6e 616d  es = super().nam
+00015f70: 656c 6973 7428 290d 0a20 2020 2020 2020  elist()..       
+00015f80: 2072 6574 7572 6e20 6e61 6d65 7320 2b20   return names + 
+00015f90: 6c69 7374 2873 656c 662e 5f69 6d70 6c69  list(self._impli
+00015fa0: 6564 5f64 6972 7328 6e61 6d65 7329 290d  ed_dirs(names)).
+00015fb0: 0a0d 0a20 2020 2064 6566 205f 6e61 6d65  ...    def _name
+00015fc0: 5f73 6574 2873 656c 6629 3a0d 0a20 2020  _set(self):..   
+00015fd0: 2020 2020 2072 6574 7572 6e20 7365 7428       return set(
+00015fe0: 7365 6c66 2e6e 616d 656c 6973 7428 2929  self.namelist())
+00015ff0: 0d0a 0d0a 2020 2020 6465 6620 7265 736f  ....    def reso
+00016000: 6c76 655f 6469 7228 7365 6c66 2c20 6e61  lve_dir(self, na
+00016010: 6d65 293a 0d0a 2020 2020 2020 2020 2222  me):..        ""
+00016020: 220d 0a20 2020 2020 2020 2049 6620 7468  "..        If th
+00016030: 6520 6e61 6d65 2072 6570 7265 7365 6e74  e name represent
+00016040: 7320 6120 6469 7265 6374 6f72 792c 2072  s a directory, r
+00016050: 6574 7572 6e20 7468 6174 206e 616d 650d  eturn that name.
+00016060: 0a20 2020 2020 2020 2061 7320 6120 6469  .        as a di
+00016070: 7265 6374 6f72 7920 2877 6974 6820 7468  rectory (with th
+00016080: 6520 7472 6169 6c69 6e67 2073 6c61 7368  e trailing slash
+00016090: 292e 0d0a 2020 2020 2020 2020 2222 220d  )...        """.
+000160a0: 0a20 2020 2020 2020 206e 616d 6573 203d  .        names =
+000160b0: 2073 656c 662e 5f6e 616d 655f 7365 7428   self._name_set(
+000160c0: 290d 0a20 2020 2020 2020 2064 6972 6e61  )..        dirna
+000160d0: 6d65 203d 206e 616d 6520 2b20 222f 220d  me = name + "/".
+000160e0: 0a20 2020 2020 2020 2064 6972 5f6d 6174  .        dir_mat
+000160f0: 6368 203d 206e 616d 6520 6e6f 7420 696e  ch = name not in
+00016100: 206e 616d 6573 2061 6e64 2064 6972 6e61   names and dirna
+00016110: 6d65 2069 6e20 6e61 6d65 730d 0a20 2020  me in names..   
+00016120: 2020 2020 2072 6574 7572 6e20 6469 726e       return dirn
+00016130: 616d 6520 6966 2064 6972 5f6d 6174 6368  ame if dir_match
+00016140: 2065 6c73 6520 6e61 6d65 0d0a 0d0a 2020   else name....  
+00016150: 2020 4063 6c61 7373 6d65 7468 6f64 0d0a    @classmethod..
+00016160: 2020 2020 6465 6620 6d61 6b65 2863 6c73      def make(cls
+00016170: 2c20 736f 7572 6365 293a 0d0a 2020 2020  , source):..    
+00016180: 2020 2020 2222 220d 0a20 2020 2020 2020      """..       
+00016190: 2047 6976 656e 2061 2073 6f75 7263 6520   Given a source 
+000161a0: 2866 696c 656e 616d 6520 6f72 207a 6970  (filename or zip
+000161b0: 6669 6c65 292c 2072 6574 7572 6e20 616e  file), return an
+000161c0: 0d0a 2020 2020 2020 2020 6170 7072 6f70  ..        approp
+000161d0: 7269 6174 6520 436f 6d70 6c65 7465 4469  riate CompleteDi
+000161e0: 7273 2073 7562 636c 6173 732e 0d0a 2020  rs subclass...  
+000161f0: 2020 2020 2020 2222 220d 0a20 2020 2020        """..     
+00016200: 2020 2069 6620 6973 696e 7374 616e 6365     if isinstance
+00016210: 2873 6f75 7263 652c 2043 6f6d 706c 6574  (source, Complet
+00016220: 6544 6972 7329 3a0d 0a20 2020 2020 2020  eDirs):..       
+00016230: 2020 2020 2072 6574 7572 6e20 736f 7572       return sour
+00016240: 6365 0d0a 0d0a 2020 2020 2020 2020 6966  ce....        if
+00016250: 206e 6f74 2069 7369 6e73 7461 6e63 6528   not isinstance(
+00016260: 736f 7572 6365 2c20 5a69 7046 696c 6529  source, ZipFile)
+00016270: 3a0d 0a20 2020 2020 2020 2020 2020 2072  :..            r
+00016280: 6574 7572 6e20 636c 7328 736f 7572 6365  eturn cls(source
+00016290: 290d 0a0d 0a20 2020 2020 2020 2023 204f  )....        # O
+000162a0: 6e6c 7920 616c 6c6f 7720 666f 7220 4661  nly allow for Fa
+000162b0: 7374 5061 7468 2077 6865 6e20 7375 7070  stPath when supp
+000162c0: 6c69 6564 207a 6970 6669 6c65 2069 7320  lied zipfile is 
+000162d0: 7265 6164 2d6f 6e6c 790d 0a20 2020 2020  read-only..     
+000162e0: 2020 2069 6620 2272 2220 6e6f 7420 696e     if "r" not in
+000162f0: 2073 6f75 7263 652e 6d6f 6465 3a0d 0a20   source.mode:.. 
+00016300: 2020 2020 2020 2020 2020 2063 6c73 203d             cls =
+00016310: 2043 6f6d 706c 6574 6544 6972 730d 0a0d   CompleteDirs...
+00016320: 0a20 2020 2020 2020 2072 6573 203d 2063  .        res = c
+00016330: 6c73 2e5f 5f6e 6577 5f5f 2863 6c73 290d  ls.__new__(cls).
+00016340: 0a20 2020 2020 2020 2076 6172 7328 7265  .        vars(re
+00016350: 7329 2e75 7064 6174 6528 7661 7273 2873  s).update(vars(s
+00016360: 6f75 7263 6529 290d 0a20 2020 2020 2020  ource))..       
+00016370: 2072 6574 7572 6e20 7265 730d 0a0d 0a0d   return res.....
+00016380: 0a63 6c61 7373 2046 6173 744c 6f6f 6b75  .class FastLooku
+00016390: 7028 436f 6d70 6c65 7465 4469 7273 293a  p(CompleteDirs):
+000163a0: 0d0a 2020 2020 2222 220d 0a20 2020 205a  ..    """..    Z
+000163b0: 6970 4669 6c65 2073 7562 636c 6173 7320  ipFile subclass 
+000163c0: 746f 2065 6e73 7572 6520 696d 706c 6963  to ensure implic
+000163d0: 6974 0d0a 2020 2020 6469 7273 2065 7869  it..    dirs exi
+000163e0: 7374 2061 6e64 2061 7265 2072 6573 6f6c  st and are resol
+000163f0: 7665 6420 7261 7069 646c 792e 0d0a 2020  ved rapidly...  
+00016400: 2020 2222 220d 0a0d 0a20 2020 2064 6566    """....    def
+00016410: 206e 616d 656c 6973 7428 7365 6c66 293a   namelist(self):
+00016420: 0d0a 2020 2020 2020 2020 7769 7468 2063  ..        with c
+00016430: 6f6e 7465 7874 6c69 622e 7375 7070 7265  ontextlib.suppre
+00016440: 7373 2841 7474 7269 6275 7465 4572 726f  ss(AttributeErro
+00016450: 7229 3a0d 0a20 2020 2020 2020 2020 2020  r):..           
+00016460: 2072 6574 7572 6e20 7365 6c66 2e5f 5f6e   return self.__n
+00016470: 616d 6573 0d0a 2020 2020 2020 2020 7365  ames..        se
+00016480: 6c66 2e5f 5f6e 616d 6573 203d 2073 7570  lf.__names = sup
+00016490: 6572 2829 2e6e 616d 656c 6973 7428 290d  er().namelist().
+000164a0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+000164b0: 7365 6c66 2e5f 5f6e 616d 6573 0d0a 0d0a  self.__names....
+000164c0: 2020 2020 6465 6620 5f6e 616d 655f 7365      def _name_se
+000164d0: 7428 7365 6c66 293a 0d0a 2020 2020 2020  t(self):..      
+000164e0: 2020 7769 7468 2063 6f6e 7465 7874 6c69    with contextli
+000164f0: 622e 7375 7070 7265 7373 2841 7474 7269  b.suppress(Attri
+00016500: 6275 7465 4572 726f 7229 3a0d 0a20 2020  buteError):..   
+00016510: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+00016520: 7365 6c66 2e5f 5f6c 6f6f 6b75 700d 0a20  self.__lookup.. 
+00016530: 2020 2020 2020 2073 656c 662e 5f5f 6c6f         self.__lo
+00016540: 6f6b 7570 203d 2073 7570 6572 2829 2e5f  okup = super()._
+00016550: 6e61 6d65 5f73 6574 2829 0d0a 2020 2020  name_set()..    
+00016560: 2020 2020 7265 7475 726e 2073 656c 662e      return self.
+00016570: 5f5f 6c6f 6f6b 7570 0d0a 0d0a 0d0a 636c  __lookup......cl
+00016580: 6173 7320 5061 7468 3a0d 0a20 2020 2022  ass Path:..    "
+00016590: 2222 0d0a 2020 2020 4120 7061 7468 6c69  ""..    A pathli
+000165a0: 622d 636f 6d70 6174 6962 6c65 2069 6e74  b-compatible int
+000165b0: 6572 6661 6365 2066 6f72 207a 6970 2066  erface for zip f
+000165c0: 696c 6573 2e0d 0a0d 0a20 2020 2043 6f6e  iles.....    Con
+000165d0: 7369 6465 7220 6120 7a69 7020 6669 6c65  sider a zip file
+000165e0: 2077 6974 6820 7468 6973 2073 7472 7563   with this struc
+000165f0: 7475 7265 3a3a 0d0a 0d0a 2020 2020 2020  ture::....      
+00016600: 2020 2e0d 0a20 2020 2020 2020 20e2 949c    ...        ...
+00016610: e294 80e2 9480 2061 2e74 7874 0d0a 2020  ...... a.txt..  
+00016620: 2020 2020 2020 e294 94e2 9480 e294 8020        ......... 
+00016630: 620d 0a20 2020 2020 2020 2020 2020 20e2  b..            .
+00016640: 949c e294 80e2 9480 2063 2e74 7874 0d0a  ........ c.txt..
+00016650: 2020 2020 2020 2020 2020 2020 e294 94e2              ....
+00016660: 9480 e294 8020 640d 0a20 2020 2020 2020  ..... d..       
+00016670: 2020 2020 2020 2020 20e2 9494 e294 80e2           .......
+00016680: 9480 2065 2e74 7874 0d0a 0d0a 2020 2020  .. e.txt....    
+00016690: 3e3e 3e20 6461 7461 203d 2069 6f2e 4279  >>> data = io.By
+000166a0: 7465 7349 4f28 290d 0a20 2020 203e 3e3e  tesIO()..    >>>
+000166b0: 207a 6620 3d20 5a69 7046 696c 6528 6461   zf = ZipFile(da
+000166c0: 7461 2c20 2777 2729 0d0a 2020 2020 3e3e  ta, 'w')..    >>
+000166d0: 3e20 7a66 2e77 7269 7465 7374 7228 2761  > zf.writestr('a
+000166e0: 2e74 7874 272c 2027 636f 6e74 656e 7420  .txt', 'content 
+000166f0: 6f66 2061 2729 0d0a 2020 2020 3e3e 3e20  of a')..    >>> 
+00016700: 7a66 2e77 7269 7465 7374 7228 2762 2f63  zf.writestr('b/c
+00016710: 2e74 7874 272c 2027 636f 6e74 656e 7420  .txt', 'content 
+00016720: 6f66 2063 2729 0d0a 2020 2020 3e3e 3e20  of c')..    >>> 
+00016730: 7a66 2e77 7269 7465 7374 7228 2762 2f64  zf.writestr('b/d
+00016740: 2f65 2e74 7874 272c 2027 636f 6e74 656e  /e.txt', 'conten
+00016750: 7420 6f66 2065 2729 0d0a 2020 2020 3e3e  t of e')..    >>
+00016760: 3e20 7a66 2e66 696c 656e 616d 6520 3d20  > zf.filename = 
+00016770: 2761 6263 6465 2e7a 6970 270d 0a0d 0a20  'abcde.zip'.... 
+00016780: 2020 2050 6174 6820 6163 6365 7074 7320     Path accepts 
+00016790: 7468 6520 7a69 7066 696c 6520 6f62 6a65  the zipfile obje
+000167a0: 6374 2069 7473 656c 6620 6f72 2061 2066  ct itself or a f
+000167b0: 696c 656e 616d 650d 0a0d 0a20 2020 203e  ilename....    >
+000167c0: 3e3e 2072 6f6f 7420 3d20 5061 7468 287a  >> root = Path(z
+000167d0: 6629 0d0a 0d0a 2020 2020 4672 6f6d 2074  f)....    From t
+000167e0: 6865 7265 2c20 7365 7665 7261 6c20 7061  here, several pa
+000167f0: 7468 206f 7065 7261 7469 6f6e 7320 6172  th operations ar
+00016800: 6520 6176 6169 6c61 626c 652e 0d0a 0d0a  e available.....
+00016810: 2020 2020 4469 7265 6374 6f72 7920 6974      Directory it
+00016820: 6572 6174 696f 6e20 2869 6e63 6c75 6469  eration (includi
+00016830: 6e67 2074 6865 207a 6970 2066 696c 6520  ng the zip file 
+00016840: 6974 7365 6c66 293a 0d0a 0d0a 2020 2020  itself):....    
+00016850: 3e3e 3e20 612c 2062 203d 2072 6f6f 742e  >>> a, b = root.
+00016860: 6974 6572 6469 7228 290d 0a20 2020 203e  iterdir()..    >
+00016870: 3e3e 2061 0d0a 2020 2020 5061 7468 2827  >> a..    Path('
+00016880: 6162 6364 652e 7a69 7027 2c20 2761 2e74  abcde.zip', 'a.t
+00016890: 7874 2729 0d0a 2020 2020 3e3e 3e20 620d  xt')..    >>> b.
+000168a0: 0a20 2020 2050 6174 6828 2761 6263 6465  .    Path('abcde
+000168b0: 2e7a 6970 272c 2027 622f 2729 0d0a 0d0a  .zip', 'b/')....
+000168c0: 2020 2020 6e61 6d65 2070 726f 7065 7274      name propert
+000168d0: 793a 0d0a 0d0a 2020 2020 3e3e 3e20 622e  y:....    >>> b.
+000168e0: 6e61 6d65 0d0a 2020 2020 2762 270d 0a0d  name..    'b'...
+000168f0: 0a20 2020 206a 6f69 6e20 7769 7468 2064  .    join with d
+00016900: 6976 6964 6520 6f70 6572 6174 6f72 3a0d  ivide operator:.
+00016910: 0a0d 0a20 2020 203e 3e3e 2063 203d 2062  ...    >>> c = b
+00016920: 202f 2027 632e 7478 7427 0d0a 2020 2020   / 'c.txt'..    
+00016930: 3e3e 3e20 630d 0a20 2020 2050 6174 6828  >>> c..    Path(
+00016940: 2761 6263 6465 2e7a 6970 272c 2027 622f  'abcde.zip', 'b/
+00016950: 632e 7478 7427 290d 0a20 2020 203e 3e3e  c.txt')..    >>>
+00016960: 2063 2e6e 616d 650d 0a20 2020 2027 632e   c.name..    'c.
+00016970: 7478 7427 0d0a 0d0a 2020 2020 5265 6164  txt'....    Read
+00016980: 2074 6578 743a 0d0a 0d0a 2020 2020 3e3e   text:....    >>
+00016990: 3e20 632e 7265 6164 5f74 6578 7428 290d  > c.read_text().
+000169a0: 0a20 2020 2027 636f 6e74 656e 7420 6f66  .    'content of
+000169b0: 2063 270d 0a0d 0a20 2020 2065 7869 7374   c'....    exist
+000169c0: 656e 6365 3a0d 0a0d 0a20 2020 203e 3e3e  ence:....    >>>
+000169d0: 2063 2e65 7869 7374 7328 290d 0a20 2020   c.exists()..   
+000169e0: 2054 7275 650d 0a20 2020 203e 3e3e 2028   True..    >>> (
+000169f0: 6220 2f20 276d 6973 7369 6e67 2e74 7874  b / 'missing.txt
+00016a00: 2729 2e65 7869 7374 7328 290d 0a20 2020  ').exists()..   
+00016a10: 2046 616c 7365 0d0a 0d0a 2020 2020 436f   False....    Co
+00016a20: 6572 6369 6f6e 2074 6f20 7374 7269 6e67  ercion to string
+00016a30: 3a0d 0a0d 0a20 2020 203e 3e3e 2073 7472  :....    >>> str
+00016a40: 2863 290d 0a20 2020 2027 6162 6364 652e  (c)..    'abcde.
+00016a50: 7a69 702f 622f 632e 7478 7427 0d0a 2020  zip/b/c.txt'..  
+00016a60: 2020 2222 220d 0a0d 0a20 2020 205f 5f72    """....    __r
+00016a70: 6570 7220 3d20 227b 7365 6c66 2e5f 5f63  epr = "{self.__c
+00016a80: 6c61 7373 5f5f 2e5f 5f6e 616d 655f 5f7d  lass__.__name__}
+00016a90: 287b 7365 6c66 2e72 6f6f 742e 6669 6c65  ({self.root.file
+00016aa0: 6e61 6d65 2172 7d2c 207b 7365 6c66 2e61  name!r}, {self.a
+00016ab0: 7421 727d 2922 0d0a 0d0a 2020 2020 6465  t!r})"....    de
+00016ac0: 6620 5f5f 696e 6974 5f5f 2873 656c 662c  f __init__(self,
+00016ad0: 2072 6f6f 742c 2061 743d 2222 2920 2d3e   root, at="") ->
+00016ae0: 204e 6f6e 653a 0d0a 2020 2020 2020 2020   None:..        
+00016af0: 7365 6c66 2e72 6f6f 7420 3d20 4661 7374  self.root = Fast
+00016b00: 4c6f 6f6b 7570 2e6d 616b 6528 726f 6f74  Lookup.make(root
+00016b10: 290d 0a20 2020 2020 2020 2073 656c 662e  )..        self.
+00016b20: 6174 203d 2061 740d 0a0d 0a20 2020 2064  at = at....    d
+00016b30: 6566 206f 7065 6e28 7365 6c66 2c20 6d6f  ef open(self, mo
+00016b40: 6465 3d22 7222 2c20 2a61 7267 732c 202a  de="r", *args, *
+00016b50: 2a6b 7761 7267 7329 3a0d 0a20 2020 2020  *kwargs):..     
+00016b60: 2020 2022 2222 0d0a 2020 2020 2020 2020     """..        
+00016b70: 4f70 656e 2074 6869 7320 656e 7472 7920  Open this entry 
+00016b80: 6173 2074 6578 7420 6f72 2062 696e 6172  as text or binar
+00016b90: 7920 666f 6c6c 6f77 696e 6720 7468 6520  y following the 
+00016ba0: 7365 6d61 6e74 6963 730d 0a20 2020 2020  semantics..     
+00016bb0: 2020 206f 6620 6060 7061 7468 6c69 622e     of ``pathlib.
+00016bc0: 5061 7468 2e6f 7065 6e28 2960 6020 6279  Path.open()`` by
+00016bd0: 2070 6173 7369 6e67 2061 7267 756d 656e   passing argumen
+00016be0: 7473 2074 6872 6f75 6768 0d0a 2020 2020  ts through..    
+00016bf0: 2020 2020 746f 2069 6f2e 5465 7874 494f      to io.TextIO
+00016c00: 5772 6170 7065 7228 292e 0d0a 2020 2020  Wrapper()...    
+00016c10: 2020 2020 2222 220d 0a20 2020 2020 2020      """..       
+00016c20: 2070 7764 203d 206b 7761 7267 732e 706f   pwd = kwargs.po
+00016c30: 7028 2270 7764 222c 204e 6f6e 6529 0d0a  p("pwd", None)..
+00016c40: 2020 2020 2020 2020 7a69 705f 6d6f 6465          zip_mode
+00016c50: 203d 206d 6f64 655b 305d 0d0a 2020 2020   = mode[0]..    
+00016c60: 2020 2020 7374 7265 616d 203d 2073 656c      stream = sel
+00016c70: 662e 726f 6f74 2e6f 7065 6e28 7365 6c66  f.root.open(self
+00016c80: 2e61 742c 207a 6970 5f6d 6f64 652c 2070  .at, zip_mode, p
+00016c90: 7764 3d70 7764 290d 0a20 2020 2020 2020  wd=pwd)..       
+00016ca0: 2069 6620 2262 2220 696e 206d 6f64 653a   if "b" in mode:
+00016cb0: 0d0a 2020 2020 2020 2020 2020 2020 6966  ..            if
+00016cc0: 2061 7267 7320 6f72 206b 7761 7267 733a   args or kwargs:
+00016cd0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00016ce0: 2020 7261 6973 6520 5661 6c75 6545 7272    raise ValueErr
+00016cf0: 6f72 2822 656e 636f 6469 6e67 2061 7267  or("encoding arg
+00016d00: 7320 696e 7661 6c69 6420 666f 7220 6269  s invalid for bi
+00016d10: 6e61 7279 206f 7065 7261 7469 6f6e 2229  nary operation")
+00016d20: 0d0a 2020 2020 2020 2020 2020 2020 7265  ..            re
+00016d30: 7475 726e 2073 7472 6561 6d0d 0a20 2020  turn stream..   
+00016d40: 2020 2020 2072 6574 7572 6e20 696f 2e54       return io.T
+00016d50: 6578 7449 4f57 7261 7070 6572 2873 7472  extIOWrapper(str
+00016d60: 6561 6d2c 202a 6172 6773 2c20 2a2a 6b77  eam, *args, **kw
+00016d70: 6172 6773 290d 0a0d 0a20 2020 2040 7072  args)....    @pr
+00016d80: 6f70 6572 7479 0d0a 2020 2020 6465 6620  operty..    def 
+00016d90: 6e61 6d65 2873 656c 6629 3a0d 0a20 2020  name(self):..   
+00016da0: 2020 2020 2072 6574 7572 6e20 706f 7369       return posi
+00016db0: 7870 6174 682e 6261 7365 6e61 6d65 2873  xpath.basename(s
+00016dc0: 656c 662e 6174 2e72 7374 7269 7028 222f  elf.at.rstrip("/
+00016dd0: 2229 290d 0a0d 0a20 2020 2064 6566 2072  "))....    def r
+00016de0: 6561 645f 7465 7874 2873 656c 662c 202a  ead_text(self, *
+00016df0: 6172 6773 2c20 2a2a 6b77 6172 6773 293a  args, **kwargs):
+00016e00: 0d0a 2020 2020 2020 2020 7769 7468 2073  ..        with s
+00016e10: 656c 662e 6f70 656e 2822 7222 2c20 2a61  elf.open("r", *a
+00016e20: 7267 732c 202a 2a6b 7761 7267 7329 2061  rgs, **kwargs) a
+00016e30: 7320 7374 726d 3a0d 0a20 2020 2020 2020  s strm:..       
+00016e40: 2020 2020 2072 6574 7572 6e20 7374 726d       return strm
+00016e50: 2e72 6561 6428 290d 0a0d 0a20 2020 2064  .read()....    d
+00016e60: 6566 2072 6561 645f 6279 7465 7328 7365  ef read_bytes(se
+00016e70: 6c66 293a 0d0a 2020 2020 2020 2020 7769  lf):..        wi
+00016e80: 7468 2073 656c 662e 6f70 656e 2822 7262  th self.open("rb
+00016e90: 2229 2061 7320 7374 726d 3a0d 0a20 2020  ") as strm:..   
+00016ea0: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+00016eb0: 7374 726d 2e72 6561 6428 290d 0a0d 0a20  strm.read().... 
+00016ec0: 2020 2064 6566 205f 6973 5f63 6869 6c64     def _is_child
+00016ed0: 2873 656c 662c 2070 6174 6829 3a0d 0a20  (self, path):.. 
+00016ee0: 2020 2020 2020 2072 6574 7572 6e20 706f         return po
+00016ef0: 7369 7870 6174 682e 6469 726e 616d 6528  sixpath.dirname(
+00016f00: 7061 7468 2e61 742e 7273 7472 6970 2822  path.at.rstrip("
+00016f10: 2f22 2929 203d 3d20 7365 6c66 2e61 742e  /")) == self.at.
+00016f20: 7273 7472 6970 2822 2f22 290d 0a0d 0a20  rstrip("/").... 
+00016f30: 2020 2064 6566 205f 6e65 7874 2873 656c     def _next(sel
+00016f40: 662c 2061 7429 3a0d 0a20 2020 2020 2020  f, at):..       
+00016f50: 2072 6574 7572 6e20 5061 7468 2873 656c   return Path(sel
+00016f60: 662e 726f 6f74 2c20 6174 290d 0a0d 0a20  f.root, at).... 
+00016f70: 2020 2064 6566 2069 735f 6469 7228 7365     def is_dir(se
+00016f80: 6c66 293a 0d0a 2020 2020 2020 2020 7265  lf):..        re
+00016f90: 7475 726e 206e 6f74 2073 656c 662e 6174  turn not self.at
+00016fa0: 206f 7220 7365 6c66 2e61 742e 656e 6473   or self.at.ends
+00016fb0: 7769 7468 2822 2f22 290d 0a0d 0a20 2020  with("/")....   
+00016fc0: 2064 6566 2069 735f 6669 6c65 2873 656c   def is_file(sel
+00016fd0: 6629 3a0d 0a20 2020 2020 2020 2072 6574  f):..        ret
+00016fe0: 7572 6e20 6e6f 7420 7365 6c66 2e69 735f  urn not self.is_
+00016ff0: 6469 7228 290d 0a0d 0a20 2020 2064 6566  dir()....    def
+00017000: 2065 7869 7374 7328 7365 6c66 293a 0d0a   exists(self):..
+00017010: 2020 2020 2020 2020 7265 7475 726e 2073          return s
+00017020: 656c 662e 6174 2069 6e20 7365 6c66 2e72  elf.at in self.r
+00017030: 6f6f 742e 5f6e 616d 655f 7365 7428 290d  oot._name_set().
+00017040: 0a0d 0a20 2020 2064 6566 2069 7465 7264  ...    def iterd
+00017050: 6972 2873 656c 6629 3a0d 0a20 2020 2020  ir(self):..     
+00017060: 2020 2069 6620 6e6f 7420 7365 6c66 2e69     if not self.i
+00017070: 735f 6469 7228 293a 0d0a 2020 2020 2020  s_dir():..      
+00017080: 2020 2020 2020 7261 6973 6520 5661 6c75        raise Valu
+00017090: 6545 7272 6f72 2822 4361 6e27 7420 6c69  eError("Can't li
+000170a0: 7374 6469 7220 6120 6669 6c65 2229 0d0a  stdir a file")..
+000170b0: 2020 2020 2020 2020 7375 6273 203d 206d          subs = m
+000170c0: 6170 2873 656c 662e 5f6e 6578 742c 2073  ap(self._next, s
+000170d0: 656c 662e 726f 6f74 2e6e 616d 656c 6973  elf.root.namelis
+000170e0: 7428 2929 0d0a 2020 2020 2020 2020 7265  t())..        re
+000170f0: 7475 726e 2066 696c 7465 7228 7365 6c66  turn filter(self
+00017100: 2e5f 6973 5f63 6869 6c64 2c20 7375 6273  ._is_child, subs
+00017110: 290d 0a0d 0a20 2020 2064 6566 205f 5f73  )....    def __s
+00017120: 7472 5f5f 2873 656c 6629 202d 3e20 7374  tr__(self) -> st
+00017130: 723a 0d0a 2020 2020 2020 2020 7265 7475  r:..        retu
+00017140: 726e 2070 6f73 6978 7061 7468 2e6a 6f69  rn posixpath.joi
+00017150: 6e28 7365 6c66 2e72 6f6f 742e 6669 6c65  n(self.root.file
+00017160: 6e61 6d65 2c20 7365 6c66 2e61 7429 0d0a  name, self.at)..
+00017170: 0d0a 2020 2020 6465 6620 5f5f 7265 7072  ..    def __repr
+00017180: 5f5f 2873 656c 6629 202d 3e20 7374 723a  __(self) -> str:
+00017190: 0d0a 2020 2020 2020 2020 7265 7475 726e  ..        return
+000171a0: 2073 656c 662e 5f5f 7265 7072 2e66 6f72   self.__repr.for
+000171b0: 6d61 7428 7365 6c66 3d73 656c 6629 0d0a  mat(self=self)..
+000171c0: 0d0a 2020 2020 6465 6620 6a6f 696e 7061  ..    def joinpa
+000171d0: 7468 2873 656c 662c 2061 6464 293a 0d0a  th(self, add):..
+000171e0: 2020 2020 2020 2020 6e65 7874 203d 2070          next = p
+000171f0: 6f73 6978 7061 7468 2e6a 6f69 6e28 7365  osixpath.join(se
+00017200: 6c66 2e61 742c 2061 6464 290d 0a20 2020  lf.at, add)..   
+00017210: 2020 2020 2072 6574 7572 6e20 7365 6c66       return self
+00017220: 2e5f 6e65 7874 2873 656c 662e 726f 6f74  ._next(self.root
+00017230: 2e72 6573 6f6c 7665 5f64 6972 286e 6578  .resolve_dir(nex
+00017240: 7429 290d 0a0d 0a20 2020 205f 5f74 7275  t))....    __tru
+00017250: 6564 6976 5f5f 203d 206a 6f69 6e70 6174  ediv__ = joinpat
+00017260: 680d 0a0d 0a20 2020 2040 7072 6f70 6572  h....    @proper
+00017270: 7479 0d0a 2020 2020 6465 6620 7061 7265  ty..    def pare
+00017280: 6e74 2873 656c 6629 3a0d 0a20 2020 2020  nt(self):..     
+00017290: 2020 2070 6172 656e 745f 6174 203d 2070     parent_at = p
+000172a0: 6f73 6978 7061 7468 2e64 6972 6e61 6d65  osixpath.dirname
+000172b0: 2873 656c 662e 6174 2e72 7374 7269 7028  (self.at.rstrip(
+000172c0: 222f 2229 290d 0a20 2020 2020 2020 2069  "/"))..        i
+000172d0: 6620 7061 7265 6e74 5f61 743a 0d0a 2020  f parent_at:..  
+000172e0: 2020 2020 2020 2020 2020 7061 7265 6e74            parent
+000172f0: 5f61 7420 2b3d 2022 2f22 0d0a 2020 2020  _at += "/"..    
+00017300: 2020 2020 7265 7475 726e 2073 656c 662e      return self.
+00017310: 5f6e 6578 7428 7061 7265 6e74 5f61 7429  _next(parent_at)
+00017320: 0d0a 0d0a 0d0a 6465 6620 6d61 696e 2861  ......def main(a
+00017330: 7267 733d 4e6f 6e65 293a 0d0a 2020 2020  rgs=None):..    
+00017340: 696d 706f 7274 2061 7267 7061 7273 650d  import argparse.
+00017350: 0a0d 0a20 2020 2064 6573 6372 6970 7469  ...    descripti
+00017360: 6f6e 203d 2022 4120 7369 6d70 6c65 2063  on = "A simple c
+00017370: 6f6d 6d61 6e64 2d6c 696e 6520 696e 7465  ommand-line inte
+00017380: 7266 6163 6520 666f 7220 7a69 7066 696c  rface for zipfil
+00017390: 6520 6d6f 6475 6c65 2e22 0d0a 2020 2020  e module."..    
+000173a0: 7061 7273 6572 203d 2061 7267 7061 7273  parser = argpars
+000173b0: 652e 4172 6775 6d65 6e74 5061 7273 6572  e.ArgumentParser
+000173c0: 2864 6573 6372 6970 7469 6f6e 3d64 6573  (description=des
+000173d0: 6372 6970 7469 6f6e 290d 0a20 2020 2067  cription)..    g
+000173e0: 726f 7570 203d 2070 6172 7365 722e 6164  roup = parser.ad
+000173f0: 645f 6d75 7475 616c 6c79 5f65 7863 6c75  d_mutually_exclu
+00017400: 7369 7665 5f67 726f 7570 2872 6571 7569  sive_group(requi
+00017410: 7265 643d 5472 7565 290d 0a20 2020 2067  red=True)..    g
+00017420: 726f 7570 2e61 6464 5f61 7267 756d 656e  roup.add_argumen
+00017430: 7428 0d0a 2020 2020 2020 2020 222d 6c22  t(..        "-l"
+00017440: 2c0d 0a20 2020 2020 2020 2022 2d2d 6c69  ,..        "--li
+00017450: 7374 222c 0d0a 2020 2020 2020 2020 6d65  st",..        me
+00017460: 7461 7661 723d 223c 7a69 7066 696c 653e  tavar="<zipfile>
+00017470: 222c 0d0a 2020 2020 2020 2020 6865 6c70  ",..        help
+00017480: 3d22 5368 6f77 206c 6973 7469 6e67 206f  ="Show listing o
+00017490: 6620 6120 7a69 7066 696c 6522 2c0d 0a20  f a zipfile",.. 
+000174a0: 2020 2029 0d0a 2020 2020 6772 6f75 702e     )..    group.
+000174b0: 6164 645f 6172 6775 6d65 6e74 280d 0a20  add_argument(.. 
+000174c0: 2020 2020 2020 2022 2d65 222c 0d0a 2020         "-e",..  
+000174d0: 2020 2020 2020 222d 2d65 7874 7261 6374        "--extract
+000174e0: 222c 0d0a 2020 2020 2020 2020 6e61 7267  ",..        narg
+000174f0: 733d 322c 0d0a 2020 2020 2020 2020 6d65  s=2,..        me
+00017500: 7461 7661 723d 2822 3c7a 6970 6669 6c65  tavar=("<zipfile
+00017510: 3e22 2c20 223c 6f75 7470 7574 5f64 6972  >", "<output_dir
+00017520: 3e22 292c 0d0a 2020 2020 2020 2020 6865  >"),..        he
+00017530: 6c70 3d22 4578 7472 6163 7420 7a69 7066  lp="Extract zipf
+00017540: 696c 6520 696e 746f 2074 6172 6765 7420  ile into target 
+00017550: 6469 7222 2c0d 0a20 2020 2029 0d0a 2020  dir",..    )..  
+00017560: 2020 6772 6f75 702e 6164 645f 6172 6775    group.add_argu
+00017570: 6d65 6e74 280d 0a20 2020 2020 2020 2022  ment(..        "
+00017580: 2d63 222c 0d0a 2020 2020 2020 2020 222d  -c",..        "-
+00017590: 2d63 7265 6174 6522 2c0d 0a20 2020 2020  -create",..     
+000175a0: 2020 206e 6172 6773 3d22 2b22 2c0d 0a20     nargs="+",.. 
+000175b0: 2020 2020 2020 206d 6574 6176 6172 3d28         metavar=(
+000175c0: 223c 6e61 6d65 3e22 2c20 223c 6669 6c65  "<name>", "<file
+000175d0: 3e22 292c 0d0a 2020 2020 2020 2020 6865  >"),..        he
+000175e0: 6c70 3d22 4372 6561 7465 207a 6970 6669  lp="Create zipfi
+000175f0: 6c65 2066 726f 6d20 736f 7572 6365 7322  le from sources"
+00017600: 2c0d 0a20 2020 2029 0d0a 2020 2020 6772  ,..    )..    gr
+00017610: 6f75 702e 6164 645f 6172 6775 6d65 6e74  oup.add_argument
+00017620: 280d 0a20 2020 2020 2020 2022 2d74 222c  (..        "-t",
+00017630: 0d0a 2020 2020 2020 2020 222d 2d74 6573  ..        "--tes
+00017640: 7422 2c0d 0a20 2020 2020 2020 206d 6574  t",..        met
+00017650: 6176 6172 3d22 3c7a 6970 6669 6c65 3e22  avar="<zipfile>"
+00017660: 2c0d 0a20 2020 2020 2020 2068 656c 703d  ,..        help=
+00017670: 2254 6573 7420 6966 2061 207a 6970 6669  "Test if a zipfi
+00017680: 6c65 2069 7320 7661 6c69 6422 2c0d 0a20  le is valid",.. 
+00017690: 2020 2029 0d0a 2020 2020 6172 6773 203d     )..    args =
+000176a0: 2070 6172 7365 722e 7061 7273 655f 6172   parser.parse_ar
+000176b0: 6773 2861 7267 7329 0d0a 0d0a 2020 2020  gs(args)....    
+000176c0: 6966 2061 7267 732e 7465 7374 2069 7320  if args.test is 
+000176d0: 6e6f 7420 4e6f 6e65 3a0d 0a20 2020 2020  not None:..     
+000176e0: 2020 2073 7263 203d 2061 7267 732e 7465     src = args.te
+000176f0: 7374 0d0a 2020 2020 2020 2020 7769 7468  st..        with
+00017700: 205a 6970 4669 6c65 2873 7263 2c20 2272   ZipFile(src, "r
+00017710: 2229 2061 7320 7a66 3a0d 0a20 2020 2020  ") as zf:..     
+00017720: 2020 2020 2020 2062 6164 6669 6c65 203d         badfile =
+00017730: 207a 662e 7465 7374 7a69 7028 290d 0a20   zf.testzip().. 
+00017740: 2020 2020 2020 2069 6620 6261 6466 696c         if badfil
+00017750: 653a 0d0a 2020 2020 2020 2020 2020 2020  e:..            
+00017760: 7072 696e 7428 0d0a 2020 2020 2020 2020  print(..        
+00017770: 2020 2020 2020 2020 2254 6865 2066 6f6c          "The fol
+00017780: 6c6f 7769 6e67 2065 6e63 6c6f 7365 6420  lowing enclosed 
+00017790: 6669 6c65 2069 7320 636f 7272 7570 7465  file is corrupte
+000177a0: 643a 207b 2172 7d22 2e66 6f72 6d61 7428  d: {!r}".format(
+000177b0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+000177c0: 2020 2020 2020 6261 6466 696c 652c 0d0a        badfile,..
+000177d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000177e0: 292c 0d0a 2020 2020 2020 2020 2020 2020  ),..            
+000177f0: 290d 0a20 2020 2020 2020 2070 7269 6e74  )..        print
+00017800: 2822 446f 6e65 2074 6573 7469 6e67 2229  ("Done testing")
+00017810: 0d0a 0d0a 2020 2020 656c 6966 2061 7267  ....    elif arg
+00017820: 732e 6c69 7374 2069 7320 6e6f 7420 4e6f  s.list is not No
+00017830: 6e65 3a0d 0a20 2020 2020 2020 2073 7263  ne:..        src
+00017840: 203d 2061 7267 732e 6c69 7374 0d0a 2020   = args.list..  
+00017850: 2020 2020 2020 7769 7468 205a 6970 4669        with ZipFi
+00017860: 6c65 2873 7263 2c20 2272 2229 2061 7320  le(src, "r") as 
+00017870: 7a66 3a0d 0a20 2020 2020 2020 2020 2020  zf:..           
+00017880: 207a 662e 7072 696e 7464 6972 2829 0d0a   zf.printdir()..
+00017890: 0d0a 2020 2020 656c 6966 2061 7267 732e  ..    elif args.
+000178a0: 6578 7472 6163 7420 6973 206e 6f74 204e  extract is not N
+000178b0: 6f6e 653a 0d0a 2020 2020 2020 2020 7372  one:..        sr
+000178c0: 632c 2063 7572 6469 7220 3d20 6172 6773  c, curdir = args
+000178d0: 2e65 7874 7261 6374 0d0a 2020 2020 2020  .extract..      
+000178e0: 2020 7769 7468 205a 6970 4669 6c65 2873    with ZipFile(s
+000178f0: 7263 2c20 2272 2229 2061 7320 7a66 3a0d  rc, "r") as zf:.
+00017900: 0a20 2020 2020 2020 2020 2020 207a 662e  .            zf.
+00017910: 6578 7472 6163 7461 6c6c 2863 7572 6469  extractall(curdi
+00017920: 7229 0d0a 0d0a 2020 2020 656c 6966 2061  r)....    elif a
+00017930: 7267 732e 6372 6561 7465 2069 7320 6e6f  rgs.create is no
+00017940: 7420 4e6f 6e65 3a0d 0a20 2020 2020 2020  t None:..       
+00017950: 207a 6970 5f6e 616d 6520 3d20 6172 6773   zip_name = args
+00017960: 2e63 7265 6174 652e 706f 7028 3029 0d0a  .create.pop(0)..
+00017970: 2020 2020 2020 2020 6669 6c65 7320 3d20          files = 
+00017980: 6172 6773 2e63 7265 6174 650d 0a0d 0a20  args.create.... 
+00017990: 2020 2020 2020 2064 6566 2061 6464 546f         def addTo
+000179a0: 5a69 7028 7a66 2c20 7061 7468 2c20 7a69  Zip(zf, path, zi
+000179b0: 7070 6174 6829 3a0d 0a20 2020 2020 2020  ppath):..       
+000179c0: 2020 2020 2069 6620 6f73 2e70 6174 682e       if os.path.
+000179d0: 6973 6669 6c65 2870 6174 6829 3a0d 0a20  isfile(path):.. 
+000179e0: 2020 2020 2020 2020 2020 2020 2020 207a                 z
+000179f0: 662e 7772 6974 6528 7061 7468 2c20 7a69  f.write(path, zi
+00017a00: 7070 6174 682c 205a 4950 5f44 4546 4c41  ppath, ZIP_DEFLA
+00017a10: 5445 4429 0d0a 2020 2020 2020 2020 2020  TED)..          
+00017a20: 2020 656c 6966 206f 732e 7061 7468 2e69    elif os.path.i
+00017a30: 7364 6972 2870 6174 6829 3a0d 0a20 2020  sdir(path):..   
+00017a40: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+00017a50: 7a69 7070 6174 683a 0d0a 2020 2020 2020  zippath:..      
+00017a60: 2020 2020 2020 2020 2020 2020 2020 7a66                zf
+00017a70: 2e77 7269 7465 2870 6174 682c 207a 6970  .write(path, zip
+00017a80: 7061 7468 290d 0a20 2020 2020 2020 2020  path)..         
+00017a90: 2020 2020 2020 2066 6f72 206e 6d20 696e         for nm in
+00017aa0: 2073 6f72 7465 6428 6f73 2e6c 6973 7464   sorted(os.listd
+00017ab0: 6972 2870 6174 6829 293a 0d0a 2020 2020  ir(path)):..    
+00017ac0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017ad0: 6164 6454 6f5a 6970 280d 0a20 2020 2020  addToZip(..     
+00017ae0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017af0: 2020 207a 662c 0d0a 2020 2020 2020 2020     zf,..        
+00017b00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017b10: 6f73 2e70 6174 682e 6a6f 696e 2870 6174  os.path.join(pat
+00017b20: 682c 206e 6d29 2c0d 0a20 2020 2020 2020  h, nm),..       
+00017b30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017b40: 206f 732e 7061 7468 2e6a 6f69 6e28 7a69   os.path.join(zi
+00017b50: 7070 6174 682c 206e 6d29 2c0d 0a20 2020  ppath, nm),..   
+00017b60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017b70: 2029 0d0a 2020 2020 2020 2020 2020 2020   )..            
+00017b80: 2320 656c 7365 3a20 6967 6e6f 7265 0d0a  # else: ignore..
+00017b90: 0d0a 2020 2020 2020 2020 7769 7468 205a  ..        with Z
+00017ba0: 6970 4669 6c65 287a 6970 5f6e 616d 652c  ipFile(zip_name,
+00017bb0: 2022 7722 2920 6173 207a 663a 0d0a 2020   "w") as zf:..  
+00017bc0: 2020 2020 2020 2020 2020 666f 7220 7061            for pa
+00017bd0: 7468 2069 6e20 6669 6c65 733a 0d0a 2020  th in files:..  
+00017be0: 2020 2020 2020 2020 2020 2020 2020 7a69                zi
+00017bf0: 7070 6174 6820 3d20 6f73 2e70 6174 682e  ppath = os.path.
+00017c00: 6261 7365 6e61 6d65 2870 6174 6829 0d0a  basename(path)..
+00017c10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017c20: 6966 206e 6f74 207a 6970 7061 7468 3a0d  if not zippath:.
+00017c30: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00017c40: 2020 2020 207a 6970 7061 7468 203d 206f       zippath = o
+00017c50: 732e 7061 7468 2e62 6173 656e 616d 6528  s.path.basename(
+00017c60: 6f73 2e70 6174 682e 6469 726e 616d 6528  os.path.dirname(
+00017c70: 7061 7468 2929 0d0a 2020 2020 2020 2020  path))..        
+00017c80: 2020 2020 2020 2020 6966 207a 6970 7061          if zippa
+00017c90: 7468 2069 6e20 2822 222c 206f 732e 6375  th in ("", os.cu
+00017ca0: 7264 6972 2c20 6f73 2e70 6172 6469 7229  rdir, os.pardir)
+00017cb0: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+00017cc0: 2020 2020 2020 207a 6970 7061 7468 203d         zippath =
+00017cd0: 2022 220d 0a20 2020 2020 2020 2020 2020   ""..           
+00017ce0: 2020 2020 2061 6464 546f 5a69 7028 7a66       addToZip(zf
+00017cf0: 2c20 7061 7468 2c20 7a69 7070 6174 6829  , path, zippath)
+00017d00: 0d0a 0d0a 0d0a 6966 205f 5f6e 616d 655f  ......if __name_
+00017d10: 5f20 3d3d 2022 5f5f 6d61 696e 5f5f 223a  _ == "__main__":
+00017d20: 0d0a 2020 2020 6d61 696e 2829 0d0a       ..    main()..
```

### Comparing `poetry_plugin_package_info-0.2.4/poetry_plugin_package_info/formatters/__init__.py` & `poetry_plugin_package_info-0.2.5/poetry_plugin_package_info/formatters/__init__.py`

 * *Files identical despite different names*

### Comparing `poetry_plugin_package_info-0.2.4/poetry_plugin_package_info/formatters/black.py` & `poetry_plugin_package_info-0.2.5/poetry_plugin_package_info/formatters/black.py`

 * *Files identical despite different names*

### Comparing `poetry_plugin_package_info-0.2.4/poetry_plugin_package_info/generators/__init__.py` & `poetry_plugin_package_info-0.2.5/poetry_plugin_package_info/generators/__init__.py`

 * *Files identical despite different names*

### Comparing `poetry_plugin_package_info-0.2.4/poetry_plugin_package_info/generators/git.py` & `poetry_plugin_package_info-0.2.5/poetry_plugin_package_info/generators/git.py`

 * *Files identical despite different names*

### Comparing `poetry_plugin_package_info-0.2.4/poetry_plugin_package_info/generators/project.py` & `poetry_plugin_package_info-0.2.5/poetry_plugin_package_info/generators/project.py`

 * *Files identical despite different names*

### Comparing `poetry_plugin_package_info-0.2.4/poetry_plugin_package_info/plugin.py` & `poetry_plugin_package_info-0.2.5/poetry_plugin_package_info/plugin.py`

 * *Files 1% similar despite different names*

```diff
@@ -13,15 +13,15 @@
 furnished to do so, subject to the following conditions:
 
 The above copyright notice and this permission notice shall be included in all
 copies or substantial portions of the Software.
 
 THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
-FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
+FITNESS FOR A PARTICULAR PURPOSE AND NON-INFRINGEMENT. IN NO EVENT SHALL THE
 AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 SOFTWARE.
 
 """
 import base64
@@ -30,15 +30,15 @@
 import io
 import tarfile
 import tempfile
 import traceback
 import typing
 from abc import ABC, abstractmethod
 from datetime import datetime
-from pathlib import Path
+from pathlib import Path, PurePath
 from types import NoneType, UnionType
 from typing import Any
 
 from cleo.commands.command import Command
 from cleo.events.console_event import ConsoleEvent
 from cleo.events.console_events import TERMINATE
 from cleo.events.console_terminate_event import ConsoleTerminateEvent
@@ -774,22 +774,23 @@
                 source_root = include.base
             else:
                 source_root = builder_instance._path  # noqa: SLF001
 
             if isinstance(include, PackageInclude):
                 include_path = source_root / include.package
             else:
-                out.write_line(
-                    f"""\
-[{Fore.BLUE}poetry-plugin-package-info{Fore.RESET}]: \
-{Fore.RED}ERROR: Plugin does not yet support {include.__class__} includes so
-will skip '{builder_instance.format}' dist.\
-""",
+                include_pattern = (
+                    f"{source_root!s}/{include._include}"  # noqa: SLF001]
                 )
-                return None
+                if PurePath(self.package_info_absolute_file_path).match(
+                    include_pattern,
+                ):
+                    include_path = self.package_info_absolute_file_path
+                else:
+                    continue
             if (
                 include_path.is_dir()
                 and include_path
                 in self.package_info_absolute_file_path.parents
             ) or (
                 not include_path.is_dir()
                 and include_path == self.package_info_absolute_file_path
@@ -819,39 +820,44 @@
         out: IO,
     ) -> None:
         """Handle and processing for the given builder type."""
         format_all = "all" in self.patch_build_formats
         if issubclass(builder_type, WheelBuilder) and (
             builder_type.format in self.patch_build_formats or format_all
         ):
-            builder_instance = builder_type(self.application.poetry)
+            builder_instance = WheelBuilder(self.application.poetry)
             package_info_file_dist_path = self._determine_package_info_path(
                 builder_instance,
                 out,
             )
             if package_info_file_dist_path is not None:
                 self.update_wheel(
                     Path(builder_instance.default_target_dir)
                     / builder_instance.wheel_filename,
+                    builder_instance.dist_info,
                     package_info_file_dist_path,
                     out,
                 )
         elif issubclass(builder_type, SdistBuilder) and (
             builder_type.format in self.patch_build_formats or format_all
         ):
-            builder_instance = builder_type(self.application.poetry)
+            builder_instance = SdistBuilder(self.application.poetry)
             dist_name = distribution_name(
                 self.application.poetry.package.name,
             )
             version = builder_instance._meta.version  # noqa: SLF001
             tar_file_name = f"{dist_name!s}-{version}.tar.gz"
-            package_info_file_dist_path = self._determine_package_info_path(
+            package_info_file_dist_path = Path(
+                f"{dist_name}-"
+                f"{builder_instance._meta.version}",  # noqa: SLF001
+            ) / self._determine_package_info_path(
                 builder_instance,
                 out,
             )
+
             if package_info_file_dist_path is not None:
                 self.update_sdist(
                     builder_instance.default_target_dir / tar_file_name,
                     package_info_file_dist_path,
                     out,
                 )
         elif format_all:
@@ -925,14 +931,15 @@
             traceback.print_exception(e, file=out)
             out.write_error_line(f"{Fore.RESET}")
             raise
 
     def update_wheel(
         self: "PackageInfoApplicationPlugin",
         wheel_file: Path,
+        dist_info_path: str,
         package_info_file_dist_path: Path,
         out: IO,
     ) -> None:
         """Update the wheel distribution with the package_info.py file."""
         with io.StringIO() as package_info_py_stream:
             self.write_package_info_py(package_info_py_stream)
             data = package_info_py_stream.getvalue()
@@ -941,17 +948,14 @@
             f"""\
 [{Fore.BLUE}poetry-plugin-package-info{Fore.RESET}]: Patching {Fore.GREEN}\
 {wheel_file.relative_to(self.pyproject_file_dir)!s}{Fore.RESET} with \
 {Fore.GREEN}{package_info_file_dist_path}{Fore.RESET}\
 """,
         )
 
-        distribution = distribution_name(self.application.poetry.package.name)
-        version = self.application.poetry.package.version
-        dist_info_path = f"{distribution}-{version}.dist-info"
         record_file_path = f"{dist_info_path}/RECORD"
 
         remove_existing_package_info = False
         with _zipfile.ZipFile(
             str(wheel_file),
             mode="r",
             compression=_zipfile.ZIP_DEFLATED,
```

### Comparing `poetry_plugin_package_info-0.2.4/pyproject.toml` & `poetry_plugin_package_info-0.2.5/pyproject.toml`

 * *Files 0% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 [tool.poetry]
 name = "poetry-plugin-package-info"
-version = "0.2.4"
+version = "0.2.5"
 description = "Plugin for poetry that creates/updates an package_info.py file with various details about the project/package."
 authors = ["Ben Ellis <ben.ellis@softweyr.co.uk>"]
 license = "MIT"
 readme = "README.md"
 packages = [{ include = "poetry_plugin_package_info" }]
 homepage = "https://github.com/bellis/poetry-plugin-package-info"
 documentation = "https://github.com/bellis/poetry-plugin-package-info"
```

### Comparing `poetry_plugin_package_info-0.2.4/PKG-INFO` & `poetry_plugin_package_info-0.2.5/PKG-INFO`

 * *Files 0% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 Metadata-Version: 2.1
 Name: poetry-plugin-package-info
-Version: 0.2.4
+Version: 0.2.5
 Summary: Plugin for poetry that creates/updates an package_info.py file with various details about the project/package.
 Home-page: https://github.com/bellis/poetry-plugin-package-info
 License: MIT
 Author: Ben Ellis
 Author-email: ben.ellis@softweyr.co.uk
 Requires-Python: >=3.7,<4.0
 Classifier: Development Status :: 3 - Alpha
```

### Comparing `poetry_plugin_package_info/package_info.py` & `poetry_plugin_package_info-0.2.5/poetry_plugin_package_info/package_info.py`

 * *Files 7% similar despite different names*

```diff
@@ -1,15 +1,15 @@
-"""Auto-generated by poetry-plugin-package-info at 2023-07-02T00:11:40."""
+"""Auto-generated by poetry-plugin-package-info at 2023-07-14T00:05:57."""
 import datetime
 
 
 class PackageInfo:
     project_name: str | None = "poetry-plugin-package-info"
     project_description: str | None = "Plugin for poetry that creates/updates an package_info.py file with various details about the project/package."
-    project_version: str | None = "0.2.4"
+    project_version: str | None = "0.2.5"
     project_authors: list[str] | None = ["Ben Ellis <ben.ellis@softweyr.co.uk>"]
     project_license: str | None = "MIT"
     project_classifiers: list[str] | None = [
         "Intended Audience :: Developers",
         "Intended Audience :: Information Technology",
         "Intended Audience :: System Administrators",
         "Operating System :: OS Independent",
@@ -36,21 +36,21 @@
     )
     project_repository: str | None = None
     project_homepage: str | None = (
         "https://github.com/bellis/poetry-plugin-package-info"
     )
     project_maintainers: list[str] | None = None
     project_keywords: list[str] | None = None
-    git_commit_id: str | None = "6a3a0f5a2d7cd0b56bb77a034cb2a4ad92f17c4f"
+    git_commit_id: str | None = "e03cb987e95108c4b6eb96a11338bde029345800"
     git_commit_author_name: str | None = "Ben Ellis"
     git_commit_author_email: str | None = "ben.ellis@softweyr.co.uk"
     git_commit_timestamp: datetime.datetime | None = datetime.datetime.fromisoformat(
-        "2023-07-02T01:09:35+01:00"
+        "2023-07-14T01:04:40+01:00"
     )
     git_branch_name: str | None = None
     git_branch_path: str | None = None
-    git_tags: list[str] | None = ["v0.2.4"]
+    git_tags: list[str] | None = ["v0.2.5"]
     git_is_dirty: bool | None = False
     git_is_dirty_excluding_untracked: bool | None = False
     git_has_staged_changes: bool | None = False
     git_has_unstaged_changes: bool | None = False
     git_has_untracked_changes: bool | None = False
```

