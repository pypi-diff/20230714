# Comparing `tmp/odoo14_addon_l10n_fr_account_vat_return-14.0.3.2.1.dev1-py3-none-any.whl.zip` & `tmp/odoo14_addon_l10n_fr_account_vat_return-14.0.4.0.0-py3-none-any.whl.zip`

## zipinfo {}

```diff
@@ -1,47 +1,47 @@
-Zip file size: 240530 bytes, number of entries: 45
--rw-r--r--  2.0 unx     3395 b- defN 23-Jun-01 05:15 odoo/addons/l10n_fr_account_vat_return/README.rst
--rw-r--r--  2.0 unx       43 b- defN 23-Jun-01 05:15 odoo/addons/l10n_fr_account_vat_return/__init__.py
--rw-r--r--  2.0 unx     1234 b- defN 23-Jun-01 05:15 odoo/addons/l10n_fr_account_vat_return/__manifest__.py
--rw-r--r--  2.0 unx     2693 b- defN 23-Jun-01 05:15 odoo/addons/l10n_fr_account_vat_return/data/account_fiscal_position_template.xml
--rw-r--r--  2.0 unx    69198 b- defN 23-Jun-01 05:15 odoo/addons/l10n_fr_account_vat_return/data/l10n.fr.account.vat.box.csv
--rw-r--r--  2.0 unx    91475 b- defN 23-Jun-01 05:15 odoo/addons/l10n_fr_account_vat_return/i18n/fr.po
--rw-r--r--  2.0 unx    77938 b- defN 23-Jun-01 05:15 odoo/addons/l10n_fr_account_vat_return/i18n/l10n_fr_account_vat_return.pot
--rw-r--r--  2.0 unx      822 b- defN 23-Jun-01 05:15 odoo/addons/l10n_fr_account_vat_return/migrations/0.0.0/pre-migration.py
--rw-r--r--  2.0 unx     2564 b- defN 23-Jun-01 05:15 odoo/addons/l10n_fr_account_vat_return/migrations/14.0.2.0.0/post-migrate.py
--rw-r--r--  2.0 unx      698 b- defN 23-Jun-01 05:15 odoo/addons/l10n_fr_account_vat_return/migrations/14.0.2.0.0/pre-migrate.py
--rw-r--r--  2.0 unx      266 b- defN 23-Jun-01 05:15 odoo/addons/l10n_fr_account_vat_return/models/__init__.py
--rw-r--r--  2.0 unx      636 b- defN 23-Jun-01 05:15 odoo/addons/l10n_fr_account_vat_return/models/account_account.py
--rw-r--r--  2.0 unx     1464 b- defN 23-Jun-01 05:15 odoo/addons/l10n_fr_account_vat_return/models/account_fiscal_position.py
--rw-r--r--  2.0 unx     2219 b- defN 23-Jun-01 05:15 odoo/addons/l10n_fr_account_vat_return/models/account_move.py
--rw-r--r--  2.0 unx      449 b- defN 23-Jun-01 05:15 odoo/addons/l10n_fr_account_vat_return/models/account_partial_reconcile.py
--rw-r--r--  2.0 unx     2104 b- defN 23-Jun-01 05:15 odoo/addons/l10n_fr_account_vat_return/models/account_tax.py
--rw-r--r--  2.0 unx    16524 b- defN 23-Jun-01 05:15 odoo/addons/l10n_fr_account_vat_return/models/l10n_fr_account_vat_box.py
--rw-r--r--  2.0 unx    94459 b- defN 23-Jun-01 05:15 odoo/addons/l10n_fr_account_vat_return/models/l10n_fr_account_vat_return.py
--rw-r--r--  2.0 unx    31165 b- defN 23-Jun-01 05:15 odoo/addons/l10n_fr_account_vat_return/models/res_company.py
--rw-r--r--  2.0 unx       50 b- defN 23-Jun-01 05:15 odoo/addons/l10n_fr_account_vat_return/readme/CONTRIBUTORS.rst
--rw-r--r--  2.0 unx      535 b- defN 23-Jun-01 05:15 odoo/addons/l10n_fr_account_vat_return/readme/DESCRIPTION.rst
--rw-r--r--  2.0 unx   135811 b- defN 23-Jun-01 05:15 odoo/addons/l10n_fr_account_vat_return/report/CA3_cerfa.pdf
--rw-r--r--  2.0 unx     1202 b- defN 23-Jun-01 05:15 odoo/addons/l10n_fr_account_vat_return/security/ir.model.access.csv
--rw-r--r--  2.0 unx      550 b- defN 23-Jun-01 05:15 odoo/addons/l10n_fr_account_vat_return/security/ir_rule.xml
--rw-r--r--  2.0 unx     9455 b- defN 23-Jun-01 05:15 odoo/addons/l10n_fr_account_vat_return/static/description/icon.png
--rw-r--r--  2.0 unx    12602 b- defN 23-Jun-01 05:15 odoo/addons/l10n_fr_account_vat_return/static/description/index.html
--rw-r--r--  2.0 unx       41 b- defN 23-Jun-01 05:15 odoo/addons/l10n_fr_account_vat_return/tests/__init__.py
--rw-r--r--  2.0 unx    15936 b- defN 23-Jun-01 05:15 odoo/addons/l10n_fr_account_vat_return/tests/test_fr_account_vat_return.py
--rw-r--r--  2.0 unx     1476 b- defN 23-Jun-01 05:15 odoo/addons/l10n_fr_account_vat_return/views/account_fiscal_position.xml
--rw-r--r--  2.0 unx     1252 b- defN 23-Jun-01 05:15 odoo/addons/l10n_fr_account_vat_return/views/account_fiscal_position_template.xml
--rw-r--r--  2.0 unx     1660 b- defN 23-Jun-01 05:15 odoo/addons/l10n_fr_account_vat_return/views/account_move.xml
--rw-r--r--  2.0 unx     1021 b- defN 23-Jun-01 05:15 odoo/addons/l10n_fr_account_vat_return/views/account_tax.xml
--rw-r--r--  2.0 unx    12043 b- defN 23-Jun-01 05:15 odoo/addons/l10n_fr_account_vat_return/views/l10n_fr_account_vat_box.xml
--rw-r--r--  2.0 unx    22852 b- defN 23-Jun-01 05:15 odoo/addons/l10n_fr_account_vat_return/views/l10n_fr_account_vat_return.xml
--rw-r--r--  2.0 unx      134 b- defN 23-Jun-01 05:15 odoo/addons/l10n_fr_account_vat_return/wizards/__init__.py
--rw-r--r--  2.0 unx     3466 b- defN 23-Jun-01 05:15 odoo/addons/l10n_fr_account_vat_return/wizards/l10n_fr_account_vat_return_reimbursement.py
--rw-r--r--  2.0 unx     2751 b- defN 23-Jun-01 05:15 odoo/addons/l10n_fr_account_vat_return/wizards/l10n_fr_account_vat_return_reimbursement_view.xml
--rw-r--r--  2.0 unx     3278 b- defN 23-Jun-01 05:15 odoo/addons/l10n_fr_account_vat_return/wizards/l10n_fr_vat_exigibility_update.py
--rw-r--r--  2.0 unx     1847 b- defN 23-Jun-01 05:15 odoo/addons/l10n_fr_account_vat_return/wizards/l10n_fr_vat_exigibility_update_view.xml
--rw-r--r--  2.0 unx     1690 b- defN 23-Jun-01 05:15 odoo/addons/l10n_fr_account_vat_return/wizards/res_config_settings.py
--rw-r--r--  2.0 unx     4143 b- defN 23-Jun-01 05:15 odoo/addons/l10n_fr_account_vat_return/wizards/res_config_settings.xml
--rw-r--r--  2.0 unx     4086 b- defN 23-Jun-01 05:15 odoo14_addon_l10n_fr_account_vat_return-14.0.3.2.1.dev1.dist-info/METADATA
--rw-r--r--  2.0 unx       92 b- defN 23-Jun-01 05:15 odoo14_addon_l10n_fr_account_vat_return-14.0.3.2.1.dev1.dist-info/WHEEL
--rw-r--r--  2.0 unx        5 b- defN 23-Jun-01 05:15 odoo14_addon_l10n_fr_account_vat_return-14.0.3.2.1.dev1.dist-info/top_level.txt
-?rw-rw-r--  2.0 unx     5587 b- defN 23-Jun-01 05:15 odoo14_addon_l10n_fr_account_vat_return-14.0.3.2.1.dev1.dist-info/RECORD
-45 files, 642911 bytes uncompressed, 230922 bytes compressed:  64.1%
+Zip file size: 240590 bytes, number of entries: 45
+-rw-r--r--  2.0 unx     3395 b- defN 23-Jul-14 15:37 odoo/addons/l10n_fr_account_vat_return/README.rst
+-rw-r--r--  2.0 unx       43 b- defN 23-Jul-14 15:37 odoo/addons/l10n_fr_account_vat_return/__init__.py
+-rw-r--r--  2.0 unx     1234 b- defN 23-Jul-14 15:37 odoo/addons/l10n_fr_account_vat_return/__manifest__.py
+-rw-r--r--  2.0 unx     2693 b- defN 23-Jul-14 15:37 odoo/addons/l10n_fr_account_vat_return/data/account_fiscal_position_template.xml
+-rw-r--r--  2.0 unx    69198 b- defN 23-Jul-14 15:37 odoo/addons/l10n_fr_account_vat_return/data/l10n.fr.account.vat.box.csv
+-rw-r--r--  2.0 unx    91475 b- defN 23-Jul-14 15:37 odoo/addons/l10n_fr_account_vat_return/i18n/fr.po
+-rw-r--r--  2.0 unx    78252 b- defN 23-Jul-14 15:37 odoo/addons/l10n_fr_account_vat_return/i18n/l10n_fr_account_vat_return.pot
+-rw-r--r--  2.0 unx      822 b- defN 23-Jul-14 15:37 odoo/addons/l10n_fr_account_vat_return/migrations/0.0.0/pre-migration.py
+-rw-r--r--  2.0 unx     2564 b- defN 23-Jul-14 15:37 odoo/addons/l10n_fr_account_vat_return/migrations/14.0.2.0.0/post-migrate.py
+-rw-r--r--  2.0 unx      698 b- defN 23-Jul-14 15:37 odoo/addons/l10n_fr_account_vat_return/migrations/14.0.2.0.0/pre-migrate.py
+-rw-r--r--  2.0 unx      266 b- defN 23-Jul-14 15:37 odoo/addons/l10n_fr_account_vat_return/models/__init__.py
+-rw-r--r--  2.0 unx      636 b- defN 23-Jul-14 15:37 odoo/addons/l10n_fr_account_vat_return/models/account_account.py
+-rw-r--r--  2.0 unx     1464 b- defN 23-Jul-14 15:37 odoo/addons/l10n_fr_account_vat_return/models/account_fiscal_position.py
+-rw-r--r--  2.0 unx     2219 b- defN 23-Jul-14 15:37 odoo/addons/l10n_fr_account_vat_return/models/account_move.py
+-rw-r--r--  2.0 unx      449 b- defN 23-Jul-14 15:37 odoo/addons/l10n_fr_account_vat_return/models/account_partial_reconcile.py
+-rw-r--r--  2.0 unx     2104 b- defN 23-Jul-14 15:37 odoo/addons/l10n_fr_account_vat_return/models/account_tax.py
+-rw-r--r--  2.0 unx    16524 b- defN 23-Jul-14 15:37 odoo/addons/l10n_fr_account_vat_return/models/l10n_fr_account_vat_box.py
+-rw-r--r--  2.0 unx    94211 b- defN 23-Jul-14 15:37 odoo/addons/l10n_fr_account_vat_return/models/l10n_fr_account_vat_return.py
+-rw-r--r--  2.0 unx    31165 b- defN 23-Jul-14 15:37 odoo/addons/l10n_fr_account_vat_return/models/res_company.py
+-rw-r--r--  2.0 unx       50 b- defN 23-Jul-14 15:37 odoo/addons/l10n_fr_account_vat_return/readme/CONTRIBUTORS.rst
+-rw-r--r--  2.0 unx      535 b- defN 23-Jul-14 15:37 odoo/addons/l10n_fr_account_vat_return/readme/DESCRIPTION.rst
+-rw-r--r--  2.0 unx   135811 b- defN 23-Jul-14 15:37 odoo/addons/l10n_fr_account_vat_return/report/CA3_cerfa.pdf
+-rw-r--r--  2.0 unx     1202 b- defN 23-Jul-14 15:37 odoo/addons/l10n_fr_account_vat_return/security/ir.model.access.csv
+-rw-r--r--  2.0 unx      550 b- defN 23-Jul-14 15:37 odoo/addons/l10n_fr_account_vat_return/security/ir_rule.xml
+-rw-r--r--  2.0 unx     9455 b- defN 23-Jul-14 15:37 odoo/addons/l10n_fr_account_vat_return/static/description/icon.png
+-rw-r--r--  2.0 unx    12602 b- defN 23-Jul-14 15:37 odoo/addons/l10n_fr_account_vat_return/static/description/index.html
+-rw-r--r--  2.0 unx       41 b- defN 23-Jul-14 15:37 odoo/addons/l10n_fr_account_vat_return/tests/__init__.py
+-rw-r--r--  2.0 unx    15936 b- defN 23-Jul-14 15:37 odoo/addons/l10n_fr_account_vat_return/tests/test_fr_account_vat_return.py
+-rw-r--r--  2.0 unx     1476 b- defN 23-Jul-14 15:37 odoo/addons/l10n_fr_account_vat_return/views/account_fiscal_position.xml
+-rw-r--r--  2.0 unx     1252 b- defN 23-Jul-14 15:37 odoo/addons/l10n_fr_account_vat_return/views/account_fiscal_position_template.xml
+-rw-r--r--  2.0 unx     1660 b- defN 23-Jul-14 15:37 odoo/addons/l10n_fr_account_vat_return/views/account_move.xml
+-rw-r--r--  2.0 unx     1021 b- defN 23-Jul-14 15:37 odoo/addons/l10n_fr_account_vat_return/views/account_tax.xml
+-rw-r--r--  2.0 unx    12043 b- defN 23-Jul-14 15:37 odoo/addons/l10n_fr_account_vat_return/views/l10n_fr_account_vat_box.xml
+-rw-r--r--  2.0 unx    22852 b- defN 23-Jul-14 15:37 odoo/addons/l10n_fr_account_vat_return/views/l10n_fr_account_vat_return.xml
+-rw-r--r--  2.0 unx      134 b- defN 23-Jul-14 15:37 odoo/addons/l10n_fr_account_vat_return/wizards/__init__.py
+-rw-r--r--  2.0 unx     3466 b- defN 23-Jul-14 15:37 odoo/addons/l10n_fr_account_vat_return/wizards/l10n_fr_account_vat_return_reimbursement.py
+-rw-r--r--  2.0 unx     2751 b- defN 23-Jul-14 15:37 odoo/addons/l10n_fr_account_vat_return/wizards/l10n_fr_account_vat_return_reimbursement_view.xml
+-rw-r--r--  2.0 unx     3278 b- defN 23-Jul-14 15:37 odoo/addons/l10n_fr_account_vat_return/wizards/l10n_fr_vat_exigibility_update.py
+-rw-r--r--  2.0 unx     1847 b- defN 23-Jul-14 15:37 odoo/addons/l10n_fr_account_vat_return/wizards/l10n_fr_vat_exigibility_update_view.xml
+-rw-r--r--  2.0 unx     1690 b- defN 23-Jul-14 15:37 odoo/addons/l10n_fr_account_vat_return/wizards/res_config_settings.py
+-rw-r--r--  2.0 unx     4143 b- defN 23-Jul-14 15:37 odoo/addons/l10n_fr_account_vat_return/wizards/res_config_settings.xml
+-rw-r--r--  2.0 unx     4081 b- defN 23-Jul-14 15:37 odoo14_addon_l10n_fr_account_vat_return-14.0.4.0.0.dist-info/METADATA
+-rw-r--r--  2.0 unx       92 b- defN 23-Jul-14 15:37 odoo14_addon_l10n_fr_account_vat_return-14.0.4.0.0.dist-info/WHEEL
+-rw-r--r--  2.0 unx        5 b- defN 23-Jul-14 15:37 odoo14_addon_l10n_fr_account_vat_return-14.0.4.0.0.dist-info/top_level.txt
+-rw-rw-r--  2.0 unx     5567 b- defN 23-Jul-14 15:37 odoo14_addon_l10n_fr_account_vat_return-14.0.4.0.0.dist-info/RECORD
+45 files, 642952 bytes uncompressed, 231022 bytes compressed:  64.1%
```

## zipnote {}

```diff
@@ -117,20 +117,20 @@
 
 Filename: odoo/addons/l10n_fr_account_vat_return/wizards/res_config_settings.py
 Comment: 
 
 Filename: odoo/addons/l10n_fr_account_vat_return/wizards/res_config_settings.xml
 Comment: 
 
-Filename: odoo14_addon_l10n_fr_account_vat_return-14.0.3.2.1.dev1.dist-info/METADATA
+Filename: odoo14_addon_l10n_fr_account_vat_return-14.0.4.0.0.dist-info/METADATA
 Comment: 
 
-Filename: odoo14_addon_l10n_fr_account_vat_return-14.0.3.2.1.dev1.dist-info/WHEEL
+Filename: odoo14_addon_l10n_fr_account_vat_return-14.0.4.0.0.dist-info/WHEEL
 Comment: 
 
-Filename: odoo14_addon_l10n_fr_account_vat_return-14.0.3.2.1.dev1.dist-info/top_level.txt
+Filename: odoo14_addon_l10n_fr_account_vat_return-14.0.4.0.0.dist-info/top_level.txt
 Comment: 
 
-Filename: odoo14_addon_l10n_fr_account_vat_return-14.0.3.2.1.dev1.dist-info/RECORD
+Filename: odoo14_addon_l10n_fr_account_vat_return-14.0.4.0.0.dist-info/RECORD
 Comment: 
 
 Zip file comment:
```

## odoo/addons/l10n_fr_account_vat_return/__manifest__.py

```diff
@@ -1,14 +1,14 @@
 # Copyright 2021 Akretion France (http://www.akretion.com/)
 # @author: Alexis de Lattre <alexis.delattre@akretion.com>
 # License AGPL-3.0 or later (http://www.gnu.org/licenses/agpl).
 
 {
     "name": "France VAT Return",
-    "version": "14.0.3.2.0",
+    "version": "14.0.4.0.0",
     "category": "Accounting",
     "license": "AGPL-3",
     "summary": "VAT return for France: CA3, CA12, 3519",
     "author": "Akretion,Odoo Community Association (OCA)",
     "maintainers": ["alexis-via"],
     "website": "https://github.com/OCA/l10n-france",
     "depends": ["l10n_fr", "l10n_fr_oca", "intrastat_base", "onchange_helper"],
```

## odoo/addons/l10n_fr_account_vat_return/i18n/l10n_fr_account_vat_return.pot

```diff
@@ -66,17 +66,16 @@
 msgid "Account"
 msgstr ""
 
 #. module: l10n_fr_account_vat_return
 #: code:addons/l10n_fr_account_vat_return/models/l10n_fr_account_vat_return.py:0
 #, python-format
 msgid ""
-"Account '%s' is a due VAT auto-liquidation account. So it should be empty at"
-" the start of the VAT period, but the balance on the last day of the "
-"previous period is %s."
+"Account '%s' is an account for autoliquidation, so it's reconcile option "
+"must be enabled."
 msgstr ""
 
 #. module: l10n_fr_account_vat_return
 #: code:addons/l10n_fr_account_vat_return/models/l10n_fr_account_vat_return.py:0
 #, python-format
 msgid "Account '%s' is present in the mapping of several fiscal positions."
 msgstr ""
@@ -1529,14 +1528,24 @@
 msgid ""
 "There are still On Payment taxes in company '%s'. To handle on payment VAT, "
 "this module uses a different implementation than the native solution based "
 "on a configuration parameter on taxes."
 msgstr ""
 
 #. module: l10n_fr_account_vat_return
+#: code:addons/l10n_fr_account_vat_return/models/l10n_fr_account_vat_return.py:0
+#, python-format
+msgid ""
+"There is a problem on the intracom vendor bill/refund '%s': check that the "
+"invoice lines have a single autoliquidation tax, and not the old dual-tax "
+"system for autoliquidation which was used by Odoo up to version 12.0 "
+"included."
+msgstr ""
+
+#. module: l10n_fr_account_vat_return
 #: model:ir.model.constraint,message:l10n_fr_account_vat_return.constraint_l10n_fr_account_vat_box_unique_page_x_y
 msgid "There is already a box at this position!"
 msgstr ""
 
 #. module: l10n_fr_account_vat_return
 #: code:addons/l10n_fr_account_vat_return/models/l10n_fr_account_vat_return.py:0
 #, python-format
```

## odoo/addons/l10n_fr_account_vat_return/models/l10n_fr_account_vat_return.py

```diff
@@ -276,28 +276,26 @@
         company_domain = [("company_id", "=", self.company_id.id)]
         base_domain = company_domain + [("parent_state", "=", "posted")]
         base_domain_period = base_domain + [
             ("date", ">=", self.start_date),
             ("date", "<=", self.end_date),
         ]
         base_domain_end = base_domain + [("date", "<=", self.end_date)]
-        base_domain_end_previous = base_domain + [("date", "<", self.start_date)]
         movetype2label = dict(
             self.env["account.move"].fields_get("move_type", "selection")["move_type"][
                 "selection"
             ]
         )
         speedy = {
             "company_id": self.company_id.id,
             "currency": self.company_id.currency_id,
             "company_domain": company_domain,
             "base_domain": base_domain,
             "base_domain_period": base_domain_period,
             "base_domain_end": base_domain_end,
-            "base_domain_end_previous": base_domain_end_previous,
             "end_date_formatted": format_date(self.env, self.end_date),
             "start_date_formatted": format_date(self.env, self.start_date),
             "movetype2label": movetype2label,
             "line_obj": self.env["l10n.fr.account.vat.return.line"],
             "log_obj": self.env["l10n.fr.account.vat.return.line.log"],
             "box_obj": self.env["l10n.fr.account.vat.box"],
             "aa_obj": self.env["account.account"],
@@ -930,14 +928,27 @@
                     )
                     % (
                         account.display_name,
                         rate_int / 100,
                         autoliq_vat_account2rate[account] / 100,
                     )
                 )
+            # Since May 2023, the new strategy to separate goods vs services
+            # for intracom autoliq base is by analyzing unreconciled lines,
+            # and not by analysing the VAT period only (which requires that the balance
+            # of the account is 0 at the start of the period).
+            # So the minimum is to make sure that the account has reconcile=True !
+            if not account.reconcile:
+                raise UserError(
+                    _(
+                        "Account '%s' is an account for autoliquidation, "
+                        "so it's reconcile option must be enabled."
+                    )
+                    % account.display_name
+                )
             autoliq_vat_account2rate[account] = rate_int
             autoliq_vat_accounts |= account
             tax_map = speedy["afpt_obj"].search(
                 [
                     ("tax_dest_id", "=", tax.id),
                     ("company_id", "=", speedy["company_id"]),
                 ],
@@ -963,39 +974,14 @@
     def _generate_due_vat_autoliq_vat_to_pay(
         self, speedy, autoliq_vat_account2rate, rate2logs
     ):
         # Generate autoliq logs for boxes 08, 09, 9A
         # For autoliq, we don't do VAT on payment, we do VAT on debit
         # Check that these autoliq due accounts 4452xx are empty at start of period
         for account, rate_int in autoliq_vat_account2rate.items():
-            # check start balance is empty at start of period
-            # This check is important because, for intracom autoliq,
-            # we analyse each invoice for the product/service ratio,
-            # so it won't work if the autoliq due account has a residual amount
-            # at start of period (and if we allow that, we get all sorts of problem:
-            # for example, when the intracom due account has a residual at start
-            # of period but there are no intracom autoliq invoice in the period, so
-            # our dicts rate2product_ratio are empty)
-            balance_end_previous_period = account._fr_vat_get_balance(
-                "base_domain_end_previous", speedy
-            )
-            if not speedy["currency"].is_zero(balance_end_previous_period):
-                raise UserError(
-                    _(
-                        "Account '%s' is a due VAT auto-liquidation account. "
-                        "So it should be empty at the start of the VAT period, "
-                        "but the balance on the last day of the previous period is %s."
-                    )
-                    % (
-                        account.display_name,
-                        format_amount(
-                            self.env, balance_end_previous_period, speedy["currency"]
-                        ),
-                    )
-                )
             balance = account._fr_vat_get_balance("base_domain_end", speedy) * -1
             if not speedy["currency"].is_zero(balance):
                 rate2logs[rate_int].append(
                     {
                         "account_id": account.id,
                         "compute_type": "balance",
                         "amount": balance,
@@ -1006,15 +992,15 @@
         self,
         speedy,
         autoliq_vat_account2rate,
         autoliq_taxedop_type2accounts,
         taxedop_type2logs,
     ):
         # Taxable operations - Autoliquidation Extra EU
-        # Box 3B: Achats de biens ou presta de services réalisés auprès d'un
+        # Box B4: Achats de biens ou presta de services réalisés auprès d'un
         # assujetti non établi en France (art 283-1 du CGI)
         for account in autoliq_taxedop_type2accounts["extracom"]:
             vat_amount = account._fr_vat_get_balance("base_domain_end", speedy) * -1
             if not speedy["currency"].is_zero(vat_amount):
                 rate_int = autoliq_vat_account2rate[account]
                 base = speedy["currency"].round(vat_amount * 10000 / rate_int)
                 taxedop_type2logs["autoliq_extracom"].append(
@@ -1124,16 +1110,17 @@
     ):
         rate2total = defaultdict(float)
         rate2product = defaultdict(float)
         autoliq_vat_move_lines = speedy["aml_obj"].search(
             [
                 ("account_id", "in", autoliq_taxedop_type2accounts["intracom_b2b"].ids),
                 ("balance", "!=", 0),
+                ("full_reconcile_id", "=", False),
             ]
-            + speedy["base_domain_period"]
+            + speedy["base_domain_end"]
         )
 
         autoliq_vat_moves = autoliq_vat_move_lines.move_id
         product_account_prefixes = self._get_product_account_prefixes()
         for move in autoliq_vat_moves:
             if move.move_type not in ("in_invoice", "in_refund"):
                 raise UserError(
@@ -1159,14 +1146,24 @@
                             line.product_id.type in ("product", "consu")
                             or line.product_id.is_accessory_cost
                         ):
                             rate2product[rate_int] += line.balance
                     else:
                         if line.account_id.code.startswith(product_account_prefixes):
                             rate2product[rate_int] += line.balance
+                else:
+                    raise UserError(
+                        _(
+                            "There is a problem on the intracom vendor bill/refund '%s': "
+                            "check that the invoice lines have a single autoliquidation "
+                            "tax, and not the old dual-tax system for autoliquidation "
+                            "which was used by Odoo up to version 12.0 included."
+                        )
+                        % move.display_name
+                    )
 
         rate2product_ratio = {}
         for rate_int, total in rate2total.items():
             productratio = 0
             if not speedy["currency"].is_zero(total):
                 productratio = round(100 * rate2product[rate_int] / total, 2)
             rate2product_ratio[rate_int] = productratio
```

## Comparing `odoo14_addon_l10n_fr_account_vat_return-14.0.3.2.1.dev1.dist-info/METADATA` & `odoo14_addon_l10n_fr_account_vat_return-14.0.4.0.0.dist-info/METADATA`

 * *Files 2% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 Metadata-Version: 2.1
 Name: odoo14-addon-l10n-fr-account-vat-return
-Version: 14.0.3.2.1.dev1
+Version: 14.0.4.0.0
 Summary: VAT return for France: CA3, CA12, 3519
 Home-page: https://github.com/OCA/l10n-france
 Author: Akretion,Odoo Community Association (OCA)
 Author-email: support@odoo-community.org
 License: AGPL-3
 Platform: UNKNOWN
 Classifier: Programming Language :: Python
```

## Comparing `odoo14_addon_l10n_fr_account_vat_return-14.0.3.2.1.dev1.dist-info/RECORD` & `odoo14_addon_l10n_fr_account_vat_return-14.0.4.0.0.dist-info/RECORD`

 * *Files 3% similar despite different names*

```diff
@@ -1,25 +1,25 @@
 odoo/addons/l10n_fr_account_vat_return/README.rst,sha256=QKkdVWvyOElF4Sgr560mX72sf1LNQ3JC6oGJZpC58Mk,3395
 odoo/addons/l10n_fr_account_vat_return/__init__.py,sha256=0XNpxETgFdVxFDEw03O8oL3NtTSk3we-HEZW2sPKzIU,43
-odoo/addons/l10n_fr_account_vat_return/__manifest__.py,sha256=bKfq0X0uMqAjiipz29eH8V6rbYH43EvsWNCwWvUSimI,1234
+odoo/addons/l10n_fr_account_vat_return/__manifest__.py,sha256=VzpEVHHtPLGL_6Ht1QGrtqt3lWx46tikpcTgPZpvI9I,1234
 odoo/addons/l10n_fr_account_vat_return/data/account_fiscal_position_template.xml,sha256=r3yQNGRR1MpQmO0t3pfxJhMkt79Cf0nosUpdseNUyYU,2693
 odoo/addons/l10n_fr_account_vat_return/data/l10n.fr.account.vat.box.csv,sha256=9oDlrvbJ_zkqVRgXhPXkWB5cErmMxSxXE5DZHFoZVZc,69198
 odoo/addons/l10n_fr_account_vat_return/i18n/fr.po,sha256=JuaZK6EpeP6RRV1zVrcApBFNKcSuE6DISsbtlAGvTNE,91475
-odoo/addons/l10n_fr_account_vat_return/i18n/l10n_fr_account_vat_return.pot,sha256=GAShW4LTzyQAGuW8DB7WyiXTDK73uUSkljvJgZgT2hI,77938
+odoo/addons/l10n_fr_account_vat_return/i18n/l10n_fr_account_vat_return.pot,sha256=umc8CEXKSK7p4LjrLopfebA6zQT9OaJjiqLO15-5zi4,78252
 odoo/addons/l10n_fr_account_vat_return/migrations/0.0.0/pre-migration.py,sha256=Ea90G0tG2Bhpzs6GwR3uRsPF0_gOtJHdM0gWRa-wXN4,822
 odoo/addons/l10n_fr_account_vat_return/migrations/14.0.2.0.0/post-migrate.py,sha256=wqthHv5WFZfr7w7GGFyDDioD72UOlZp9h9ak-9fo134,2564
 odoo/addons/l10n_fr_account_vat_return/migrations/14.0.2.0.0/pre-migrate.py,sha256=AZRLwQQitsWsCiJErHE9MxPyhtb_iNqb-RXMJqnP39w,698
 odoo/addons/l10n_fr_account_vat_return/models/__init__.py,sha256=u35W9qwjcJkmA6A2mzP7AcmugAVPOF3rZnFYYE_9ZUA,266
 odoo/addons/l10n_fr_account_vat_return/models/account_account.py,sha256=4d6-atQKBiOeLFUj029MCM1nO4mAeFmQIeNaUo1oUGw,636
 odoo/addons/l10n_fr_account_vat_return/models/account_fiscal_position.py,sha256=E8qx9tfGFm0sCyPT0PlSOeo3i0q64Cs5x4u9Duvn-NE,1464
 odoo/addons/l10n_fr_account_vat_return/models/account_move.py,sha256=us8d3uAA_fKc4IUV2VgCJYyvz97f_t9prhnyn-WDxkA,2219
 odoo/addons/l10n_fr_account_vat_return/models/account_partial_reconcile.py,sha256=KPuANP3JLwE3zSVoer9iCm_i23_CGlnhWlAgN_90NAA,449
 odoo/addons/l10n_fr_account_vat_return/models/account_tax.py,sha256=CWuNo3uFox2rogKNQ5m1upGiumUbOOEk_c5eHIACwqk,2104
 odoo/addons/l10n_fr_account_vat_return/models/l10n_fr_account_vat_box.py,sha256=yp5lvBUhclD91MNRvprhesUdRk0B1ACQImyK-eBG-tU,16524
-odoo/addons/l10n_fr_account_vat_return/models/l10n_fr_account_vat_return.py,sha256=k386mN0fpjFo7TFPnT4iyPXBYgoE0hJcUd9SQ2BYA-g,94459
+odoo/addons/l10n_fr_account_vat_return/models/l10n_fr_account_vat_return.py,sha256=RHmaMNiLTwgiF9H7nd_YrJwp1pIlMjFkgvYnXzD7YEg,94211
 odoo/addons/l10n_fr_account_vat_return/models/res_company.py,sha256=ewXXAJBZW35eZx81EgHSvubWatRCcSBC-Qvn83JYWoc,31165
 odoo/addons/l10n_fr_account_vat_return/readme/CONTRIBUTORS.rst,sha256=e8dOgio6UxRss1tsAaHVr97hi-hjTfI5ouj7XQ1JHGE,50
 odoo/addons/l10n_fr_account_vat_return/readme/DESCRIPTION.rst,sha256=jeGrR7518IHyslhMIU_Z9FcxS2VoLj6SAgxEmnfFyVk,535
 odoo/addons/l10n_fr_account_vat_return/report/CA3_cerfa.pdf,sha256=JHWvXMQSFNNee5iqJfax4zEkz5G7MdmdSjK0Mq8U19g,135811
 odoo/addons/l10n_fr_account_vat_return/security/ir.model.access.csv,sha256=j138judK-zT9J3LDedvSKALjsMmNzYtRVuAstOQvxhg,1202
 odoo/addons/l10n_fr_account_vat_return/security/ir_rule.xml,sha256=g2eieOIBwW6AmcKfPsj2FOt14NPTS5hJB-dWZbHjgVQ,550
 odoo/addons/l10n_fr_account_vat_return/static/description/icon.png,sha256=6xBPJauaFOF0KDHfHgQopSc28kKvxMaeoQFQWZtfZDo,9455
@@ -35,11 +35,11 @@
 odoo/addons/l10n_fr_account_vat_return/wizards/__init__.py,sha256=zG45x0O-rZf0Q-bkOLiyBZ_4TqCd9M9CdLad6bQYKPU,134
 odoo/addons/l10n_fr_account_vat_return/wizards/l10n_fr_account_vat_return_reimbursement.py,sha256=7Ss638IWrgwgDz92Ny5bMOPoN1u5PejXbz8LLJDenj4,3466
 odoo/addons/l10n_fr_account_vat_return/wizards/l10n_fr_account_vat_return_reimbursement_view.xml,sha256=d_66GLBpF3S99mNsneiFvdRRHrd87bNWuA3LLuOYXdE,2751
 odoo/addons/l10n_fr_account_vat_return/wizards/l10n_fr_vat_exigibility_update.py,sha256=mEj1U8krLYyKmaOCIHrYJGzyE488slNHtEopxG00pFc,3278
 odoo/addons/l10n_fr_account_vat_return/wizards/l10n_fr_vat_exigibility_update_view.xml,sha256=E_gA30-NU9X2mGbhffeLko88BkvFSbTXyzk7Ee7Eifc,1847
 odoo/addons/l10n_fr_account_vat_return/wizards/res_config_settings.py,sha256=IuXpodEp1zlMzcx4zUxfnruVossbV_EMnJVig81Upds,1690
 odoo/addons/l10n_fr_account_vat_return/wizards/res_config_settings.xml,sha256=cVmCh0SeqD3PFpR8oBbsHuzVdm7-nipnNGxtFZ_mxDg,4143
-odoo14_addon_l10n_fr_account_vat_return-14.0.3.2.1.dev1.dist-info/METADATA,sha256=MBFLqtpcokRnTYtfHpu4LRRhXbZU_2JvQGCwd5K54No,4086
-odoo14_addon_l10n_fr_account_vat_return-14.0.3.2.1.dev1.dist-info/WHEEL,sha256=2wepM1nk4DS4eFpYrW1TTqPcoGNfHhhO_i5m4cOimbo,92
-odoo14_addon_l10n_fr_account_vat_return-14.0.3.2.1.dev1.dist-info/top_level.txt,sha256=qBj40grFkGOfDZ2WDSw3y1RnDlgG0u8rP8pvGNdbz4w,5
-odoo14_addon_l10n_fr_account_vat_return-14.0.3.2.1.dev1.dist-info/RECORD,,
+odoo14_addon_l10n_fr_account_vat_return-14.0.4.0.0.dist-info/METADATA,sha256=w20XLKBc-z7xhtydAeHVT78nWZJf-QXDmrt36v5jjjM,4081
+odoo14_addon_l10n_fr_account_vat_return-14.0.4.0.0.dist-info/WHEEL,sha256=pkctZYzUS4AYVn6dJ-7367OJZivF2e8RA9b_ZBjif18,92
+odoo14_addon_l10n_fr_account_vat_return-14.0.4.0.0.dist-info/top_level.txt,sha256=qBj40grFkGOfDZ2WDSw3y1RnDlgG0u8rP8pvGNdbz4w,5
+odoo14_addon_l10n_fr_account_vat_return-14.0.4.0.0.dist-info/RECORD,,
```

